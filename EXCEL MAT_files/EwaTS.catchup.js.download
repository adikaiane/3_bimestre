'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[10],{1337:function(y,r,a){a.d(r,"a",function(){return f});y=a(0);var c=a(136);r=a(1099);var b=a(952);class f extends r.a{constructor(k,x){super(k,x);x!==b.a.sH&&this.pH(x);this.SS(f.iterateNext);this.SS(f.KIa);this.SS(f.fgb);this.SS(f.saveACopy);this.bSa(c.a.b8a);this.bSa(c.a.c8a);this.bSa(c.a.g1);this.bSa("App_EwrWorkbookNotSupportedCancelResponse")}}f.iterateNext="IterateNext";f.KIa="IteratePrevious";f.fgb="DownloadVersion";
f.saveACopy="SaveACopy";f.w9b="ToggleShowChanges";f.setCurrentChangeCount="SetCurrentChangeCount";f.setTotalChangesCount="SetTotalChangesCount";f.u2a="OnVHDiffReady";Object(y.a)(f,"VersionHistoryMessenger",r.a,[])},1447:function(y,r,a){a.r(r);a.d(r,"VersionHistoryHighlightManager",function(){return fa});y=a(133);r=a(0);var c=a(15),b=a(78),f=a(974),k=a(154),x=a(10),d=a(74),h=a(44),n=a(213),m=a(327),u=a(255),l=a(1),t=a(12),e=a(117),w=a(13),z=a(266),E=a(25),M=a(397);class G{constructor(la,ba,aa){this.$Ra=
la;this.Lk=ba;this.aBe=aa}}Object(r.a)(G,"UserActivityLocation",null,[]);var A=a(1337),N=a(61),K=a(952),I=a(67),L=a(76),J=a(45),B=a(287),Y=a(8),U=a(693),O=a(694),C=a(283),X=a(83),S=a(98),ea=a(36),Oa=a(5),Ha=a(65),Za;let fa=Za=class{constructor(la,ba,aa,oa){oa=void 0===oa?!0:oa;this.authorColor=this.Daa=this.Ona=null;this.rmb=!1;this.PKb=-1;this.eAd=0;this.fVa=100;this.L2=-1;this.ABe=null;this.fHb=x.a.pjl;this.mLb=x.a.qjl;this.pCk="&versionHistorySaveACopy=1";this.IOi=()=>({DisplayName:x.a.rjl,Email:null,
Id:null,Provider:null});this.Zi=Na=>{(Na=u.a(Na)?null:Na.Result)?Na.OperationWaitingForFileDownload?20>this.eAd?(this.fVa*=2,I.Task.delay(this.fVa).continueWith(()=>{this.xye()})):(this.a3c(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):Na.ActivityList?(this.initialize(Na.ActivityList,Na.VersionAuthors),this.u2a(),this.ABe.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.ABe.Kc.toString()}`)):
(this.a3c(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.fVa*=2,I.Task.delay(this.fVa).continueWith(()=>{this.xye()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.Ila=()=>{this.a3c();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.s1b=Na=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.PostMessageHandler called with MessageID:${Na.MessageId}`);
switch(Na.MessageId){case A.a.iterateNext:this.iterateNext();this.L2=(this.L2+1)%this.v4.length;this.Btb(A.a.setCurrentChangeCount,this.L2+1);break;case A.a.KIa:this.KIa();this.L2=0>this.L2?0:this.L2;this.L2=(this.L2+this.v4.length-1)%this.v4.length;this.Btb(A.a.setCurrentChangeCount,this.L2+1);break;case A.a.fgb:this.Bji();break;case A.a.w9b:this.uZc(Na.Values.ToggleValue);break;case A.a.saveACopy:this.oCk()}};this.m1h=(Na,Ia)=>this.dxd(Na.Lk,Ia.Lk);this.Zp=()=>{this.uBd()};this.Nh=()=>{this.uBd()};
c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=la;this.ariaLiveNotifier=aa;this.da=E.f(this.$);this.da.KJ(this.Zp);this.da.Rb.Jp(this.Nh);this.ydl();oa&&(this.ABe=la.Vb.Uc("UserAction","VersionHistoryDiffManagerStopWatch"),this.xye());if(this.yq=ba)la=b.a.getOrigin(this.$.ta.VersionHistoryActionUrl)||K.a.sH,la!==K.a.sH&&this.yq.pH(la),this.yq.nl(A.a.iterateNext),this.yq.nl(A.a.KIa),this.yq.nl(A.a.w9b),this.yq.nl(A.a.fgb),this.yq.ik(A.a.fgb,this.s1b),this.yq.nl(A.a.saveACopy),
this.yq.ik(A.a.saveACopy,this.s1b),this.yq.ik(A.a.iterateNext,this.s1b),this.yq.ik(A.a.KIa,this.s1b),this.yq.ik(A.a.w9b,this.s1b)}get pxb(){return this.Daa}get t5b(){return-1===this.PKb?null:this.v4[this.PKb]}get v4(){this.rmb||(this.Ona.sort(this.m1h),this.rmb=!0);return this.Ona}dispose(){this.S3a();this.Ona=this.Daa=null;this.da&&(this.da.xL(this.Zp),this.da.Rb&&this.da.Rb.zp(this.Nh),this.yq&&(this.yq.YL(A.a.KIa),this.yq.YL(A.a.iterateNext),this.yq.YL(A.a.w9b),this.yq.YL(A.a.fgb),this.yq.YL(A.a.saveACopy)))}initialize(la,
ba){la?(this.S3a(),this.PKb=-1,this.Ona=[],this.rmb=!1,this.Daa={},this.authorColor={},this.HJj(ba),this.Pzd(la)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}xye(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.eAd.toString()} --${this.fVa.toString()}`);this.eAd++;this.$.userOperationManager.enqueueOperation(new n.a(537,0,(la,ba,aa)=>{var oa=this.$.ma.sa;la=z.c(la,
this.Zi);ba=z.b(ba,this.Ila);const Na=oa.$a(1,null);return N.h(oa,"GetVersionHistoryHighlightActivitiesData",Na,la,ba,aa,null,4)},80),null)}uZc(la){const ba=this.Daa;for(const oa in ba){var aa=oa;const Na=ba[oa];Na?Na.s7b(la):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+aa+"view was Null")}}S3a(){const la=this.Daa;for(const aa in la){var ba=aa;const oa=la[aa];oa?oa.Rhe():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+
ba+"view was Null")}this.Ona=this.Daa=null}wOg(la){la=la?this.hWi(this.L2):this.xYi(this.L2);const ba=this.v4[la];c.ULS.shipAssertTag(537150402,0,!!ba,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.uBd();if(ba.$Ra.toString()in this.Daa){this.Daa[ba.$Ra.toString()].gFk(ba.Lk);var aa=h.I(ba.Lk);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(w.a.instance.Ib(158),la+1,this.v4.length,
aa.Gz(!1),ba.aBe.DisplayName));this.PKb=la}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${ba.$Ra.toString()} view not present in views dictionary`)}oCk(){if(this.$.fa.yc)c.ULS.sendTraceTag(508601793,0,50,"VersionHistoryHighlightManager.saveACopyHelper started saveACopy operation using downloadACopy url"),l.EwaSettings.isChangeGateEnabled("OfficeVSO:8827948_editWithoutLogin")?this.lme():void Ha.a.resolve(Oa.OpenInExcelService,{xa:0}).then(la=>
{this.jfi(la)});else{c.ULS.sendTraceTag(508601794,0,50,"VersionHistoryHighlightManager.saveACopyHelper: saveACopy not allowed in expired session");const la=ea.a.Azd();J.a(this.$).Dt(new C.a(Y.a.xy,5,()=>{const ba=L.a(this.$);ba.Kd.activityState[B.a.Tq]=Y.a.accessTokenExpiringWarning;ba.Kd.Yt([la])}))}}lme(){let la;this.$.Fe.get(51)?(c.ULS.sendTraceTag(508601792,0,50,"VersionHistoryHighlightManager: saveACopyHelper for ODConsumer Called"),la=new X.a(-309686558,0,this.$.xc,0,null)):la=new X.a(-1244760097,
0,this.$.xc,0,null);S.c(1604651619,!0);this.$.Ia.Gb(la,{["AddFileDownloadUrl"]:!0})}jfi(la){la=la.noc(-1804063550);la+=this.pCk;var ba=new URLSearchParams(la.split("?")[1]);if(ba.has("id")){let aa=this.e3b(ba.get("id"),"access_token");aa=this.e3b(aa,"access_token_ttl");ba.set("id",aa);la=la.split("?")[0]+"?"+ba.toString()}this.$.Fe.get(51)?(c.ULS.sendTraceTag(507330977,0,50,"VersionHistoryHighlightManager: saveACopyHelper for ODConsumer Called"),ba=new X.a(-309686558,0,this.$.xc,0,null)):ba=new X.a(-1244760097,
0,this.$.xc,0,null);S.c(1604651619,!0);this.$.Ia.Gb(ba,{["FileDownloadUrl"]:la})}e3b(la,ba){la=new URLSearchParams(la);la.has(ba)&&la.delete(ba);return la.toString()}Bji(){c.ULS.sendTraceTag(508703947,0,50,"VersionHistoryHighlightManager.downloadVersionHelper started version download using downloadACopy command");this.$.fa.$b.hasUnsupportedFeaturesForEdit&&c.ULS.sendTraceTag(508687379,0,50,"VersionHistoryHighlightManager.downloadVersionHelper: The selected version for download has hasUnsupportedFeaturesForEdit.");
J.a(this.$).Dt(new C.a(Y.a.xy,5,()=>{this.$.sL(!1);const la=L.a(this.$).Kd.activityState;la[B.a.Tq]=Y.a.zCd;la[U.a.VEb]=this.$.fa.$b.hasUnsupportedFeaturesForEdit;la[O.a.lkc]=-1804063550}));S.c(1316171850,!0)}Btb(la,ba){if(l.EwaSettings.Ra(279))if(this.yq){var aa={};aa.count=ba;la=new f.a(la);la.Values=aa;this.yq.send(la)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}hWi(la){return(la+
1)%this.v4.length}xYi(la){-1===la&&(la=0);return la=(la+this.v4.length-1)%this.v4.length}Pzd(la){this.qbi(la);this.rzd();null!=this.v4&&0<this.v4.length&&(this.iterateNext(),this.L2=(this.L2+1)%this.v4.length)}h4i(la,ba){const aa=[];if(!la.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),aa;for(const oa of la.RangeList)oa&&this.$.qa.Bl(oa.SheetName)?this.$.qa.getItemByName(oa.SheetName).visible&&
(la=new G(0,oa,ba),aa.push(la)):c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name");return aa}qbi(la){for(const ba of la)if(!ba||m.a(ba.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const aa of ba.LocationList)if(aa)switch(aa.Type){case 0:this.Ona.push(...this.h4i(aa,ba.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}rzd(){var la=
{};const ba=[];for(const aa of this.Ona){if(0!==aa.$Ra)continue;const oa=new M.a(h.I(aa.Lk),d.d(this.$.qa.getItemByName(aa.Lk.SheetName))),Na=Za.uYc(oa);Na in la||ba.push(oa);la[Na]=this.vMi(aa.aBe);la[Na]===this.mLb&&this.agl(aa)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.Ona.length}, Highlightable activities: ${ba.length},Total userlist in activities : ${this.Ona.length}, Total userlist from pane: ${ba.length} `);this.a3c();
0<ba.length&&(la=new (a(1625).RangeVersionHistoryHighlightView)(this.$,ba,la,this.fHb),this.Daa["0"]=la)}agl(la){la.aBe=this.IOi()}a3c(){const la=this.Ona?this.v4.length:0;0<la?this.Btb(A.a.setCurrentChangeCount,1):this.Btb(A.a.setCurrentChangeCount,0);this.Btb(A.a.setTotalChangesCount,la)}u2a(){this.Btb(A.a.u2a,0)}HJj(la){if(la)for(let Na=0;Na<la.length;++Na)if(la[Na].InitialsColor){var ba=la[Na].EmailAddress;var aa=la[Na].UserName;var oa=null;if(la[Na].LoginName){const Ia=la[Na].LoginName.split("|");
3===Ia.length&&(oa=Ia[2])}oa?this.authorColor[oa]=la[Na].InitialsColor:ba?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[ba]=la[Na].InitialsColor):aa?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[aa]=la[Na].InitialsColor):c.ULS.sendTraceTag(537150359,0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150362,
0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}ydl(){if(this.$.ta.VersionHistoryHighlightsSettings){var la=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ta.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ta.VersionHistoryHighlightsSettings):null;for(let aa=
0;aa<la.length;aa++){var ba=la[aa];const oa=ba.key?ba.key:ba.Key?ba.Key:"";ba=ba.value?ba.value:ba.Value?ba.Value:"";"DefaultColor"===oa?this.mLb=ba:"InitialTint"===oa?this.fHb=Za.x9j:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}vMi(la){if(la.Email in this.authorColor)return this.authorColor[la.Email];
if(la.DisplayName in this.authorColor)return this.authorColor[la.DisplayName];c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.mLb}dxd(la,ba){var aa=Object(k.a)(e.a,this.$.qa.getItemByName(la.SheetName));const oa=Object(k.a)(e.a,this.$.qa.getItemByName(ba.SheetName));return aa&&oa?(aa=(aa=t.HelperMethods.gO(aa.index,oa.index))||t.HelperMethods.gO(la.FirstRow,ba.FirstRow))||t.HelperMethods.gO(la.FirstColumn,
ba.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),0)}uBd(){if(this.t5b){if(!(this.t5b.$Ra.toString()in this.Daa)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.t5b.$Ra.toString()} view not present in views dictionary`);return}this.Daa[this.t5b.$Ra.toString()].tfi(this.t5b.Lk)}this.PKb=-1}iterateNext(){this.wOg(!0)}KIa(){this.wOg(!1)}static uYc(la){return`${la.range}${la.sheetId}`}};
fa.x9j="0.0";fa=Za=Object(y.__decorate)([Object(Ha.d)(Oa.VersionHistoryHighlightManagerService),Object(y.__param)(0,Object(Oa.EwaControlService)()),Object(y.__param)(1,Object(Oa.HostMessengerService)()),Object(y.__param)(2,Object(Oa.AriaLiveNotifierService)())],fa);Object(r.a)(fa,"VersionHistoryHighlightManager",null,[335,4])},1538:function(y,r,a){r=a(490);a=a(1539);a=a.Di?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);r(a,{insert:"head",Oj:!1});y.exports=a.Fk||{}},1539:function(y,r,a){r=a(489)(!1);
r.push([y.i,".ewa-vhr-rectinnerborder{position:absolute;top:0;bottom:0;left:0;right:0;border:1px solid #fff;pointer-events:none}",""]);y.exports=r},1540:function(y,r,a){r=a(490);a=a(1541);a=a.Di?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);r(a,{insert:"head",Oj:!1});y.exports=a.Fk||{}},1541:function(y,r,a){r=a(489)(!1);r.push([y.i,'.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:700;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}.LineageActivityPaneBody{height:100%;padding-left:16px;overflow:hidden;background-color:#f5f5f5}',
""]);y.exports=r},1542:function(y,r,a){r=a(490);a=a(1543);a=a.Di?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);r(a,{insert:"head",Oj:!1});y.exports=a.Fk||{}},1543:function(y,r,a){r=a(489)(!1);r.push([y.i,'.CatchUpActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden}.CatchUpActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding:16px;min-height:26px;height:auto}.CatchUpActivityPaneTitle{max-width:230px;display:inline-flex;font-weight:700;font-family:"Segoe UI Light","Segoe UI Web",Arial,Verdana,sans-serif;font-size:21px;line-height:21px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden}.CatchUpActivityCloseButton{display:inline-flex;align-self:center}.CatchUpActivityBody{display:flex;width:300px;flex:auto;flex-direction:column;justify-content:space-between;overflow-y:auto;overflow-x:hidden}.CatchUpActivityHighlightContainer{position:absolute;width:20px;height:20px;cursor:default;z-index:4;pointer-events:auto}.CatchUpActivityHighlightDot{width:4px;height:4px;border-radius:50%;border-width:1px;border-color:#fff;border-style:solid;background-color:#006bff;pointer-events:none;margin-top:4px}.CatchUpActivityHighlightDotHitTesting{margin-left:10px;pointer-events:auto;margin-bottom:-1px;width:9px;height:9px;overflow:hidden;max-height:100%}.CatchUpActivityHighlightEnlarged .CatchUpActivityHighlightDot{width:5px;height:5px}.CatchUpActivityFlyoutContainer{position:relative;z-index:992}.CatchUpFlyoutAnchorTarget{position:fixed}.RangeCatchUpActivityHighlightRectHovered,.RangeCatchUpActivityHighlightRectSelected{position:absolute;border:2px solid #006bff;pointer-events:none}.RangeCatchUpActivityHighlightRectHovered{background-color:rgba(0,107,255,.2)}.RangeCatchUpActivityHighlightRectSelected{background-color:rgba(0,107,255,.4)}.RangeCatchUpActivityHighlightRectInnerBorder{position:absolute;top:0;bottom:0;left:0;right:0;border:1px solid #fff;pointer-events:none}.ewr-grdcontarea-ltr .RangeCatchUpActivityHighlightRectHovered,.ewr-grdcontarea-ltr .RangeCatchUpActivityHighlightRectSelected{margin:-2px 0 0 -2px}.ewr-grdcontarea-rtl .RangeCatchUpActivityHighlightRectHovered,.ewr-grdcontarea-rtl .RangeCatchUpActivityHighlightRectSelected{margin:-2px -2px 0 0}@media screen and (-ms-high-contrast:active){.RangeCatchUpActivityHighlightRectHovered,.RangeCatchUpActivityHighlightRectSelected{background-color:transparent}}.CatchUpActivityHighlight{position:absolute;cursor:default;z-index:4;pointer-events:none}.CatchUpDotOuterDiv{width:20px;height:100%;z-index:4;position:absolute;margin-left:-11px;pointer-events:none;max-height:120%;max-width:100%;overflow:visible;display:flex;align-items:end}.RangeCatchUpActivityHighlightHovered,.RangeCatchUpActivityHighlightSelected{position:absolute;border:2px solid #006bff;pointer-events:none;outline:1px solid #fff;outline-offset:-3px;z-index:4}.RangeCatchUpActivityHighlightHovered{background-color:rgba(0,107,255,.2)}.RangeCatchUpActivityHighlightSelected{background-color:rgba(0,107,255,.4);width:inherit;height:inherit;outline:1px solid #fff;outline-offset:-3px;z-index:4}.ewr-grdcontarea-ltr .RangeCatchUpActivityHighlightHovered,.ewr-grdcontarea-ltr .RangeCatchUpActivityHighlightSelected{margin:-2px 0 0 -2px}.ewr-grdcontarea-rtl .RangeCatchUpActivityHighlightHovered,.ewr-grdcontarea-rtl .RangeCatchUpActivityHighlightSelected{margin:-2px -2px 0 0}.ewr-grdcontarea-rtl .CatchUpDotOuterDiv{margin-right:1px}.ewr-grdcontarea-rtl .CatchUpActivityHighlightDot{margin-top:3px}.ewr-grdcontarea-rtl .CatchUpActivityHighlightDotHitTesting{margin-bottom:-2px}@media screen and (-ms-high-contrast:active){.RangeCatchUpActivityHighlightHovered,.RangeCatchUpActivityHighlightSelected{background-color:transparent}}',
""]);y.exports=r},1625:function(y,r,a){a.r(r);a.d(r,"RangeVersionHistoryHighlightView",function(){return m});y=a(0);var c=a(15);class b{}b.dti="ewa-vhr-rectinnerborder";Object(y.a)(b,"VersionHistoryClassNames",null,[]);var f=a(74),k=a(44),x=a(172),d=a(25),h=a(397),n=a(1447);class m{constructor(u,l,t,e){this.CAb=null;this.$=u;this.auh=l;this.D5a=t;this.E5a={};this.fHb=e;this.FDi=m.F9j;this.Qij()}get GK(){return[m.P7]}get Ub(){return this.CAb||(this.CAb=d.f(this.$).Ub)}s7b(u){u?this.Ub.Iq(this.GK):
this.Ub.rl(this.GK)}Rhe(){this.s7b(!1);this.Ub.Rtb(new h.a(null,f.d(this.$.la)),this.GK)}gFk(u){if(this.D5a){var l=new h.a(k.I(u),f.d(this.$.qa.getItemByName(u.SheetName))),t=n.VersionHistoryHighlightManager.uYc(l);if(t in this.D5a)if(t in this.E5a){l=x.a.np(this.D5a[t]);t=this.E5a[t];for(const e in t){const w=t[e];w.style.backgroundColor=`rgba(${l.r},${l.g},${l.b},${this.FDi})`;w.classList.add("ewa-vhr-highlight-focus")}d.f(this.$).ha.ob.WH(null);d.f(this.$).gotoSheetRangeKeepCurrentSelection(u,
60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+t);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+t)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}tfi(u){u=new h.a(k.I(u),f.d(this.$.qa.getItemByName(u.SheetName)));
var l=n.VersionHistoryHighlightManager.uYc(u);if(l in this.E5a)if(l in this.D5a){u=x.a.np(this.D5a[l]);l=this.E5a[l];for(const t in l){const e=l[t];e.style.backgroundColor=`rgba(${u.r},${u.g},${u.b},${this.fHb})`;e.classList.remove("ewa-vhr-highlight-focus")}}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+l);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+
l)}Qij(){this.Ub.HL(this.auh,[m.P7],!1,(u,l)=>{if(u&&u.range&&u.sheetId&&l){var t=new h.a(u.range,u.sheetId);t=n.VersionHistoryHighlightManager.uYc(t);t in this.E5a||(this.E5a[t]={});this.E5a[t][u.paneType.toString()]=l;t in this.D5a?(u=this.D5a[t],t=x.a.np(u),l.style.borderColor=u,l.style.backgroundColor=`rgba(${t.r},${t.g},${t.b},${this.fHb})`,u=document.createElement("div"),u.className=b.dti,l.appendChild(u)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+
t)}else c.ULS.shipAssertTag(537150423,0,!!u,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!u||!!u.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!u||!!u.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!l,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}m.P7=23;m.F9j="0.1";Object(y.a)(m,"RangeVersionHistoryHighlightView",
null,[349])},335:function(y,r,a){async function c(Ab){return N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)?0:await new Promise(Uc=>{Object(X.D)(Ab.ma.sa,4,Od=>{var {Result:le,Errors:ge}=Od;M.a.zf(ge)?(t.ULS.sendTraceTag(507892569,0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${M.a.pc(ge)}`),Od=1):null==le?Od=0:(Od=parseInt(le,10),t.ULS.sendTraceTag(507892568,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Od}`));
Uc(Od)},Od=>{({data:Od}=Od);Od=E.a.te(Od);t.ULS.sendTraceTag(507892567,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${M.a.pc(Od)}.`);Uc(1)},null,null)})}a.r(r);var b={};a.r(b);a.d(b,"BlueDotManager",function(){return aa});var f={};a.r(f);a.d(f,"CatchUpActivityCommandHandler",function(){return Sa});var k={};a.r(k);a.d(k,"CatchUpActivityManager",function(){return ed});var x={};a.r(x);a.d(x,"LineageActivityCommandHandler",function(){return qd});var d={};a.r(d);
a.d(d,"LineageManager",function(){return dd});var h={};a.r(h);a.d(h,"LineageTaskPane",function(){return ub});var n={};a.r(n);a.d(n,"RestoreVersionActivity",function(){return Xb});var m={};a.r(m);a.d(m,"RestoreVersionErrorActivity",function(){return Vc});var u={};a.r(u);a.d(u,"VersionHistoryCommandHandler",function(){return dg});var l=a(0),t=a(15),e=a(151),w=a(150),z=a(249),E=a(124),M=a(36),G=a(255),A=a(266),N=a(1),K=a(6),I;(function(Ab){Ab[Ab.default=0]="default";Ab[Ab.Iml=1]="D48X48";Ab[Ab.Lml=2]=
"D64X64";Ab[Ab.Mml=3]="D96X96";Ab[Ab.Eml=4]="D120X120";Ab[Ab.Fml=5]="D240X240";Ab[Ab.Gml=6]="D360X360";Ab[Ab.Hml=7]="D432X432";Ab[Ab.Jml=8]="D504X504";Ab[Ab.Kml=9]="D648X648"})(I||(I={}));Object(l.b)("ProfilePhotoDimension",I);const L=(Ab,Uc)=>{let Od=[];for(const vc of Ab){Ab=vc;var le=Uc,ge=Number.parseLocale(Ab.UserActivity.Id),ze=Ab.Uid,Le=Ab.UserActivity.Type;var nf=Ab.UserActivity.Person;var cf=le;if(nf){var Te=null;K.AFrameworkApplication.ea.ka("IsUserProfilePictureResolutionEnabled")&&(Te=
cf.Eia(nf.Email,nf.Provider,K.AFrameworkApplication.Uh,I.default));nf={id:nf.Id,provider:nf.Provider,displayName:nf.DisplayName,email:nf.Email,imageUrl:Te}}else nf=null;cf=Ab.SheetName;Te=new Date(Ab.UserActivity.DisplayTimestamp);var Wf=Ab.DisplayLocation;var Hf=Ab.LineageValueChangeList;var ib=[];for(const md of Hf)ib.push({hasNewValue:md.HasNewValue,hasOldValue:md.HasOldValue,newValue:md.HasNewValue?md.NewValue:null,oldValue:md.HasOldValue?md.OldValue:null,cellLocation:md.CellLocation});Hf=ib;
ib=Ab.IsBulkEditOverFlow;a:{var xc=Ab.UserActivity.LocationList;var Kc=Ab.UserActivity.Type;if(!xc){t.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");Kc=null;break a}if(!xc.length){t.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");Kc=null;break a}var ra=[],jb=[];let md="";21===Kc?jb.push(xc[0]):jb=xc;for(const Qd of jb)switch(Qd.Type){case 1:break;case 2:md=Qd.SheetName;break;case 0:xc=
Qd;if(!xc.RangeList){t.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}md=xc.RangeList[0].SheetName;jb=[];21===Kc?jb.push(xc.RangeList[0]):jb=xc.RangeList;for(const v of jb)ra.push({firstCol:v.FirstColumn,firstRow:v.FirstRow,lastRow:v.LastRow,lastCol:v.LastColumn});break;default:t.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",Qd.Type)}Kc={sheetName:md,rangeList:ra}}le=
(ra=Ab.NestedActivityList)?L(ra,le):null;Ab={activityId:ge,activityGuid:ze,activityType:Le,author:nf,sheetName:cf,displayTimestamp:Te,gridLocation:Wf,valueChanges:Hf,isBulkEditOverflow:ib,rangeHighlightLocation:Kc,nestedActivityList:le,degradedCardTypeBits:Ab.DegradedCardTypeBits};25===Ab.activityType?(ge=[],J(Ab,ge),Od=[...Od,...ge]):Od.push(Ab)}return Od},J=(Ab,Uc)=>{25===Ab.activityType?Ab.nestedActivityList.forEach(Od=>{Od&&J(Od,Uc)}):Uc.push(Ab)};var B=a(61);const Y=(Ab,Uc,Od,le,ge,ze)=>{ze=
Ab.$a(1,void 0===ze?null:ze);return B.h(Ab,"LineageUpdateView",ze,Uc,Od,le,ge,0)},U=(Ab,Uc,Od,le,ge,ze)=>{ze=Ab.$a(1,void 0===ze?null:ze);return B.h(Ab,"LineageClosePane",ze,Uc,Od,le,ge,0)};var O=a(213),C=a(83),X=a(368),S=a(41);class ea{}Object(l.a)(ea,"LineageBlueDotsInfo",null,[]);var Oa=a(2),Ha=a(29);class Za extends Sys.EventArgs{constructor(Ab){super();this.FPj=Ab}}Object(l.a)(Za,"BlueDotVisibilityChangeEventArgs",Sys.EventArgs,[]);var fa=a(65),la=a(5);Object(fa.b)(la.BlueDotManagerService,{we:"singleton"})(async Ab=>
{Ab=await fa.a.resolve(la.EwaControlService,Ab);if(N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotBehindLineage",!1))return new aa(Ab,0);const Uc=await c(Ab);return new aa(Ab,Uc)});class ba extends Error{constructor(Ab,Uc){super(`${ba.IOh}: ${Ab}. With errors: ${M.a.pc(Uc)}`)}}ba.IOh="BlueDotError";Object(l.a)(ba,"BlueDotError",Error,[]);class aa extends S.a{constructor(Ab,Uc){super();this.blueDotSettings=0;this.Yqa=this.r6=null;this.j8e=this.Iqa=this.oZa=this.WXb=this.ISf=this.TSf=
!1;this.jd=(Od,le)=>{le.elb&&this.MBd()};this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.CKk=Od=>{t.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Od);this.blueDotSettings=Od?0:1;this.raiseEvent("cubdvcek",new Za(Od));this.oPg({});this.$kl()};this.N2g=Od=>{this.oPg({BlueDotVisibility:Od})};this.$=Ab;this.blueDotSettings=Uc;this.zea=z.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.hdb=
new Set;this.zsd=new Set;this.oZa=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotCountLimitEnabled",!1);this.HOh=N.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.BlueDotCountLimit",50);this.j8e=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotBehindLineage",!1);this.$.Sj(this.jd)}dispose(){this.$.ro(this.jd);this.Yqa=this.r6=this.zsd=this.hdb=this.zea=this.$=null}BDh(Ab){this.addHandler("cubddek",Ab)}Bsk(Ab){this.removeHandler("cubddek",Ab)}wGh(Ab){this.addHandler("cubduek",
Ab)}evk(Ab){this.removeHandler("cubduek",Ab)}PCh(Ab){this.addHandler("cubdvcek",Ab)}Urk(Ab){this.removeHandler("cubdvcek",Ab)}Xfb(Ab,Uc){t.ULS.sendTraceTag(509167327,0,50,"BlueDotManager::dismissBlueDot: Blue dot dismissed by "+Uc);Ab.forEach(Od=>this.zsd.add(Od));this.raiseEvent("cubddek")}shouldShowBlueDot(Ab){return this.hdb.has(Ab)}blueDotSheetRangeKey(Ab){return Ab&&Ab.range&&Ab.sheetId?`${Ab.range.bottom}-${Ab.range.left}-${Ab.sheetId}`:null}Y9k(Ab){this.Yqa=Ab;if(this.oZa){if(this.Iqa)return!1;
if(Object.keys(this.Yqa).length>this.HOh)return t.ULS.sendTraceTag(508101824,0,50,"BlueDotManager.setBlueDotActivityMap: Number of blue dots in session exceeds limit. Disabling blue dots."),this.MBd(),!1}!this.WXb&&this.Yqa&&(this.WXb=!0,t.ULS.sendTraceTag(508363083,0,50,"BlueDotManager.setBlueDotActivityMap: Number of blue dots in session: "+Object.keys(this.Yqa).length));return!0}$Ob(Ab){return this.Yqa?this.Yqa[Ab]:null}hasAnyActiveInGridHighlight(){return N.EwaSettings.isChangeGateEnabled("OfficeVSO:7665355_DisableToggleForEmptyInGridHighlights")?
!this.TSf&&0<this.hdb.size:!0}OCh(Ab){this.addHandler("cubdfdek",Ab)}Trk(Ab){this.removeHandler("cubdfdek",Ab)}hXj(){this.TSf=!0;this.MBd();this.ISf||(this.rBg(),this.ISf=!0)}async lDj(){return new Promise((Ab,Uc)=>{t.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::loadInGridBlueDots");e.b(this.$).Jd(w.a.lineageLoadInGridBlueDots,{});const Od=ge=>{ge=E.a.te(ge.data);t.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${M.a.pc(ge)}]`);Uc(new ba("loadInGridBlueDots failed",
ge))},le=ge=>{if(ge=G.a(ge)?null:ge.Result){var ze={["CountOfActivities"]:ge.ActivityList.length};e.b(this.$).Jd(w.a.DCj,ze);ge=L(ge.ActivityList,this.zea);this.Phf(ge);this.r6&&N.EwaSettings.isChangeGateEnabled("OfficeVSO:7833821_BlueDotsReapplyFlattenedUids")&&this.Z7e(this.r6.FlattenedUids);Ab(ge)}else t.ULS.shipAssertTag(512234914,0,!!ge,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};this.$.userOperationManager.enqueueOperation(new O.a(1024,0,(ge,ze,Le)=>{var nf=this.$.ma.sa;
ge=A.c(ge,le);ze=A.b(ze,Od);const cf=nf.$a(1,null);return B.h(nf,"LineageLoadInGridBlueDots",cf,ge,ze,Le,null,0)},80),null)})}async mDj(){return new Promise((Ab,Uc)=>{var Od,le,ge,ze,Le,nf;t.ULS.sendTraceTag(509109974,0,50,"BlueDotManager::loadInGridBlueDotsWithReloadHint");e.b(this.$).Jd(w.a.lineageLoadInGridBlueDotsWithReloadHint,{});const cf=Hf=>{Hf=E.a.te(Hf.data);t.ULS.sendTraceTag(509109973,0,50,`BlueDotManager::LineageLoadInGridBlueDotsWithReloadHint service call failed. Errors: [${M.a.pc(Hf)}]`);
Uc(new ba("loadInGridBlueDotsWithReloadHint failed",Hf))},Te=Hf=>{if(Hf=G.a(Hf)?null:Hf.Result){var ib={["CountOfActivities"]:Hf.ActivityList.length};e.b(this.$).Jd(w.a.ECj,ib);Hf=L(Hf.ActivityList,this.zea);this.Phf(Hf);Ab(Hf)}else t.ULS.shipAssertTag(509109971,0,!1,"BlueDotManager LineageLoadInGridBlueDotsWithReloadHint returned null response.")},Wf=Object(Oa.a)(new ea,{FlattenedUids:null,ToplevelUids:null===(Od=this.r6)||void 0===Od?void 0:Od.ToplevelUids,XrevidFirst:null===(le=this.r6)||void 0===
le?void 0:le.XrevidFirst,XrevidLast:null===(ge=this.r6)||void 0===ge?void 0:ge.XrevidLast,XrevidLastAccepted:null===(ze=this.r6)||void 0===ze?void 0:ze.XrevidLastAccepted,ApplyToplevelAllowList:null===(Le=this.r6)||void 0===Le?void 0:Le.ApplyToplevelAllowList,DocId:null===(nf=this.r6)||void 0===nf?void 0:nf.DocId});this.$.userOperationManager.enqueueOperation(new O.a(1031,0,(Hf,ib,xc)=>{var Kc=this.$.ma.sa;Hf=A.c(Hf,Te);ib=A.b(ib,cf);const ra=Kc.$a(1,null);ra.blueDotsReloadHint=Wf;return B.h(Kc,"LineageLoadInGridBlueDotsWithReloadHint",
ra,Hf,ib,xc,null,0)},80),null)})}XCj(){this.YCj().then(Ab=>{this.r6=Ab;this.Z7e(Ab.FlattenedUids);this.rBg()},()=>{})}MBd(){this.Iqa||(this.Iqa=!0,this.Yqa={},this.raiseEvent("cubdfdek"))}async YCj(){return new Promise((Ab,Uc)=>{t.ULS.sendTraceTag(509109970,0,50,"BlueDotManager::loadBlueDotsInformationAsync");const Od=ge=>{ge=E.a.te(ge.data);t.ULS.sendTraceTag(509109969,0,50,`BlueDotManager  loadBlueDotsInformation service call failed. Errors: [${M.a.pc(ge)}]`);Uc(new ba("loadBlueDotsInformation load failed",
ge))},le=ge=>{(ge=G.a(ge)?null:ge.Result)?Ab(ge):t.ULS.shipAssertTag(509109967,0,!!ge,"BlueDotManager loadBlueDotsInformation returned null response.")};this.$.userOperationManager.enqueueOperation(new O.a(1030,0,(ge,ze,Le)=>{var nf=this.$.ma.sa;ge=A.c(ge,le);ze=A.b(ze,Od);const cf=nf.$a(1,null);return B.h(nf,"LineageGetBlueDotsInformation",cf,ge,ze,Le,null,4)},80),null)})}Z7e(Ab){Ab&&Ab.forEach(Uc=>{Uc=`{${Uc.toUpperCase()}}`;this.hdb.has(Uc)||this.hdb.add(Uc)})}Phf(Ab){this.hdb=new Set(Ab.map(Uc=>
Uc.activityGuid))}oPg(Ab){if(Ha.a.GTb(this.$)){var Uc=new C.a(950288339,0,2,12,null);this.$.Ia.Gb(Uc,Ab)}}a_a(){return this.j8e}eSk(){return!this.r6||this.r6.ApplyToplevelAllowList}$kl(){N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)||X.K(this.$.ma.sa,4,this.blueDotSettings.toString(),Ab=>{M.a.zf(Ab.Errors)?t.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${M.a.pc(Ab.Errors)}`):Ab.Result||
t.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Ab,Uc,Od)=>{Ab=E.a.te(Ab.data);t.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Od}. Errors: ${M.a.pc(Ab)}.`)},null,null)}rBg(){N.EwaSettings.isChangeGateEnabled("OfficeVSO:7501927_SendBlueDotsUpdateEvent")&&this.raiseEvent("cubduek")}}Object(l.a)(aa,"BlueDotManager",S.a,[249,4]);var oa=a(133),Na=a(209),Ia=a(67);
let Sa=class{constructor(Ab){this.catchUpActivityManager=Ab}gd(){return!1}executeCommand(Ab,Uc,Od){switch(Uc.command){case -876699925:return this.catchUpActivityManager.G6j(),Ia.Task.Va(!0);case 950288339:return this.catchUpActivityManager.a_a()?(Ab=Od.BlueDotVisibility,void 0!==Ab?this.catchUpActivityManager.Ndl(Ab):this.catchUpActivityManager.showHideInGridHighlights()):this.catchUpActivityManager.showHideInGridHighlights(),Ia.Task.Va(!0)}return Na.a(Uc.command)}Rc(Ab,Uc){return N.EwaSettings.Ra(382)?
-876699925===Uc.command||950288339===Uc.command:!1}td(){return!1}};Sa=Object(oa.__decorate)([Object(fa.d)(la.CatchUpActivityCommandHandlerService),Object(oa.__param)(0,Object(la.CatchUpActivityManagerService)())],Sa);Object(l.a)(Sa,"CatchUpActivityCommandHandler",null,[29]);var Pa=a(19);const za=Object(Pa.b)("Common.App.CatchUpActivity.FloodgateEventLogger"),wa=Object(Pa.c)(za),db=Object(Pa.b)("Common.App.CatchUpActivity.ICatchUpRequestHandler");var Ba=a(242),Ka=a(613),da=a(91),sa=a(545),mb;(function(Ab){Ab[Ab.None=
1]="None";Ab[Ab.New=2]="New";Ab[Ab.Outstanding=3]="Outstanding"})(mb||(mb={}));var Ma;(function(Ab){Ab[Ab.Success=1]="Success";Ab[Ab.DeletedItem=2]="DeletedItem";Ab[Ab.UnknownError=3]="UnknownError";Ab[Ab.EmptyNavigationId=4]="EmptyNavigationId";Ab[Ab.DecodeNavIdFailed=5]="DecodeNavIdFailed";Ab[Ab.AppNavigationFailure=6]="AppNavigationFailure";Ab[Ab.UnsupportedActivityType=7]="UnsupportedActivityType";Ab[Ab.NoActivityProvided=8]="NoActivityProvided"})(Ma||(Ma={}));var hb;(function(Ab){Ab[Ab.None=
0]="None";Ab[Ab.Edit=1]="Edit";Ab[Ab.Comment=2]="Comment";Ab[Ab.Reply=3]="Reply";Ab[Ab.AtMention=4]="AtMention";Ab[Ab.Restore=5]="Restore";Ab[Ab.TaskAssign=6]="TaskAssign";Ab[Ab.TaskReassign=7]="TaskReassign";Ab[Ab.TaskReopen=8]="TaskReopen";Ab[Ab.TaskComplete=9]="TaskComplete";Ab[Ab.TaskReply=10]="TaskReply";Ab[Ab.WordCommentReaction=11]="WordCommentReaction";Ab[Ab.CommentReaction=12]="CommentReaction"})(hb||(hb={}));var $a;(function(Ab){Ab[Ab.NewAssignee=1]="NewAssignee";Ab[Ab.ExistingAssignee=
2]="ExistingAssignee";Ab[Ab.TaskCreator=3]="TaskCreator"})($a||($a={}));var Va;(function(Ab){Ab[Ab.TopLeftEdge=1]="TopLeftEdge";Ab[Ab.TopCenter=2]="TopCenter";Ab[Ab.TopRightEdge=3]="TopRightEdge";Ab[Ab.TopAutoEdge=4]="TopAutoEdge";Ab[Ab.BottomLeftEdge=5]="BottomLeftEdge";Ab[Ab.BottomCenter=6]="BottomCenter";Ab[Ab.BottomRightEdge=7]="BottomRightEdge";Ab[Ab.BottomAutoEdge=8]="BottomAutoEdge";Ab[Ab.LeftTopEdge=9]="LeftTopEdge";Ab[Ab.LeftCenter=10]="LeftCenter";Ab[Ab.LeftBottomEdge=11]="LeftBottomEdge";
Ab[Ab.RightTopEdge=12]="RightTopEdge";Ab[Ab.RightCenter=13]="RightCenter";Ab[Ab.RightBottomEdge=14]="RightBottomEdge"})(Va||(Va={}));var xa;(function(Ab){Ab[Ab.None=0]="None";Ab[Ab.IsDismissed=1]="IsDismissed";Ab[Ab.IsSeen=2]="IsSeen";Ab[Ab.IsRead=4]="IsRead";Ab[Ab.IsCompleted=8]="IsCompleted";Ab[Ab.IsFlagged=16]="IsFlagged"})(xa||(xa={}));var ia=a(26);class Z{constructor(Ab){this.zh=Ab}doesContentExist(Ab){if(!Ab)return t.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),
!1;switch(Ab.type){case hb.Comment:case hb.Reply:case hb.AtMention:case hb.TaskAssign:case hb.TaskReopen:case hb.TaskComplete:case hb.TaskReassign:case hb.TaskReply:if(!Ab.navigationId)return t.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const Uc={};Uc.NavigationId=atob(Ab.navigationId);return 32===this.zh.pe(ia.a.pVa,2,Uc);default:return!1}}}Object(l.a)(Z,"CatchUpActivityContentManager",null,[]);var ta=a(1085),pa=a(7),Ga=a(1444),Ca=a(17);
class kb{constructor(Ab){this.w_b=()=>{switch(this.vw.model.state){case 1:this.hXg(!0);break;case 0:this.s7b(!1);break;case 2:case 3:this.s7b(!0);break;default:t.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.vw.model.state)}};this.eoh=Ab;this.vw.T3e(this.w_b);this.uC=[]}get vw(){return this.eoh}dispose(){this.vw.OGg(this.w_b);this.uC=null}rKk(Ab){this.uC.push(Ab)}lZh(){this.uC.length=0}hXg(Ab){for(const Uc of this.uC){Uc.className=
ta.a.VVh;const Od=document.getElementById(`${Uc.id}-${pa.a.bdf}`);Ca.DOMElementExtensions.setVisible(Od,Ab)}}s7b(Ab){for(const Uc of this.uC)Uc&&(Ab?Uc.className=2===this.vw.model.state?ta.a.Mjk:ta.a.Njk:this.hXg(!1))}}Object(l.a)(kb,"RangeCatchUpActivityView",null,[371,4]);var eb=a(44),Yb=a(327),Gb=a(28),Mb=a(25);class Rb extends Ga.a{constructor(Ab,Uc,Od){super(Ab,Uc,Od);this.da=Mb.f(Ab);this.cLa=Uc}dispose(){this.da=null;super.dispose()}nCh(Ab){const Uc=this.pxb[0];Uc?Uc.rKk(Ab):t.ULS.shipAssertTag(537168004,
0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.cLa.blueDotSheetRangeKey)}Tyk(){const Ab=this.pxb[0];Ab&&Ab.lZh()}LMi(){if(3!==this.cLa.activityType)return null;t.ULS.shipAssertTag(537168003,0,1===this.cLa.Z7b.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");return eb.I(this.cLa.Z7b[0])}tne(Ab){if(Ab){if(!this.cLa)return;this.G6d(this.iAk())}super.tne(Ab)}Pzd(){const Ab=
this.rzd();this.pxb.push(Ab)}rzd(){return new kb(this)}G6d(Ab){Ab?Ab.SheetName?(this.da.ha.ob.WH(null),this.da.focus(),this.da.gotoSheetRangeKeepCurrentSelection(Ab,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):t.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):t.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}iAk(){if(Yb.a(this.cLa.Z7b))return t.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var Ab=this.$.qa.la;t.ULS.shipAssertTag(537167970,0,!!Ab,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Ab=this.V8k(Ab.sheetName,this.cLa.Z7b);if(!Ab&&(Ab=this.W4i(this.cLa.Z7b),!Ab))return null;const Uc={};Uc.SheetName=Ab.SheetName;Uc.FirstColumn=Ab.FirstColumn;Uc.FirstRow=Ab.FirstRow;Uc.LastColumn=Ab.FirstColumn;
Uc.LastRow=Ab.FirstRow;return Uc}W4i(Ab){if(Yb.a(Ab))return null;let Uc=null;for(let le=0;le<Ab.length;le++){var Od=Ab[le].SheetName;if(!Gb.a.equals(Od,Uc,!1)&&(Uc=Od,Od=this.$.qa.getItemByName(Od),null===Od||void 0===Od?0:Od.visible))return Ab[le]}return null}V8k(Ab,Uc){if(Uc)for(const Od of Uc)if(Gb.a.equals(Od.SheetName,Ab,!1))return Od;return null}}Object(l.a)(Rb,"RangeCatchUpActivityHighlightController",Ga.a,[]);var $b=a(93);class cc extends $b.a{constructor(Ab,Uc,Od,le,ge,ze,Le){super();this.$=
Ab;this.Qbc=Uc;this.A6c=Od;this.HM=le;this.VHe=Le;N.EwaSettings.isChangeGateEnabled("OfficeVSO:7809002_CatchUpActivityHoverStateFix")&&ge&&ze?this.state=2:this.state=ge?1:0}get type(){return this.HM}get blueDotSheetRangeKey(){return this.Qbc}get activityType(){return this.A6c}dispose(){this.Qbc=null;super.dispose()}JEc(Ab){return Ab?this.VHe.sheetId===Ab.sheetId&&this.VHe.range.bottomLeft.equals(Ab.range.bottomLeft):(t.ULS.shipAssertTag(508379232,0,!1,"CatchUpActivityHighlightModelBase.isAnchoredRange(): sheetRange is null."),
!1)}}Object(l.a)(cc,"CatchUpActivityHighlightModelBase",$b.a,[]);class fb extends cc{constructor(Ab,Uc,Od,le,ge,ze,Le,nf){super(Ab,Uc,Od,le,ze,Le,nf);this.ranges=ge;this.rmb=!1}get Z7b(){this.rmb||(this.ranges.sort(fb.dxd),this.rmb=!0);return this.ranges}addRange(Ab){for(const Uc of Ab)this.ranges.push(Uc)}dispose(){this.ranges=null;super.dispose()}static dxd(Ab,Uc){if(!Ab.SheetName||!Uc.SheetName)return t.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),
0;const Od=Ab.SheetName.localeCompare(Uc.SheetName);return Od?Od:Ab.FirstColumn<Uc.FirstColumn||Ab.FirstColumn===Uc.FirstColumn&&Ab.FirstRow<Uc.FirstRow?-1:Ab.FirstColumn===Uc.FirstColumn&&Ab.FirstRow===Uc.FirstRow?0:1}}Object(l.a)(fb,"RangeCatchUpActivityHighlightModel",cc,[]);var Sb=a(74),kc=a(397);class na{constructor(){this.jxd=[];this.rub={};this.YUd=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7795308_EnableCatchupHighlightLogging")}dispose(){this.rub=this.jxd=null}bIg(Ab,Uc){Uc?Mb.f(Ab).Ub.Iq([24]):
Mb.f(Ab).Ub.rl([24]);this.YUd&&t.ULS.sendTraceTag(508933385,0,50,`CatchUpHighlightControllersCreator:renderAllCatchUpRangeHighlights with setVisible=${Uc}.`)}zFg(Ab){this.Akf(Ab,[new kc.a(null,null)],this.rub,!1);this.YUd&&t.ULS.sendTraceTag(508933384,0,50,"In CatchUpHighlightControllersCreator:removeAllCatchUpRangeHighlights().")}Sjf(Ab,Uc,Od,le){const ge={},ze=new Map;for(const cf in Uc){var Le=Uc[cf];if(Ab.qa.la.sheetName!==Le.sheetName)continue;var nf=[];const Te=new Rb(Ab,new fb(Ab,Le.blueDotSheetRangeKey,
Le.activityType,0,Le.Kqe,le,!1,Le.FOh),Od);nf.push(Te);ge[Le.blueDotSheetRangeKey]=nf;for(const Wf of Le.Kqe){Le=new kc.a(eb.I(Wf),Sb.d(Ab.qa.getItemByName(Wf.SheetName)));nf=this.XTg(Le);if(nf in this.rub)this.rub[nf].push(Te);else{const Hf=[];Hf.push(Te);this.rub[nf]=Hf}ze.set(nf,Le)}}this.jxd=Array.from(ze.values());this.Akf(Ab,this.jxd,this.rub,le);return ge}gZh(Ab){for(const Uc in Ab){const Od=Ab[Uc];for(const le of Od)le.Tyk()}}XTg(Ab){return`${Ab.range}-${Ab.sheetId}`}Akf(Ab,Uc,Od,le){0!==
Uc.length&&(this.gZh(Od),Mb.f(Ab).Ub.HL(Uc,[24],le,(ge,ze)=>{if(null==ge.range){for(var Le of ge.p6)Le.dispose();ge.p6=[];ge.iHb=!1}else{Le=new kc.a(ge.range,ge.sheetId);var nf=this.XTg(Le),cf=Od[nf];if(cf){ge.metadata=null;for(const Te of cf)Te.nCh(ze),Te.JEc(Le)&&(ge.metadata=Te)}else t.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+nf)}}))}}Object(l.a)(na,"CatchUpHighlightControllersCreator",null,
[]);var fc=a(70);class Cc{constructor(Ab,Uc,Od){this.$=Ab;this.zh=Uc;this.sOd=Od}navigateToActivity(Ab){var Uc;if(Ab.fromSummaryString)return Ab=new C.a(1834994092,fc.a.Hb,this.$.xc,18,null),this.$.Ia.Gb(Ab),this.hOa(Ma.Success);var Od=Ab.activity;if(Od&&Od.type===hb.Edit){var le=new C.a(1834994092,fc.a.Hb,this.$.xc,30,null);Od={["activityGuid"]:Od.activityId,["blueDotSheetRangeKey"]:Ab.locationId,["sheetRanges"]:null===(Uc=this.sOd)||void 0===Uc?void 0:Uc.call(this,Ab.locationId)};this.$.Ia.Gb(le,
Od);return this.hOa(Ma.Success)}if(!this.Wlj(Od))return this.hOa(Ma.EmptyNavigationId);if(!this.zxj(Od))return this.hOa(Ma.UnsupportedActivityType);Ab={};try{le=window.self.atob(Od.navigationId);if(!le)return this.hOa(Ma.DecodeNavIdFailed);Ab.NavigationId=le}catch(ge){return t.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${ge}`),this.hOa(Ma.DecodeNavIdFailed)}if(8===this.zh.pe(ia.a.pVa,2,Ab))return this.zh.hf(ia.a.Qob,2),this.hOa(Ma.DeletedItem);
Ab=32===this.zh.pe(ia.a.Beb,2,Ab)?Ma.Success:Ma.AppNavigationFailure;return this.hOa(Ab)}Wlj(Ab){return Ab&&Ab.navigationId?!0:!1}zxj(Ab){switch(Ab.type){case hb.Reply:case hb.AtMention:case hb.TaskAssign:case hb.TaskReassign:case hb.TaskComplete:case hb.TaskReopen:case hb.TaskReply:return!0;default:return!1}}hOa(Ab){return Promise.resolve(Ab)}}Object(l.a)(Cc,"CatchUpActivityNavigationManager",null,[]);class tc{constructor(Ab,Uc,Od,le){this.Sdc=this.lRa="";this.bNe=!1;this.Qbc=Ab;this.A6c=Uc.Type;
this.Gjh=Od;this.OGe=[];this.ujd=[];this.w7e(Uc);this.lRa=le}get Kqe(){return this.ujd}get blueDotSheetRangeKey(){return this.Qbc}get FOh(){return this.Gjh}get activityType(){return this.A6c}get Wmd(){return this.OGe}get sheetName(){return this.lRa}get fCi(){return this.Sdc}get Gaj(){return this.bNe}w7e(Ab){this.OGe.push(Ab.Id);const Uc=[];""===this.Sdc?this.Sdc=Ab.Person.DisplayName:this.Sdc!==Ab.Person.DisplayName&&(this.bNe=!0);for(Od of Ab.LocationList)if(0===Od.Type){Ab=Od;for(const le of Ab.RangeList)this.mef(le,
Uc)||Uc.push(le)}t.ULS.sendTraceTag(508682390,0,100,`BlueDotActivity.appendActivityAndSheetRange() with rangeListLength = ${Uc.length.toString()}`);var Od=this.nBf(this.ujd,Uc);this.ujd=Od.concat(this.nBf(Uc,Od))}nBf(Ab,Uc){const Od=[];for(const le of Ab)this.mef(le,Uc)||Od.push(le);return Od}mef(Ab,Uc){for(const Od of Uc)if(Od.SheetName===Ab.SheetName&&Od.FirstColumn<=Ab.FirstColumn&&Od.FirstRow<=Ab.FirstRow&&Od.LastColumn>=Ab.LastColumn&&Od.LastRow>=Ab.LastRow)return!0;return!1}}Object(l.a)(tc,
"BlueDotActivity",null,[]);var nb=a(12);class tb{constructor(Ab,Uc,Od){this.krc=this.bAa=null;this.A9f=!1;this.f2d=!0;this.WXb=this.gZf=!1;this.X4a=null;this.iua={};this.T$=null;this.aSd=!1;this.Byd=0;this.Gj=(le,ge)=>{ge.la!==ge.Vx&&this.blueDotManager&&(le=this.blueDotManager.Yqa)&&this.Tjf(le,this.zcb(),!1)};this.sOd=le=>{const ge=[];le=this.blueDotManager.$Ob(le);for(const ze of le.Kqe)le=new kc.a(eb.I(ze),Sb.d(this.$.qa.getItemByName(ze.SheetName))),ge.push(le);return ge};this.w_b=(le,ge)=>{switch(ge.state){case 0:case 1:3===
ge.hee&&(this.Vbj(),this.X4a=null);break;case 2:break;case 3:this.pof();this.X4a=ge.activityId;this.FUk();break;default:t.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+ge.state)}};this.Jj=()=>{this.uLb()};this.Nd=()=>{this.uLb()};this.Zp=()=>{this.uLb()};this.Nh=()=>{this.uLb()};this.K6j=()=>{this.Vpc()};this.L6j=()=>{this.Wef();this.NCf=setTimeout(()=>{this.Wfb()},200)};this.SVg=(le,ge)=>{ge.Fnj?(this.Vpc(),this.Wfb()):
(this.gZf&&t.ULS.sendTraceTag(508938368,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Flyout is created while bluedots are updating."),this.iff(),this.LHd=setTimeout(()=>{this.Vpc();this.Wfb();const ze=this.p9k(ge.Vja);if(ze){var Le=this.blueDotManager.$Ob(ge.blueDotSheetRangeKey);Le?(Le=Le.Wmd,this.bAa.createActivityIndicatorTooltip({target:this.vni(ge.Vja),container:ze,activityIds:Le,isSticky:!1,dirHint:this.da.rtl?Va.RightTopEdge:Va.LeftTopEdge,activityNavigationManager:this.ipc,
onHoverEnter:this.K6j,onHoverLeave:this.L6j,blueDotSheetRangeKey:ge.blueDotSheetRangeKey}),this.fDc=ge.Vja,t.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event."),this.bGc||(this.da.view.Ks(this.q2c),this.da.aw(this.q2c),this.bGc=!0)):t.ULS.shipAssertTag(508384723,0,!1,"CatchUpActivityHighlightManager.ShowActivityFlyoutHandler(): blueDotActivity is null.")}else t.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null.")},
150))};this.Emg=()=>{this.Vpc();this.NCf=setTimeout(()=>{this.Wfb()},200)};this.q2c=()=>{this.bAa?(this.Tjb&&this.bAa.updateActivityIndicatorTooltip({target:this.Tjb,isSticky:!0}),this.fDc&&this.bAa.updateActivityIndicatorTooltip({target:this.Tjb,isSticky:!1})):t.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Ab;this.da=Mb.f(this.$);this.zoom=Od;this.ha=this.da.ha;this.qd=this.da.Rb;this.ha.AFb(this.Jj);this.ha.Vq(this.Nd);
this.da.KJ(this.Zp);this.qd.Jp(this.Nh);this.Tjb=this.fDc=null;this.bGc=!1;this.GHd={};this.ipc=new Cc(this.$,K.AFrameworkApplication.Kb,this.sOd);this.blueDotManager=Uc;this.WCc=!!Uc&&Uc.a_a();this.Ijf=this.$.Vb.Pg("UserAction","CreateBlueDotMapIntervalStopwatch");this.Rjf=this.$.Vb.Pg("UserAction","CreateControllerIntervalStopwatch");this.$.qa.mh(this.Gj)}get zoomManager(){return this.zoom.zoomManager}get v1e(){return this.bAa}set v1e(Ab){this.bAa=Ab}get vd(){this.T$||(this.T$=fa.a.Cb(la.ExcelCommentManagerService));
return this.T$}get via(){this.krc||(this.krc=new na);return this.krc}set via(Ab){this.krc=Ab}dispose(){this.ha.s3b(this.Jj);this.ha.vr(this.Nd);this.da.xL(this.Zp);this.qd.zp(this.Nh);this.$.qa.xh(this.Gj);this.xBd();this.$=this.GHd=this.Tjb=this.fDc=this.X4a=this.qd=this.ha=this.da=null}GPg(Ab){var Uc,Od;const le=this.zcb();this.xBd();Yb.a(Ab)?(this.via.zFg(this.$),null===(Uc=this.blueDotManager)||void 0===Uc?void 0:Uc.hXj(),this.via.YUd&&t.ULS.sendTraceTag(508933386,0,50,"CatchUpActivityHighlightManager:setActivityPayloadForHighlights - userActivities is NULL or empty.")):
(t.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:setActivityPayloadForHighlights()."),(Uc=this.Byd<tb.GOh)?(this.Ijf.start(),Ab=this.Hjf(this.$,Ab),this.Ijf.stop(),this.Byd+=1):Ab=this.Hjf(this.$,Ab),null!==(Od=this.blueDotManager)&&void 0!==Od&&Od.Y9k(Ab)&&this.Tjf(Ab,le,Uc))}blueDotSheetRangeKey(Ab){return this.blueDotManager?this.blueDotManager.blueDotSheetRangeKey(Ab):null}uZc(){const Ab=this.zcb();Ab&&this.aSd?t.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):
(Ab||this.uLb(),this.via.bIg(this.$,Ab))}Xfb(Ab){this.blueDotManager&&((Ab=this.blueDotManager.$Ob(Ab))?(this.blueDotManager.Xfb(Ab.Wmd,0),N.EwaSettings.isChangeGateEnabled("OfficeVSO:7809018_dismissFlyoutOnBlueDotDismissal")&&this.Wfb()):t.ULS.shipAssertTag(508384724,0,!1,"CatchUpActivityHighlightManager.dismissBlueDot(): blueDotActivity is null."))}aKk(Ab){if(!this.WCc||this.f2d!==Ab){var Uc=this.zcb();this.WCc?this.WCc?this.f2d=Ab:t.ULS.shipAssertTag(508908755,0,!1,"CatchUpActivityHighlightManager.SetForceHighlightsOff - Unknown reason for setting force highlights off"):
(this.A9f=Ab,t.ULS.shipAssertTag(507859465,0,!1,"CatchUpActivityHighlightManager.SetForceHighlightsOff - called when not hidden behind lineage"));Uc!==this.zcb()&&this.uZc()}}YPg(Ab){this.gZf=Ab}zcb(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.A9f&&(!this.WCc||!this.f2d)}Hjf(Ab,Uc){const Od={};for(const ge of Uc)for(const ze of ge.LocationList)if(0!==ze.Type)t.ULS.sendTraceTag(508700376,0,10,"CatchUpActivityHighlightManager.createBlueDotActivityMap: invalid ActivityLocationType");
else{var le=ze;for(const Le of le.RangeList){le=new kc.a(eb.I(Le),Sb.d(Ab.qa.getItemByName(Le.SheetName)));const nf=this.blueDotSheetRangeKey(le);nf in Od?Od[nf].w7e(ge):Od[nf]=new tc(nf,ge,le,Le.SheetName)}}this.WXb||(this.WXb=!0,Ab=Object.keys(Od).length,t.ULS.sendTraceTag(508076807,0,50,"CatchUpActivityHighlightManager.createBlueDotActivityMap: blue dot count: "+Ab+", user activity count: "+Uc.length));return Od}Tjf(Ab,Uc,Od){Od?(this.Rjf.start(),this.iua=this.via.Sjf(this.$,Ab,this,Uc),this.Rjf.stop()):
this.iua=this.via.Sjf(this.$,Ab,this,Uc);if(this.iua){Ab=this.iua;for(const le in Ab){Od=Ab[le];for(const ge of Od)this.FLh(ge)}}this.via.bIg(this.$,Uc)}xBd(){if(this.iua){const Ab=this.iua;for(const Uc in Ab){const Od=Ab[Uc];for(const le of Od)this.zqk(le)}}this.via.zFg(this.$);this.iua={};this.via.dispose();this.via=null}sNc(){this.$.qa.xh(this.Gj);this.xBd()}FUk(){if(this.vd){var Ab=this.iua[this.X4a];Ab&&0<Ab.length&&3===Ab[0].model.activityType&&((Ab=Ab[0])?this.vd.jVk(Ab.LMi()):t.ULS.shipAssertTag(537168029,
0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}Vbj(){this.vd&&this.vd.OMb()}pof(){if(this.X4a){const Ab=this.iua[this.X4a];if(Ab){for(const Uc of Ab)Uc.tne(!1);this.X4a=null}else t.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}uLb(){this.pof();this.Wfb()}p9k(Ab){if(!Ab)return t.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),
null;Ab=`${Ab.id}-${pa.a.TVh}`;let Uc=this.GHd[Ab];if(!Uc){if(!this.da.domElement)return t.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;Uc=document.createElement("Div");Uc.className=ta.a.UVh;Uc.id=Ab;this.da.domElement.appendChild(Uc);this.GHd[Ab]=Uc}return Uc}Wfb(){if(this.bAa&&(this.bAa.dismissActivityIndicatorTooltips({clearSticky:!0}),this.Tjb=this.fDc=null,this.bGc&&!this.Tjb&&(this.da.view.xs(this.q2c),this.da.Zz(this.q2c),
this.bGc=!1),this.KT)){const Ab=this.KT.parentElement;null===Ab||void 0===Ab?void 0:Ab.removeChild(this.KT);this.KT=null}}FLh(Ab){Ab.T3e(this.w_b);Ab.XCh(this.SVg);Ab.WCh(this.Emg)}zqk(Ab){Ab.OGg(this.w_b);Ab.Zrk(this.SVg);Ab.Yrk(this.Emg)}iff(){this.LHd&&clearTimeout(this.LHd)}Wef(){this.LHd&&clearTimeout(this.NCf)}Vpc(){this.iff();this.Wef()}vni(Ab){if(this.KT){var Uc=this.KT.parentElement;null===Uc||void 0===Uc?void 0:Uc.removeChild(this.KT);this.KT=null}Ab=Ab.getBoundingClientRect();this.KT=document.createElement("div");
this.KT.className=ta.a.YVh;this.$.xba.appendChild(this.KT);Uc=nb.HelperMethods.isStandardZoomCssSupportedByBrowser?Ab.top:this.zoomManager.sh(Ab.top);const Od=nb.HelperMethods.isStandardZoomCssSupportedByBrowser?Ab.width:this.zoomManager.sh(Ab.width),le=nb.HelperMethods.isStandardZoomCssSupportedByBrowser?Ab.height:this.zoomManager.sh(Ab.height);this.KT.style.left=`${nb.HelperMethods.isStandardZoomCssSupportedByBrowser?Ab.left:this.zoomManager.sh(Ab.left)}px`;this.KT.style.top=`${Uc}px`;this.KT.style.width=
`${Od}px`;this.KT.style.height=`${le}px`;return this.KT}}tb.GOh=10;Object(l.a)(tb,"CatchUpActivityHighlightManager",null,[356,4]);var La=a(789),wb=a(788),Wa=a(551),Fa=a(1138),Da=a(169);class ja{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(l.a)(ja,"ActivityFeedEntry",null,[]);const Qa=()=>K.AFrameworkApplication.ea?K.AFrameworkApplication.ea.isChangeGateEnabled("Microsoft.Office.SharedOnline.AddSharedActivityFeedLogging"):
!0,Ob=(Ab,Uc)=>Qa()&&!Ab?[]:Uc.isUserProfilePictureResolutionEnabled?Qa()?Ab.map(Od=>{if(!Od||!Od.activityFeedItemPayload)return Od;const le=JSON.parse(Od.activityFeedItemPayload);var ge=le.actor;if(!ge||ge.pictureUrl)return Od;const ze=ge.userPrincipalName||ge.email;if(!ze)return Od;ge=Uc.Eia(ze,ge.provider,K.AFrameworkApplication.Uh,0);if(!ge)return Od;le.actor.pictureUrl=ge;return Object.assign({},Od,{activityFeedItemPayload:JSON.stringify(le)})}):Da.toArray(Da.select(Da.asEnumerable(Ab),Od=>{if(!Od||
!Od.activityFeedItemPayload)return Od;const le=JSON.parse(Od.activityFeedItemPayload);var ge=le.actor;if(!ge||ge.pictureUrl)return Od;const ze=ge.userPrincipalName||ge.email;if(!ze)return Od;ge=Uc.Eia(ze,ge.provider,K.AFrameworkApplication.Uh,0);if(!ge)return Od;le.actor.pictureUrl=ge;return Object.assign(new ja,{id:Od.id,type:Od.type,collectionId:Od.collectionId,activityState:Od.activityState,activityFeedItemPayload:JSON.stringify(le),timestamp:Od.timestamp})})):Ab,Ub=(Ab,Uc)=>{const Od=new Map;
if(Qa()&&!Ab)return Od;const le=new Map;for(const ge of Ab){if(!ge||!ge.activityFeedItemPayload)continue;Ab=JSON.parse(ge.activityFeedItemPayload).actor;if(!Ab)continue;const ze=Ab.email||Ab.userPrincipalName;ze&&!le.has(ze)&&le.set(ze,new Wa.a(ze,null,Ab.name))}le.forEach(ge=>{const ze=Uc.wBc(ge,6);Od.set(ge.UserId,ze)});return Od};class Zb{}Object(l.a)(Zb,"UserActivityPerson",null,[]);var uc=a(88);const Hc=(Ab,Uc,Od,le,ge,ze)=>{ze=Ab.$a(1,void 0===ze?null:ze);return B.h(Ab,"GetLineageWywaAuthors",
ze,Uc,Od,le,ge,4)};class Dd{constructor(Ab,Uc,Od,le){Od=void 0===Od?!1:Od;le=void 0===le?null:le;this.$Ae=null;this.$=Ab;this.kpc=Uc;this.yqb=Object(Pa.a)(La.a);this.zea=Object(Pa.a)(wb.a);this.RGc=Od;this.blueDotManager=le}requestWYWAActivities(){return this.RGc?new Promise((Ab,Uc)=>{Hc(this.$.ma.sa,Od=>{var le;Od=G.a(Od)?null:Od.Result;if(N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const ge=null===(le=null===Od||void 0===Od?void 0:Od.WywaAuthors)||void 0===le?void 0:
le.length;if(null!=ge&&0<ge){const ze={activities:[],actors:Od?this.XLf(Od.WywaAuthors):null,hasMore:!1,highWaterline:Dd.bsa,lowWaterline:Dd.bsa,wywaWaterline:Dd.bsa};this.Y7g(Le=>{ze.activities=Le;Ab(ze)},Le=>{t.ULS.sendTraceTag(509638481,0,10,`updateInGridBlueDots failed: reason: "${Le}"`);Ab(ze)},!0,!1)}else Ab(Dd.aBd)}else le={activities:[],actors:Od?this.XLf(Od.WywaAuthors):null,hasMore:!1,highWaterline:Dd.bsa,lowWaterline:Dd.bsa,wywaWaterline:Dd.bsa,isFirstDocumentOpen:null},Ab(le)},()=>{t.ULS.sendTraceTag(537168022,
0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");Uc(null)},null,null)}):Promise.resolve(Dd.aBd)}requestActivities(){return Promise.resolve(Dd.aBd)}requestActivityFeed(){return uc.c(this.CJd()).then(Ab=>{Ab=null!==Ab&&void 0!==Ab?Ab:[];return{activityFeedItems:Ob(Ab,this.zea),personaColorMap:Ub(Ab,this.yqb)}})}updateActivityState(Ab){return this.kpc?uc.c(this.kpc).then(Uc=>{var Od,le;return uc.c(Uc.pbl(Ab.itemIds,null!==(Od=Ab.activityStatesToSet)&&void 0!==Od?Od:0,
null!==(le=Ab.activityStatesToReset)&&void 0!==le?le:0,Ab.resetUnseenCount))}):Promise.resolve(!1)}CJd(){return this.kpc?Fa.a.Swe(this.kpc,Ab=>Ab.CJd(null)):Ia.Task.Va([])}XLf(Ab){const Uc=[];if(!Ab||!Ab.length)return Uc;for(const Od of Ab)Od&&Uc.push(this.GAc(Od));return Uc}GAc(Ab){return{id:Ab.Id,provider:Ab.Provider,displayName:Ab.DisplayName,givenName:null,email:Ab.Email,imageUrl:this.zea.Eia(Ab.Email,Ab.Provider,K.AFrameworkApplication.Uh,0),color:this.yqb.wBc(new Wa.a(null,void 0,Ab.DisplayName),
6)}}neh(){if(this.blueDotManager){const Ab=this.blueDotManager.zsd;return this.$Ae.filter(Uc=>!Ab.has(Uc.Id))}return this.$Ae}Qfk(Ab,Uc){const Od=Ab.map(le=>({activityId:le.activityGuid,type:hb.Edit,actors:[{id:le.author.id,provider:le.author.provider,displayName:le.author.displayName,givenName:null,email:le.author.email,imageUrl:le.author.imageUrl,color:null}],displayTimestamp:le.displayTimestamp}));this.$Ae=Ab.map(le=>{var ge,ze,Le,nf,cf,Te;const Wf=null!==(ze=null===(ge=le.rangeHighlightLocation)||
void 0===ge?void 0:ge.rangeList.map(Hf=>({Type:0,RangeList:[{SheetName:le.sheetName,FirstRow:Hf.firstRow,LastRow:Hf.lastRow,FirstColumn:Hf.firstCol,LastColumn:Hf.lastCol}]})))&&void 0!==ze?ze:[];ge=new Zb;ge.DisplayName=null===(Le=le.author)||void 0===Le?void 0:Le.displayName;ge.Email=null===(nf=le.author)||void 0===nf?void 0:nf.email;ge.Id=null===(cf=le.author)||void 0===cf?void 0:cf.id;ge.Provider=null===(Te=le.author)||void 0===Te?void 0:Te.provider;return{Id:le.activityGuid,Type:null,Person:ge,
DisplayTimestamp:null,LocationList:Wf}});Uc(Od)}Y7g(Ab,Uc,Od,le){this.blueDotManager?(le?this.blueDotManager.mDj():this.blueDotManager.lDj()).then(ge=>{this.Qfk(ge,Ab);Od&&this.blueDotManager.XCj()},ge=>{Uc&&Uc(ge)}):t.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}Dd.bsa="<WywaWaterline>DefaultWaterline</WywaWaterline>";Dd.aBd={activities:[],actors:[],hasMore:!1,highWaterline:Dd.bsa,lowWaterline:Dd.bsa,wywaWaterline:Dd.bsa,
isFirstDocumentOpen:null};Object(l.a)(Dd,"CatchUpActivityRequestManager",null,[]);var jc=a(13);class $c{constructor(Ab){this.$=Ab}shouldShowEmptyExperienceButton(){return this.$.fa.jKc?!0:!1}onButtonClick(){const Ab={["InputMethod"]:fc.a.Hb};this.$.Ia.Gb(new C.a(1834994092,fc.a.Hb,this.$.xc,16,null),Ab)}onInviteOthersButtonClick(){const Ab={["InputMethod"]:fc.a.Hb};this.$.Ia.Gb(new C.a(869186573,fc.a.Hb,this.$.xc,16,null),Ab)}getExplanationText(){const Ab=fa.a.Cb(la.LineageTaskPaneService);return jc.a.instance.La(Ab&&
Ab.isVisible?657:656)}getCommandName(){return jc.a.instance.ia(443)}}Object(l.a)($c,"CatchUpEmptyExperienceBehaviorManager",null,[]);const ud=Ab=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Ab)};var Ud=a(16),ec=a(94),Db=a(306),ic=a(282);class Pc{constructor(Ab,Uc){this.$=Ab;this.flyoutRibbonButton=void 0===Uc?null:Uc;Db.a(this.$).hl(this);this.hasFocus=!1}dispose(){Db.a(this.$).XC(this)}get ud(){return document.getElementById("catchUpFlyoutContainer")}get ij(){return this.flyoutRibbonButton.B0f&&
!this.hasFocus}get tf(){return ic.a.wud}Nj(Ab,Uc){if(Uc)return!1;Ab=document.getElementById("flyoutItem0");if(!Ab)return t.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Ab.focus();this.Ghi(Ab);return!0}zk(Ab){return this.ud?Ca.DOMElementExtensions.Ki(this.ud,Ab):!1}Hm(){this.hasFocus=!0}fo(){this.hasFocus=!1}Ghi(Ab){if(Sys.Browser.agent===Sys.Browser.Firefox){var Uc=document.createEvent("KeyboardEvent");Uc.initKeyEvent(Ud.a.nd,!0,!0,window.self,
!1,!1,!1,!1,ec.a.U$b,0);Ab.dispatchEvent(Uc)}else Uc=document.createEvent("Events"),Uc.initEvent(Ud.a.nd,!0,!0),Uc.keyCode=ec.a.U$b,Uc.which=ec.a.U$b,Ab.dispatchEvent(Uc)}}Object(l.a)(Pc,"FlyoutFocus",null,[24,4]);var Ed=a(310),de=a(98);class se{constructor(Ab){this.buttonClickedCallback=null;this.kOb=this.cGc=!1;this.uDi=new Date;this.ACf=Ab}dispose(){this.kOb=this.cGc=!1}registerButtonClickedEvent(Ab){this.buttonClickedCallback&&t.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");
this.buttonClickedCallback=Ab.buttonClickedCallback}onFlyoutInitialized(){this.cGc&&t.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Ab=(new Date).getTime()-this.uDi.getTime();t.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Ab}`);de.c(ia.a.ZVh,!0,de.e,0,0,Ab);this.cGc=!0}logFlightTriggers(){}toggleCatchUpFlyout(){this.cGc?this.buttonClickedCallback?this.buttonClickedCallback():t.ULS.sendTraceTag(537168005,
3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):t.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get B0f(){return this.kOb}onFlyoutVisibilityChanged(Ab){this.kOb!==Ab.flyoutIsVisible&&(this.kOb=Ab.flyoutIsVisible,Ed.a.Xv&&Ed.a.Xv.ax(!0),this.kOb||this.ACf&&this.ACf.DEj())}}Object(l.a)(se,"FlyoutRibbonButton",null,[]);var Fe=a(619),fe=a(43),Tc=a(325);Object(fa.b)(la.CatchUpActivityManagerService,
{we:"singleton"})(async Ab=>{const [Uc,Od,le]=await Promise.all([fa.a.resolve(la.EwaControlService,Ab),N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?fa.a.resolve(la.BlueDotManagerService,Ab):null,fa.a.resolve(la.ZoomService,Ab)]);Ab=Ab.xa;const ge=new se(Object(Pa.a)(wa));return new ed(Uc,Ab,le,ge,Od)});class ed{constructor(Ab,Uc,Od,le,ge){le=void 0===le?null:le;this.GTa=null;this.cJa=0;this.PVb=this.ATb=this.xYf=this.Iqa=!1;this.aIb=null;this.oZa=!1;this.Mjg=(ze,Le)=>{this.Dze(Le.FPj)};
this.fg=()=>{const ze=this.$.fa.el.LineageVersion;this.cJa!==ze&&(t.ULS.sendTraceTag(509645837,0,50,`CatchUpActivityManager.onWorkbookMetadataChanged: lineageVersion: ${ze}, this.lineageVersion: ${this.cJa}`),this.cJa=ze,void this.D2b(!1))};this.Ln=()=>{t.ULS.sendTraceTag(509109976,0,100,"CatchUpActivityManager.onLoadOnDemandOccurred");void this.D2b(!0)};this.yd=(ze,Le)=>{ze=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7788930_BlueDotReloadAfterBecomingActive");Le.nI&&this.blueDotManager&&(t.ULS.sendTraceTag(509109975,
0,100,"CatchUpActivityManager.onSessionIdChanged"),ze&&void this.D2b(!0));ze||void this.D2b(!0)};this.Uug=ze=>{var Le,nf,cf;N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!Ba.a.Zg(ze.wywaActivities)&&ze.wywaActivities[0].type!==hb.Comment&&this.wpe()&&(this.showHideInGridHighlights(),this.$.fa.au(this.fg),null===(Le=this.blueDotManager)||void 0===Le?void 0:Le.BDh(this.onBlueDotDismissed),null===(nf=this.blueDotManager)||void 0===nf?void 0:nf.OCh(this.sNc),null===(cf=this.blueDotManager)||
void 0===cf?void 0:cf.PCh(this.Mjg),this.$.fa.LJ(this.Ln),this.$.fa.Vk(this.yd))};this.onBlueDotDismissed=()=>{this.wpe()};this.sNc=()=>{this.Iqa=!0;this.Jhe();this.y6.sNc();this.y6.GPg([]);this.aIb=[]};this.$=Ab;this.blueDotManager=void 0===ge?null:ge;this.xYf=N.EwaSettings.isChangeGateEnabled("OfficeVSO:7805176_CatchUpReadoutEnabled");this.y6=new tb(this.$,this.blueDotManager,Od);this.HIe=new Z(K.AFrameworkApplication.Kb,N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CatchUpMockDataEnabled",
!1));Ab=Ka.a.oxe(Object(Pa.d)(db));this.jpc=new Dd(this.$,Ab,this.RGc(),this.blueDotManager);this.ipc=new Cc(this.$,K.AFrameworkApplication.Kb);this.emptyCatchUpBehaviorManager=new $c(this.$);this.oZa=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotCountLimitEnabled",!1);this.$Cj(ze=>{this.fUj(ze)},Uc);this.rFj();this.flyoutRibbonButton=le;this.flyoutRibbonButton||la.CatchUpActivityManagerService.Oa()||(this.flyoutRibbonButton=new se(Object(Pa.a)(wa)));this.flyoutFocus=new Pc(this.$,
this.flyoutRibbonButton);this.blueDotManager&&this.blueDotManager.a_a()&&this.Dze(!1)}get lnj(){return this.flyoutRibbonButton.B0f}dispose(){this.GTa&&this.GTa.getWywaEvent().removeListener(this.Uug);this.Bqd()||this.Jhe();this.GTa=this.$=null;da.a.vb(this.y6);this.flyoutRibbonButton=this.flyoutFocus=this.HIe=this.ipc=this.jpc=this.y6=null}G6j(){this.flyoutRibbonButton.toggleCatchUpFlyout()}Ndl(Ab){this.y6.aKk(!Ab);this.Dze(Ab)}showHideInGridHighlights(){this.y6.uZc()}a_a(){return!!this.blueDotManager&&
this.blueDotManager.a_a()}PJi(Ab,Uc){if(!this.xYf||!this.blueDotManager||Uc.top!==Uc.bottom||Uc.left!==Uc.right||this.y6&&!this.y6.zcb())return null;Ab=this.blueDotManager.blueDotSheetRangeKey(new kc.a(Uc,Ab));Ab=this.blueDotManager.$Ob(Ab);if(!Ab)return null;Uc=Ab.fCi;return Ab.Gaj?[Uc,Uc]:[Uc]}Dze(Ab){N.EwaSettings.isChangeGateEnabled("OfficeVSO:7808898_EnableBlueDotsRefreshSuspension")&&(Ab&&this.ATb?this.eAk():Ab||this.ATb||this.l2k())}l2k(){this.ATb=!0}eAk(){this.ATb=!1;const Ab=this.PVb;this.PVb=
!1;this.Bqd()||void this.D2b(Ab)}Bqd(){var Ab;return this.oZa?null===(Ab=this.blueDotManager)||void 0===Ab?void 0:Ab.Iqa:this.Iqa}Jhe(){var Ab,Uc,Od;this.$.fa.Bv(this.fg);null===(Ab=this.blueDotManager)||void 0===Ab?void 0:Ab.Bsk(this.onBlueDotDismissed);null===(Uc=this.blueDotManager)||void 0===Uc?void 0:Uc.Trk(this.sNc);null===(Od=this.blueDotManager)||void 0===Od?void 0:Od.Urk(this.Mjg);this.$.fa.zL(this.Ln);this.$.fa.Qk(this.yd)}rFj(){t.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.")}async D2b(Ab){this.blueDotManager?
this.oZa&&this.blueDotManager.Iqa?t.ULS.sendTraceTag(508076379,0,50,"CatchUpActivityManager.refreshBlueDotsAsync: refreshBlueDotsAsync is called when blue dots are disabled for session"):this.ATb?(this.PVb=this.PVb||Ab,t.ULS.sendTraceTag(508696778,0,50,`BlueDots refresh is suspended, skip refresh, should do server reload when resuming: ${this.PVb}`)):(this.y6.YPg(!0),this.jpc.Y7g(()=>{setTimeout(()=>{this.wpe();this.y6.YPg(!1);Ab&&(this.cJa=0)},0)},null,Ab&&this.blueDotManager.eSk(),Ab)):t.ULS.sendTraceTag(508953163,
0,50,"blueDotManager is null when refreshBlueDotsAsync is called")}$Cj(Ab,Uc){ud("ScriptDownload");Ab(uc.d(Object(Tc.loadChunkWithDynamicScriptLoader)("catchUpActivity",{xa:Uc})))}RGc(){return this.$.fa.jKc}fUj(Ab){fe.TaskExtensions.tb(Ab,()=>{this.GTa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance({activityContentManager:this.HIe,activityNavigationManager:this.ipc,activityRequestManager:this.jpc,dataCulture:this.$.ta.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:this.flyoutRibbonButton,
uiCulture:this.$.ta.UICultureTag,ulsLogger:new sa.a,emptyCatchUpBehaviorManager:this.emptyCatchUpBehaviorManager});this.y6.v1e=this.GTa.getActivityIndicatorTooltipManager();Fe.b(this.$);this.GTa.getWywaEvent().addListener(this.Uug);ud("InitializeCatchUpApp");this.GTa.initialize({summaryStringEnabled:this.RGc(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0})},this.$.Aa,3)}iCk(Ab){if(!this.aIb||!Ab||this.aIb.length!==Ab.length)return!1;for(let le=0;le<Ab.length;le++){const ge=
Ab[le],ze=this.aIb[le];if(ge.Id!==ze.Id||ge.Type!==ze.Type||ge.Person.DisplayName!==ze.Person.DisplayName||ge.LocationList.length!==ze.LocationList.length)return!1;for(let Le=0;Le<ge.LocationList.length;Le++){var Uc=ge.LocationList[Le],Od=ze.LocationList[Le];if(Uc.Type!==Od.Type)return!1;if(0!==Uc.Type)t.ULS.shipAssertTag(508368390,0,!1,"CatchUpActivityManager.sameUserActivitiesAfterLoad: unsupported location type.");else{if(Uc.RangeList.length!==Od.RangeList.length)return!1;for(let nf=0;nf<Uc.RangeList.length;nf++){const cf=
Uc.RangeList[nf],Te=Od.RangeList[nf];if(cf.SheetName!==Te.SheetName||cf.FirstRow!==Te.FirstRow||cf.FirstColumn!==Te.FirstColumn||cf.LastRow!==Te.LastRow||cf.LastColumn!==Te.LastColumn)return!1}}}}return!0}wpe(){var Ab;if(this.Bqd())return!1;const Uc=this.jpc.neh();if(this.iCk(Uc))return!1;this.y6.GPg(Uc);this.aIb=Uc;return this.oZa&&(null===(Ab=this.blueDotManager)||void 0===Ab?0:Ab.Iqa)?(this.Jhe(),!1):!0}}Object(l.a)(ed,"CatchUpActivityManager",null,[336,4]);var pd=a(177),Kb=a(127);class rb extends Kb.a{constructor(Ab,
Uc,Od){super(Ab,Uc);this.e2d=Od}execute(Ab){this.e2d.lineageHidePreviousHistory();return super.execute(Ab)}}Object(l.a)(rb,"LineageClearHistoryConfirmedActivity",Kb.a,[]);var rc=a(45),ld=a(283),Tb=a(8),Wc=a(18),Ac=a(76),nd=a(163);let qd=class{constructor(Ab,Uc){this.$=Ab;this.e2d=Uc;Ab=[new Wc.a(Tb.a.d2d,1038647878,0,0,2244),new Wc.a(Tb.a.idle,1038647878,0,1)];Ac.a(this.$).Zge(new nd.a(Tb.a.c2d,Tb.a.idle,Ab),new rb(Tb.a.d2d,Tb.a.idle,Uc))}gd(){return!1}executeCommand(Ab,Uc,Od){Ab=!1;switch(Uc.command){case 1834994092:N.EwaSettings.isChangeGateEnabled("OfficeVSO:8942344_ReviewTabAutoSwitch")&&
(this.v2k(),t.ULS.sendTraceTag(507852168,0,50,"Show changes opened from entry point other than ribbon tab"));this.yUk(Uc,Od);Ab=!0;N.EwaSettings.EN()&&this.$.lza();break;case -409942531:this.DUk(),Ab=!0}return Ab?Ia.Task.Va(!0):Na.a(Uc.command)}Rc(Ab,Uc){return 1834994092===Uc.command||-409942531===Uc.command}td(){return!1}yUk(Ab,Uc){t.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${Uc.MenuItemId||Ab.Re}`);this.e2d.QWg(19===Ab.Re&&!!Uc.MenuItemId,
Uc.MenuItemId,Ab.Re,Uc)}v2k(){const Ab=pa.a.zSc;Ab!==pd.a(this.$).um.Tw&&pd.a(this.$).um.activateRibbonTab(Ab)}DUk(){rc.a(this.$).Dt(new ld.a(Tb.a.c2d,5,()=>{const Ab=Ac.a(this.$).Kd,Uc=M.a.Cd(3,1,2241,2242,2243,1038647878,"LineageConfirmClearHistory");Uc.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";Uc.HelpDescription=jc.a.instance.ia(1319);Ab.Yt([Uc])}))}};qd=Object(oa.__decorate)([Object(fa.d)(la.LineageActivityCommandHandlerService),Object(oa.__param)(0,Object(la.EwaControlService)()),Object(oa.__param)(1,
Object(la.LineageManagerService)())],qd);Object(l.a)(qd,"LineageActivityCommandHandler",null,[29]);var Xd=a(178),Hd=a(126);class Zc{}Object(l.a)(Zc,"LineageClientParams",null,[]);class Jc{}Object(l.a)(Jc,"LineageFilter",null,[]);var gc=a(173);Object(fa.b)(la.LineageManagerService,{we:"singleton"})(async Ab=>{const Uc=await fa.a.resolve(la.EwaControlService,Ab),Od=Uc.Vb.Uc("UserAction","LineagePaneSeenStopwatch");Od.start();const [le,,ge]=await Promise.all([fa.a.resolve(la.LineageTaskPaneService,Ab),
fa.a.resolve(la.ReactTaskPaneManagerService,Ab),N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?fa.a.resolve(la.BlueDotManagerService,Ab):null]);await Object(Tc.loadChunkWithDynamicScriptLoader)("cellLineage",Ab);return new dd(Uc,le,ge,Od)});class dd{constructor(Ab,Uc,Od,le){this.phb=this.xI=null;this.EJ=this.cJa=0;this.C_b=()=>{this.Jse&&(this.Jse.stop(),this.Jse=null);this.Kse.start();this.xI.createLineageTaskPane(this.b2d,this.phb,this.activityGuid)};this.onBlueDotsUpdated=
()=>{this.xI.onBlueDotsUpdated()};this.lineageOpenPaneOrChangeFilterRequest=(ge,ze)=>{this.Kse.stop();e.b(this.$).Jd(w.a.d1j,{});const Le=Object(Oa.a)(new Zc,{ClientViewCapacity:ge.clientViewCapacity});let nf=null;ze&&(nf=Object(Oa.a)(new Jc,{FilterSheetMultiRange:this.H7k(ze.filterSheetMultiRange),DateTimeFilter:this.F7k(ze.dateTimeFilter)}));const cf=Te=>{Te=E.a.te(Te.data);t.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${M.a.pc(Te)}]`)};
this.$.userOperationManager.enqueueOperation(new O.a(1010,0,(Te,Wf,Hf)=>{var ib=this.$.ma.sa,xc=nf;Te=A.c(Te,this.uMd("LineageOpenPaneOrChangeFilter"));Wf=A.b(Wf,cf);const Kc=ib.$a(1,null);Kc.clientParams=Le;Kc.lineageFilter=xc;return B.h(ib,"LineageOpenPaneOrChangeFilter",Kc,Te,Wf,Hf,null,0)},80),null)};this.lineageLoadMoreRequest=ge=>{e.b(this.$).Jd(w.a.c1j,{});const ze=Le=>{Le=E.a.te(Le.data);t.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${M.a.pc(Le)}]`)};
this.$.userOperationManager.enqueueOperation(new O.a(1011,0,(Le,nf,cf)=>{var Te=this.$.ma.sa;Le=A.c(Le,this.uMd("LineageLoadMore"));nf=A.b(nf,ze);const Wf=Te.$a(1,null);Wf.fetchFromBelow=ge;return B.h(Te,"LineageLoadMore",Wf,Le,nf,cf,null,0)},80),null)};this.lineageRefreshViewRequest=()=>{e.b(this.$).Jd(w.a.e1j,{});const ge=ze=>{ze=E.a.te(ze.data);t.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${M.a.pc(ze)}]`)};this.$.userOperationManager.enqueueOperation(new O.a(1012,
0,(ze,Le,nf)=>{var cf=this.$.ma.sa;ze=A.c(ze,this.uMd("LineageRefreshView"));Le=A.b(Le,ge);const Te=cf.$a(1,null);return B.h(cf,"LineageRefreshView",Te,ze,Le,nf,null,0)},80),null)};this.lineageUpdateViewRequest=()=>{Y(this.$.ma.sa,ge=>{if(ge=G.a(ge)?null:ge.Result){var ze={["CountOfUpdatedActivities"]:ge.LineageActivitiesResponse.ActivityList.length};e.b(this.$).Jd(w.a.f1j,ze);ge={activityList:L(ge.LineageActivitiesResponse.ActivityList,this.zea),latestActivityId:ge.LineageActivitiesResponse.LastSearchedActivityId,
oldestActivityId:ge.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:ge.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(ge.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:ge.HasNewActivities,filterSheetMultiRange:this.y7k(ge.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:ge.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:ge.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:ge.LineageActivitiesResponse.ShowLoadPrevious,
eolCorrelationId:ge.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(ge.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.GAc(ge.LineageActivitiesResponse.EolPersonHideHistory)};this.xI.onLineageActivitiesUpdateResponse(ge)}else t.ULS.shipAssertTag(537155475,0,!!ge,"LineageManager.LineageUpdateView returned null response.")},ge=>{ge=E.a.te(ge.data);t.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${M.a.pc(ge)}]`)},
null,null)};this.areInGridHighlightsAvailable=()=>Ha.a.GTb(this.$)&&this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.hasAnyActiveInGridHighlight=()=>this.blueDotManager?this.blueDotManager.hasAnyActiveInGridHighlight():!0;this.onDisplayInGridHighlightsChanged=ge=>{this.blueDotManager&&this.blueDotManager.CKk(ge)};this.onCardSelected=(ge,ze)=>{if(ge=ge.rangeHighlightLocation){if(ze){let Le;
if((()=>{let nf=eb.kb(ze,this.$.qa);({range:Le}=nf);return nf})().returnValue){this.oUf(ge.sheetName,this.uQb([eb.l(Le)]));return}t.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+ze+" is not valid.")}ge.rangeList.length?this.oUf(ge.sheetName,ge.rangeList):this.Lcj(ge.sheetName)}};this.onLearnMoreLinkClicked=()=>{const ge=new C.a(-859308420,fc.a.Hb,this.$.xc,12,null);this.$.Ia.Gb(ge,{[fc.a.Bf]:"HelpID=XLO_LineageTS",["InputMethod"]:fc.a.Hb,[fc.a.Wc]:pa.a.VF,["ShouldCanvasTakeFocus"]:!0})};
this.onVersionHistoryButtonClicked=ge=>{this.$.Ia.Gb(new C.a(-1112508866,ge,this.$.xc,12,null))};this.isFeatureEnabled=()=>!1;this.fg=()=>{const ge=this.$.fa.el.LineageVersion;ge!==this.cJa&&(t.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${ge}, this.lineageVersion: ${this.cJa}`),this.cJa=ge,this.dnk())};this.yd=(ge,ze)=>{this.xI&&!this.yI.QGc&&ze.nI&&(t.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};
this.Ln=()=>{this.xI&&!this.yI.QGc&&(t.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.MC=()=>{const ge=this.ejb();this.xI.onFilterableSheetListChange(ge)};this.fZ=()=>{const ge=this.ejb();this.xI.onFilterableSheetListChange(ge)};this.sPc=()=>{const ge=this.ejb();this.xI.onFilterableSheetListChange(ge)};this.onPaneClosed=()=>{this.xI.onPaneClosed();this.blueDotManager&&this.blueDotManager.a_a()&&this.blueDotManager.N2g(!1);
U(this.$.ma.sa,null,ge=>{ge=E.a.te(ge.data);t.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${M.a.pc(ge)}]`)},null,null)};this.onRangeFilterInputEnabled=ge=>{ge?this.da.ha.ZS(this.Nd):this.da.ha.rV(this.Nd)};this.Nd=()=>{var ge=eb.t(this.da.ha.oa.activeRange,this.$);ge={rangeList:this.uQb(ge.Ranges),sheetName:ge.SheetName};this.xI.onSelectedRangeUpdated(ge)};this.tryParseRangeInfo=ge=>{let ze,Le;if((()=>{let cf=eb.kb(ge,this.$.qa);({sheetName:Le,
range:ze}=cf);return cf})().returnValue){Le||(Le=this.$.qa.la.sheetName);var nf=[];nf.push(ze);nf=eb.x(Le,null,nf);return{rangeList:this.uQb(nf.Ranges),sheetName:nf.SheetName}}return null};this.gea=()=>{const ge=this.EJ!==this.$.fa.Je;this.xI&&this.yI.isVisible&&ge&&(this.EJ=this.$.fa.Je,this.xI.onRefreshRequired())};this.$=Ab;this.blueDotManager=Od;this.da=Mb.f(this.$);this.yI=Uc;this.b2d=this.yI.e8h();this.batchSize=50;this.Jse=le;this.Kse=this.$.Vb.Pg("UserAction","LineagePaneLoadingShimmerStopWatch");
this.zea=z.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.cij();this.wzh();this.q_d=N.EwaSettings.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.OfficeVSO_8836792_AsyncTaskPaneUITiming")}dispose(){this.yqk();this.$=null;this.yI&&(this.yI.guk(this.onPaneClosed),this.yI.Bxa(this.gea),this.yI=null);this.Kse=this.zea=this.phb=this.b2d=this.xI=null}QWg(Ab,Uc,Od,le){this.activityGuid=null;this.yI.isVisible&&!Ab&&16!==Od&&18!==Od&&30!==Od?this.yI.lwd():(this.yI.QGc||
t.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Ab?Uc:Od}`),this.EJ=this.$.fa.Je,this.phb=null,Ab?(Ab=eb.u(this.da.ha.oa.selectedRanges,this.$),this.phb={rangeList:Uc.toString()===pa.a.aWg?this.uQb(Ab.Ranges):null,sheetName:Ab.SheetName}):30===Od&&this.kek(le),this.yI.QGc?this.yI.XKk(this.C_b):this.xI.createLineageTaskPane(this.b2d,this.phb,this.activityGuid),this.q_d&&(null===le||void 0===le?0:le.event)&&gc.b(this.$).kq(le.event,"task_pane_open_lineage",
null,["task-pane"]),this.yI.dA(!0),this.blueDotManager&&this.blueDotManager.a_a()&&this.blueDotManager.N2g(!0),this.$.Dc(-71295319,-1,0,null))}kek(Ab){if(Ab){var Uc=Ab.sheetRanges,Od=Ab.activityGuid;Ab=Ab.blueDotSheetRangeKey;if(Uc&&Od)if(Ab){if(this.blueDotManager){Ab=this.blueDotManager.$Ob(Ab);if(!Ab){t.ULS.shipAssertTag(508384722,0,!1,"LineageManager.prepareBlueDotNavigationAndFilterFromCommandProperties(): blueDotActivity is null.");return}this.blueDotManager.Xfb(Ab.Wmd,2)}this.activityGuid=
Od;this.phb=this.QQi(Uc)}else t.ULS.shipAssertTag(508700375,0,!1,"LineageManager.prepareBlueDotNavigationAndFilterFromCommandProperties: blueDotSheetRangeKey is not set.");else t.ULS.shipAssertTag(509752709,0,!1,"Blue dot gridLocation/activityGuid is not set.")}else t.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){Xd.a.sendTelemetryEvent({name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:Hd.a.Eh({["paneVisible"]:this.yI.isVisible})});
this.$.userOperationManager.enqueueOperation(new O.a(1018,0,(Ab,Uc,Od)=>{var le=this.$.ma.sa;const ge=le.$a(1,null);return B.h(le,"LineageHidePreviousHistory",ge,Ab,Uc,Od,null,0)},64),null);this.yI.isVisible||this.QWg(!1,null,4,void 0)}cij(){var Ab={tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,
lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,hasAnyActiveInGridHighlight:this.hasAnyActiveInGridHighlight,onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged,shouldShowBlueDot:Uc=>
{var Od,le;return null!==(le=null===(Od=this.blueDotManager)||void 0===Od?void 0:Od.shouldShowBlueDot(Uc))&&void 0!==le?le:!1}};Ab={clientBatchSize:this.batchSize,filterableSheetList:this.ejb(),uiCulture:this.$.ta.UICultureTag,dataCulture:this.$.ta.DataCultureTag,logger:new sa.a,lineageAppCallbacks:Ab};this.xI=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Ab)}QQi(Ab){let Uc=null;const Od=this.$.qa.la;for(const le of Ab)le.sheetId===Od.sheetId&&(Ab=eb.l(le.range),
Uc?(Uc.FirstRow=Math.min(Uc.FirstRow,Ab.FirstRow),Uc.FirstColumn=Math.min(Uc.FirstColumn,Ab.FirstColumn),Uc.LastRow=Math.max(Uc.LastRow,Ab.LastRow),Uc.LastColumn=Math.max(Uc.LastColumn,Ab.LastColumn)):Uc=Ab);return{rangeList:[{firstCol:Uc.FirstColumn,firstRow:Uc.FirstRow,lastCol:Uc.LastColumn,lastRow:Uc.LastRow}],sheetName:Od.sheetName}}uMd(Ab){return Uc=>{if(Uc=G.a(Uc)?null:Uc.Result){var Od={["CountOfActivities"]:Uc.ActivityList.length};Od.WebRequestName=Ab;e.b(this.$).Jd(w.a.BZj,Od);Uc={activityList:L(Uc.ActivityList,
this.zea),latestActivityId:Uc.LastSearchedActivityId,oldestActivityId:Uc.FirstSearchedActivityId,serverMessageCode:Uc.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Uc.EcmaLastSearchedDate),serverFirstActivityId:Uc.ServerFirstActivityId,serverLastActivityId:Uc.ServerLastActivityId,showLoadPrevious:Uc.ShowLoadPrevious,eolCorrelationId:Uc.EolCorrelationId,eolDateHideHistory:new Date(Uc.EolDateHideHistory),eolPersonHideHistory:this.GAc(Uc.EolPersonHideHistory)};this.xI.onLineageActivitiesResponse(Uc)}else t.ULS.shipAssertTag(537155477,
0,!!Uc,"LineageManager."+Ab+" returned null response.")}}y7k(Ab){return Yb.a(Ab.Ranges)&&!Ab.SheetName?null:{rangeList:this.uQb(Ab.Ranges),sheetName:Ab.SheetName}}uQb(Ab){const Uc=[];for(const Od of Ab)Uc.push({firstCol:Od.FirstColumn,firstRow:Od.FirstRow,lastRow:Od.LastRow,lastCol:Od.LastColumn});return Uc}H7k(Ab){if(!Ab)return null;const Uc={};Uc.Ranges=this.PNd(Ab.rangeList);Uc.SheetName=Ab.sheetName;return Uc}F7k(Ab){if(!Ab)return null;const Uc={};Uc.TimeOption=Ab.timeOption;return Uc}PNd(Ab){const Uc=
[];if(Yb.a(Ab))return Uc;for(const Od of Ab)Ab={},Ab.FirstColumn=Od.firstCol,Ab.FirstRow=Od.firstRow,Ab.LastRow=Od.lastRow,Ab.LastColumn=Od.lastCol,Uc.push(Ab);return Uc}Lcj(Ab){(Ab=this.$.qa.getItemByName(Ab))&&Ab.visible&&Ab.activate({disableAutoFocusOnGrid:!0,scenario:"lineage"})}oUf(Ab,Uc){const Od=[];for(var le of Uc)Uc={},Uc.FirstColumn=le.firstCol,Uc.FirstRow=le.firstRow,Uc.LastRow=le.lastRow,Uc.LastColumn=le.lastCol,Od.push(eb.I(Uc));le=Od.length-1;Uc=Od[le].topLeft;Mb.f(this.$).oY(Od,le,
Ab,null,Uc,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}dnk(){this.xI&&this.yI.isVisible&&(this.EJ=this.$.fa.Je,this.xI.onRefreshRequired())}wzh(){var Ab;this.yI.BFh(this.onPaneClosed);this.yI.xqa(this.gea);this.$.fa.au(this.fg);this.$.fa.Vk(this.yd);this.$.fa.LJ(this.Ln);const Uc=this.$.qa;Uc.i0(this.MC);Uc.sqa(this.sPc);Uc.tqa(this.fZ);Uc.Tbb(this.sPc);null===(Ab=this.blueDotManager)||void 0===Ab?void 0:Ab.wGh(this.onBlueDotsUpdated)}yqk(){var Ab;this.$.fa.Bv(this.fg);this.da.ha.rV(this.Nd);
this.$.fa.Qk(this.yd);this.$.fa.zL(this.Ln);const Uc=this.$.qa;Uc.y9(this.MC);Uc.zxa(this.sPc);Uc.Axa(this.fZ);Uc.w3b(this.sPc);null===(Ab=this.blueDotManager)||void 0===Ab?void 0:Ab.evk(this.onBlueDotsUpdated)}onStaleActivitiesDetected(){this.xI.onStaleActivitiesDetected()}ejb(){const Ab=this.$.qa.items,Uc=[];for(const Od of Ab)Od.visible&&!Sb.e(Od)&&Uc.push(Od.sheetName);return Uc}GAc(Ab){if(!Ab)return null;let Uc=null;K.AFrameworkApplication.ea.ka("IsUserProfilePictureResolutionEnabled")&&(Uc=
this.zea.Eia(Ab.Email,Ab.Provider,K.AFrameworkApplication.Uh,0));return{id:Ab.Id,provider:Ab.Provider,displayName:Ab.DisplayName,email:Ab.Email,imageUrl:Uc}}}Object(l.a)(dd,"LineageManager",null,[334,4]);var Bb=a(606),pc=a(267),wc=a(20),cd=a(960),Vd=a(684);const xb=N.EwaSettings.isChangeGateEnabled("OfficeVSO:8849239_ShowChangesBGColorFix")?"LineageActivityPaneBody":"LineageActivityBody";Object(fa.b)(la.LineageTaskPaneService,{we:"singleton"})(async Ab=>{const Uc=await fa.a.resolve(la.EwaControlService,
Ab);await Promise.all([fa.a.resolve(Vd.b,Ab),fa.a.resolve(la.CommonUIStringsService,Ab)]);Ab=await fa.a.resolve(la.ReactTaskPaneManagerService,Ab);return ub.Ea(Uc,Ab)});class ub extends pc.a{constructor(Ab,Uc,Od){super(Ab);this.C_b=null;this.fYd=!0;this.cS=0;this.d8a=!1;this.jd=(le,ge)=>{ge.Hg||this.lwd()};this.$=Uc;this.taskPaneManager=Od;this.$.Sj(this.jd);Db.a(this.$).hl(this);this.isVisible=!1}xqa(Ab){this.addHandler("LineageTaskPaneVisibilityChanged",Ab)}Bxa(Ab){this.removeHandler("LineageTaskPaneVisibilityChanged",
Ab)}BFh(Ab){this.get_events().addHandler("LineageTaskPaneClose",Ab)}guk(Ab){this.get_events().removeHandler("LineageTaskPaneClose",Ab)}get isVisible(){return super.isVisible}set isVisible(Ab){super.isVisible!==Ab&&(super.isVisible=Ab,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get QGc(){return this.fYd}get ij(){return this.isVisible}get Q6a(){return 15}get tf(){return ic.a.FCj}get gs(){return wc.a.Fui}get cL(){return 300}get isResizable(){return!1}get ud(){return this.domElement}get height(){return this.taskPaneManager.v0c.offsetHeight}get titleText(){return jc.a.instance.ia(1294)}get OG(){return this.taskPaneManager.dib(this.ud,
this.titleText,this.cL,this.isResizable,()=>{this.isVisible=!0;this.C_b?this.C_b():t.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{N.EwaSettings.isChangeGateEnabled("OfficeVSO:8234691_setLineagePaneCloseAtTheBeginingOfCallback")||(this.isVisible=!1);this.lwd()},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.cL)}GQ(){return this.d8a}v2(){return this.d8a}Hm(){}fo(){}dispose(){this.$&&(this.$.ro(this.jd),Db.a(this.$).XC(this));this.taskPaneManager=this.$=null;
super.dispose()}Nj(Ab,Uc){if(!Uc){Ab=Ca.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Ab)return!1;Ca.DOMElementExtensions.setFocus(Ab)}return!Uc}zk(Ab){return Ca.DOMElementExtensions.Ki(this.ud,Ab)}dA(Ab){this.d8a=Ab;const Uc=this.taskPaneManager;if(this.isVisible=Ab)this.$.frame.hh.fm("LineagePane"),this.fYd=!1;Ab?Uc.PC("LineageTaskPane",this.OG):Uc.hideTaskPane("LineageTaskPane");this.$.Sg()}e8h(){const Ab=this.domElement,Uc=cd.b("div","LineagePaneBodyId",xb);
Ab.appendChild(Uc);this.YKk();return Uc}lwd(){this.$.frame.hh.fm(this.$.frame.hh.b1||Bb.AFrame.p0);this.fYd=!0;this.dA(!1);this.raiseEvent("LineageTaskPaneClose")}XKk(Ab){this.C_b=Ab}YKk(){this.$.frame.hh.Bp("LineagePane");const Ab=this.$.frame.hh.ql("LineagePane");Ab.parent=Bb.AFrame.p0;Ab.JY=!0}static Ea(Ab,Uc){let Od=document.getElementById(Ab.Oc+pa.a.o9f);Od||(Od=document.createElement("div"),Od.id=Ab.Oc+pa.a.o9f,Od.classList.add("LineageActivityPane"));return new ub(Od,Ab,Uc)}}Object(l.a)(ub,
"LineageTaskPane",pc.a,[333,4,229,24]);var Fc=a(78),xd=a(136),Ic=a(256);class bd{static addAppPLTEventToLog(Ab){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Ab)}catch(Uc){}}static setIsPageLoadForFirstTime(Ab){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Ab)}catch(Uc){}}}Object(l.a)(bd,"VersionHistoryLogConnector",null,[]);var yb=a(974),Oc=a(1099),kd=a(199),Rc;let Xb=Rc=class extends Kb.a{constructor(Ab,Uc,Od,le,ge){la.RestoreVersionActivityService.Oa()?
(super(Tb.a.oVc,Tb.a.yj),this.tK=Tb.a.y4b,this.retryCount=null):(super(Ab,Uc),this.tK=Od,this.yba=le,this.baseUrl=ge,this.retryCount=0);this.executionContext=null}execute(Ab){this.executionContext=Ab;la.RestoreVersionActivityService.Oa()||(this.retryCount=3);this.APj();return 1}APj(){var Ab=this.executionContext.ff,Uc=this.executionContext.activityState[Rc.cSc];const Od={};Od.VersionId=this.executionContext.activityState[Rc.W$g];Od.QuerySignature=Uc;Uc=Ab.ma.sa.mc();Ab=Ab.ma.sa;var le=this.Z1j.bind(this),
ge=this.Y1j.bind(this);Uc=Ab.$a(0,void 0===Uc?null:Uc);Uc.restoreVersionParams=Od;B.h(Ab,"RestoreVersion",Uc,le,ge,null,null,0)}Z1j(Ab){const Uc=Ab.Result;Uc?Uc.Success?(de.c(2138207060,!0),t.ULS.sendTraceTag(508859478,0,15,"RestoreVersionActivity:onNewRestoreSuccessCallback Restore version is successful")):(de.c(2138207060,!1),t.ULS.sendTraceTag(508859479,0,10,`RestoreVersionActivity:onNewRestoreSuccessCallback Restore version failed with message ${Ab.Result.Output}`),this.zi(this.tK)):(de.c(2138207060,
!1),this.zi(this.tK));(Ab=this.executionContext.activityState[Rc.y3d])&&Ab();this.mr();this.executionContext.MP()}Y1j(){t.ULS.sendTraceTag(508859477,0,10,"RestoreVersionActivity:onNewRestoreFailureCallback Restore version failed");de.c(2138207060,!1);this.zi(this.tK);const Ab=this.executionContext.activityState[Rc.y3d];Ab&&Ab();this.mr();this.executionContext.MP()}};Xb.W$g="RVAvi";Xb.cSc="RVAqs";Xb.y3d="RVlvrt";Xb=Rc=Object(oa.__decorate)([Object(fa.d)(la.RestoreVersionActivityService)],Xb);Object(l.a)(Xb,
"RestoreVersionActivity",Kb.a,[]);var dc;let Vc=dc=class extends Kb.a{constructor(Ab,Uc){la.RestoreVersionErrorActivityService.Oa()?super(Tb.a.y4b,Tb.a.yj):super(Ab,Uc)}execute(Ab){(0,Ab.activityState[dc.CXg])(()=>{this.mr();Ab.MP()});return 1}};Vc.CXg="RVEAssea";Vc=dc=Object(oa.__decorate)([Object(fa.d)(la.RestoreVersionErrorActivityService)],Vc);Object(l.a)(Vc,"RestoreVersionErrorActivity",Kb.a,[]);var yd=a(1337);class Pd{constructor(Ab){this.pB=Ab}hl(){Db.a(this.pB.$).$A(this.tf)||Db.a(this.pB.$).hl(this)}Sfa(){Db.a(this.pB.$).$A(this.tf)&&
Db.a(this.pB.$).XC(this)}get tf(){return ic.a.T$g}get ud(){return document.querySelector('[id="vhHeader"]')}get ij(){return!0}zk(Ab){return Ca.DOMElementExtensions.Ki(this.ud,Ab)}Hm(){this.pB.$.frame.hh.Bp(this.pB.$.frame.hh.b1)}fo(){}Nj(Ab,Uc){Uc||this.pB.R9b.then(Od=>{Od.enterHeaderFocusTrapZone();return null});return!Uc}}Object(l.a)(Pd,"VersionHistoryHeader",null,[24]);class re{constructor(Ab){this.pB=Ab}hl(){Db.a(this.pB.$).$A(this.tf)||Db.a(this.pB.$).hl(this)}Sfa(){Db.a(this.pB.$).$A(this.tf)&&
Db.a(this.pB.$).XC(this)}get tf(){return ic.a.U$g}get ud(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get ij(){return!0}zk(Ab){return Ca.DOMElementExtensions.Ki(this.ud,Ab)}Hm(){this.pB.$.frame.hh.Bp(this.pB.$.frame.hh.b1)}fo(){}Nj(Ab,Uc){Uc||this.pB.R9b.then(Od=>{Od.enterFocusTrapZone();return null});return!Uc}}Object(l.a)(re,"VersionHistoryPane",null,[24]);class ue{constructor(Ab){this.pB=Ab}hl(){Db.a(this.pB.$).$A(this.tf)||Db.a(this.pB.$).hl(this)}Sfa(){Db.a(this.pB.$).$A(this.tf)&&
Db.a(this.pB.$).XC(this)}get tf(){return ic.a.V$g}get ud(){return document.querySelector('[id="vhViewer"]')}get ij(){return!0}zk(Ab){return Ca.DOMElementExtensions.Ki(this.ud,Ab)}Hm(){this.pB.$.frame.hh.Bp(this.pB.$.frame.hh.b1)}fo(){}Nj(Ab,Uc){Uc||this.pB.R9b.then(Od=>{Od.enterViewerFocusTrapZone();return null});return!Uc}}Object(l.a)(ue,"VersionHistoryViewer",null,[24]);var He=a(168),bf=a(287),af=a(952),Pe=a(353),wf;(function(Ab){Ab[Ab.None=0]="None";Ab[Ab.VHUnknown=1]="VHUnknown";Ab[Ab.VHFailedToLoadVersionList=
100]="VHFailedToLoadVersionList";Ab[Ab.VHFailedToGetDownloadToken=101]="VHFailedToGetDownloadToken";Ab[Ab.VHFailedToParseVersionList=102]="VHFailedToParseVersionList";Ab[Ab.VHFetchFailed=103]="VHFetchFailed";Ab[Ab.VHVersioningNotEnabled=104]="VHVersioningNotEnabled";Ab[Ab.VHFileNotFound=105]="VHFileNotFound";Ab[Ab.VHVersionTooOld=106]="VHVersionTooOld";Ab[Ab.VHFetchException=107]="VHFetchException";Ab[Ab.VHServiceUnavailable=108]="VHServiceUnavailable";Ab[Ab.VHBadGateway=109]="VHBadGateway";Ab[Ab.VHUnauthorized=
110]="VHUnauthorized";Ab[Ab.VHInternalServerError=111]="VHInternalServerError";Ab[Ab.VHEmptyVersionMetadatas=112]="VHEmptyVersionMetadatas";Ab[Ab.VHFailedHostDownload=113]="VHFailedHostDownload";Ab[Ab.VHFailedToAddDownloadToVersionStore=114]="VHFailedToAddDownloadToVersionStore";Ab[Ab.VHFailedToCacheParts=115]="VHFailedToCacheParts";Ab[Ab.VHFailedToDownloadVersionMetadata=116]="VHFailedToDownloadVersionMetadata";Ab[Ab.VHFailedToDownloadParts=117]="VHFailedToDownloadParts";Ab[Ab.VHInvalidDocID=118]=
"VHInvalidDocID";Ab[Ab.VHMissingDocID=119]="VHMissingDocID";Ab[Ab.VHNullDocID=120]="VHNullDocID";Ab[Ab.VHNullHashedDocID=121]="VHNullHashedDocID";Ab[Ab.VHNullGetDownloadAccessTokenRequest=122]="VHNullGetDownloadAccessTokenRequest";Ab[Ab.VHFailedToDownloadVersionFromHost=123]="VHFailedToDownloadVersionFromHost";Ab[Ab.VHNullResponseFromFetch=124]="VHNullResponseFromFetch";Ab[Ab.VHGetTipVersionException=125]="VHGetTipVersionException";Ab[Ab.VHGetVersionsException=126]="VHGetVersionsException";Ab[Ab.VHGetDownloadTokenException=
127]="VHGetDownloadTokenException";Ab[Ab.VHFetchRetryException=128]="VHFetchRetryException";Ab[Ab.VHNullResponseFromRequestVersionHistory=129]="VHNullResponseFromRequestVersionHistory";Ab[Ab.VHNullResponseFromRequestDownloadToken=130]="VHNullResponseFromRequestDownloadToken";Ab[Ab.VHXhrJsonParseFailed=131]="VHXhrJsonParseFailed";Ab[Ab.VHXhrException=132]="VHXhrException";Ab[Ab.VHNullResponseFromXhr=133]="VHNullResponseFromXhr";Ab[Ab.VHFileGone=134]="VHFileGone";Ab[Ab.VHNullRevisionIDs=135]="VHNullRevisionIDs";
Ab[Ab.VHRequestDeleteVersionsException=136]="VHRequestDeleteVersionsException";Ab[Ab.VHNullResponseFromRequestDeleteVersions=137]="VHNullResponseFromRequestDeleteVersions";Ab[Ab.VHVersionInfoFromTipVersionException=138]="VHVersionInfoFromTipVersionException"})(wf||(wf={}));var xf;(function(Ab){Ab[Ab.NotSet=0]="NotSet";Ab[Ab.PowerPoint=100]="PowerPoint";Ab[Ab.Word=110]="Word";Ab[Ab.Excel=120]="Excel";Ab[Ab.OneNote=130]="OneNote"})(xf||(xf={}));var Cf;(function(Ab){Ab[Ab.None=0]="None";Ab[Ab.Share=
1]="Share";Ab[Ab.Rename=2]="Rename";Ab[Ab.Restore=3]="Restore"})(Cf||(Cf={}));class tf{constructor(Ab){this.baseVersionInfo=this.Esc=this.Tna=this.versionHistoryController=this.IX=this.R9b=null;this.yhe=this.shg=!1;this.wmf=!0;this.dialog=this.accessTokenExpirationManager=this.lA=this.kCf=this.GL=this.FBe=this.CBe=this.EBe=null;this.Jrg=Uc=>{t.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.DTk()){var Od=ge=>{de.c(2138207060,!1);this.versionHistoryController.setRestoreFailedAtServer(ge)};
this.GL&&this.GL.startTimer(tf.t2g);var le=()=>{this.GL.endTimer(tf.t2g);this.Vcf(this.GL)};this.versionHistoryController.setRestoreInProgress();rc.a(this.$).Dt(new ld.a(Tb.a.xy,5,()=>{const ge=Ac.a(this.$).Kd.activityState;ge[bf.a.Tq]=Tb.a.Mff;ge[He.a.d6]=!0;ge[He.a.d0]=0;ge[Xb.W$g]=Uc;ge[Xb.cSc]=K.AFrameworkApplication.Uh;ge[Xb.y3d]=le;ge[Vc.CXg]=Od;ge[Pe.a.UPc]=!0}))}else de.c(2138207060,!1)};this.vug=Uc=>{this.R9b.then(Od=>{Od.enterFocusTrapZone();return null});t.ULS.sendTraceTag(537150349,0,
50,"VersionHistoryPaneActor: OnVersionsReady called");this.GL.endTimer(tf.Zwe);this.GL.incrementCounter(tf.b5h);t.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.GL.getTimerDuration(tf.Zwe)}`);this.hyk(Uc.containerDiv);Uc.versions&&0<Uc.versions.length&&(this.kCf=tf.Pca(Uc.versions[Uc.versions.length-1]));t.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=Uc=>{t.ULS.sendTraceTag(537150345,
0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${tf.Pca(Uc.currentVersion)}, LastSelected:${tf.Pca(this.Esc)}`);this.GL.incrementCounter(tf.a5h);this.Esc=Uc.currentVersion;this.baseVersionInfo=Uc.baseVersion;this.shg=Uc.noBaseToCompareTo;this.Tna&&this.Bil()&&(this.fFk(Uc.currentVersion),t.ULS.sendTraceTag(537150344,0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.$8d=()=>{t.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");
this.i_h();const Uc=new C.a(1470556788,0,this.$.xc,0,null);this.$.Ia.Gb(Uc)};this.Wrg=()=>{t.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");this.B5b(yd.a.saveACopy,{})};this.zlg=()=>{t.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");this.CTk()&&this.B5b(yd.a.fgb,{})};this.jjg=Uc=>{this.versionHistoryController.setFullAppErrorCode(Uc);this.versionHistoryController.setViewerError(!0)};this.l9e=Uc=>{const Od=document.getElementById(tf.qzf);
!Od||this.lA&&!Uc||(t.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.lA=new yd.a(Od.contentWindow,Fc.a.getOrigin(this.$.ta.VersionHistoryActionUrl)||af.a.sH),this.lA.ik(xd.a.b8a,this.B3a),this.lA.ik("App_EwrWorkbookNotSupportedCancelResponse",this.B3a),this.lA.ik(xd.a.c8a,this.B3a),this.lA.ik(xd.a.g1,this.B3a),this.lA.nl(yd.a.setCurrentChangeCount),this.lA.nl(yd.a.setTotalChangesCount),this.lA.nl(yd.a.u2a),this.lA.ik(yd.a.setCurrentChangeCount,
this.B3a),this.lA.ik(yd.a.setTotalChangesCount,this.B3a),this.lA.ik(yd.a.u2a,this.B3a))};this.Vmg=Uc=>{Uc=wf[Uc]?wf[Uc]:"None";this.GL.addEvent("OnFullAppError",Uc);t.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${Uc}`)};this.nae=Uc=>{this.wmf=Uc;t.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${Uc.toString()}`);this.B5b(yd.a.w9b,{["ToggleValue"]:Uc})};this.Eog=Uc=>{t.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${Uc}`);
de.c(1488635506,!0);const Od={};Uc?this.B5b(yd.a.iterateNext,Od):this.B5b(yd.a.KIa,Od)};this.B3a=Uc=>{switch(Uc.MessageId){case xd.a.b8a:t.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");this.versionHistoryController.setVersionLoadComplete();break;case "App_EwrWorkbookNotSupportedCancelResponse":t.ULS.sendTraceTag(508347987,0,15,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession App_EwrWorkbookNotSupportedCancelResponse");this.versionHistoryController.setViewerError(!0);
break;case xd.a.c8a:t.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case yd.a.setCurrentChangeCount:Uc=Uc.Values.count;t.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${Uc}`);this.versionHistoryController.setCurrentChangeCount(Uc);break;case yd.a.setTotalChangesCount:Uc=Uc.Values.count;t.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${Uc}`);
this.versionHistoryController.setTotalChangesCount(Uc);break;case yd.a.u2a:this.nae(this.wmf);break;case xd.a.g1:t.ULS.sendTraceTag(509682466,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession DocumentRefresh");this.ASj();break;default:t.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${Uc.MessageId}`)}};this.$=Ab;this.pNb=this.$.Oc+tf.Nxi;this.vbi();la.AccessTokenManagerService.Oa()?void fa.a.Bd(la.AccessTokenManagerService).then(Uc=>
{this.accessTokenExpirationManager=Uc;this.hZ=this.hZ.bind(this);this.accessTokenExpirationManager.uqa(this.hZ)}):this.$.ra.Vc(38,Uc=>{this.accessTokenExpirationManager=Uc;this.hZ=this.hZ.bind(this);this.accessTokenExpirationManager.uqa(this.hZ)});this.fXb="";this.i1d=0;this.perfTelemetryInfos=[]}hZ(){null!=this.versionHistoryController&&(this.versionHistoryController.updateDocId(K.AFrameworkApplication.Uh),t.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){this.accessTokenExpirationManager&&
this.accessTokenExpirationManager.lsb(this.hZ);this.Gpc()}Sck(){void fa.a.Bd(la.EwaAccessibilityManagerService).then(Ab=>{this.IX=Ab;this.IX.mode=2})}vbi(){this.EBe=new re(this);this.CBe=new Pd(this);this.FBe=new ue(this)}LXk(){null===this.Tna&&null===this.versionHistoryController||this.$8d();t.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");Ic.a.UN("8492a557;72ff4572");this.GL=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=
[];this.GL.startTimer(tf.s2g);if(!this.versionHistoryController&&(this.versionHistoryController=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance({ulsLogger:new sa.a,docId:K.AFrameworkApplication.Uh,appSettings:{appName:xf.Excel,userSessionId:K.AFrameworkApplication.userSessionId,serverSessionId:this.$.fa.sessionId,wdEnableDownloadTokens:!0,wacCluster:K.AFrameworkApplication.od.X4,uiLocale:K.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:this.$.isEditMode,wdEnableIterator:N.EwaSettings.Ra(279),
useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:!0,disableSaveACopy:this.wUg()||this.ore(),wdEnableShowVersionChanges:!0,disabledChangeGates:this.$.ta.VHSDisabledChangeGates,isRtl:K.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1),wdDisableSPOFileCache:!0,wdDisableODCFileCache:!0,wdEnableAppVHProvider:!0},perfTelemetryInfos:this.perfTelemetryInfos}),!this.versionHistoryController))return t.ULS.sendTraceTag(537150352,
0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),de.c(429638140,!1),!1;this.MXk();this.GL.endTimer(tf.s2g);this.GL.startTimer(tf.w2g);t.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");de.c(429638140,!0);return!0}MXk(){var Ab;this.tpk();if(!document.getElementById(this.pNb)){const Uc=document.createElement("div");Uc.id=this.pNb;Uc.style.width="100%";Uc.style.zIndex="998";Uc.style.display=
"block";Uc.style.position="absolute";const Od=(null===(Ab=document.getElementById("HeaderRegion"))||void 0===Ab?void 0:Ab.offsetHeight)||0;Uc.style.top=Od+"px";Uc.style.bottom="0px";Uc.style.height=`calc(100vh - ${Od}px)`;this.$.Su.insertBefore(Uc,this.$.Su.firstChild);this.R9b=this.versionHistoryController.createVersionHistoryDialog(Uc)}document.getElementById(this.pNb).style.display="block";this.ohe();this.GL.startTimer(tf.Zwe);this.versionHistoryController.getVersions("")}ohe(){this.EBe.hl();this.CBe.hl();
this.FBe.hl();this.Sck()}nze(){this.EBe.Sfa();this.CBe.Sfa();this.FBe.Sfa();this.IX&&(this.IX.mode=0)}tpk(){this.versionHistoryController.getVersionsReadyEvent().addListener(this.vug);this.versionHistoryController.getVersionSelectedEvent().addListener(this.onVersionSelected);this.versionHistoryController.getCloseSelectedEvent().addListener(this.$8d);this.versionHistoryController.getFullAppErrorEvent().addListener(this.Vmg);this.versionHistoryController.getIteratorSelectedEvent().addListener(this.Eog);
this.versionHistoryController.getShowVersionChangesToggledEvent().addListener(this.nae);this.versionHistoryController.getSaveACopySelectedEvent().addListener(this.Wrg);this.versionHistoryController.getDownloadVersionSelectedEvent().addListener(this.zlg);this.$.isEditMode&&(this.versionHistoryController.getRestoreVersionSelectedEvent().addListener(this.Jrg),this.yhe=!0)}upk(){this.Tna.getAppErrorEvent().addListener(this.jjg)}Bi(){this.versionHistoryController.getVersionsReadyEvent().removeListener(this.vug);
this.versionHistoryController.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.versionHistoryController.getCloseSelectedEvent().removeListener(this.$8d);this.versionHistoryController.getFullAppErrorEvent().removeListener(this.Vmg);this.versionHistoryController.getIteratorSelectedEvent().removeListener(this.Eog);this.versionHistoryController.getShowVersionChangesToggledEvent().removeListener(this.nae);this.versionHistoryController.getSaveACopySelectedEvent().removeListener(this.Wrg);
this.versionHistoryController.getDownloadVersionSelectedEvent().removeListener(this.zlg);this.yhe&&(this.versionHistoryController.getRestoreVersionSelectedEvent().removeListener(this.Jrg),this.yhe=!1);this.Tna&&this.Tna.getAppErrorEvent().removeListener(this.jjg)}ore(){const Ab=0===(this.$.DT&64);return!this.$.b8||Ab}CTk(){return this.ore()?(t.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),de.c(1316171850,!1),!1):!0}DTk(){let Ab=!0;(N.EwaSettings.isChangeGateEnabled("OfficeVSO:8279562_CheckAmIOnlyEditorWhenRestoreVersion")?
this.$.fa.Rpd:this.$.fa.WW)||(this.FEj(),this.versionHistoryController.setCoauthRestoreError(),Ab=!1);this.$.hU&&(t.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Ab&&(Ab=!1,this.JXk()));return Ab}JXk(){var Ab=M.a.Cd(1,0,1903,1902,0,-1603358883,"RestoreVersionUnsavedChangesError");Ab=this.dialog||new kd.ErrorDialog(this.$,Ab);Ab.initialize();Ab.Om()}Bil(){t.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?
tf.Pca(this.baseVersionInfo):""}`);return tf.Pca(this.Esc)===this.kCf?(t.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0):!this.baseVersionInfo&&this.shg?(t.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),!0):this.baseVersionInfo?!0:(t.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1)}wUg(){let Ab;Ab=0===(this.$.DT&
16|this.$.DT&8);return!this.$.b8||Ab}i_h(){document.getElementById(this.pNb).style.display="none";const Ab=new C.a(-1423792966,0,this.$.xc,0,null);this.$.Ia.Gb(Ab);this.Gpc()}Gpc(){this.GL&&(this.GL.endTimer(tf.w2g),this.Vcf(this.GL),this.GL=null);this.Bi();this.nze();this.perfTelemetryInfos&&(t.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Uc=>JSON.stringify(Uc)).toString()),this.perfTelemetryInfos=null);this.lA&&(this.lA.YL(xd.a.b8a),this.lA.YL(xd.a.c8a),this.lA.YL(yd.a.setCurrentChangeCount),
this.lA.YL(yd.a.setTotalChangesCount),this.lA.YL(xd.a.g1),this.lA.YL(yd.a.u2a),this.lA.YL("App_EwrWorkbookNotSupportedCancelResponse"),this.lA.dispose(),this.lA=null);this.Tna=this.versionHistoryController=null;const Ab=document.getElementById(this.pNb);Ab&&Ab.remove()}hyk(Ab){try{if(this.Tna)bd.setIsPageLoadForFirstTime(!1),document.getElementById(tf.qzf)||(this.Tna.resetContainer(Ab),this.l9e(!0));else{bd.setIsPageLoadForFirstTime(!0);const Uc={ulsLogger:new sa.a,actionUrl:this.$.ta.VersionHistoryActionUrl,
hideEmbedFooter:!0,useFetch:!0};this.Tna=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance({appBootSettings:Uc,rootDiv:Ab,versionHistoryController:this.versionHistoryController})}this.upk()}catch(Uc){t.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${Uc}`)}}fFk(Ab){t.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${tf.Pca(Ab)}, LastSelected:${this.fXb}`);if(Ab)if(tf.Pca(Ab).length){var Uc=
(new Date).getTime();if(tf.Pca(Ab)===this.fXb&&1E3>Uc-this.i1d)t.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");else{tf.Pca(Ab)!==this.fXb&&(t.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.versionHistoryController.setTotalChangesCount(-1),this.versionHistoryController.setCurrentChangeCount(-1));var Od=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Od.addEvent("SelectVersion",
tf.Pca(Ab));try{this.gll(Od),this.i1d=Uc,this.fXb=tf.Pca(Ab),this.Tna.onVersionSelectedWithParams({selectedVersionInfo:this.Esc,baseVersionInfo:this.baseVersionInfo,telemetryCollector:Od}),this.versionHistoryController&&this.versionHistoryController.setDisableSaveACopy(this.wUg()||this.ore()),this.l9e(!1)}catch(le){this.i1d=0,this.fXb="",Od.addEvent("Exception",le.toString()),t.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${le}`)}finally{t.ULS.sendTraceTag(537150292,
0,50,Od?Od.getJsonForLogging():"")}}}else t.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else t.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}gll(Ab){for(const Uc of this.perfTelemetryInfos){const Od=Uc.TelemetryEventKey?Uc.TelemetryEventKey:Uc.telemetryEventKey?Uc.telemetryEventKey:"",le=Uc.TelemetryEventData?Uc.TelemetryEventData:Uc.telemetryEventData?Uc.telemetryEventData:"";Od&&le&&
Ab.addEvent(Od,le)}this.perfTelemetryInfos.length=0}Vcf(Ab){t.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Ab?Ab.getJsonForLogging():""} `)}FEj(){const Ab=this.$.fa.ko,Uc={};let Od=null;for(const le of Ab)le.UserEmail&&(Uc[le.UserEmail]=le.UserEmail in Uc?Uc[le.UserEmail]+1:1),le.User.UserID===this.$.fa.clientId&&(Od=le.UserEmail);t.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Ab.length}, TotalAuthorsAsYourself ${Od?
Uc[Od]:-1}`)}ASj(){rc.a(this.$).Dt(new ld.a(Tb.a.xy,5,()=>{const Ab=Ac.a(this.$).Kd.activityState;Ab[bf.a.Tq]=Tb.a.yj;Ab[Pe.a.UPc]=!0}))}B5b(Ab,Uc){t.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Ab}`);if(this.lA){Ab=new yb.a(Ab);Ab.Values[Oc.a.RKb]=this.$.ta.UserSessionId;if(Uc)for(const Od in Uc)Ab.Values[Od]=Uc[Od];this.lA.send(Ab)}else t.ULS.sendTraceTag(537150284,0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static Pca(Ab){return Ab?
Ab.RevisionID?Ab.RevisionID:Ab.revisionID?Ab.revisionID:"":""}}tf.Nxi="_excelVersionHistoryOverlay";tf.qzf="vhs_frame";tf.s2g="TimeTakenShowVersionHistoryDialogAction";tf.w2g="TimeTillVersionHistoryDialogWasOpenMs";tf.Zwe="TimeTakenGetVersionsToOnVersionsReady";tf.a5h="CountOnVersionSelectedCalledinOneVHSession";tf.b5h="CountOnVersionsReadyCalledinOneVHSession";tf.t2g="TimeTakenVersionRestore";Object(l.a)(tf,"VersionHistoryPaneActor",null,[4]);var Jf=a(433);Object(fa.b)(la.VersionHistoryCommandHandlerService,
{we:"singleton"})(async Ab=>{await Object(Tc.loadChunkWithDynamicScriptLoader)("excelVersionHistory",Ab);const Uc=await fa.a.resolve(la.EwaControlService,Ab);Ab=await fa.a.resolve(la.HostMessengerService,Ab);const Od=Fc.a.getOrigin(Uc.ta.VersionHistoryActionUrl);Od!==af.a.sH&&Ab.pH(Od);return new dg(Uc,null)});class dg{constructor(Ab,Uc){this.$=Ab;this.tjl=la.VersionHistoryHighlightManagerService.Oa()?new tf(Ab):Uc}gd(){return K.AFrameworkApplication.ea.ka("IsAnonymousUser")?(t.ULS.sendTraceTag(537150415,
0,15,"Version History Command Handler: Anonymous user."),!0):!1}executeCommand(Ab,Uc){t.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Ab=!1;switch(Uc.command){case -1112508866:Jf.a(this.$)&&fa.a.Cb(la.PresentModeManagerService).vZc(!1),Ab=this.tjl.LXk()}t.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Ab}.`);N.EwaSettings.EN()&&this.$.lza();return Ab?Ia.Task.Va(Ab):Na.a(Uc.command)}Rc(Ab,Uc){return-1112508866===Uc.command&&
this.$.isVersionHistoryEnabled()}td(){return!1}}Object(l.a)(dg,"VersionHistoryCommandHandler",null,[29]);var uf=a(1447),lf=a(9),Pf=a(430);class Rf extends Pf.a{constructor(Ab,Uc,Od){super();this.activityName=Ab;this.WP=Uc;this.tK=Od;this.ri()}create(){this.Uf(new Xb(this.activityName,this.WP,this.tK,K.AFrameworkApplication.od,K.AFrameworkApplication.ua.Ab.fR))}static Ea(Ab){Ab.ra.zc(320,new Rf(Tb.a.oVc,Tb.a.yj,Tb.a.y4b))}}Object(l.a)(Rf,"RestoreVersionActivityFactory",Pf.a,[]);class Mf extends Pf.a{constructor(Ab,
Uc){super();this.activityName=Ab;this.WP=Uc;this.ri()}create(){this.Uf(new Vc(this.activityName,this.WP))}static Ea(Ab){Ab.ra.zc(321,new Mf(Tb.a.y4b,Tb.a.yj))}}Object(l.a)(Mf,"RestoreVersionErrorActivityFactory",Pf.a,[]);var zf=a(936),df=a(81);class Bf extends zf.a{constructor(Ab){super(Ab)}oq(){const Ab=this.MDj(),Uc=la.HostMessengerService.Oa()?uc.d(fa.a.resolve(la.HostMessengerService,{xa:this.Cc})):df.GetServiceTaskFactory.Ne(this.$.ra,21,137,this.Cc);fe.TaskExtensions.tb(fe.TaskExtensions.jl([Ab,
Uc],this.Aa,3),()=>{var Od=Uc.result;const le=Fc.a.getOrigin(this.$.ta.VersionHistoryActionUrl);le!==af.a.sH&&Od.pH(le);Od=new tf(this.$);this.fn([new dg(this.$,Od)])},this.Aa,3)}MDj(){return uc.d(Object(Tc.loadChunkWithDynamicScriptLoader)("excelVersionHistory",{xa:this.Cc}))}static Ea(Ab){zf.a.cw(304,new Bf(Ab))}}Object(l.a)(Bf,"VersionHistoryCommandHandlerFactory",zf.a,[]);const Kf=Object(Pa.c)(db);var Vf=a(663);const sb=Object(Pa.b)("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),Gc=Object(Pa.c)(sb);
class ad{constructor(Ab,Uc){this.sg=Ab;this.mz=Uc}LZ(Ab,Uc,Od,le){return this.Xii(Ab,void 0===le?null:le,ge=>this.sg.HCa(ge,2,Od,Uc,void 0,void 0,void 0,void 0,void 0,"2"))}Xii(Ab,Uc,Od){const le=!!Uc&&""!==Uc;let ge=Ab;le&&(ge=Fc.a.lqa(Ab,"perfTag",Uc));const ze=new Date;return Fa.a.then(Od(ge),Le=>{const nf=+new Date-+ze;if(!Le||!Le.Vf||!Le.Vf.data)return Le;le&&Le.Vf.data.request&&this.nGk(Le.Vf.data.request.getResolvedUrl(),Uc,nf);return Le})}nGk(Ab,Uc,Od){Ab=this.mz.l_i(Ab);if(Ab.count&&(Ab=
Da.last(Ab))){const le={Message:"Request durations for activities calls."};le.PerfTag=Uc;le.CustomDuration=Od;le.PerformanceDuration=Ab.duration;t.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(le))}}}Object(l.a)(ad,"CatchUpNetworkingWrapper",null,[368]);var Wd=a(239),je=a(450),Ie=a(273);class Je extends Ie.a{constructor(Ab,Uc){super(Ab,Uc)}VWa(){return 6}}Object(l.a)(Je,"GetActivityFeedRequest",Ie.a,[]);class $e extends Ie.a{constructor(Ab,Uc,Od,le,ge,ze){super(Ab,Uc);this.ItemIds=null;this.ActivityStatesToReset=
this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Od;this.ActivityStatesToSet=le;this.ActivityStatesToReset=ge;this.ResetUnseenCount=ze}VWa(){return 7}}Object(l.a)($e,"UpdateActivityFeedStateRequest",Ie.a,[]);class Ib{constructor(Ab,Uc,Od,le){le=void 0===le?K.AFrameworkApplication.ea:le;this.Rfd=Ab;this.jAa=Uc;this.sAa=Od;this.ya=le}CJd(Ab){return this.ya.isChangeGateEnabled("Microsoft.Office.SharedOnline.AddSharedActivityFeedLogging")?Fa.a.then(this.OIi(Ab),Uc=>{const Od=Uc.error,
le=Uc.Czi;if(Uc.succeeded&&le)return le;t.ULS.sendTraceTag(507261656,3012,10,`GetActivityFeed failed: ${null!==Od&&void 0!==Od?Od:"no error message"}`);return[]}):this.NIi(Ab)}NIi(Ab){return Fa.a.then(this.sAa.execute(new Je(this.jAa(),null),(Uc,Od,le)=>this.Rfd.LZ(Uc,Od,le,"ActivityFeed"),Ab),Uc=>{if(!Uc)return t.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!Uc.Vf)return t.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;Uc=Uc.Vf.data;
if(!Uc)return t.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(Uc.httpStatus!==Wd.a.nA)return t.ULS.sendTraceTag(508929507,3012,10,"GetActivityFeed: Response status code {0}",Uc.httpStatus),null;if(!Uc.responseData)return t.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;Uc=je.a.wLb(Uc.responseData);return Uc?Uc:(t.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}OIi(Ab){return Fa.a.then(this.sAa.execute(new Je(this.jAa(),
null),(Uc,Od,le)=>this.Rfd.LZ(Uc,Od,le,"ActivityFeed"),Ab),Uc=>{if(!Uc)return{succeeded:!1,error:"Response is null"};if(!Uc.Vf)return{succeeded:!1,error:"Response.Args is null"};Uc=Uc.Vf.data;return Uc?Uc.httpStatus!==Wd.a.nA?{succeeded:!1,error:`Response status code ${Uc.httpStatus}`}:Uc.responseData?(Uc=je.a.wLb(Uc.responseData))?{succeeded:!0,Czi:Uc}:{succeeded:!1,error:"Deserialized response is null"}:{succeeded:!1,error:"Response.Args.Data.ResponseData is null"}:{succeeded:!1,error:"Response.Args.Data is null"}})}pbl(Ab,
Uc,Od,le){return Fa.a.then(this.sAa.execute(new $e(this.jAa(),null,Ab,Uc,Od,le),(ge,ze,Le)=>this.Rfd.LZ(ge,ze,Le,"UpdateActivityFeedState"),null),ge=>{if(this.ya.isChangeGateEnabled("Microsoft.Office.SharedOnline.AddSharedActivityFeedLogging")){if(!ge.succeeded){const ze=ge&&ge.Vf&&ge.Vf.data&&ge.Vf.data.httpStatus;t.ULS.sendTraceTag(507897795,3012,10,`UpdateActivityFeed failed: ${null!==ze&&void 0!==ze?ze:"no status"}`)}return ge.succeeded}try{return ge.succeeded}catch(ze){return t.ULS.sendTraceTag(523121054,
3012,10,"UpdateActivityFeed: Exception {0}",ze.message),!1}})}}Object(l.a)(Ib,"CatchUpRequestHandler",null,[367]);var Nb=a(508);class Bc{constructor(Ab){this.Cpa=Ab;this.WRe=new Nb.a}DEj(){this.yFj()}yFj(){if(this.Cpa){var Ab=Uc=>{this.WRe.contains("CatchUpChangesFeedback")||(this.WRe.add("CatchUpChangesFeedback"),Uc.logActivity("CatchUpChangesFeedback",null))};this.Cpa.execute(Uc=>{window.setTimeout(()=>{Ab(Uc)},2E4)})}else t.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}
Object(l.a)(Bc,"FloodgateEventLogger",null,[]);var Af=a(254);class gf{constructor(Ab){this.Yrh=Ab}get duration(){return this.Yrh.duration}}Object(l.a)(gf,"PerformanceResourceTimingWrapper",null,[]);class Qe{constructor(Ab){this.mz=Ab}l_i(Ab){const Uc=new Af.a;if(!this.mz)return Uc;Ab=this.mz.getEntriesByName(Ab,"resource");if(!Ab)return Uc;for(const Od of Ab)Uc.add(new gf(Od));return Uc}}Object(l.a)(Qe,"PerformanceWrapper",null,[]);var Aa=a(281);class Fb{constructor(){this.oc=null}get name(){return"Common.App.CatchUpActivity"}ji(Ab){this.oc=
Ab;this.oc.register(ad,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").Lc().Qc(()=>new ad(K.AFrameworkApplication.od,new Qe(window.performance)));this.oc.register(Ib,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").Lc().Qc(()=>new Ib(Object(Pa.a)(Gc),()=>K.AFrameworkApplication.Uh,new je.a,K.AFrameworkApplication.ea));this.oc.register(Bc,"Common.App.CatchUpActivity.FloodgateEventLogger").Lc().Qc(()=>
new Bc(Object(Pa.d)(Vf.a)))}init(){Object(Pa.a)(Gc);Object(Pa.a)(Kf)}dispose(){}static main(){Aa.a.instance.Qi(new Fb)}}Object(l.a)(Fb,"CatchUpActivityPackage",null,[11,12]);var Ta=a(942);class Eb extends Pf.a{constructor(Ab){super();this.$=Ab;this.ri()}create(){const Ab=N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?la.BlueDotManagerService.Oa()?Object(uc.d)(fa.a.resolve(la.BlueDotManagerService,{xa:this.Cc})):df.GetServiceTaskFactory.Ne(this.$.ra,501,500,1):Ia.Task.Va(null),
Uc=Object(uc.d)(fa.a.resolve(la.ZoomService));fe.TaskExtensions.tb(fe.TaskExtensions.jl([Ab,Uc],this.$.Aa),()=>{const Od=Ab.result,le=Uc.result,ge=Object(Ta.a)(this.$.ra,286,()=>new ed(this.$,this.Cc,le,null,Od));this.Uf(ge)},this.$.Aa,3)}static Ea(Ab){Ab.ra.zc(287,new Eb(Ab))}}Object(l.a)(Eb,"CatchUpActivityManagerFactory",Pf.a,[]);var oc=a(263),Lc=a(182);class Jd extends Pf.a{constructor(Ab){super();this.Kyc=null;this.OYj=Uc=>{Uc=E.a.te(Uc.data);t.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${M.a.pc(Uc)}.`)};
this.$=Ab;this.ri()}create(){N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotBehindLineage",!1)?this.Uf(Object(Ta.a)(this.$.ra,501,()=>new aa(this.$,0))):(this.Kyc||(this.Kyc=this.FKi()),this.Kyc.continueWith(()=>{this.Uf(Object(Ta.a)(this.$.ra,501,()=>new aa(this.$,this.Kyc.result)))}))}static Ea(Ab){Ab.ra.zc(500,new Jd(Ab))}FKi(){if(N.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return oc.a.Va(0);const Ab=new Lc.a;Object(X.D)(this.$.ma.sa,
4,Uc=>{this.PYj(Uc,Ab)},Uc=>{this.OYj(Uc);Ab.setResult(1)},null,null);return Ab.task}PYj(Ab,Uc){M.a.zf(Ab.Errors)?(t.ULS.sendTraceTag(509732675,0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${M.a.pc(Ab.Errors)}`),Uc.setResult(1)):null==Ab.Result?Uc.setResult(0):(Ab=parseInt(Ab.Result,10),t.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Ab}`),Uc.setResult(Ab))}}Object(l.a)(Jd,"BlueDotManagerFactory",Pf.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");
Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");(()=>{a(1538);lf.a.wb(Ab=>{la.VersionHistoryCommandHandlerService.Oa()||Bf.Ea(Ab)});lf.a.wb(Ab=>{la.RestoreVersionErrorActivityService.Oa()||Mf.Ea(Ab)});lf.a.wb(Ab=>{la.RestoreVersionActivityService.Oa()||Rf.Ea(Ab)})})();a(1540);Type.registerNamespace("Common.App.CatchUpActivity");Fb.main();(()=>{lf.a.wb(Ab=>{a(1542);ud("Begin");
la.CatchUpActivityManagerService.Oa()||Eb.Ea(Ab)})})();(()=>{lf.a.wb(Ab=>{la.BlueDotManagerService.Oa()||Jd.Ea(Ab)})})();String(b);String(f);String(k);String(x);String(d);String(h);String(u);String(uf);String(n);String(m);window.___1717508060425_closurehack=b;window.___1717508060425_closurehack=f;window.___1717508060425_closurehack=k;window.___1717508060425_closurehack=x;window.___1717508060425_closurehack=d;window.___1717508060425_closurehack=h;window.___1717508060425_closurehack=u;window.___1717508060425_closurehack=
uf;window.___1717508060425_closurehack=n;window.___1717508060425_closurehack=m}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.catchup.js.map/c5a6538b77cdd23d2615209499356811/EwaTS.catchup.js.map