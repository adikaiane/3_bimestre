'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1496:function(y,r,a){r=a(490);a=a(1497);a=a.Di?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);r(a,{insert:"head",Oj:!1});y.exports=a.Fk||{}},1497:function(y,r,a){r=a(489)(!1);r.push([y.i,'.DataCleansingPane{background:#edebe9;height:100%;overflow:hidden;display:flex;flex-direction:column}.DataCleansingPaneHeader{position:relative;overflow:hidden;padding:16px 16px 16px 16px}.DataCleansingPaneBody{flex:auto;position:relative}.DataCleansingPaneTitle{position:relative!important;max-width:230px;display:inline-block;text-overflow:ellipsis;overflow:hidden;height:22px;font-weight:400;background:#edebe9;font-size:16px;color:#252423;font-family:"Segoe UI Semibold","Segoe UI Web",Arial,Verdana,sans-serif}.DataCleansingCloseButton{display:inline-block;padding:0 5px;font-size:16px}',
""]);y.exports=r},443:function(y,r,a){function c(Tb){var {level:Wc,methodName:Ac,message:nd,JAl:qd="Table",Qql:Xd=0,dataFields:Hd={},Qo:Zc="OnDemand",fields:Jc={}}=Tb,gc;Tb=Object.assign({},Hd);Tb.Method=Ac;Tb.Message=nd;null!==(gc=Tb.SuggestionType)&&void 0!==gc?gc:Tb.SuggestionType=qd;Tb.MetadataType=Zc;Tb.Fields=Jc;gc=$a.a.Nc(Tb);switch(Wc){case 50:A.ULS.sendTraceTag(509752733,Xd,50,gc);break;case 15:A.ULS.sendTraceTag(509752732,Xd,15,gc);break;case 10:A.ULS.sendTraceTag(509752731,Xd,10,gc)}}function b(Tb){return`Microsoft.Office.Excel.SmartView.${Tb}`}
function f(Tb){return`XLS-SmartView-${Tb}-Treatment;XLS-SmartView-${Tb}-Control`}a.r(r);var k={};a.r(k);a.d(k,"DataCleansingCommandHandler",function(){return G});var x={};a.r(x);a.d(x,"DataCleansingPaneManager",function(){return S});var d={};a.r(d);a.d(d,"ExcelIntelligenceCalloutManager",function(){return aa});var h={};a.r(h);a.d(h,"IntelligentMetadataOverlayManager",function(){return kc});var n={};a.r(n);a.d(n,"ProactiveSuggestionCard",function(){return La});var m={};a.r(m);a.d(m,"RecognizedTableGridHighlighter",
function(){return Wa});var u={};a.r(u);a.d(u,"LAUNCH_SOURCE_BY_FLAGS",function(){return Zb});a.d(u,"TableSuggestionManager",function(){return Hc});var l=a(133),t=a(0),e=a(1),w=a(209),z=a(67),E=a(65),M=a(5);let G=class{constructor(Tb,Wc){this.$=Tb;this.d$j=Wc}gd(){return!1}executeCommand(Tb,Wc){Tb=!0;switch(Wc.command){case -1190551534:void this.d$j.O9h();break;default:Tb=!1}return Tb?z.Task.Va(!0):w.a(Wc.command)}Rc(Tb,Wc){return-1190551534===Wc.command&&e.EwaSettings.IVd()&&!(e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MiniWACInEditMode",
!1)&&this.$.isMobileMode)}td(){return!1}};G=Object(l.__decorate)([Object(E.d)(M.DataCleansingCommandHandlerService),Object(l.__param)(0,Object(M.EwaControlService)()),Object(l.__param)(1,Object(M.DataCleansingPaneManagerService)())],G);Object(t.a)(G,"DataCleansingCommandHandler",null,[29]);var A=a(15),N=a(1483),K=a(179),I=a(13),L=a(2);class J{constructor(Tb){this.type="DataCleansingStatefulTaskPaneProps";this.annotations=[];this.appliedSuggestions=[];this.hostAppCallbacks=Tb}}Object(t.a)(J,"TaskpaneProps",
null,[710]);var B=a(1060),Y=a(29),U=a(41);class O extends U.a{wDh(Tb){this.addHandler(O.aEe,Tb)}vDh(Tb){this.addHandler(O.$De,Tb)}constructor(Tb,Wc,Ac){super();this.Ad=Tb;this.taskPaneManager=Ac;this.fVb=!1;this.OG=Object(L.a)(new N.a,{width:330,title:I.a.instance.ia(1303),enableResize:!0,minResizeWidth:250,maxResizeWidth:400,onOpen:nd=>{nd.addEventListener("keydown",this.onKeyDown);this.fVb=!0;A.ULS.sendTraceTag(510247821,0,20,"DataCleansingTaskpane.onOpen");this.raiseEvent(O.aEe,{})},onClose:nd=>
{nd.removeEventListener("keydown",this.onKeyDown);this.fVb=!1;Object(B.c)(this.Ad);A.ULS.sendTraceTag(510247820,0,20,"DataCleansingTaskpane.onClose");this.raiseEvent(O.$De,{})},onHide:()=>{this.fVb=!1;A.ULS.sendTraceTag(510247819,0,20,"DataCleansingTaskpane.onHide")},onShow:()=>{this.fVb=!0;A.ULS.sendTraceTag(510247818,0,20,"DataCleansingTaskpane.onShow")}});this.onKeyDown=nd=>{const qd=this.Ad.fa;switch(this.Ad.shortcutKeyManager.yy(new Sys.UI.DomEvent(nd))){case -1502853784:switch(nd.stopPropagation(),
qd.s7a){case 1:A.ULS.sendTraceTag(508966177,0,50,"DataCleansingTaskpane.onKeyDown: Undo command triggered");void Object(B.d)(this.Ad,1);break;default:A.ULS.sendTraceTag(508966176,0,50,`DataCleansingTaskpane.onKeyDown: Undo command skipped, state is ${qd.s7a}`)}}};this.OG.contentProps=new J(Wc)}TXc(Tb){Object.assign(this.OG.contentProps,Tb);void this.render()}async render(){if(this.fVb)if(Y.a.Fj())this.taskPaneManager.updateTaskPane("DataCleansingStatefulTaskPane",this.OG),this.taskPaneManager.setSelectedTaskPane("DataCleansingStatefulTaskPane");
else{const Tb=await K.a.li();Tb.updateTaskPane("DataCleansingStatefulTaskPane",this.OG);Tb.setSelectedTaskPane("DataCleansingStatefulTaskPane")}}async show(){Y.a.Fj()?this.taskPaneManager.PC("DataCleansingStatefulTaskPane",this.OG):(await K.a.li()).showTaskPane("DataCleansingStatefulTaskPane",this.OG)}async hide(){Y.a.Fj()?this.taskPaneManager.hideTaskPane("DataCleansingStatefulTaskPane"):(await K.a.li()).hideTaskPane("DataCleansingStatefulTaskPane",this.OG.location)}}O.aEe="dctoek";O.$De="dctcek";
Object(t.a)(O,"DataCleansingTaskpane",U.a,[]);var C=a(961),X=a(1245);let S=class{constructor(Tb,Wc,Ac){this.$=Tb;this.OBj=Wc;this.RBj=Ac;this.Xng=(nd,qd)=>{var Xd;null===(Xd=this.BEa)||void 0===Xd?void 0:Xd.TXc(qd)};this.jd=(nd,qd)=>{({Hg:nd}=qd);!nd&&this.BEa&&(void this.BEa.hide(),A.ULS.sendTraceTag(507860748,0,50,"DataCleansingPaneManager.onWorkbookClosing"))};this.$.Sj(this.jd)}async O9h(){await this.showTaskPane();A.ULS.sendTraceTag(509383055,0,20,'DataCleansingPaneManager.showTaskPane: Show task pane"\n        }');
e.EwaSettings.isChangeGateEnabled("OfficeVSO:8892675_RevertOtelEvents")&&Object(C.c)(Object(X.b)())}dispose(){var Tb;null===(Tb=this.Mia)||void 0===Tb?void 0:Tb.OHg(this.Xng)}async showTaskPane(){const [Tb]=await Promise.all([this.G2i(),this.u5j()]);e.EwaSettings.PQ()?await (null===Tb||void 0===Tb?void 0:Tb.show()):await Tb.show()}async u5j(){await this.NDc()}async NDc(){this.Mia||(this.Mia=await this.OBj(0))}async nWj(){await this.NDc();e.EwaSettings.PQ()&&!this.Mia?A.ULS.sendTraceTag(507093953,
0,15,"DataCleansingHostManagerService is not available due to null dependency"):this.Mia.o3k()}async mWj(){await this.NDc();e.EwaSettings.PQ()&&!this.Mia?A.ULS.sendTraceTag(507093952,0,15,"DataCleansingHostManagerService is not available due to null dependency"):this.Mia.k3k()}async G2i(){if(!this.BEa){await this.NDc();if(e.EwaSettings.PQ()&&!this.Mia)return A.ULS.sendTraceTag(507093923,0,15,"DataCleansingHostManagerService is not available due to null dependency"),null;const Tb=Y.a.Fj()?await this.RBj(0):
null;this.BEa=new O(this.$,this.Mia.cJh,Tb);this.BEa.TXc(this.Mia.state);this.Mia.Llc(this.Xng);this.BEa.wDh(()=>this.nWj());this.BEa.vDh(()=>this.mWj())}return this.BEa}};S=Object(l.__decorate)([Object(E.d)(M.DataCleansingPaneManagerService),Object(l.__param)(0,Object(M.EwaControlService)()),Object(l.__param)(1,Object(M.DataCleansingHostManagerService)({CU:!0})),Object(l.__param)(2,Object(M.ReactTaskPaneManagerService)({CU:!0}))],S);Object(t.a)(S,"DataCleansingPaneManager",null,[]);var ea=a(19),
Oa=a(663),Ha=a(1065),Za=a(282);class fa extends Ha.a{constructor(Tb){super(Tb,fa.featureName)}get tf(){return Za.a.Exi}show(Tb,Wc,Ac,nd){this.Oub(void 0===Tb?null:Tb,qd=>{appChrome.renderExcelIntelligenceSuggestionCard(this.domElement,qd.y,qd.x,qd.y+qd.height,qd.x+qd.width,Wc,Ac,nd,this.Ztb)})}}Object(t.a)(fa,"ExcelIntelligenceUIControl",Ha.a,[699]);var la=a(25),ba=a(684);let aa=class{constructor(Tb,Wc,Ac){this.WVa=this.k0c=this.agaveCommandManager=null;this.Fxi=e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelIntelligenceUsesLPP",
!1);this.Sbf=0;this.yKj=e.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.MaxExcelIntelligenceCalloutShownCount",5);this.xfg=e.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.MininumTableRowsForExcelIntelligenceCallout",4);this.Nd=()=>{this.$Uk()};this.N7i=(nd,qd)=>{A.ULS.sendTraceTag(509633888,306,50,"handleExcelIntelligenceActivationCallback callback invoked");if(!qd)return A.ULS.sendTraceTag(509633887,306,10,"handleExcelIntelligenceActivationCallback surveyParams is null"),null;if(!qd.contextInfo||
!qd.contextInfo.length||1<qd.contextInfo.length)return A.ULS.sendTraceTag(509633886,306,10,"handleExcelIntelligenceActivationCallback no valid contextInfo in surveyParams"),null;this.WVa.show(qd.contextInfo[0].context,()=>this.kjg(),()=>this.onIgnore(),()=>this.Z8());return null};this.$=Tb;this.da=Object(la.f)(Tb);this.agaveCommandManager=Wc;this.WVa=null!==Ac&&void 0!==Ac?Ac:new fa(this.$);this.da.ha.Vq(this.Nd);this.Fxi&&(this.k0c=this.Ink())}Ink(){const Tb=Object(ea.d)(Oa.a);Tb?Tb.execute(Wc=>
{Wc.J2b("ExcelIntelligenceHandRaiseSurface",this.N7i)}):A.ULS.sendTraceTag(509618381,306,10,"registerExcelIntelligenceLPPCallback failed, ISystemInitiatedFeedback is null");return Tb}dispose(){this.da.ha.vr(this.Nd)}$Uk(){const Tb=this.da.ha.oa.activeCell;this.WVa.hide();this.OSk(Tb)&&(null!=this.k0c?this.k0c.execute(Wc=>{Wc.logActivity("ExcelIntelligenceHandRaiseActivity",null,Tb)}):(this.Sbf++,this.WVa.show(Tb,()=>this.kjg(),()=>this.onIgnore(),()=>this.Z8())))}OSk(Tb){var Wc;return(null===(Wc=
this.agaveCommandManager)||void 0===Wc?0:Wc.Yrj())?!1:!this.k0c&&this.Sbf>=this.yKj?(A.ULS.sendTraceTag(509618380,306,50,"ExcelIntelligence callout not shown as limit has been reached"),!1):null!=this.da.Eb.MOd(Tb,this.xfg)}kjg(){A.ULS.sendTraceTag(509659226,1,50,"ExcelIntelligenceSuggestionCard Applied");const Tb={SourceControlId:"AnalyzeDataExcelIntelligenceHandRaise",tableName:this.da.Eb.MOd(this.da.ha.oa.activeCell,this.xfg).name};this.$.Dc(-167264441,0,0,Tb).continueWith(()=>{this.WVa.hide()})}onIgnore(){this.WVa.hide();
A.ULS.sendTraceTag(509659225,1,50,"ExcelIntelligenceSuggestionCard Ignored")}Z8(){this.WVa.hide();A.ULS.sendTraceTag(509659224,1,50,"ExcelIntelligenceSuggestionCard Cancelled")}};aa=Object(l.__decorate)([Object(E.d)(M.ExcelIntelligenceCalloutManagerService),Object(l.__param)(0,Object(M.EwaControlService)()),Object(l.__param)(1,Object(ba.a)())],aa);Object(t.a)(aa,"ExcelIntelligenceCalloutManager",null,[684,4]);var oa=a(27),Na=a(150),Ia=a(44),Sa=a(397),Pa=a(151),za;(function(Tb){Tb[Tb.success=0]="success";
Tb[Tb.featureDisabled=1]="featureDisabled";Tb[Tb.rangeNotInGrid=2]="rangeNotInGrid";Tb[Tb.emptyRange=3]="emptyRange";Tb[Tb.rangeTooLarge=4]="rangeTooLarge";Tb[Tb.successWithMergedCells=5]="successWithMergedCells"})(za||(za={}));Object(t.b)("ResultCode",za);var wa=a(28),db=a(257),Ba=a(74),Ka=a(256),da=a(83),sa=a(70),mb=a(7),Ma=a(197),hb=a(177),$a=a(58),Va=a(88),xa;(function(Tb){Tb.FormatAsTable="FormatAsTable";Tb.ExplicitClose="ExplicitClose";Tb.ESC="Dismiss";Tb.CommandExecution="CommandExecution";
Tb.Undo="Undo";Tb.SelectionEnd="SelectionEnd";Tb.EditedOutOfRange="EditedOutOfRange";Tb.InvalidInterpretation="InvalidInterpretation";Tb.RevertTable="RevertTable";Tb.MenuItem="MenuItem";Tb.Error="Error"})(xa||(xa={}));Object(t.b)("IgnoreSource",xa);var ia;(function(Tb){Tb.Implicit="Implicit";Tb.Explicit="Explicit";Tb.Positive="Positive";Tb.Invalid="Invalid"})(ia||(ia={}));Object(t.b)("IgnoreSourceType",ia);const Z={[xa.FormatAsTable]:{["Table"]:ia.Positive,["RevertTable"]:ia.Positive},[xa.ExplicitClose]:{["Table"]:ia.Explicit,
["RevertTable"]:ia.Explicit},[xa.ESC]:{["Table"]:ia.Explicit,["RevertTable"]:ia.Implicit},[xa.CommandExecution]:{["Table"]:ia.Implicit,["RevertTable"]:ia.Positive},[xa.Undo]:{["Table"]:ia.Implicit,["RevertTable"]:ia.Explicit},[xa.SelectionEnd]:{["Table"]:ia.Implicit,["RevertTable"]:ia.Implicit},[xa.EditedOutOfRange]:{["Table"]:ia.Implicit,["RevertTable"]:ia.Implicit},[xa.InvalidInterpretation]:{["Table"]:ia.Invalid,["RevertTable"]:ia.Invalid},[xa.RevertTable]:{["Table"]:ia.Explicit,["RevertTable"]:ia.Explicit},
[xa.MenuItem]:{["Table"]:ia.Positive,["RevertTable"]:ia.Positive},[xa.Error]:{["Table"]:ia.Invalid,["RevertTable"]:ia.Invalid}};class ta{constructor(Tb,Wc,Ac,nd,qd,Xd){qd=void 0===qd?"OnDemand":qd;this.dob=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")?10:3;this.f8j=()=>{this.bka("MenuItem");const Hd={};Hd[mb.a.MF]="SmartViewTableSuggestion";this.$.Dc(802602464,sa.a.Hb,8,Hd);c({level:50,methodName:"openGiveFeedback",message:"Give feedback menu open success",dataFields:this.Pd(),
Qo:this.Qo})};this.openLearnMore=()=>{this.bka("MenuItem");const Hd=new da.a(-859308420,sa.a.Hb,this.$.xc,9,null);this.$.Ia.Gb(Hd,{[sa.a.Bf]:"HelpID=22118",["InputMethod"]:sa.a.Hb,["ShouldCanvasTakeFocus"]:!0,[sa.a.Wc]:mb.a.VF,[mb.a.wna]:!0});Pa.b(this.$).Jd(Na.a.uZk,this.Pd(!0),{},!0);Pa.b(this.$).Jd(Na.a.vZk,this.Pd(!0),{},!0)};this.Oif=async Hd=>{Hd=void 0===Hd?!0:Hd;const Zc=Ia.y(this.VRa.tableLocation,this.$);var Jc=Ia.I(Zc);this.G_a(Jc)||this.grid.ha.VI([Jc],0,Jc.topLeft,0);c({level:50,methodName:"convertToTable",
message:"Create table initiated",dataFields:this.Pd(),Qo:this.Qo});Jc={};Jc.TableRange=Zc;Jc.HasHeader=!0;Hd||(Jc.StyleIndex=e.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SmartView.FormatTableStyle",-1));Hd=this.$.Dc(71074531,sa.a.Hb,9,Jc);return Va.e(Hd).then(gc=>{gc?(c({level:50,methodName:"convertToTable",message:"Create table complete",dataFields:this.Pd(),Qo:this.Qo}),"RevertTable"!==this.GF&&(Pa.b(this.$).Jd(Na.a.OYg,this.Pd(!0),{},!0),Pa.b(this.$).Jd(Na.a.PYg,this.Pd(!0),{},!0)),
this.g9d(()=>{hb.a(this.$).um.activateRibbonTab(mb.a.s2b)})):c({level:10,methodName:"convertToTable",message:"Create table failed",dataFields:this.Pd(),Qo:this.Qo});return gc})};this.onDismiss=Hd=>{(Hd=Hd?new Sys.UI.DomEvent(Hd):null)&&"keydown"===Hd.type&&27===Hd.keyCode&&this.bka("Dismiss");c({level:50,methodName:"onDismiss",message:"OnDismiss called for Table Invitation",dataFields:this.Pd(),Qo:this.Qo})};this.HKc=()=>{Object(ea.d)(Oa.a).execute(Hd=>{Hd.logActivity("Office_Excel_SmartView_FormatAsTableOnPasteFloodgate",
null)})};this.hO=(Hd,Zc)=>{ta.Aqf(Zc)&&this.bka("CommandExecution")};this.aug=()=>{this.bka("Undo")};this.ph=()=>{const Hd=e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DismissOnEditingOutOfRangeCell",!1)?this.grid.isEditing:!0;this.isVisible&&this.VRa&&!this.G_a(this.VRa.tableLocation)&&Hd&&this.bka("SelectionEnd")};this.N8j=()=>{this.bka("MenuItem");this.a4.e6k();c({level:50,methodName:"optOutTableSuggestions",message:"User opted out of all suggestions",dataFields:this.Pd(),
Qo:this.Qo})};this.$=Tb;this.bka=Ac;this.proactiveSuggestionCard=Wc;this.grid=la.f(this.$);this.isVisible=!1;Object(ea.d)(db.a).execute(Hd=>{void Hd.isFeatureEnabled("mso_sendASmile",!1).then(Zc=>{this.Mua=Zc;return null})});this.a4=nd;this.Qo=qd;this.Rya=Xd;this.GF="Table";this.U0="Default"}Pd(Tb){const Wc={["LaunchSource"]:this.U0,["SuggestionType"]:this.GF};(void 0===Tb?0:Tb)||(Wc.Class="TableSuggestionCardUtil");return Wc}LXg(Tb,Wc){this.U0=Wc;this.VRa=Tb;this.GF="Table";(this.isVisible=this.proactiveSuggestionCard.show(Tb.tableLocation,
I.a.instance.La(710),I.a.instance.La(711),I.a.instance.La(712),I.a.instance.La(713),()=>{void this.Oif().then(()=>{this.HKc();this.bka("FormatAsTable")})},()=>{this.onClose()},this.sAc(),()=>{this.eKa(!0)},()=>{this.eKa(!1)},"TableDesignIdeas",e.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?13:void 0,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?[10,11,8]:void 0,5,this.onDismiss,void 0,!0))?(this.GF="Table",Pa.b(this.$).Jd(Na.a.RYg,this.Pd(!0),
{},!0),Pa.b(this.$).Jd(Na.a.SYg,this.Pd(!0),{},!0),c({level:50,methodName:"showTableSuggestionCard",message:"Proactive suggestion card displayed",dataFields:this.Pd(),Qo:this.Qo}),this.eFb()):c({level:15,methodName:"showTableSuggestionCard",message:"Proactive suggestion card failed to show",dataFields:this.Pd(),Qo:this.Qo})}Q9e(Tb,Wc){this.VRa=Tb;this.U0=Wc;this.GF="RevertTable";this.zsj()?void this.Oif(!1).then(Ac=>{Ac&&this.g9d(()=>{this.GXk(Tb,Wc)})}):c({level:50,methodName:"automaticallyConvertToTable",
message:"Range is not in visible area",dataFields:this.Pd(),Qo:this.Qo})}GXk(Tb,Wc){this.U0=Wc;this.VRa=Tb;this.GF="RevertTable";(this.isVisible=this.proactiveSuggestionCard.show(Tb.tableLocation,I.a.instance.La(750),I.a.instance.La(751),I.a.instance.La(752),I.a.instance.La(753),()=>{this.onClose("FormatAsTable");Pa.b(this.$).Jd(Na.a.OYg,this.Pd(!0),{},!0);Pa.b(this.$).Jd(Na.a.PYg,this.Pd(!0),{},!0)},()=>{this.nLg("RevertTable");c({level:50,methodName:"showUndoFormattingCard",message:"User explicitly selects to revert the conversion",
dataFields:this.Pd()})},this.sAc(),()=>{this.eKa(!0)},()=>{this.eKa(!1)},"TableDesignIdeas",e.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?13:void 0,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?[10,11,8]:void 0,5,this.onDismiss,void 0,!0))?(Pa.b(this.$).Jd(Na.a.RYg,this.Pd(!0),{},!0),Pa.b(this.$).Jd(Na.a.SYg,this.Pd(!0),{},!0),c({level:50,methodName:"showUndoFormattingCard",message:"Undo automatic table conversion card displayed",dataFields:this.Pd()}),
this.eFb()):(c({level:15,methodName:"showUndoFormattingCard",message:"Undo automatic table conversion card failed to show",dataFields:this.Pd()}),this.nLg("Error"))}get visible(){return this.isVisible}set visible(Tb){this.isVisible=Tb}hide(Tb){this.visible&&(this.proactiveSuggestionCard.hide(),this.isVisible=!1,e.EwaSettings.isChangeGateEnabled("OfficeVSO:7748494_SVUpdateDismissCounts")?this.ycl(Tb):"MenuItem"!==Tb&&("FormatAsTable"===Tb?this.a4.Fsb(this.GF):this.a4.skb(this.GF)));this.zTc()}ycl(Tb){if(!e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.ForceEnabled",
!1)){var Wc=this.YSi(Tb,this.GF);"FormatAsTable"===Tb&&this.a4.Fsb(this.GF);"Explicit"===Wc&&this.a4.skb(this.GF);e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")&&("FormatAsTable"===Tb?this.Rya.Lyk():"Explicit"===Wc?this.Rya.Pej():"Implicit"===Wc&&this.Rya.Oej())}}YSi(Tb,Wc){if(Tb=Z[Tb])if(Wc=Tb[Wc])return Wc;c({level:15,methodName:"getIgnoreSourceType",message:"No ignore source type set for ignore source + suggestion type (configuration error)",dataFields:this.Pd()});
return"Invalid"}sAc(){const Tb=[{key:"learnMessage",text:I.a.instance.La(716),onClick:this.openLearnMore},{key:"giveFeedback",text:I.a.instance.La(756),onClick:this.f8j}];Tb.push({key:"optOut",text:I.a.instance.La(764),onClick:this.N8j});return Tb}async Bca(Tb){return this.a4.Bca(Tb)}async dKf(){if(e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.ForceEnabled",!1))return this.a4.Iyk(),!0;if(!await this.a4.Lwj())return c({level:50,methodName:"getIsCardEnabled",message:"Roaming service setting is disabled",
dataFields:this.Pd()}),!1;Ka.a.UN("XLS-SmartView-EnableSessionCap-Treatment;XLS-SmartView-EnableSessionCap-Control");if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")&&this.Rya.Iwj())return c({level:50,methodName:"getIsCardEnabled",message:"Exceeded maximum dismiss count for the session",dataFields:this.Pd()}),!1;const Tb=await this.Bca("Table"),Wc={Tba:Tb};c({level:50,methodName:"getIsCardEnabled",message:"Dismiss count.",dataFields:this.Pd(),fields:Wc});return Tb>=this.dob?
(c({level:50,methodName:"getIsCardEnabled",message:"Exceeded maximum dismiss count.",dataFields:this.Pd(),fields:Wc}),!1):!0}static bsj(Tb){var Wc=Tb.properties;Tb=Wc.SourceControlId&&Wc.SourceControlId.includes("Sensitivity");Wc=Wc.ShouldCanvasTakeFocus;return Tb&&!Wc}static $rj(Tb){return[1941920197,1928326585,1833782813,-1059615499,-1027730316,-1104934572,-28797232,71074531,1237877382,974713501].includes(Tb)}static Aqf(Tb){return!(ta.$rj(Tb.fc.command)||ta.bsj(Tb))}static wCd(Tb,Wc){const Ac={["Class"]:"TableSuggestionCardUtil"};
return la.f(Tb).Eb.r8(Wc)?(c({level:50,methodName:"doesRangeContainTable",message:"Last paste was a table.",dataFields:Ac}),!0):la.f(Tb).Eb.tU(Wc)?(c({level:50,methodName:"doesRangeContainTable",message:"Last paste was a pivot table.",dataFields:Ac}),!0):!1}g9d(Tb){if(this.Z0f())Tb();else{const Wc=()=>{this.Z0f()&&(Tb(),this.grid.hHg(Wc))};this.grid.p4e(Wc)}}nLg(Tb){c({level:50,methodName:"revertTable",message:"Revert table initiated",dataFields:this.Pd(),fields:{source:Tb}});this.bka(Tb);this.$.Dc(-1502853784,
sa.a.Hb,9,null).continueWith(Wc=>{Ma.b(Wc)&&Wc.result?(c({level:50,methodName:"revertTable",message:"Undo successful",dataFields:this.Pd()}),"RevertTable"===Tb&&Pa.b(this.$).Jd(Na.a.wZk,this.Pd(!0),{},!0),this.HKc()):c({level:10,methodName:"revertTable",message:"Undo failed",dataFields:this.Pd()})})}onClose(Tb){Tb=void 0===Tb?"ExplicitClose":Tb;this.bka(Tb);this.HKc();"FormatAsTable"===Tb&&c({level:50,methodName:"showUndoFormattingCard",message:"User explicitly selects to keep the conversion",dataFields:this.Pd()})}dispose(){this.proactiveSuggestionCard&&
this.proactiveSuggestionCard.dispose()}eKa(Tb){Tb?this.rRg(this.VRa.tableLocation,this.OOb()):this.rRg(this.grid.ha.oa.activeRange,this.OOb())}Z0f(){return this.grid.za.t8(4,this.$.la)}G_a(Tb){return Tb.ld(this.grid.ha.oa.activeRange)}OOb(){return Ba.d(this.$.la)}rRg(Tb,Wc){Tb=Sa.a.a7a(Wc,[Tb]);this.grid.Ub.S3a();this.grid.Ub.HL(Tb,[0],!0)}zsj(){var Tb=this.VRa.tableLocation;const Wc=this.grid.rb.Yh(Tb);Tb=this.grid.Wg(Tb,Wc);return this.grid.pg(Wc).ul.ld(Tb)?!0:!1}eFb(){this.$.Ia.Qbb(this.hO);this.$.fa.f5e(this.aug);
this.grid.ha.ZS(this.ph)}zTc(){this.$.Ia.b4a(this.hO);this.$.fa.RHg(this.aug);this.grid.ha.rV(this.ph)}}Object(t.a)(ta,"TableSuggestionCardUtil",null,[]);class pa{constructor(Tb,Wc,Ac,nd,qd){this.dob=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")?10:3;this.DHa=Xd=>{this.hSb.push(this.ybb);this.NG.hide(Xd);"ExplicitClose"===Xd&&Pa.b(this.$).Jd(Na.a.QYg,this.Pd(!0),{},!0);c({level:50,methodName:"ignoreActiveRange",message:"Ignore Current Range",dataFields:this.Pd(),Qo:"Existing",
fields:{["ignoreSource"]:Xd}})};this.ph=()=>{e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DismissOnEditingOutOfRangeCell",!1)?this.NG.visible&&null!==this.ybb&&!this.G_a(this.ybb)&&this.grid.isEditing&&this.DHa("EditedOutOfRange"):this.NG.visible&&null!==this.ybb&&!this.G_a(this.ybb)&&this.DHa("SelectionEnd")};this.hO=(Xd,Hd)=>{ta.Aqf(Hd)&&this.DHa("CommandExecution")};this.$=Tb;this.ybb=null;this.eD=Wc;this.hSb=[];this.U0="Default";this.grid=la.f(this.$);this.proactiveSuggestionCard=
Ac;this.a4=nd;this.Rya=qd;this.NG=new ta(this.$,this.proactiveSuggestionCard,this.DHa,this.a4,"Existing",this.Rya);this.P2k=.75}Pd(Tb){const Wc={["LaunchSource"]:this.U0,["SuggestionType"]:"Table"};(void 0===Tb?0:Tb)||(Wc.Class="IntelligentMetadataTableManager");return Wc}async e8k(Tb,Wc){var Ac;this.U0=Wc;if(Y.a.k8()||Y.a.qmb()){if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7748494_SVUpdateDismissCounts")){if(!await this.NG.dKf()){c({level:50,methodName:"triggerHandRaise",message:"Card is not enabled",
dataFields:this.Pd()});return}}else{var nd=await this.NG.Bca("Table");const qd={Tba:nd};c({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Dismiss count.",dataFields:this.Pd(),Qo:"Existing",fields:qd});if(nd>=this.dob){c({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Exceeded maximum dismiss count.",dataFields:this.Pd(),Qo:"Existing",fields:qd});return}}for(const qd of this.hSb)if(qd.sheetId===Tb.sheetId&&qd.range.ld(Tb.range))return;Tb=this.FZi(Tb);
if(1===Tb.length&&(Tb=null===(Ac=Tb[0])||void 0===Ac?void 0:Ac.table,Ac=this.dRi(Tb)))if(Tb.RSf)c({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"The pasted field contains merged cells",dataFields:this.Pd(),Qo:"Existing"});else{if(this.HTi(Wc)){nd=this.Y3i(Wc,Ac.tableLocation);if(!nd)return;Ac.tableLocation=nd}this.ybb=new Sa.a(Ac.tableLocation,Tb.analyzedRange.sheetId);e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableAutomaticFormatting",!1)&&1===
Ac.confidence?(this.NG.Q9e(Ac,Wc),c({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Automatically formatting table",dataFields:this.Pd()})):this.NG.LXg(Ac,Wc)}}else c({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions is disabled",dataFields:this.Pd(),Qo:"Existing"})}FZi(Tb){const Wc=this.eD.Hja().yXa(Tb,6);Tb=this.eD.Hja().yXa(Tb,6,1);0<Wc.length&&0===Tb.length&&c({level:50,methodName:"getRecognizedTableRecords",
message:"Suppressed card, table records were invalid",dataFields:this.Pd(),Qo:"Existing"});return Tb}Y3i(Tb,Wc){const Ac=Wc.clone();switch(Tb){case "InsertColumn":Ac.Sma(4,Ac.right+1);break;case "InsertRow":Ac.Sma(2,Ac.bottom+1);break;case "DeleteColumn":Tb=Wc.right-1;if(1>Tb||Tb<Wc.left)return null;Ac.Sma(4,Tb);break;case "DeleteRow":Tb=Wc.bottom-1;if(1>Tb||Tb<Wc.top)return null;Ac.Sma(2,Tb)}return Ac}HTi(Tb){return["InsertColumn","InsertRow","DeleteColumn","DeleteRow"].includes(Tb)}dRi(Tb){for(const Wc of Tb.interpretations)if(Wc.confidence>=
this.P2k&&2===Wc.orientation&&1===Wc.headerRowCount&&!Tb.tableName)return Wc;return null}G_a(Tb){return Tb.range.contains(this.grid.ha.oa.activeRange)}dispose(){this.NG&&this.NG.dispose()}}Object(t.a)(pa,"IntelligentMetadataTableManager",null,[4]);var Ga=a(61),Ca=a(266),kb=a(213),eb=a(255),Yb=a(206),Gb=a(368),Mb=a(124),Rb=a(36);class $b{constructor(){this.version=6;this.revert=this.table=0;this.enabled=!0}}Object(t.a)($b,"SmartViewTableHandRaiseSetting",null,[]);class cc{constructor(Tb){this.eVc=
new $b;this.ILc=new $b;this.skb=Wc=>{this.GF=Wc;if(this.smartViewTableHandRaiseSetting){let Ac=this.VHf(Wc);Ac++;this.t7g(Wc,Ac);c({level:50,methodName:"incrementDismissCount",message:"Incremented smartViewTableHandRaiseSetting dismiss count.",dataFields:this.Pd(),fields:{gbc:this.smartViewTableHandRaiseSetting}});this.z3c()}else c({level:50,methodName:"incrementDismissCount",message:"Can't increment smartViewTableHandRaiseSetting dismiss count.",dataFields:this.Pd()})};this.Fsb=Wc=>{this.GF=Wc;this.smartViewTableHandRaiseSetting?
(this.t7g(Wc,0),c({level:50,methodName:"resetDismissCount",message:"Reset smartViewTableHandRaiseSetting dismiss count.",dataFields:this.Pd(),fields:{gbc:this.smartViewTableHandRaiseSetting}}),this.z3c()):c({level:50,methodName:"resetDismissCount",message:"Can't reset smartViewTableHandRaiseSetting dismiss count.",dataFields:this.Pd()})};this.kAk=()=>{c({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Reading latest roaming setting.",dataFields:this.Pd()});
return new Promise(Wc=>{Gb.D(this.$.ma.sa,2,Ac=>{c({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"OnReadRoamingStringSuccess called.",dataFields:this.Pd()});if(Rb.a.zf(Ac.Errors))Ac={errors:Rb.a.pc(Ac.Errors)},c({level:10,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"onReadRoamingSuccessCallback encountered an error.",dataFields:this.Pd(),fields:Ac}),Wc(null);else if(Ac.Result){if(Ac=this.Bfi(Ac.Result)){const nd={gbc:Ac};
c({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Successfully retrieved smartViewTableHandRaiseSetting.",dataFields:this.Pd(),fields:nd});6>Ac.version?(c({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Version mismatch. Resetting smartViewTableHandRaiseSetting",dataFields:this.Pd()}),Wc(this.eVc)):Wc(Ac)}}else c({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"onReadRoamingSuccessCallback received null result. Returning default value.",
dataFields:this.Pd()}),Wc(this.eVc)},Ac=>{Ac={ewaErrors:Mb.a.te(Ac.data)};c({level:10,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Roaming operation failed.",dataFields:this.Pd(),fields:Ac});Wc(null)},null,null)})};this.z3c=()=>{const Wc=this.aHk(this.smartViewTableHandRaiseSetting);if(Wc){var Ac={serializedSetting:Wc};c({level:50,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Updating roaming setting.",dataFields:this.Pd(),fields:Ac});
this.O7j(Wc)}else c({level:15,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Empty serialized roaming setting.",dataFields:this.Pd()})};this.O7j=Wc=>{Gb.K(this.$.ma.sa,2,Wc,Ac=>{c({level:50,methodName:"onWriteRoamingString",message:"WriteRoamingString called.",dataFields:this.Pd()});Rb.a.zf(Ac.Errors)?(Ac={errors:Rb.a.pc(Ac.Errors)},c({level:10,methodName:"onWriteRoamingString",message:"WriteRoamingString encountered an error.",dataFields:this.Pd(),fields:Ac})):Ac.Result&&
(Ac.Result||c({level:10,methodName:"onWriteRoamingString",message:"Failed to write to the roaming service.",dataFields:this.Pd()}))},Ac=>{Ac={ewaErrors:Mb.a.te(Ac.data)};c({level:10,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Roaming operation failed.",dataFields:this.Pd(),fields:Ac})},null,null)};this.Bfi=Wc=>{if(!Wc)return c({level:15,methodName:"deserializeToSmartViewTableHandRaiseSetting",message:"Received an empty roamingXml.",dataFields:this.Pd()}),null;let Ac;
try{Ac=JSON.parse(Wc)}catch(nd){return Wc={errorMessage:nd.message},c({level:10,methodName:"deserializeToSmartViewTableHandRaiseSetting",message:"Error while deserializing SmartViewTableHandRaiseSetting.",dataFields:this.Pd(),fields:Wc}),null}return Ac};this.aHk=Wc=>{if(!Wc)return c({level:50,methodName:"serializeFromSmartViewTableHandRaiseSetting",message:"Empty roaming setting.",dataFields:this.Pd()}),null;Wc=$a.a.Nc(Wc);return 100<Wc.length?(c({level:10,methodName:"serializeFromSmartViewTableHandRaiseSetting",
message:"Exceeded the MaxSize for smartViewTableHandRaiseSettingMaxSize.",dataFields:this.Pd()}),null):Wc};this.$=Tb;this.smartViewTableHandRaiseSetting=null;this.ILc={version:6,table:Number.POSITIVE_INFINITY,revert:Number.POSITIVE_INFINITY,enabled:!1};this.GF="Table"}Pd(Tb){const Wc={["LaunchSource"]:"Default",["SuggestionType"]:this.GF};(void 0===Tb?0:Tb)||(Wc.Class="SmartViewTableHandRaiseRoamingHandler");return Wc}async Lwj(){if(await this.pOf()){if(this.smartViewTableHandRaiseSetting)return this.smartViewTableHandRaiseSetting.enabled;
c({level:15,methodName:"isSettingEnabled",message:"Received null setting. Returning false.",dataFields:this.Pd()})}return this.ILc.enabled}e6k(){var Tb;(null===(Tb=this.smartViewTableHandRaiseSetting)||void 0===Tb?0:Tb.enabled)?this.smartViewTableHandRaiseSetting=this.ILc:this.smartViewTableHandRaiseSetting=this.eVc;this.z3c()}Iyk(){this.smartViewTableHandRaiseSetting=this.eVc;this.z3c()}async Bca(Tb){this.GF=Tb;if(await this.pOf()){if(this.smartViewTableHandRaiseSetting)return c({level:50,methodName:"getDismissCount",
message:"Returning existing smartViewTableHandRaiseSetting",dataFields:this.Pd(),fields:{gbc:this.smartViewTableHandRaiseSetting}}),this.VHf(Tb);c({level:15,methodName:"getDismissCount",message:"smartViewTableHandRaiseSetting is null",dataFields:this.Pd()})}c({level:50,methodName:"getDismissCount",message:"Received null setting. Returning infinity",dataFields:this.Pd()});return Number.POSITIVE_INFINITY}async pOf(){if(!this.smartViewTableHandRaiseSetting){const Tb=await this.kAk();if(!Tb)return c({level:15,
methodName:"getTableHandRaiseSetting",message:"Received null setting",dataFields:this.Pd()}),this.smartViewTableHandRaiseSetting=this.ILc,!1;this.smartViewTableHandRaiseSetting=Tb;c({level:50,methodName:"getTableHandRaiseSetting",message:"Received setting from roaming service.",dataFields:this.Pd(),fields:{gbc:this.smartViewTableHandRaiseSetting}})}return!0}VHf(Tb){return{["Table"]:this.smartViewTableHandRaiseSetting.table,["RevertTable"]:this.smartViewTableHandRaiseSetting.revert}[Tb]}t7g(Tb,Wc){switch(Tb){case "Table":this.smartViewTableHandRaiseSetting.table=
Wc;break;case "RevertTable":this.smartViewTableHandRaiseSetting.revert=Wc;break;default:this.smartViewTableHandRaiseSetting.revert=Wc,this.smartViewTableHandRaiseSetting.table=Wc}}}Object(t.a)(cc,"SmartViewTableHandRaiseRoamingHandler",null,[]);class fb{constructor(){this.iMa=this.soe=0;this.l5d=this.k5d=-1;this.k5d=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")?3:5;this.l5d=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")?1:3}Pej(){this.soe++;
this.iMa++}Oej(){this.iMa++}Lyk(){this.soe=this.iMa=0}Iwj(){return-1!==this.k5d&&this.iMa>=this.k5d||-1!==this.l5d&&this.soe>=this.l5d?!0:!1}}Object(t.a)(fb,"TableSuggestionSessionHandler",null,[]);var Sb=a(134);let kc=class{constructor(Tb,Wc,Ac){this.vna=this.S1a=null;this.l$g=!1;this.dob=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8616831_svRemoveStaleFlights")?10:3;this.y$i=async(nd,qd)=>{c({level:50,methodName:"handleSmartViewActivationCallback",message:"handleSmartViewActivationCallback invoked.",
dataFields:this.Pd()});if(!qd)return c({level:10,methodName:"handleSmartViewActivationCallback",message:"surveyParams is null.",dataFields:this.Pd()}),null;if(!qd.contextInfo||0===qd.contextInfo.length){var Xd={["contextInfo"]:qd.contextInfo};c({level:10,methodName:"handleSmartViewActivationCallback",message:"no valid contextInfo in surveyParams.",dataFields:this.Pd(),fields:Xd});return null}nd=qd.contextInfo[qd.contextInfo.length-1];if(!nd.context.sheetRange)return Xd={["contextInfo"]:qd.contextInfo},
c({level:10,methodName:"handleSmartViewActivationCallback",message:"no valid sheetRange in surveyParams.",dataFields:this.Pd(),fields:Xd}),null;qd=nd.context.sheetRange;nd=null!==(Xd=nd.context.hasSurroundingCells)&&void 0!==Xd?Xd:!1;await this.HLf(qd,nd);return null};this.DHa=nd=>{this.GSd=this.R1a.analyzedRange;this.hSb.push(this.GSd);this.NG.hide(nd);this.WJk();"ExplicitClose"===nd&&(Pa.b(this.$).Jd(Na.a.tZk,this.Pd(!0),{},!0),Pa.b(this.$).Jd(Na.a.QYg,this.Pd(!0),{},!0));c({level:50,methodName:"ignoreActiveRange",
message:"Ignore Current Range",dataFields:this.Pd(),fields:{["ignoreSource"]:nd}})};this.HKc=()=>{Object(ea.d)(Oa.a).execute(nd=>{nd.logActivity("Office_Excel_SmartView_FormatAsTableOnPasteFloodgate",null)})};this.WJk=()=>{const nd=this.grid.ha.oa.activeRange;this.grid.ha.updateSelection(nd,nd,0,0)};this.$=Tb;this.eD=Wc;this.hSb=[];this.GSd=this.v6c=this.R1a=null;this.GF="Table";this.U0="Default";this.proactiveSuggestionCard=Ac;this.grid=la.f(this.$);this.a4=new cc(this.$);this.Rya=new fb;this.NG=
new ta(this.$,this.proactiveSuggestionCard,this.DHa,this.a4,"OnDemand",this.Rya);if(Y.a.k8()||e.EwaSettings.isChangeGateEnabled("OfficeVSO:7800675_SVCleanupPostConsolidation")&&Y.a.qmb())this.GXf=new pa(this.$,this.eD,this.proactiveSuggestionCard,this.a4,this.Rya);this.l$g=["en-US","en-GB","en-CA","en-AU","en_IN"].includes(this.$.O4);(Tb=Object(ea.d)(Oa.a))&&Tb.execute(nd=>{nd.J2b("SmartViewSuggestion",this.y$i)});this.$.Vb&&(this.S1a=this.$.Vb.Pg("WebServiceCall","onDemandStopWatch"),this.vna=this.$.Vb.Pg("WebServiceCall",
"getTableInfoStopwatch"))}Pd(Tb){const Wc={["LaunchSource"]:this.U0,["SuggestionType"]:this.GF};(void 0===Tb?0:Tb)||(Wc.Class="IntelligentMetadataOverlayManager");return Wc}get Nmd(){return this.v6c}fel(Tb,Wc){Wc=void 0===Wc?!1:Wc;this.R1a=null;Tb.tableName||(this.R1a=Tb);Tb={["Duration"]:-1};this.S1a&&(this.S1a.stop(),Tb.Duration=this.S1a.Kc);c({level:50,methodName:"updateOnDemandRecognizedTable",message:"OnDemand request succeeded",dataFields:this.Pd(),fields:Tb});void this.eel(Wc)}async tNa(Tb,
Wc){if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7800833_SVAddUniversalChecks")||!ta.wCd(this.$,Tb.range)){this.U0=Wc;this.GF="Table";if(!e.EwaSettings.isChangeGateEnabled("OfficeVSO:7800675_SVCleanupPostConsolidation")){Tb||c({level:10,methodName:"triggerHandRaise",message:"sheetRange is null or undefined",dataFields:this.Pd()});if(!this.l$g){c({level:50,methodName:"triggerHandRaise",message:"Invalid language for TriggerHandRaise.",dataFields:this.Pd()});return}if(this.$.ta.IsMeetingLiveSession){c({level:50,
methodName:"triggerHandRaise",message:"User is in Teams live.",dataFields:this.Pd()});return}if(Yb.a.Tua()||Yb.a.iIa()){c({level:50,methodName:"triggerHandRaise",message:"User is in Excel hosted in Teams.",dataFields:this.Pd()});return}if((new Sb.SheetProtection(this.$.qa)).activeSheet.Ih)return}if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7748494_SVUpdateDismissCounts")){if(!await this.NG.dKf()){c({level:50,methodName:"triggerHandRaise",message:"Card is not enabled",dataFields:this.Pd()});return}}else{Wc=
await this.NG.Bca("Table");const nd={Tba:Wc};c({level:50,methodName:"triggerHandRaise",message:"Dismiss count.",dataFields:this.Pd(),fields:nd});if(Wc>=this.dob){c({level:50,methodName:"triggerHandRaise",message:"Exceeded maximum dismiss count.",dataFields:this.Pd(),fields:nd});return}}for(var Ac of this.hSb)if(Ac.sheetId===Tb.sheetId&&Ac.range.ld(Tb.range)){c({level:50,methodName:"triggerHandRaise",message:"Range was already ignored.",dataFields:this.Pd()});return}Ac=!1;if(!this.Exj(Tb)){c({level:50,
methodName:"triggerHandRaise",message:"Surrounding Cells contain values, update boundary required",dataFields:this.Pd()});Tb=await this.mUd(Tb);if(!Tb){c({level:50,methodName:"triggerHandRaise",message:"Expanded Range is null or undefined",dataFields:this.Pd()});return}Ac=!0}if(!e.EwaSettings.isChangeGateEnabled("OfficeVSO:7800833_SVAddUniversalChecks")){if(this.L2h(Tb)){c({level:50,methodName:"triggerHandRaise",message:"Header contains links or formulas.",dataFields:this.Pd()});return}if(this.rIa(Tb.range)){c({level:50,
methodName:"triggerHandRaise",message:"Specified range is empty",dataFields:this.Pd()});return}}e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.ForceEnabled",!1)?(c({level:50,methodName:"triggerHandRaise",message:"LPP Disabled, requesting OnDemandMetadata",dataFields:this.Pd()}),await this.HLf(Tb,Ac)):this.nHj(Tb,Ac)}}async d8k(Tb,Wc){this.GXf&&void this.GXf.e8k(Tb,Wc)}nHj(Tb,Wc){Wc=void 0===Wc?!1:Wc;const Ac=Object(ea.d)(Oa.a);Ac&&(c({level:50,methodName:"logSmartViewEventToLpp",
message:"logged event to LPP",dataFields:this.Pd()}),Ac.execute(nd=>{nd.logActivity("SmartViewProactiveSuggestionActivity",null,{["sheetRange"]:Tb,["hasSurroundingCells"]:Wc})}))}async HLf(Tb,Wc){Wc=void 0===Wc?!1:Wc;e.EwaSettings.isChangeGateEnabled("OfficeVSO:7800675_SVCleanupPostConsolidation")?await this.getMetadata(Tb,Wc):this.NG.g9d(async()=>{await this.getMetadata(Tb,Wc)})}dispose(){this.NG&&this.NG.dispose()}async eel(Tb){Tb=void 0===Tb?!1:Tb;if(null!=this.R1a){var Wc=this.R1a.analyzedRange,
Ac=this.GSd===Wc;if(this.R1a.RSf)c({level:50,methodName:"updateOnDemandActionButton",message:"The pasted field contains merged cells",dataFields:this.Pd()});else if(!Ac&&Wc.sheetId===this.$.qa.la.sheetId){Ac=(Wc=e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.HigherConfidence",!1))?1:.5;let nd=null;for(const qd of this.R1a.interpretations)qd.confidence>=Ac&&2===qd.orientation&&(Ac=qd.confidence,nd=qd);if(!nd)this.DHa("InvalidInterpretation"),c({level:50,methodName:"updateOnDemandActionButton",
message:"The recognition contained no interpretations",dataFields:this.Pd()});else if(1!==nd.headerRowCount||nd.headerColumnCount)this.DHa("InvalidInterpretation"),c({level:50,methodName:"updateOnDemandActionButton",message:"The recognition cannot be converted to a table",dataFields:this.Pd()});else if(this.v6c!==nd||!this.NG.visible){this.v6c=nd;c({level:50,methodName:"updateOnDemandActionButton",message:"Table Suggestion Confidence",dataFields:this.Pd(),fields:{confidence:Ac,useHigherConfidence:Wc}});
if(e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableAutomaticFormatting",!1)&&1===Ac&&this.G_a(this.Nmd.tableLocation)&&!Tb&&"CutAndPaste"===this.U0){Tb=await this.NG.Bca("RevertTable");if(Tb<this.dob){this.GF="RevertTable";this.NG.Q9e(this.Nmd,this.U0);c({level:50,methodName:"updateOnDemandActionButton",message:"Automatically formatting table",dataFields:this.Pd()});return}c({level:50,methodName:"updateOnDemandActionButton",message:"Exceeded maximum dismiss count.",dataFields:this.Pd(),
fields:{dismiss:Tb}})}this.NG.LXg(this.Nmd,this.U0)}}}}L2h(Tb){Tb=new oa.Range(Tb.range.top,Tb.range.left,Tb.range.top,Tb.range.right,!0,!1);for(Tb=la.f(this.$).Np("IntelligenceMetadataOverlay.containsFormulasInHeader",Tb,1);Tb.$$mn();)if(Tb.$$cu().Jx)return!0;return!1}async getMetadata(Tb,Wc){Wc=void 0===Wc?!1:Wc;this.S1a.stop();this.S1a.start();Tb=await this.eD.kVi(Tb,Ac=>{this.fel(Ac,Wc)});c({level:50,methodName:"getMetadata",message:"OnDemand metadata requested",dataFields:this.Pd()});Tb&&5!==
Tb&&(c({level:50,methodName:"getMetadata",message:"getMetadataForRange unsuccessful",dataFields:this.Pd(),fields:{["resultCode"]:za[Tb]}}),this.S1a.stop())}Exj(Tb){Tb=new oa.Range(1<Tb.range.top-1?Tb.range.top-1:1,1<Tb.range.left-1?Tb.range.left-1:1,Tb.range.bottom+1,Tb.range.right+1,!0,!1);const Wc=1===Tb.top,Ac=1===Tb.left,nd=la.f(this.$).Np("IntelligenceMetadataOverlay",Tb,1);for(;nd.$$mn();){const qd=nd.$$cu();if((qd.range.top===Tb.top&&!Wc||qd.range.left===Tb.left&&!Ac||qd.range.bottom===Tb.bottom||
qd.range.right===Tb.right)&&qd.Qh.value)return!1}return!0}G_a(Tb){return Tb.ld(this.grid.ha.oa.activeRange)}rIa(Tb){for(Tb=la.f(this.$).Np("IntelligentMetadataOverlayManager.isRangeEmpty",Tb,1);Tb.$$mn();){const Wc=Tb.$$cu();if(Wc&&(0!==Wc.Qh.type||!wa.a.uu(Wc.Qh.value)))return!1}return!0}async mUd(Tb){this.vna||(this.vna=this.$.Vb.Pg("WebServiceCall","getTableInfoStopwatch"));this.vna.stop();this.vna.start();const Wc=Ia.y(Tb.range.topLeft,this.$),Ac=this.$.ma.sa.mc(),nd={Duration:-1};return new Promise(qd=>
{const Xd=new kb.a(260,0,(Hd,Zc,Jc)=>Ga.t(this.$.ma.sa,Wc,Object(Ca.c)(Hd,gc=>{this.vna.stop();if(!gc||eb.a(gc))c({level:50,methodName:"invokeGetTableInfoAction",message:"Result returned with errors",dataFields:this.Pd()}),qd(null);else{gc=Ia.I(gc.Result.TableRange);nd.Duration=this.vna.Kc;var dd=e.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SmartView.ExpandedRangeLimit",800);this.vna.Kc>dd&&-1!==dd?(c({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableInfo timed out",dataFields:this.Pd(),
fields:nd}),qd(null)):(c({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableRange Succeeded",dataFields:this.Pd(),fields:nd}),qd(new Sa.a(gc,Tb.sheetId)))}}),Object(Ca.b)(Zc,()=>{this.vna.stop();nd.Duration=this.vna.Kc;c({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableRange Failed",dataFields:this.Pd(),fields:nd});qd(null)}),Jc,null,Ac),88);Xd.sMa(()=>!0);this.$.userOperationManager.enqueueOperation(Xd,null)})}};kc=Object(l.__decorate)([Object(E.d)(M.IntelligentMetadataOverlayManagerService),
Object(l.__param)(0,Object(M.EwaControlService)()),Object(l.__param)(1,Object(M.TableIntelligenceManagerService)()),Object(l.__param)(2,Object(M.ProactiveSuggestionCardService)())],kc);Object(t.a)(kc,"IntelligentMetadataOverlayManager",null,[683,4]);var na=a(39),fc=a(16),Cc=a(267),tc=a(49),nb=a(33),tb=a(57);let La=class extends Cc.a{constructor(Tb,Wc){super(document.createElement("div"));this.$=Tb;this.zoom=Wc;this.isMac=na.a.isMac;this.onKeyDown=Ac=>{Ac=Ac.Ha;switch(Ac.keyCode){case 27:if(this.so.onDismiss)this.so.onDismiss(Ac);
this.hide();return!0;default:return!1}};this.onKeyUp=Ac=>{Ac=Ac.Ha;switch(Ac.keyCode){case 121:return Ac.altKey&&Ac.shiftKey?(this.focus(),!0):!1;default:return!1}};this.QUd=(Ac,nd)=>Ac.x==nd.x&&Ac.y==nd.y&&Ac.width==nd.width&&Ac.height==nd.height;this.sGf=(Ac,nd)=>{const qd=Ac.topLeft.y,Xd=Ac.bottomRight.y,Hd=Ac.topLeft.x;Ac=Ac.bottomRight.x;switch(nd){case 0:return new tc.a(Hd+320,qd-166);case 1:return new tc.a(Hd-(320-(Ac-Hd))/2,qd-166);case 2:return new tc.a(Ac-320,qd-166);case 3:return new tc.a(Hd,
qd);case 4:return new tc.a(Hd+320,Xd+166);case 5:return new tc.a(Hd-(320-(Ac-Hd))/2,Xd+166);case 6:return new tc.a(Ac-320,Xd+166);case 7:return new tc.a(Hd,Xd);case 8:return new tc.a(Hd-320,qd+166);case 9:return new tc.a(Hd-320,qd-(166-(Xd-qd))/2);case 10:return new tc.a(Hd-320,Xd-166);case 11:return new tc.a(Ac+320,qd+166);case 12:return new tc.a(Ac+320,qd-(166-(Xd-qd))/2);case 13:return new tc.a(Ac+320,Xd-166);default:throw Error(`Unhandled direction: ${nd}`);}};this.Gze=()=>{if(this.isVisible){if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){const Ac=
this.rGf();if(!Ac&&!this.isc||Ac&&this.isc&&this.QUd(Ac.bounds,this.isc.bounds)&&Ac.direction===this.isc.direction)return}this.Ojl=nb.a.zb.me.m;this.hide();this.$6g=tb.a.instance.create(()=>{this.Ybl()},this.wah,"ProactiveSuggestionCard.UpdateCardPosition",void 0,!0)}else this.grid.view.xs(this.Gze)};this.Ybl=()=>{nb.a.zb.me.m-this.Ojl>=this.wah&&this.vUc()};this.grid=la.f(Tb);this.jee=null;this.tpc=this.w1=!1;this.wah=250;this.lXc=!1}get zoomManager(){return this.zoom.zoomManager}show(Tb,Wc,Ac,nd,
qd,Xd,Hd,Zc,Jc,gc,dd,Bb,pc,wc,cd,Vd,xb,ub,Fc){this.rootBounds=Sys.UI.DomElement.getBounds(this.grid.ZT.ud);this.lXc=xb;this.dpj=!!Bb;this.eWa=pc;this.so={range:Tb,container:this.domElement,title:Wc,description:Ac,primaryButtonText:nd,secondaryButtonText:qd,c3j:Xd,M4j:Hd,menuItems:Zc,I_b:Jc,fea:gc,icon:dd,direction:Bb,gapSpace:wc,onDismiss:cd,m$h:xd=>{xd&&(this.jee=xd)},setInitialFocus:Vd,ariaLabel:this.isMac?Wc+" "+I.a.instance.ia(1835):Wc+" "+I.a.instance.ia(1834),U5i:ub,J_j:Fc};Tb=this.vUc();this.w1||
(this.$.frame.hD.va(fc.a.Ye,this.$.domElement,this.onKeyUp),this.$.frame.hD.Vy(fc.a.nd,this.$.domElement,this.onKeyDown,!0),this.w1=!0);e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?void E.a.Bd(M.AriaLiveNotifierService).then(xd=>{const Ic=this.isMac?I.a.instance.ia(1835):I.a.instance.ia(1834);xd.setEnabled(!0);xd.readText(Ic)}):this.$.ra.Vc(211,xd=>{const Ic=this.isMac?I.a.instance.ia(1835):I.a.instance.ia(1834);xd.setEnabled(!0);xd.readText(Ic)});return Tb}hide(){A.ULS.sendTraceTag(527218006,
1,50,"ProactiveSuggestionUIControl.Hide: calling AppChrome API to unmount card UI.");e.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")&&this.$6g&&this.$6g.cancel();appChrome.unmountReactComponent(this.domElement);this.isVisible=!1;this.grid.view.xs(this.Gze);this.w1&&(this.$.frame.hD.Ua(fc.a.Ye,this.$.domElement,this.onKeyUp),this.$.frame.hD.fz(fc.a.nd,this.$.domElement,this.onKeyDown,!0),this.w1=!1)}focus(){this.jee&&this.jee.focus()}dispose(){super.dispose()}THf(Tb){var Wc,
Ac,nd=this.grid.rb.Yh(Tb);Tb=this.grid.Wg(Tb,nd);nd=this.grid.pg(nd).ul;const qd=this.sGf(Tb,null!==(Wc=this.so.direction)&&void 0!==Wc?Wc:13);if(nd.Dra(qd))return null!==(Ac=this.so.direction)&&void 0!==Ac?Ac:13;if(void 0===this.so.direction)return 11;if(this.eWa&&0<this.eWa.length)for(Wc=0;Wc<this.eWa.length;Wc++){if(Ac=this.sGf(Tb,this.eWa[Wc]),nd.Dra(Ac))return this.eWa[Wc]}else return this.so.direction}getCellBounds(Tb){if(Tb=this.grid.Ob(Tb))if(Tb.cell.Ak)if(this.grid.Bta(Tb.cell.aB.Yc)){if(!e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon"))return{bounds:this.grid.getCellBounds(Tb.cell,
!0),direction:void 0};var Wc=Tb.range,Ac=this.grid.rb.Yh(Wc),nd=this.grid.Wg(Wc,Ac);if(this.grid.pg(Ac).ul.ld(nd))if(Wc=this.THf(Wc),void 0===Wc)A.ULS.sendTraceTag(512361876,1,15,"ProactiveSuggestionUIControl.GetCellBounds failed to show UI, direction is undefined");else return{bounds:this.grid.getCellBounds(Tb.cell,!0),direction:Wc};else A.ULS.sendTraceTag(512266887,0,15,"ProactiveSuggestionUIControl.GetCellBounds: Range not in visible area")}else A.ULS.sendTraceTag(525341026,1,15,"ProactiveSuggestionUIControl.GetCellBounds failed to show UI, gridViewBlock not found");
else A.ULS.sendTraceTag(527218009,1,15,"ProactiveSuggestionUIControl.GetCellBounds: failed to show UI, formattedActiveCell is not in view.");else A.ULS.sendTraceTag(527218010,1,15,"ProactiveSuggestionUIControl.GetCellBounds: failed to show UI, formattedActiveCell is null.")}getRangeBounds(Tb){var Wc=this.grid.rb.Yh(Tb),Ac=this.grid.Wg(Tb,Wc);const nd=this.grid.pg(Wc);Wc=nd.ul;if(!Wc.ld(Ac))return A.ULS.sendTraceTag(508936469,0,50,"ProactiveSuggestionUIControl.getRangeBounds: Range not in visible area"),
{bounds:this.rootBounds,direction:this.so.direction};Ac=Wc.Xe(Ac);var qd=Ac.topLeft.y;const Xd=Ac.bottomRight.y,Hd=Ac.topLeft.x,Zc=Ac.bottomRight.x;Ac=this.so.direction;if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){if(Ac=this.THf(Tb),void 0===Ac)return A.ULS.sendTraceTag(508936468,0,50,"ProactiveSuggestionUIControl.getRangeBounds: Directional hint is undefined"),{bounds:this.rootBounds,direction:this.so.direction}}else Tb=new tc.a(Zc,Xd-134),this.tpc=!Wc.Dra(Tb);
Tb=Sys.UI.DomElement.getLocation(nd.domElement);qd=new Sys.UI.Point(Hd+Tb.x-Wc.topLeft.x,qd+Tb.y-Wc.topLeft.y);Wc=new Sys.UI.Point(Zc+Tb.x-Wc.topLeft.x,Xd+Tb.y-Wc.topLeft.y);qd=this.zoomManager.B7(qd);Wc=this.zoomManager.B7(Wc);return{bounds:new Sys.UI.Bounds(qd.x,qd.y,Wc.x-qd.x,Wc.y-qd.y),direction:Ac}}rGf(){const Tb=this.getRangeBounds(this.so.range);return this.lXc&&!this.QUd(Tb.bounds,this.rootBounds)?Tb:this.lXc?void 0:this.getCellBounds(this.so.range)}vUc(){if(!this.so)return!1;if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){var Tb=
this.rGf();if(!Tb)return A.ULS.sendTraceTag(512361875,1,15,"ProactiveSuggestionUIControl.renderCard: cardLayoutInfo is undefined"),!1;var Wc=Tb.bounds;Tb=Tb.direction;if(void 0===Wc)return A.ULS.sendTraceTag(512361874,1,15,"ProactiveSuggestionUIControl.renderCard: bounds is undefined"),!1}else this.lXc?(Wc=this.getRangeBounds(this.so.range).bounds,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?this.so.direction=this.tpc&&null!=this.eWa?this.eWa[0]:this.so.direction:this.so.direction=
this.dpj?this.so.direction:this.tpc?11:13,this.tpc=!1):(Wc=this.getCellBounds(this.so.range),Wc=null!=Wc?Wc[0]:void 0);if(this.QUd(Wc,this.rootBounds))return A.ULS.sendTraceTag(525341025,1,15,"ProactiveSuggestionUIControl.RenderCard failed to show UI, targetBounds set to root"),!1;A.ULS.shipAssertTag(527218008,1,!!Wc,"ProactiveSuggestionUIControl.RenderCard: target cell bounds should not be null.");A.ULS.sendTraceTag(527218007,1,50,"ProactiveSuggestionUIControl.RenderCard: calling AppChrome API to render card UI.");
appChrome.renderProactiveSuggestionCard(Wc.y,Wc.x,Wc.y+Wc.height,Wc.x+Wc.width,this.so.container,this.so.title,this.so.description,this.so.primaryButtonText,this.so.secondaryButtonText,this.so.c3j,this.so.M4j,this.so.menuItems,this.so.I_b,this.so.fea,this.so.icon,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?Tb:this.so.direction,this.so.gapSpace,this.so.onDismiss,this.so.m$h,this.so.setInitialFocus,this.so.ariaLabel,this.so.U5i,this.so.J_j);this.isVisible=!0;e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")&&
(this.isc={bounds:Wc,direction:Tb});this.grid.view.Ks(this.Gze);return!0}};La=Object(l.__decorate)([Object(E.d)(M.ProactiveSuggestionCardService),Object(l.__param)(0,Object(M.EwaControlService)()),Object(l.__param)(1,Object(M.ZoomService)())],La);Object(t.a)(La,"ProactiveSuggestionCard",Cc.a,[682]);var wb=a(1259);let Wa=class{constructor(Tb,Wc){this.$=Tb;this.eD=Wc;this.eD.Hja();Tb.qa.mh(()=>this.Wze());this.eD.Jbb("Valid",()=>{this.Wze()});this.eD.Jbb("Invalid",()=>{this.Wze()})}Wze(){const Tb=[],
Wc=[],Ac=[],nd=this.$.qa.la;if(nd){var qd=this.eD.Hja().yXa(new Sa.a(Object(Ia.h)(),nd.sheetId),2);for(const Hd of qd){if(Hd.table.analyzedRange.sheetId!==nd.sheetId)continue;var Xd=!this.roj(Hd.table.interpretations);qd=this.sKi(Hd.table);if(!qd)continue;const Zc=qd.tableLocation.clone();Zc.left+=qd.headerColumnCount;Zc.top+=qd.headerRowCount;if(Xd){let Jc=Xd=!0;for(let gc=0;gc<qd.fields.length;gc++){const dd=Zc.clone();2===qd.orientation?(dd.left+=gc,dd.right=dd.left):(dd.top+=gc,dd.bottom=dd.top);
1===qd.fields[gc].classification?(this.W2e(Tb,dd,Jc),Jc=!1):(this.W2e(Wc,dd,Xd),Xd=!1)}}else Tb.push(Zc);qd=this.CSi(qd);null!=qd&&0<qd.length&&Ac.push(...qd)}this.Rhe();0<Tb.length&&this.highlightRanges(Tb,[32]);0<Wc.length&&this.highlightRanges(Wc,[33]);0<Ac.length&&this.highlightRanges(Ac,[31])}else A.ULS.sendTraceTag(520147412,0,50,"GridHighlighter.updateGridHighlights: Active sheet null")}Rhe(){const Tb=[33,32,31];Object(la.f)(this.$).Ub.rl(Tb);Object(la.f)(this.$).Ub.Rtb(new Sa.a(null,Ba.d(this.$.la)),
Tb)}W2e(Tb,Wc,Ac){!Tb.length||Ac?Tb.push(Wc.clone()):(Ac=Tb[Tb.length-1],Ac.right+1===Wc.left?Ac.right=Wc.right:Ac.bottom+1===Wc.top?Ac.bottom=Wc.bottom:Tb.push(Wc.clone()))}sKi(Tb){const Wc=Tb.interpretations;return 0===(null===Wc||void 0===Wc?void 0:Wc.length)?null:1===Wc.length?Wc[0]:2===Wc.length?Wc[0].confidence===Wc[1].confidence?(Tb=2===Wc[0].orientation?Wc[0]:Wc[1],new wb.a(Tb.tableLocation,Tb.confidence,Tb.headerRowCount,(1===Wc[0].orientation?Wc[0]:Wc[1]).headerColumnCount,Tb.orientation,
Tb.fields)):Tb.interpretations[0].confidence>Tb.interpretations[1].confidence?Tb.interpretations[0]:Tb.interpretations[1]:null}highlightRanges(Tb,Wc){Tb=Sa.a.a7a(Ba.d(this.$.la),Tb);Object(la.f)(this.$).Ub.HL(Tb,Wc,!0)}CSi(Tb){const Wc=[];var Ac=Tb.tableLocation.clone();if(0<Tb.headerColumnCount){const nd=Tb.tableLocation.clone();nd.right=Ac.left+Tb.headerColumnCount-1;Wc.push(nd)}0<Tb.headerRowCount&&(Ac=Tb.tableLocation.clone(),Ac.bottom=Ac.top+Tb.headerRowCount-1,Wc.push(Ac));return Wc}roj(Tb){return!Tb||
2>Tb.length?!1:Tb[0].confidence===Tb[1].confidence}};Wa=Object(l.__decorate)([Object(E.d)(M.RecognizedTableGridHighlighterService),Object(l.__param)(0,Object(M.EwaControlService)()),Object(l.__param)(1,Object(M.TableIntelligenceManagerService)())],Wa);Object(t.a)(Wa,"RecognizedTableGridHighlighter",null,[]);var Fa;(function(Tb){Tb.Default="Default";Tb.Paste="Paste";Tb.ColumnAutoFit="ColumnAutoFit";Tb.BorderActions="BorderActions";Tb.Filter="Filter";Tb.CutAndPaste="CutAndPaste";Tb.PasteCoOccurrence=
"PasteCoOccurrence";Tb.InsertColumn="InsertColumn";Tb.DeleteColumn="DeleteColumn";Tb.InsertRow="InsertRow";Tb.DeleteRow="DeleteRow"})(Fa||(Fa={}));Object(t.b)("LaunchSource",Fa);const Da={[Fa.Paste]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("OnPasteEnabled"),!1)&&!e.EwaSettings.getBooleanFeatureGate(b("PasteCoOccurrence"),!1),HVg:e.EwaSettings.getBooleanFeatureGate(b("PasteCoOccurrence"),!1),Fma:f("OnPasteEnabled"),Qo:"OnDemand"},[Fa.CutAndPaste]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("OnPasteEnabled"),
!1),Fma:f("CutAndPaste"),Qo:"OnDemand"},[Fa.PasteCoOccurrence]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("OnPasteEnabled"),!1)&&e.EwaSettings.getBooleanFeatureGate(b("PasteCoOccurrence"),!1),HVg:!e.EwaSettings.getBooleanFeatureGate(b("OnPasteEnabled"),!1),Fma:f("PasteCoOccurrence"),Qo:"OnDemand"},[Fa.ColumnAutoFit]:{isEnabled:Y.a.k8(),Fma:"XLS-IntelligentMetadataTableProactiveSuggestions-Treatment;XLS-IntelligentMetadataTableProactiveSuggestions-Control",Qo:"Existing"},[Fa.BorderActions]:{isEnabled:Y.a.k8(),
Fma:"XLS-IntelligentMetadataTableProactiveSuggestions-Treatment;XLS-IntelligentMetadataTableProactiveSuggestions-Control",Qo:"Existing"},[Fa.Filter]:{isEnabled:Y.a.k8(),Fma:"XLS-IntelligentMetadataTableProactiveSuggestions-Treatment;XLS-IntelligentMetadataTableProactiveSuggestions-Control",Qo:"Existing"},[Fa.InsertColumn]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("InsertRowColProactiveSuggestions"),!1),Fma:f("InsertRowColProactiveSuggestions"),Qo:"Existing"},[Fa.DeleteColumn]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("DeleteRowColProactiveSuggestions"),
!1),Fma:f("DeleteRowColProactiveSuggestions"),Qo:"Existing"},[Fa.InsertRow]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("InsertRowColProactiveSuggestions"),!1),Fma:f("InsertRowColProactiveSuggestions"),Qo:"Existing"},[Fa.DeleteRow]:{isEnabled:e.EwaSettings.getBooleanFeatureGate(b("DeleteRowColProactiveSuggestions"),!1),Fma:f("DeleteRowColProactiveSuggestions"),Qo:"Existing"}};var ja=a(43);class Qa{constructor(Tb){this.$=Tb;this.grid=la.f(this.$)}a2j(Tb){this.grid.za.iKa(Tb)}}Object(t.a)(Qa,"GridHelper",
null,[]);class Ob{constructor(Tb){this.dataFields={Class:"TableSuggestionController"};this.$=Tb;this.t6i=new Qa(Tb)}VSa(Tb,Wc){if(Tb)if(this.ATi())if(this.ITi())this.FC("User in teams",Wc);else if(this.FTi())this.FC("Sheet is protected",Wc);else{var Ac=this.GQb(Tb);this.t6i.a2j(()=>{if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7800833_SVAddUniversalChecks")){if(this.wCd(Tb)){this.FC("Range already contains table",Wc);return}if(this.kji(Tb)){this.FC("Range already contains pivot table",Wc);return}if(this.gNi(Tb)){this.FC("Header contains links or formulas",
Wc);return}if(this.DTi(Ac.range)){this.FC("Specified range is empty",Wc);return}}this.uTi(nd=>this.y8k(nd,Ac,Wc))})}else this.FC("Language not supported",Wc);else this.FC("Range not provided",Wc)}uTi(Tb){ja.TaskExtensions.tb(Object(Va.d)(E.a.resolve(M.IntelligentMetadataOverlayManagerService,{xa:1})),Tb,this.$.Aa,3)}y8k(Tb,Wc,Ac){var nd;Tb=null===Tb||void 0===Tb?void 0:Tb.result;const qd=Object.assign({},this.dataFields,{LaunchSource:Ac}),Xd=null===(nd=Da[Ac])||void 0===nd?void 0:nd.Qo;Tb?(c({level:50,
methodName:"triggerTableSuggestionCard",message:"IntelligentMetadata is triggered",dataFields:qd,fields:{metadataType:Xd}}),"Existing"===Xd?void Tb.d8k(Wc,Ac):"OnDemand"===Xd?void Tb.tNa(Wc,Ac):c({level:50,methodName:"triggerTableSuggestionCard",message:"Invalid MetadataType is configured for the LaunchSource",dataFields:qd})):c({level:15,methodName:"triggerTableSuggestionCard",message:"IntelligentMetadataOverlayManager couldn't be retrieved",dataFields:qd})}GQb(Tb){var Wc;const Ac=null===(Wc=this.$.qa.la)||
void 0===Wc?void 0:Wc.sheetId;return new Sa.a(Tb,Ac)}FC(Tb,Wc){c({level:50,methodName:"logTableSuggestionDisabled",message:"Table suggestion disabled",dataFields:Object.assign({},this.dataFields,{LaunchSource:Wc}),fields:{reason:Tb}})}ATi(){return["en-US","en-GB","en-CA","en-AU","en_IN"].includes(this.$.O4)}ITi(){return this.$.ta.IsMeetingLiveSession||Yb.a.Tua()}FTi(){return(new Sb.SheetProtection(this.$.qa)).activeSheet.Ih}DTi(Tb){for(Tb=la.f(this.$).Np("TableSuggestionController.isRangeEmpty",Tb,
1);Tb.$$mn();){const Wc=Tb.$$cu();if(Wc&&(0!==Wc.Qh.type||!wa.a.uu(Wc.Qh.value)))return!1}return!0}gNi(Tb){Tb=new oa.Range(Tb.top,Tb.left,Tb.top,Tb.right,!0,!1);for(Tb=la.f(this.$).Np("TableSuggestionController.containsFormulasInHeader",Tb,1);Tb.$$mn();)if(Tb.$$cu().Jx)return!0;return!1}wCd(Tb){return la.f(this.$).Eb.r8(Tb)}kji(Tb){return la.f(this.$).Eb.tU(Tb)}}Object(t.a)(Ob,"TableSuggestionController",null,[]);var Ub;const Zb={[5]:"InsertRow",[9]:"InsertColumn",[6]:"DeleteRow",[10]:"DeleteColumn"},
uc=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,264209770,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761,719923386];let Hc=Ub=class{constructor(Tb,Wc){this.BZa=!1;this.dataFields={Class:"TableSuggestionManager"};this.$=Tb;M.TableSuggestionManagerService.Oa()?(this.fD=new Ob(Tb),c({level:50,methodName:"constructor",message:"Initialized successfully",dataFields:this.dataFields})):this.fD=Wc;e.EwaSettings.isChangeGateEnabled("OfficeVSO:7931124_sv_enable_commercial")&&
Object(ea.d)(db.a).execute(Ac=>{void Ac.isFeatureEnabled(Ub.V7b,!1).then(nd=>this.BZa=nd)})}dispose(){}G1c(Tb,Wc){const Ac=this.nXa("BorderActions");this.I0a("BorderActions",Ac);Ac&&(["OutsideBorders","AllBorders","ThickOutsideBorders"].includes(Wc)?this.fD.VSa(Tb,"BorderActions"):this.fD.FC(`Border action not supported - ${Wc}`,"BorderActions"))}c4g(Tb){var Wc,Ac,nd;const qd=this.nXa("ColumnAutoFit");this.I0a("ColumnAutoFit",qd);qd&&(null!==Tb&&void 0!==Tb&&Tb.Pnj?null!==(Wc=null===Tb||void 0===
Tb?void 0:Tb.Grd)&&void 0!==Wc&&Wc.SheetName?null!==(nd=null===(Ac=null===Tb||void 0===Tb?void 0:Tb.Grd)||void 0===Ac?void 0:Ac.Ranges)&&void 0!==nd&&nd.length?(Tb=Ia.G(Tb.Grd.Ranges[0]),this.fD.VSa(Tb,"ColumnAutoFit")):this.fD.FC("No range available on userContext","ColumnAutoFit"):this.fD.FC("SheetName was not provided","ColumnAutoFit"):this.fD.FC("isColumnAutoFit is falsy","ColumnAutoFit"))}e4g(Tb){const Wc=this.nXa("Filter");this.I0a("Filter",Wc);Wc&&(this.$.qa.la.bD?this.fD.FC("Filter was toggled off",
"Filter"):null!==Tb&&void 0!==Tb&&Tb.selection?(Tb=Ia.I(Tb.selection),this.fD.VSa(Tb,"Filter")):this.fD.FC("No selection provided","Filter"))}H1c(Tb,Wc){if(Y.a.k8()&&(Tb=Zb[Tb])){var Ac=this.nXa(Tb);this.I0a(Tb,Ac);Ac&&(1!==Wc.InsertDeleteRangeItems.length?this.fD.FC("Not exactly one operation",Tb):(Wc=Wc.InsertDeleteRangeItems[0],1<Wc.DeltaColumn||1<Wc.DeltaRow?this.fD.FC("Too many rows/cols added/deleted",Tb):(Wc=Ia.G(Wc.AdjustedSelectedRange),this.fD.VSa(Wc,Tb))))}}d4g(Tb,Wc){var Ac,nd;const qd=
this.nXa("CutAndPaste");this.I0a("CutAndPaste",qd);qd&&((null===Tb||void 0===Tb?0:Tb.pasteRecoveryUIDisplayed)?this.fD.FC("Paste recovery UI was displayed","CutAndPaste"):1!==(null===Wc||void 0===Wc?void 0:Wc.length)?this.fD.FC("Not exactly one range impacted","CutAndPaste"):[237279923,-875588320,-185374993,-958589048].includes(null===(nd=null===(Ac=Tb.commandParameters)||void 0===Ac?void 0:Ac.ribbonCommandInfo)||void 0===nd?void 0:nd.command)?(Tb=Ia.S(Wc),this.fD.VSa(Tb,"CutAndPaste")):this.fD.FC("Unsupported paste command",
"CutAndPaste"))}f4g(Tb){const Wc=this.nXa("PasteCoOccurrence");this.I0a("PasteCoOccurrence",Wc);Wc&&this.fD.VSa(Tb,"PasteCoOccurrence")}g4g(Tb,Wc,Ac){const nd=this.nXa("Paste");this.I0a("Paste",nd);nd&&(Ac?(c({level:50,methodName:"triggerTableSuggestionOnRecoveryUiDismiss",message:"RecoveryUI is being dismissed.",dataFields:Object.assign({},this.dataFields,{LaunchSource:"Paste"})}),uc.includes(null===Tb||void 0===Tb?void 0:Tb.command)?this.fD.FC("Last command is not supported","Paste"):Wc?this.fD.FC("User clicked outside of document",
"Paste"):this.fD.VSa(Ac,"Paste")):this.fD.FC("No pastedRange provided","Paste"))}nXa(Tb){var Wc;let Ac=!(null===(Wc=Da[Tb])||void 0===Wc||!Wc.isEnabled);e.EwaSettings.isChangeGateEnabled("OfficeVSO:7931124_sv_enable_commercial")&&(Wc=e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CommercialProEnabled",!1)&&this.BZa,"PasteCoOccurrence"===Tb&&(Wc=!1),Ac||(Ac=Wc));return Ac}I0a(Tb,Wc){this.cHj(Tb);Wc&&c({level:50,methodName:"logEntryOccurredForLaunchSource",message:"Entered funnel",
dataFields:Object.assign({},this.dataFields,{LaunchSource:Tb})})}cHj(Tb){var Wc,Ac;const nd=null===(Wc=Da[Tb])||void 0===Wc?void 0:Wc.Fma;Tb=null===(Ac=Da[Tb])||void 0===Ac?void 0:Ac.HVg;nd&&!Tb&&Ka.a.UN(nd)}};Hc.V7b="SmartViewTableCommercial";Hc=Ub=Object(l.__decorate)([Object(E.d)(M.TableSuggestionManagerService),Object(l.__param)(0,Object(M.EwaControlService)())],Hc);Object(t.a)(Hc,"TableSuggestionManager",null,[681,4]);var Dd=a(9),jc=a(430);class $c extends jc.a{constructor(Tb){super();this.$=
Tb;this.ri();this.dataFields={Class:"TableSuggestionManagerFactory"}}create(){var Tb=this.$.ra.Tb(534);Tb||(Tb=new Ob(this.$),Tb=new Hc(this.$,Tb),this.$.ra.zc(534,Tb));this.Uf(Tb);c({level:50,methodName:"Create",message:"Initialized successfully",dataFields:this.dataFields})}static Ea(Tb){Tb.ra.zc(535,new $c(Tb))}}Object(t.a)($c,"TableSuggestionManagerFactory",jc.a,[]);var ud=a(6),Ud=a(307);class ec{constructor(){this.Tba=0;this.localStorage=new Ud.a;this.Tba=this.dPi()}Bca(){return this.Tba}Fsb(){this.Tba=
0;this.YMg()}skb(){this.Tba++;this.YMg()}dPi(){try{if(!this.localStorage.Tf())return 0;const Tb=this.localStorage.getItem("PivotTableHandRaiseDismissCount");return Tb?Number.parseLocale(Tb):0}catch(Tb){return A.ULS.sendTraceTag(522311635,306,10,"PivotTableHandRaiseLocalStorageLoaderSaver:getDismissCountFromCache failure"),0}}YMg(){try{this.localStorage.Tf()&&this.localStorage.setItem("PivotTableHandRaiseDismissCount",this.Tba.toString())}catch(Tb){A.ULS.sendTraceTag(522311634,306,10,"PivotTableHandRaiseLocalStorageLoaderSaver:saveDismissCountToCache failure")}}}
Object(t.a)(ec,"PivotTableHandRaiseLocalStorageLoaderSaver",null,[]);class Db{constructor(Tb){this.version=1;this.iMa=0;this.$=Tb}async Bca(){this.JLg||(this.JLg=this.ePi());return await this.JLg+this.iMa}Fsb(){this.iMa=0;this.gNg(0)}async skb(){this.iMa++;this.gNg(await this.Bca())}ePi(){return new Promise(Tb=>{Gb.D(this.$.ma.sa,3,Wc=>{Rb.a.zf(Wc.Errors)?(A.ULS.sendTraceTag(520370311,0,10,`readRoamingString encountered an error. Errors: ${Rb.a.pc(Wc.Errors)}`),Tb(Number.POSITIVE_INFINITY)):Wc.Result?
(Wc=JSON.parse(Wc.Result),!Wc||null==Wc.version||null==Wc.Tba||Wc.version<this.version?Tb(0):Tb(Wc.Tba)):(A.ULS.sendTraceTag(520370310,0,50,"readRoamingString - Received null"),Tb(0))},(Wc,Ac,nd)=>{Wc=Mb.a.te(Wc.data);A.ULS.sendTraceTag(520370309,0,10,`OnRoamingOperationFailure: Encountered errors for ${nd}. Errors: ${Rb.a.pc(Wc)}.`);Tb(Number.POSITIVE_INFINITY)},null,null)})}gNg(Tb){Tb!==Number.POSITIVE_INFINITY&&(Tb=JSON.stringify({version:this.version,Tba:Tb}),Gb.K(this.$.ma.sa,3,Tb,Wc=>{Rb.a.zf(Wc.Errors)?
A.ULS.sendTraceTag(520370308,0,10,`writeRoamingString encountered an error. Errors: ${Rb.a.pc(Wc.Errors)}`):Wc.Result||A.ULS.sendTraceTag(520370307,0,10,"writeRoamingString failed to write to roaming service.")},(Wc,Ac,nd)=>{Wc=Mb.a.te(Wc.data);A.ULS.sendTraceTag(520370306,0,10,`OnRoamingOperationFailure: Encountered errors for ${nd}. Errors: ${Rb.a.pc(Wc)}.`)},null,null))}}Object(t.a)(Db,"PivotTableHandRaiseRoamingHandler",null,[723]);var ic=a(81),Pc=a(1064),Ed=a(367);class de extends Pc.a{constructor(){super();
this.userCommands=null;this.H_=Object.assign(new Ed.a,{T_:de.getTypeName(),B_:de.getBaseTypes()})}static getTypeName(){return"AugLoop_ExcelProactiveSuggestion_ProactiveSuggestionSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}}Object(t.a)(de,"ProactiveSuggestionSignal",Pc.a,[]);class se extends de{constructor(){super();this.interpretations=null;this.H_=Object.assign(new Ed.a,{T_:se.getTypeName(),B_:se.getBaseTypes()})}static getTypeName(){return"AugLoop_ExcelProactiveSuggestion_PivotTableProactiveSuggestionSignal"}static getBaseTypes(){return["AugLoop_ExcelProactiveSuggestion_ProactiveSuggestionSignal",
"AugLoop_Signals_Signal"]}}Object(t.a)(se,"PivotTableProactiveSuggestionSignal",de,[]);class Fe{constructor(){this.confidence=0;this.orientation=this.location=null;this.headerColumnCount=this.headerRowCount=0;this.headerNames=this.sectionLines=this.aggregationLines=this.dataBlockIntervals=this.fields=null}}Object(t.a)(Fe,"ExcelRecognizedTableInterpretationNew",null,[]);class fe{constructor(){this.headerReferences=this.aggregations=this.classification=null}}Object(t.a)(fe,"ExcelRecognizedTableFieldNew",
null,[]);class Tc{constructor(){this.left=this.top=0}}Object(t.a)(Tc,"ExcelRecognizedTableCellReferenceNew",null,[]);var ed=a(1258);class pd{constructor(){this.type=null;this.timestamp=0}}Object(t.a)(pd,"UserCommand",null,[]);var Kb=a(614);class rb extends Kb.a{constructor(){super();this.suggestPivotTable=!1;this.H_=Object.assign(new Ed.a,{T_:rb.getTypeName(),B_:rb.getBaseTypes()})}static getTypeName(){return"AugLoop_ExcelProactiveSuggestion_ProactiveSuggestionAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
Object(t.a)(rb,"ProactiveSuggestionAnnotation",Kb.a,[]);class rc{constructor(Tb,Wc,Ac,nd){this.PKj=e.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.MaxPivotTableHandRaiseCount",1);this.ueg=e.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.MaxPivotTableHandRaiseDismissCount",20);this.X1d=!1;this.UQc=this.TQc=null;this.j9i=(qd,Xd)=>{qd=this.i9i(Xd);a:{switch(qd){case "InvalidContextInfo":case "SurveyParamsNull":Xd="Error";break a;case "Success":Xd="Success";break a}Xd=void 0}A.ULS.sendTraceTag(521441668,
306,50,`PivotTableHandRaiseManager.handlePivotTableActivationCallback Results: ${JSON.stringify({result:qd,status:Xd})}`);return null};this.Nd=(qd,Xd)=>{Xd&&Xd.G5f||(la.f(this.$).ha.vr(this.Nd),A.ULS.sendTraceTag(526984154,306,50,"PivotTableProactiveSuggestion: selection changed, hide hand raise card"),this.$Bd())};this.$=Tb;this.eD=Wc;this.hj=nd;this.fSe=this.v9c=0;this.proactiveSuggestionCard=Ac;Object(ea.d)(db.a).execute(async qd=>{const Xd=ud.AFrameworkApplication.tc.AudienceGroup,Hd="Automation"===
Xd||"Dogfood"===Xd||"Microsoft"===Xd;qd.oLa("ExcelIdeasPivotTableHandRaise",Zc=>{this.X1d=Zc.isEnabled&&(Hd||1===Zc.tierName)});await qd.isFeatureEnabled("ExcelIdeasPivotTableHandRaise",!1)&&(Hd||1===await qd.getFeatureTier("ExcelIdeasPivotTableHandRaise",0))&&(this.X1d=!0)});(Tb=Object(ea.d)(Oa.a))&&Tb.execute(qd=>{qd.J2b("PivotTableHandRaiseSurface",this.j9i)});if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",
!1))this.UQc=new Db(this.$);e.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&(this.TQc=new ec);this.activateAnnotation()}activateAnnotation(){this.hj.register(this.hj.RT().NV("PivotTableProactiveSuggestions").activateAnnotation({annotationType:rb.getTypeName(),ls:!1,dO:()=>{A.ULS.sendTraceTag(509449989,306,50,"PivotTableHandRaiseManager: Received annotation");return this.lFj()}}).LV((Tb,Wc)=>{A.ULS.sendTraceTag(509449990,306,50,JSON.stringify({closeReason:Tb,errorCode:Wc}))}).build())}get Nbg(){return this.fSe}async tNa(Tb){var Wc=
Date.now();Tb=await this.b8k(Tb);a:{switch(Tb){case "Success":case "SuccessWithLppDisabled":var Ac="Success";break a;case "DismissCountAboveLimit":case "IncorrectLicense":case "NotInEditMode":case "NoTableMetadata":case "RangeTooLarge":case "TriggerCountAboveMax":Ac="Aborted";break a;case "ActiveRangeNull":case "SystemInitiatedFeedbackNull":Ac="Error";break a}Ac=void 0}Wc={result:Tb,status:Ac,duration:Date.now()-Wc};A.ULS.sendTraceTag(521441669,306,50,`PivotTableHandRaiseManager.triggerHandRaise Results: ${JSON.stringify(Wc)}`)}async b8k(Tb){e.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&
Pa.b(this.$).Jd(Na.a.wbk,{},void 0,!0);if(!this.X1d)return A.ULS.sendTraceTag(537154654,306,50,"PivotTableHandRaiseManager:TriggerHandRaise License is not enabled."),"IncorrectLicense";if(!Tb)return A.ULS.sendTraceTag(537154653,306,10,"PivotTableHandRaiseManager:TriggerHandRaise activeRangeForHandRaise is null."),"ActiveRangeNull";if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:6212469_PTPSReadOnly")&&!this.$.fa.isEditMode)return A.ULS.sendTraceTag(523100545,306,50,"PivotTableHandRaiseManager:TriggerHandRaise not in edit mode."),
"NotInEditMode";if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)){if(await this.UQc.Bca()>=this.ueg)return A.ULS.sendTraceTag(520370312,306,50,"PivotTableHandRaiseManager:TriggerHandRaise dismiss count above limit"),"DismissCountAboveLimit"}else if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.TQc.Bca()>=this.ueg)return A.ULS.sendTraceTag(522311633,
306,50,"PivotTableHandRaiseManager:TriggerHandRaise dismiss count above limit"),"DismissCountAboveLimit";if(e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseTestOnly",!1))return this.v9c<this.PKj?(this.pXg(new Sa.a(Tb,Ba.d(this.$.qa.la))),"SuccessWithLppDisabled"):"TriggerCountAboveMax";Tb=this.PZi(Tb);if(!Tb)return"NoTableMetadata";if(176E4<Tb.analyzedRange.range.gu)return A.ULS.sendTraceTag(523776329,306,50,"PivotTableHandRaiseManager.triggerHandRaise range is too large to generate suggestions"),
"RangeTooLarge";this.pGk(Tb);return"Success"}dispose(){this.proactiveSuggestionCard&&this.proactiveSuggestionCard.dispose()}PZi(Tb){var Wc;A.ULS.sendTraceTag(537154651,306,50,"PivotTableHandRaiseManager:GetRelevantRecognizedTable get table metadata info.");(Tb=null===(Wc=this.eD.Hja().yXa(new Sa.a(Tb,Ba.d(this.$.qa.la)),6)[0])||void 0===Wc?void 0:Wc.table)&&A.ULS.sendTraceTag(520147406,306,50,`PivotTableHandRaiseManager.getRelevantRecognizedTable Found metadata with ID: ${Tb.id}`);return Tb}pGk(Tb){this.sheetRange=
Tb.analyzedRange;const Wc=new se;Wc.interpretations=Array.from(Tb.interpretations,Ac=>{const nd=new Fe;nd.confidence=Ac.confidence;nd.fields=Array.from(Ac.fields,qd=>{const Xd=new fe;Xd.aggregations=Array.from(qd.aggregations,Hd=>{switch(Hd){case 2:return"average";case 1:return"count";case 5:return"distinctCount";case 4:return"max";case 3:return"min";case 6:return"stdDev";case 0:return"sum";case 7:return"variance"}});switch(qd.classification){case 1:Xd.classification="dimension";break;case 2:Xd.classification=
"measure"}Xd.headerReferences=Array.from(qd.headerReferences,Hd=>{const Zc=new Tc;Zc.left=Hd.left;Zc.top=Hd.top;return Zc});return Xd});nd.headerColumnCount=Ac.headerColumnCount;nd.headerRowCount=Ac.headerRowCount;switch(Ac.orientation){case 1:nd.orientation="rowMajor";break;case 2:nd.orientation="columnMajor"}nd.location=new ed.a;nd.location.bottom=Ac.tableLocation.bottom;nd.location.left=Ac.tableLocation.left;nd.location.right=Ac.tableLocation.right;nd.location.top=Ac.tableLocation.top;return nd});
Tb=new pd;Tb.type="SortAscending";Tb.timestamp=Date.now();Wc.userCommands=[Tb];A.ULS.sendTraceTag(509450059,306,50,"PivotTableHandRaiseManager.sendPivotTableProactiveSuggestionSignal: Submit operation signal");this.hj.qvb(Wc,"PivotTableProactiveSuggestions")}async lFj(){const Tb=Object(ea.d)(Oa.a);return Tb?(this.fSe=this.Nbg+1,A.ULS.sendTraceTag(537154648,306,50,`PivotTableHandRaiseManager:TriggerHandRaise PivotTableHandRaiseActivity LPP activity log count: ${this.Nbg}`),(await new Promise(Wc=>{Tb.execute(Wc)})).logActivity("PivotTableHandRaiseActivity",
null,this.sheetRange),"Success"):"SystemInitiatedFeedbackNull"}i9i(Tb){A.ULS.sendTraceTag(537154647,306,50,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback HandlePivotTableActivationCallback invoked.");return Tb?!Tb.contextInfo||!Tb.contextInfo.length||1<Tb.contextInfo.length?(A.ULS.sendTraceTag(537154645,306,10,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback no valid contextInfo in surveyParams."),"InvalidContextInfo"):this.pXg(Tb.contextInfo[0].context):(A.ULS.sendTraceTag(537154646,
306,10,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback surveyParams is null."),"SurveyParamsNull")}pXg(Tb){void this.cek();e.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&Pa.b(this.$).Jd(Na.a.vbk,{},void 0,!0);A.ULS.sendTraceTag(526984158,306,50,"PivotTableProactiveSuggestion: show pivot table hand raise.");this.proactiveSuggestionCard.show(Tb.range,I.a.instance.ia(1833),I.a.instance.La(692),I.a.instance.ia(1831),I.a.instance.ia(1832),()=>{var Wc,Ac;e.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&
Pa.b(this.$).Jd(Na.a.ubk,{},void 0,!0);A.ULS.sendTraceTag(526984157,306,50,"PivotTableProactiveSuggestion:OpenPane Pivot table hand raise OOUI clicked.");e.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")&&this.proactiveSuggestionCard.hide();const nd={SourceControlId:"PivotTableHandRaise",spl:null!==(Ac=null===(Wc=la.f(this.$).Eb.dg(Tb.range))||void 0===Wc?void 0:Wc.name)&&void 0!==Ac?Ac:Object(Ia.A)(Tb.range,this.$.qa.pOd(Tb.sheetId).name,!0)};this.$.Dc(-1444574190,0,
0,nd).continueWith(()=>{e.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)?this.UQc.Fsb():e.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.TQc.Fsb();e.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")||this.proactiveSuggestionCard.hide()})},()=>{e.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&
Pa.b(this.$).Jd(Na.a.tbk,{},void 0,!0);A.ULS.sendTraceTag(526984156,306,50,"PivotTableProactiveSuggestion: Not Now clicked.");this.$Bd()},void 0,void 0,void 0,void 0,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?11:void 0,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?[13,8,10,6,4,2,0]:void 0,void 0,Wc=>{Wc=Wc?new Sys.UI.DomEvent(Wc):null;"keydown"===(null===Wc||void 0===Wc?void 0:Wc.type)&&27===Wc.keyCode&&(e.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&
Pa.b(this.$).Jd(Na.a.sbk,{},void 0,!0),this.$Bd())},!1,!0);la.f(this.$).ha.Vq(this.Nd);this.v9c+=1;return"Success"}async cek(){(await ic.GetServiceTaskFactory.$Wi(this.$.ra)).Pyg()}$Bd(){if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7071239_SwitchSheetWhenCardOpen")||!e.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")||this.proactiveSuggestionCard.isVisible)this.proactiveSuggestionCard.hide(),e.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||
e.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)?this.UQc.skb():e.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.TQc.skb()}}Object(t.a)(rc,"PivotTableHandRaiseManager",null,[709,4]);class ld extends jc.a{constructor(Tb){super();this.$=Tb;this.ri()}create(){const Tb=Object(Va.d)(E.a.resolve(M.TableIntelligenceManagerService,{xa:1})),Wc=Object(Va.d)(E.a.resolve(M.ProactiveSuggestionCardService,{xa:1})),Ac=Object(Va.d)(E.a.resolve(M.AugmentationLoopManagerService,
{xa:1}));ja.TaskExtensions.tb(z.Task.VE(...[Tb,Wc,Ac]),()=>{if(!this.$.ra.Tb(430)){var nd=Tb.result;const qd=Wc.result,Xd=null===Ac||void 0===Ac?void 0:Ac.result;nd&&qd?(nd=new rc(this.$,nd,qd,Xd),this.Uf(nd),this.$.ra.zc(430,nd)):(null==nd&&A.ULS.sendTraceTag(537154644,306,10,"PivotTableHandRaiseManagerFactory.Create: TableIntelligenceManager instance null."),null==qd&&A.ULS.sendTraceTag(525620053,306,10,"PivotTableHandRaiseManagerFactory.Create: ProactiveSuggestionCard instance null."),this.Uf(null))}},
this.$.Aa)}static Ea(Tb){Tb.ra.zc(431,new ld(Tb))}dispose(){this.$=null;super.dispose()}}Object(t.a)(ld,"PivotTableHandRaiseManagerFactory",jc.a,[]);a(1496);(()=>{Dd.a.wb(Tb=>{M.TableSuggestionManagerService.Oa()||$c.Ea(Tb)})})();(()=>{Dd.a.wb(Tb=>{e.EwaSettings.FN()||ld.Ea(Tb)})})();String(k);String(x);String(d);String(h);String(n);String(m);String(u);window.___1717508060447_closurehack=k;window.___1717508060447_closurehack=x;window.___1717508060447_closurehack=d;window.___1717508060447_closurehack=
h;window.___1717508060447_closurehack=n;window.___1717508060447_closurehack=m;window.___1717508060447_closurehack=u}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.datacleansing.js.map/1bf4a43c3bb9bc1c00268601bb8c024f/EwaTS.datacleansing.js.map