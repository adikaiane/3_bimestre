'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[4],{1048:function(y,r,a){a.r(r);a.d(r,"RelativeAndAbsoluteReferencesManager",function(){return G});y=a(0);var c=a(2),b=a(15);class f{}Object(y.a)(f,"Reference",null,[]);class k extends f{constructor(){super();this.column=this.row=null}}Object(y.a)(k,"CellReference",f,[]);class x{constructor(){this.end=this.start=0;this.zv=null}WJh(A,N){for(let K=0;K<this.zv.length;K++){const I=this.Nmc(A,this.zv[K]);N+=I;K<this.zv.length-
1&&(N+=":")}return N}}Object(y.a)(x,"IReferenceSequence",null,[]);var d=a(27),h=a(1025);class n extends x{constructor(){super();this.qIa=!1}vAc(){const {RelativeAndAbsoluteReferencesManager:A}=a(1048),N=this.zv[0];return A.khg(N.row.kind===h.a.abs,N.column.kind===h.a.abs)}Nmc(A,N){N=d.Range.Hc(N.row.index+1,N.column.index+1);return this.qIa?N.Azc(1===A||3===A,1===A||2===A):N.Nca(1===A||3===A,1===A||2===A,!0,!0)}}Object(y.a)(n,"CellReferenceSequence",x,[]);class m extends f{constructor(){super();this.secondColumn=
this.firstColumn=null}}Object(y.a)(m,"ColumnReference",f,[]);class u extends x{constructor(){super()}vAc(){const A=this.zv[0];return a(1048).RelativeAndAbsoluteReferencesManager.tfg(A.firstColumn,A.secondColumn).kind===h.a.abs?2:3}Nmc(A,N){return d.Range.bY(N.firstColumn.index+1,N.secondColumn.index+1).Nca(1===A||3===A,!0,1===A||3===A,!0)}}Object(y.a)(u,"ColumnReferenceSequence",x,[]);class l extends f{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(y.a)(l,"RangeReference",
f,[]);class t extends x{constructor(){super()}vAc(){const {RelativeAndAbsoluteReferencesManager:A}=a(1048),N=this.zv[0];return A.khg(N.top.kind===h.a.abs,N.left.kind===h.a.abs)}Nmc(A,N){N=new d.Range(N.top.index+1,N.left.index+1,N.bottom.index+1,N.right.index+1,!1,!1);const K=1===A||3===A;A=1===A||2===A;return N.Nca(K,A,K,A)}}Object(y.a)(t,"RangeReferenceSequence",x,[]);class e extends f{constructor(){super();this.secondRow=this.firstRow=null}}Object(y.a)(e,"RowReference",f,[]);class w extends x{constructor(){super()}vAc(){const A=
this.zv[0];return a(1048).RelativeAndAbsoluteReferencesManager.tfg(A.firstRow,A.secondRow).kind===h.a.abs?0:1}Nmc(A,N){return d.Range.lQ(N.firstRow.index+1,N.secondRow.index+1).Nca(!0,1===A||2===A,!0,1===A||2===A)}}Object(y.a)(w,"RowReferenceSequence",x,[]);var z=a(1241),E=a(1120),M=a(159);class G{constructor(A){this.Yd=A}yfb(A,N,K){let I,L;I=N;L=K;if(!A||!M.f(A))return{returnValue:A,f7d:I,e7d:L};var J=this.Yd.cGd(A);if(!J)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,f7d:I,e7d:L};J=this.w0i(J,A,N,K);let B=0,Y="",U=0,O=0;for(;O<J.length;O++)if(this.Gqf(J[O],N,K)){B=J[O].vAc();I=J[O].start;break}for(;O<J.length&&this.Gqf(J[O],N,K);O++)Y+=A.substring(U,J[O].start),Y=J[O].WJh(B,Y),U=J[O].end;U&&(L=Y.length);Y+=A.substring(U,A.length);return{returnValue:Y,f7d:I,e7d:L}}w0i(A,N,K,I){const L=[];for(let U=0;U<A.length;U++){var J=A[U];if(J.kind===z.a.range)if(J=J.ref,J.type===E.a.cell){var B=J;J=Object(c.a)(new n,{start:J.span.start,end:J.span.end,zv:[Object(c.a)(new k,
{column:B.col,row:B.row})],qIa:this.Yd.ITa(J.span.end,N)});L.push(J)}else if(J.type===E.a.range)this.Hqf(J.topLeftSpan,K,I)&&this.Hqf(J.bottomRightSpan,K,I)?(B=new l,J.top.index<=J.bottom.index?(B.top=J.top,B.bottom=J.bottom):(B.bottom=J.top,B.top=J.bottom),J.left.index<=J.right.index?(B.left=J.left,B.right=J.right):(B.right=J.left,B.left=J.right),J=Object(c.a)(new t,{start:J.topLeftSpan.start,end:J.bottomRightSpan.end,zv:[B]}),L.push(J)):(B=Object(c.a)(new n,{start:J.topLeftSpan.start,end:J.topLeftSpan.end,
zv:[Object(c.a)(new k,{column:J.left,row:J.top})],qIa:this.Yd.ITa(J.topLeftSpan.end,N)}),J=Object(c.a)(new n,{start:J.bottomRightSpan.start,end:J.bottomRightSpan.end,zv:[Object(c.a)(new k,{column:J.right,row:J.bottom})],qIa:this.Yd.ITa(J.topLeftSpan.end,N)}),L.push(B),L.push(J));else if(J.type===E.a.column){B=J;for(J=Object(c.a)(new u,{start:J.span.start,end:J.span.end,zv:[Object(c.a)(new m,{firstColumn:B.startIndex,secondColumn:B.endIndex})]});J.end<N.length-1&&":"===N.charAt(J.end)&&U<A.length-
1;)if(B=A[U+1].ref,B.type===E.a.column&&B.span.start===J.end+1){var Y=B;J.zv.push(Object(c.a)(new m,{firstColumn:Y.startIndex,secondColumn:Y.endIndex}));J.end=B.span.end;U++}else break;L.push(J)}else if(J.type===E.a.row){B=J;for(J=Object(c.a)(new w,{start:J.span.start,end:J.span.end,zv:[Object(c.a)(new e,{firstRow:B.startIndex,secondRow:B.endIndex})]});J.end<N.length-1&&":"===N.charAt(J.end)&&U<A.length-1;)if(B=A[U+1].ref,B.type===E.a.row&&B.span.start===J.end+1)Y=B,J.zv.push(Object(c.a)(new e,{firstRow:Y.startIndex,
secondRow:Y.endIndex})),J.end=B.span.end,U++;else break;L.push(J)}}return L}Gqf(A,N,K){return!(A.start>K||N>A.end)}Hqf(A,N,K){return!(A.start>K||N>A.end)}static tfg(A,N){return A.index<=N.index?A:N}static khg(A,N){return N||A?N&&A?2:!N&&A?3:0:1}}Object(y.a)(G,"RelativeAndAbsoluteReferencesManager",null,[754])},1071:function(y,r,a){a.d(r,"h",function(){return d});a.d(r,"g",function(){return n});a.d(r,"f",function(){return m});a.d(r,"b",function(){return u});a.d(r,"c",function(){return l});a.d(r,"e",
function(){return t});a.d(r,"d",function(){return e});a.d(r,"a",function(){return z});y=a(0);var c=a(12),b=a(494),f=a(15),k=a(1439),x=a(28);const d=(G,A,N,K)=>{const I={["flowId"]:G.flowId,["originFormulaFlowId"]:G.fV.flowId,["formulaAnonymized"]:G.anonymizedFormula,["originalFormulaAnonymized"]:G.fV.anonymizedFormula,["range"]:G.range,["failureReason"]:A,["isTableSuggestion"]:Object(k.b)(G)};f.ULS.sendTraceTag(221794372,306,20,`FormulaByExample suggestion display failure reported. Failure data ${JSON.stringify(I)}`);
N&&N.Xp(G.flowId,K,{reason:A})};var h;(function(G){G.EXAMPLE="EXAMPLE";G.MODIFIEDEXAMPLE="MODIFIEDEXAMPLE";G.RESTOFRANGE="RESTOFRANGE";G.MODIFIEDRESTOFRANGE="MODIFIEDRESTOFRANGE"})(h||(h={}));Object(y.b)("suggestionCellType",h);const n=(G,A,N,K,I,L,J,B,Y,U)=>{G={["failureReason"]:G,["flowId"]:L.flowId,["cellType"]:J,["caller"]:I,["formulaAnonymized"]:L.anonymizedFormula,["originalCellText"]:x.a.XW(A),["evalFormulaText"]:x.a.XW(N),["cellFormatIndex"]:K,["isOriginalValueMatchCellValue"]:B,["isTableSuggestion"]:Object(k.b)(L),
["originalNumFmt"]:Y?{["Start"]:x.a.XW(Y.Start),["Separator"]:x.a.XW(Y.Separator),["End"]:x.a.XW(Y.End)}:null,["evalNumFmt"]:U?{["Start"]:x.a.XW(U.Start),["Separator"]:x.a.XW(U.Separator),["End"]:x.a.XW(U.End)}:null};f.ULS.sendTraceTag(84165388,0,20,`FormulaByExample CloneEval mismatch failure reported. Failure data ${JSON.stringify(G)}`)},m=(G,A,N)=>{try{const K=E(G,A,N);window.performance.mark(K)}catch(K){f.ULS.sendTraceTag(529109767,0,10,`FormulaByExampleTelemetryGenerator.markPerformancePoint: Error thrown : ${K.message}`)}},
u=G=>{for(const A in w)try{window.performance.clearMarks(E(A,G,!1)),window.performance.clearMarks(E(A,G,!0))}catch(N){f.ULS.sendTraceTag(527005662,0,10,`FormulaByExampleTelemetryGenerator.clearPerformanceFlowMarks: Error thrown : ${N.message}`)}},l=G=>M(`FBE_flowCurrentDuration_${G}`,E(w.EditCommit,G,!1)),t=(G,A)=>{try{return{["EditCommitToSignal"]:M(`FBE_EditCommitToSignal_${A}_${G}`,E(w.EditCommit,A,!1),E(w.SignalSent,A,!1)),["WorkflowAndNetworkTime"]:G?0:M(`FBE_WorkflowAndNetworkTime_${A}_${G}`,
E(w.SignalSent,A,!1),E(w.AnnotationReceived,A,!1)),["Calculation"]:M(`FBE_Calculation_${A}_${G}`,E(w.CalculationStart,A,G),E(w.CalculationEnd,A,G)),["ModelUpdate"]:M(`FBE_ModelUpdate_${A}_${G}`,E(w.CalculationEnd,A,G),E(w.ModelUpdated,A,G)),["PreviewRender"]:M(`FBE_PreviewRendered_${A}_${G}`,E(w.ModelUpdated,A,G),E(w.PreviewRendered,A,G)),["Total"]:M(`FBE_Total_${A}_${G}`,E(w.EditCommit,A,!1),E(w.PreviewRendered,A,G))}}catch(N){f.ULS.sendTraceTag(529109766,0,50,`FormulaByExampleTelemetryGenerator.getPreviewShownDurations: Error thrown : ${N.message}`)}},
e=(G,A)=>{try{return{["UserInPreviewDuration"]:M(`FBE_InputToPreviewRemovedWithCSE_${A}_${G}`,E(w.PreviewRendered,A,G),E(w.UserInputArrived,A,G)),["InputToPreviewRemovedWithCSE"]:M(`FBE_InputToPreviewRemovedWithCSE_${A}_${G}`,E(w.UserInputArrived,A,G),E(w.PreviewRemovedWithCSE,A,G))}}catch(N){f.ULS.sendTraceTag(529109765,0,10,`FormulaByExampleTelemetryGenerator.getPreviewRemovedDurations: Error thrown : ${N.message}`)}};var w;(function(G){G.EditCommit="EDITCOMMIT";G.SignalSent="SIGNALSENT";G.AnnotationReceived=
"ANNOTATIONRECEIVED";G.CalculationStart="CALCULATIONSTART";G.CalculationEnd="CALCULATIONED";G.ModelUpdated="MODELUPDATED";G.PreviewRendered="PREVIEWRENDERED";G.UserInputArrived="USERINPUTARRIVED";G.PreviewRemovedWithCSE="PREVIEWREMOVEDWITHCSE"})(w||(w={}));Object(y.b)("FormulaByExampleFlowMarks",w);const z=G=>c.HelperMethods.Nsd&&b.a.gTa&&G.eIa(),E=(G,A,N)=>`${G}_${A+(N?"_cached":"")}`,M=(G,A,N)=>{const K=window.performance.measure(G,A,N);if(K)return A=K.duration,performance.clearMeasures(G),A;f.ULS.sendTraceTag(526984791,
0,15,`FormulaByExampleTelemetryGenerator.measureTime: could not find performance entry for measure: ${G}, startMark: ${A}, endMark: ${N}`);return-1}},1102:function(y,r,a){a.d(r,"b",function(){return-1});a.d(r,"a",function(){return M});y=a(0);var c=a(15),b;(function(K){K[K.UserEditedInTable=0]="UserEditedInTable";K[K.FormulaByExampleNoTrigger=1]="FormulaByExampleNoTrigger";K[K.FlowInterrupted=2]="FlowInterrupted";K[K.FormulaByExampleFullTrigger=3]="FormulaByExampleFullTrigger";K[K.HadCachedSuggestion=
4]="HadCachedSuggestion";K[K.NoCachedSuggestion=5]="NoCachedSuggestion";K[K.PreCalcPreviewRejected=6]="PreCalcPreviewRejected";K[K.WaitingForCalcResult=7]="WaitingForCalcResult";K[K.PostCalcPreviewRejected=8]="PostCalcPreviewRejected";K[K.SuggestionDidntMatch=9]="SuggestionDidntMatch";K[K.SuggestionMatched=10]="SuggestionMatched";K[K.PreviewShouldBeShown=11]="PreviewShouldBeShown";K[K.SignalSent=12]="SignalSent";K[K.NoSignalSent=13]="NoSignalSent";K[K.AnnotationReceived=14]="AnnotationReceived";K[K.NoFormulaFound=
15]="NoFormulaFound";K[K.FormulaFound=16]="FormulaFound";K[K.WorkbookClosed=17]="WorkbookClosed";K[K.UnexpectedTransition=18]="UnexpectedTransition"})(b||(b={}));Object(y.b)("FormulaByExampleFlowState",b);const f=new Map([[b.UserEditedInTable,[b.FormulaByExampleNoTrigger,b.FormulaByExampleFullTrigger]],[b.FormulaByExampleFullTrigger,[b.FlowInterrupted,b.NoCachedSuggestion,b.HadCachedSuggestion]],[b.NoCachedSuggestion,[b.NoSignalSent,b.SignalSent]],[b.HadCachedSuggestion,[b.PreCalcPreviewRejected,
b.WaitingForCalcResult]],[b.PreCalcPreviewRejected,[b.NoSignalSent,b.SignalSent]],[b.WaitingForCalcResult,[b.NoSignalSent,b.SignalSent]]]),k=new Set([b.FormulaByExampleNoTrigger,b.FlowInterrupted,b.NoSignalSent,b.SignalSent]),x=new Map([[b.PreCalcPreviewRejected,[b.SuggestionDidntMatch,b.SuggestionMatched]]]),d=new Set([b.SuggestionDidntMatch,b.SuggestionMatched]),h=new Map([[b.WaitingForCalcResult,[b.PostCalcPreviewRejected,b.SuggestionDidntMatch,b.SuggestionMatched]],[b.SuggestionDidntMatch,[b.PostCalcPreviewRejected,
b.PreviewShouldBeShown]],[b.SuggestionMatched,[b.PostCalcPreviewRejected,b.PreviewShouldBeShown]]]),n=new Set([b.PostCalcPreviewRejected,b.PreviewShouldBeShown]),m=new Map([[b.SignalSent,[b.AnnotationReceived]],[b.AnnotationReceived,[b.NoFormulaFound,b.FormulaFound]],[b.FormulaFound,[b.PreCalcPreviewRejected,b.WaitingForCalcResult]]]),u=new Set([b.NoFormulaFound,b.FormulaFound]),l=new Set([b.NoFormulaFound,b.PreCalcPreviewRejected,b.WaitingForCalcResult]);var t;(function(K){K[K.Initial=0]="Initial";
K[K.Pending=1]="Pending";K[K.Resolved=2]="Resolved"})(t||(t={}));Object(y.b)("SignalState",t);var e=a(1);class w{constructor(K,I,L){this.currentState=K;this.p0k=I;this.WAi=L}mFa(K){const I=this.p0k.get(this.currentState);return I&&I.includes(K)?(this.currentState=K,!0):!1}get isActive(){return!this.WAi.has(this.currentState)}BOd(){return b[this.currentState]}}Object(y.a)(w,"FormulaByExampleStateMachine",null,[]);class z{constructor(K,I,L,J,B,Y){this.dYj=Y;this.bQc=new w(0,f,k);this.rca={flowId:K,
V_h:I,rowNumber:L,dW:J,BMc:null,DCf:!1,Foe:!1,W5a:0,nU:B,ECf:{},hdf:new Set}}get W5a(){return this.rca.W5a}set flowId(K){this.rca.flowId=K}uNc(K){this.rca.hdf.add(K)}mFa(K,I){17===K?this.Hha():(this.lvc(K,I),this.$Hh())}Hha(){this.dYj(this.rca)}lvc(K,I){var L,J;this.bQc.mFa(K)?this.B2j(K):(null===(L=this.Edb)||void 0===L?0:L.mFa(K))?this.TTj(K):(null===(J=this.FZc)||void 0===J?0:J.mFa(K))?this.z5j(K,I):this.C0j(K,I);(K=this.SKf(K))&&this.M2e(K,I)}B2j(K){switch(K){case 2:this.rca.DCf=!0;break;case 6:this.Edb=
new w(K,x,d);break;case 7:this.Edb=new w(K,h,n);break;case 12:this.rca.W5a=1,this.FZc=new w(K,m,e.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer")?l:u)}}TTj(K){switch(K){case 9:this.rca.Foe=!1;break;case 10:this.rca.Foe=!0}}z5j(K,I){switch(K){case 14:this.rca.W5a=2;break;case 16:this.rca.BMc=I?I.BMc:null;break;case 7:this.Edb=new w(K,h,n)}}C0j(K,I){this.M2e(this.SKf(18),{reason:`${`Tried to change state from ${this.iHk()} to ${b[K]}`}.${this.HMf(I)}`});
this.Hha()}$Hh(){var K,I;this.bQc.isActive||(null===(K=this.Edb)||void 0===K?0:K.isActive)||(null===(I=this.FZc)||void 0===I?0:I.isActive)||this.Hha()}M2e(K,I){if(I=this.HMf(I))K.explanation||(K.explanation=""),K.explanation+=I;I=Object.assign({},K);K=K.name;I=(delete I.name,I);this.rca.ECf[K]=I}HMf(K){return null!=K&&null!=K.reason?" "+K.reason:""}iHk(){var K,I;const L=`OriginStateMachine: ${this.bQc.isActive?this.bQc.BOd():"NotActive"}`,J=`CalcStateMachine: ${(null===(K=this.Edb)||void 0===K?0:
K.isActive)?this.Edb.BOd():"NotActive"}`;K=`SignalStateMachine: ${(null===(I=this.FZc)||void 0===I?0:I.isActive)?this.FZc.BOd():"NotActive"}`;return`[${L}, ${J}, ${K}]`}SKf(K){switch(K){case 1:return this.R0("FBEFullTrigger",!1);case 3:return this.R0("FBEFullTrigger",!0);case 5:return this.R0("CachedSuggestion",!1);case 4:return this.R0("CachedSuggestion",!0);case 6:return this.R0("PreviewShouldBeShown",!1,"Before calling calc evaluation");case 8:return this.R0("PreviewShouldBeShown",!1,"After returning from Calc");
case 9:return this.R0("SetCellMatchedSuggestion",!1);case 10:return this.R0("SetCellMatchedSuggestion",!0);case 11:return this.R0("PreviewShouldBeShown",!0);case 8:return this.R0("PreviewShouldBeShown",!1,"After returning from Calc");case 15:return this.R0("FormulaFound",!1);case 16:return this.R0("FormulaFound",!0);case 18:return this.R0("UnexpectedTransition",!0)}return null}R0(K,I,L){return L?{name:K,value:I,explanation:L}:{name:K,value:I}}}Object(y.a)(z,"FormulaByExampleFlowDataAggregator",null,
[]);var E=a(976);class M{static getInstance(K){this.instance||(e.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")?this.instance=G.getInstance(K):this.instance=N.getInstance(K));return this.instance}}Object(y.a)(M,"FormulaByExampleFlowsTrackerFactory",null,[]);class G{constructor(K){this.nextId=1;this.SXf=this.D9b=0;this.C1=new Map;this.mwe=new Map;this.rgf=new Map;this.jd=()=>{const I=this.DXi();if(0!==I.size){this.dc.sendBeaconTraceTag(526984790,50,!1,`some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: ${this.D9b}, Unresolved flows amount: ${I.size}, pending flows: ${[...I].join()}, interrupted flows amount ${this.SXf}`);
for(const L of I)this.Xp(L,17)}};this.T1k=I=>{const L=I.flowId;var J=I.V_h;const B=I.rowNumber,Y=I.dW,U=I.BMc,O=I.DCf,C=I.Foe,X=I.W5a,S=I.ECf,ea=I.hdf,Oa=I.nU,Ha=this.MLf(J);I=Ha.Hva;const Za=I!==U;Za&&(Ha.d0g++,Ha.Hva=U);C&&Ha.Nrf++;O&&this.SXf++;2===X&&this.D9b++;J={["flowId"]:L,["columnKey"]:J,["rowNumber"]:B,["triggerCommand"]:E.a.wKd(Y),["flowDataAggergation"]:S,["editOperationsInColumn"]:Ha.Erf,["suggestionChangesInColumn"]:Ha.d0g,["gotNewSuggestion"]:Za,["matchedSuggestionsInColumn"]:Ha.Nrf,
["cellCycleColumns"]:Array.from(ea).sort(),["rowsEditedInColumn"]:Array.from(Ha.Krf).sort(),["isInExplicitTable"]:Oa};c.ULS.sendTraceTag(512365781,0,null!=I||null!=U?20:50,`FormulaByExampleFlowsTracker.summarizeFlowOverallData: Flow Aggregation results: ${JSON.stringify(J)}`);this.C1.set(L,void 0)};this.dc=K;K.Sj(this.jd);this.eoe=new A}static getInstance(K){G.instance||(G.instance=new G(K));return G.instance}jLf(){const K=this.nextId++,I=this.C1.get(-1);I?(I.flowId=K,this.C1.set(K,I),this.C1.delete(-1)):
c.ULS.sendTraceTag(512503829,0,15,`FormulaByExampleFlowsTracker.getNewFlowId: on flowId ${K} called getNewFlowId without having matched anonymousFlow`);return K}z0f(K){const I=this.C1.has(K),L=this.C1.get(K),J=L&&1===L.W5a;let B;I?L?J||(B="The flow exists but is not pending for annotation"):B="Flow was resolved already":B="This flow does not exist";B&&c.ULS.sendTraceTag(509650145,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: flow is not pending for annotation. ${B} flowId: ${K}`);
return J}Isg(K,I,L,J){this.C1.get(-1)&&(this.Xp(-1,2),this.C1.delete(-1));const B=this.MLf(K);B.Erf++;B.Krf.add(I);this.C1.set(-1,new z(-1,K,I,J,L,this.T1k))}Plg(K,I,L,J){I=this.Gyc(I,L);this.Isg(I,J,!0,K)}Qlg(K,I,L,J,B){I=this.SOb(I,L,B);this.Isg(I,J,!1,K)}uNc(K,I){const L=this.C1.get(K);L?L.uNc(I):this.ZIg("onCellCycleFound",K)}Xp(K,I,L){const J=this.C1.get(K);J?J.mFa(I,L):this.ZIg("notifyFlowReachedState",K,I)}Gyc(K,I){let L=this.mwe.get(K);void 0===L&&(L=this.mwe.size,this.mwe.set(K,L));return L+
"_"+I}SOb(K,I,L){return this.EFf(K,L,I)}FFf(K,I){return this.EFf(K,I)}EFf(K,I,L){let J;const B=this.eoe.z2i(I);B?B.find((Y,U)=>{J=U;return Y.ld(K)})||(this.eoe.m3e(I,K),J=B.length-1):(J=0,this.eoe.m3e(I,K));return`${I}_${J}${L?`_${L}`:""}`}DXi(){const K=new Set;for(const I of this.C1){const [L,J]=I;1===(null===J||void 0===J?void 0:J.W5a)&&K.add(L)}return K}MLf(K){let I=this.rgf.get(K);I||(I={Erf:0,Nrf:0,d0g:0,Hva:null,Krf:new Set},this.rgf.set(K,I));return I}ZIg(K,I,L){const J=this.C1.has(I);c.ULS.sendTraceTag(509678805,
0,15,`FormulaByExampleFlowsTracker.${K}:
       on flowId ${I} ${L?` transition to ${b[L]}`:""}, `+"flowIdsToAggregatorsMap didn't find the requested flowAggregatoror. "+`Did flow exist: ${J}`)}}Object(y.a)(G,"FormulaByExampleFlowsTracker",null,[771]);class A{constructor(){this.p0c=new Map}m3e(K,I){this.p0c.has(K)||this.p0c.set(K,[]);this.p0c.get(K).push(I)}z2i(K){return this.p0c.get(K)}}Object(y.a)(A,"SensedTablesHeatMap",null,[]);class N{constructor(K){this.nextId=1;this.cOb=new Set;this.D9b=0;this.jd=()=>{const I=this.cOb.size;0!==I&&
this.dc.sendBeaconTraceTag(526984790,50,!1,"some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: {0}, Unresolved flows amount: {1}, pending flows: {2}",this.D9b,I,[...this.cOb].join())};this.dc=K;this.dc.Sj(this.jd)}static getInstance(K){N.instance||(N.instance=new N(K));return N.instance}z0f(K){return this.cOb.has(K)}Plg(){}Qlg(){}uNc(){}Gyc(){return null}SOb(){return null}FFf(){return null}Xp(K,I){switch(I){case 12:this.MJk(K);break;case 14:this.NJk(K)}}jLf(){return this.nextId++}MJk(K){this.cOb.add(K);
this.D9b++}NJk(K){this.cOb.delete(K)}}Object(y.a)(N,"FormulaByExampleFlowsTrackerDeprecated",null,[771])},1139:function(y,r,a){a.d(r,"b",function(){return"<<<FBE_XL_RW>>>"});a.d(r,"a",function(){return c});y=a(0);a=a(1285);class c extends a.a{constructor(b,f,k,x){super(b,f,k,x);this.kind="Range";this.ZAa=x.headerRow;this.zs=x.zs;this.aVb=x.RK}get formula(){const b=super.formula;return b?b.replace(RegExp("<<<FBE_XL_RW>>>","g"),`${this.originCell.top}`):null}get CId(){return super.formula}get aVb(){return this.pph}set aVb(b){this.pph=
b}get zs(){return this.qvh}set zs(b){this.qvh=b}get headerRow(){return this.ZAa}}Object(y.a)(c,"FormulaByExampleRangeSuggestion",a.a,[])},1140:function(y,r,a){a.d(r,"a",function(){return 2})},1212:function(y,r,a){a.d(r,"b",function(){return f});a.d(r,"c",function(){return x});a.d(r,"a",function(){return d});y=a(0);var c;(function(h){h.accept="ACCEPT";h.undo="UNDO";h.decline="DECLINE";h.ignore="IGNORE";h.unseen="UNSEEN"})(c||(c={}));Object(y.b)("PreviewOutcome",c);var b;(b||(b={})).unseen="UNSEEN";
Object(y.b)("EntryState",b);const f=Object.assign({},b,c);class k{constructor(h){this.state=f.unseen;this.CL=0;this.suggestion=h}Mej(){this.CL+=1}}Object(y.a)(k,"SuggestionEntryInternal",null,[]);class x extends Map{kba(h){const n=this.FGa(h);if(!n)return null;let m=this.get(n);m||(m=[],this.set(n,m));h=new k(h);m.push(h);return h}Kfb(h){h=this.aQb(h);return this.cfi(h)}cfi(h){if(h){var n=this.FGa(h.suggestion);n=this.get(n);n.splice(n.indexOf(h));return!0}return!1}d8g(h){const n=this.aQb(h);return this.CAe(n,
h)}CAe(h,n){h&&(h.suggestion=n);return h}}Object(y.a)(x,"SuggestionsCache",Map,[]);class d extends x{ZPi(h){var n;return null===(n=super.get(h))||void 0===n?void 0:n[0]}aQb(h){return(h=this.FGa(h))?this.has(h)?this.get(h)[0]:null:null}kba(h){const n=this.FGa(h);if(!n)return null;h=new k(h);this.set(n,[h]);return h}Kfb(h){return(h=this.FGa(h))?this.delete(h):!1}}Object(y.a)(d,"SingularSuggestionsCache",x,[])},1285:function(y,r,a){a.d(r,"a",function(){return f});y=a(0);r=a(1286);var c=a(15),b=a(27);
class f extends r.a{constructor(k,x,d,h){super();this.xad=null;this.bUe=!1;Object.assign(this,x);this.dc=k;this.qMe=d;h&&(this.T$a=h.aQc,this.Dlh=h.valueType,this.vjd=h.sheetId,this.bUe=h.jsj);this.fV={flowId:this.flowId,xz:this.xz,originCell:this.originCell,anonymizedFormula:this.anonymizedFormula}}set PEi(k){this.xad=k}set flowId(k){this.qMe=k}get flowId(){return this.qMe}get formula(){var k;if(this.xad)return this.xad;void 0===this.WAa&&(this.WAa=null===(k=this.generatedFormula)||void 0===k?void 0:
k.formula)&&"="!==this.WAa.charAt(0)&&(c.ULS.sendTraceTag(509620492,306,50,"FormulaByExampleSuggestion.formula: appending = sign as formula prefix."),this.WAa=`=${this.WAa}`);return this.WAa}set xz(k){this.C$c=k}get xFd(){return this.rows}get gei(){return this.Dlh}get anonymizedFormula(){var k;void 0===this.bec&&(this.bec=null===(k=this.generatedFormula)||void 0===k?void 0:k.anonymizedFormula);return this.bec}get sheetId(){return this.vjd}get xz(){void 0===this.C$c&&(this.C$c=this.xFd.length);return this.C$c}set originCell(k){this.T$a=
k}get originCell(){void 0===this.T$a&&(c.ULS.sendTraceTag(509620491,306,10,`FormulaByExampleSuggestion.originCell: origin cell is not defined - falling back to first cell of annotation range. flowId: ${this.flowId}`),this.T$a=b.Range.Hc(this.xFd[0],this.column));return this.T$a}get range(){return new b.Range(this.zs.top,this.T$a.left,this.zs.bottom,this.T$a.left,!0,!0)}get X1j(){return this.bUe}$_f(k){return k.ld(this.range)&&this.xFd.includes(k.top)}}Object(y.a)(f,"FormulaByExampleSuggestionBase",
r.a,[786])},1286:function(y,r,a){a.d(r,"a",function(){return b});y=a(0);r=a(614);var c=a(367);class b extends r.a{constructor(){super();this.rows=null;this.column=0;this.generatedFormula=this.formulas=null;this.resultKind=this.invocationMethod=this.stateID=0;this.errorMessage=this.guid=null;this.H_=Object.assign(new c.a,{T_:b.getTypeName(),B_:b.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
Object(y.a)(b,"FormulaByExampleAnnotation",r.a,[])},1287:function(y,r,a){a.d(r,"a",function(){return c});const c=b=>excelOnlineCalc.util.isSuccess(b)},1439:function(y,r,a){a.d(r,"b",function(){return l});a.d(r,"a",function(){return e});y=a(0);var c=a(397);r=a(1212);var b=a(15);class f{constructor(w){this.rC=w;this.Ioc=new Map}kba(w){return this.eXi(w.sheetId).kba(w)}jAc(w){const z=this.Ioc.get(w.sheetId);return z?z.jAc(w.range):null}Vei(w){const z=this.Ioc.get(w.sheetId);return z?z.Kfb(w):!1}eXi(w){let z=
this.Ioc.get(w);z||(z=new k(this.rC),this.Ioc.set(w,z));return z}}Object(y.a)(f,"FormulaByExampleRangeSuggestionsCache",null,[]);class k extends r.c{constructor(w){super();this.rC=w}kba(w){const z=this.d8g(w);if(z)return z;this.Kfb(w);this.rC.TV(w.originCell,3);return super.kba(w)}aQb(w){return this.jAc(w.range)}jAc(w){var z;b.ULS.shipAssertTag(509383498,306,w.wU,"FormulaByExampleRangeSuggestionsCache.getIntersectingSuggestion: lookup range must be of single column width.");return null===(z=this.get(w.left))||
void 0===z?void 0:z.find(E=>E.suggestion.range.ld(w))}FGa(w){return w.range.left}d8g(w){const z=this.aQb(w);return z&&z.suggestion.CId===w.CId?this.CAe(z,w):null}}Object(y.a)(k,"ColumnBasedRangeSuggestionsCache",r.c,[]);var x=a(1);const d=(w,z,E)=>{var M,G;if(x.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){if((E=null===(M=w.z4)||void 0===M?void 0:M.HeadersList)&&0<E.length&&(E=E.find(N=>N.Index===z-1)))return w.name+"_"+E.Name;b.ULS.sendTraceTag(537161876,306,20,
`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${w.usedRange}, columnNumber: ${z}, `+`areAllTableHeadersAvailable: ${null===(G=w.z4)||void 0===G?void 0:G.IsFullTableHeaders}`);return null}G=E.LXa(w);if(!G)return null;M=w.usedRange;const A=z-M.left;return 0>A||A>=G.length?(b.ULS.sendTraceTag(537161876,306,20,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${M}, columnNumber: ${z}, `+`areAllTableHeadersAvailable: ${E.EKh(w,
G)}`),null):(E=G[A])?w.name+"_"+E:null};class h extends r.a{constructor(w,z){super();this.dc=w;this.rC=z}kba(w){var z;let E=!1;const M=super.aQb(w);if(!M||(E=M.suggestion.formula!==w.formula))return E&&b.ULS.sendTraceTag(523842004,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula changed from last cache entry, overriding cache entry.
           Last example count: ${M.suggestion.xz}, current: ${w.xz}, oldFormula: ${M.suggestion.anonymizedFormula}, newFormula:${w.anonymizedFormula}`),b.ULS.sendTraceTag(537161877,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: saving suggestion for table range. tableRange: ${null===(z=w.table)||void 0===z?void 0:z.usedRange}, columnNumber: ${w.column}, examplesCount ${w.xz}, hasPreviousSuggestion: ${this.has(this.FGa(w))}`),(z=super.kba(w))||b.ULS.sendTraceTag(528889932,306,15,"SuggestionsCache.cacheSuggestion: failed to cache table suggestion due to getTableColumnKey failure."),
this.rC.TV(w.originCell,3),z;M.suggestion.xz!==w.xz&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${M.suggestion.xz}, current: ${w.xz}`),this.rC.TV(w.originCell,4),w.fV.xz=M.suggestion.fV.xz);M.suggestion.xz!==w.xz&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${M.suggestion.xz}, current: ${w.xz}`),
this.rC.TV(w.originCell,4),w.fV.xz=M.suggestion.fV.xz);return this.CAe(M,w)}r2i(w,z){w=d(w,z,this.dc);return w?this.ZPi(w):(b.ULS.sendTraceTag(528889931,306,15,"FormulaByExampleSuggestionsCache.getTableCachedSuggestion: failed to get cached table suggestion due to getTableColumnKey failure."),null)}FGa(w){return d(w.table,w.column,this.dc)}}Object(y.a)(h,"FormulaByExampleTableSuggestionsCache",r.a,[]);class n extends Sys.EventArgs{constructor(w){super();this.suggestion=w}}Object(y.a)(n,"FormulaByExampleFormulaRejectedEventArgs",
Sys.EventArgs,[]);r=a(41);var m=a(27),u=a(43);const l=w=>"Table"===w.kind;class t extends Map{}Object(y.a)(t,"ForbiddenFormulasMap",Map,[]);class e extends r.a{constructor(w,z,E){super();this.dc=w;this.rC=z;this.kj=E;this.sce=!1;this.$ak="formulaByExamplePersistentCache";this.abk="formulaByExamplePersistentSuggestionsCache";this.aEi="forbiddenFormulas";this.yzi=1;this.Hfe=new f(z);this.r0c=new h(this.dc,z);x.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&(this.SFa=
new Map,this.KSd=new Map,this.sce=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)&&this.dc.Ooj())&&(this.jbh=this.dc.i5i(),void this.Zfj());this.Uqj=x.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleForbidFormulaForTable",!1)}UCh(w){this.addHandler("fbefr",w)}$3i(w,z){let E;const M=w.aQc;var G=w.zs;if(w.nU){w=this.dc.dg(M,!1);if(!w)return b.ULS.sendTraceTag(509649310,306,50,`FormulaByExampleManager.onUserInput: getTableContainingRange returned null. flowId: ${z}, editedCellRange: ${M}`),
null;if(G=this.r0c.r2i(w,M.left))G.suggestion.table=w,E=G}else if(z=new m.Range(G.top,M.left,G.bottom,M.right,!0,!0),z=this.Hfe.jAc(new c.a(z,w.sheetId)))z.suggestion.zs=G,z.suggestion.aVb=w.RK,E=z;return E}kba(w){return"Table"===w.kind?this.r0c.kba(w):this.Hfe.kba(w)}Kfb(w){return"Table"===w.kind?this.r0c.Kfb(w):this.Hfe.Vei(w)}HSg(w,z,E){E=void 0===E?!1:E;w.state=z;w.Mej();x.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.t2h(w,E)}crj(w){const z=this.GLd(w);
return this.SFa.has(z)?this.SFa.get(z).has(this.YIf(w)):!1}get bEe(){return Date.now()}YIf(w){return x.EwaSettings.isChangeGateEnabled("OfficeVSO:8666058_FormulaByExampleForbidByAnonymizedFormula")?w.anonymizedFormula:w.formula}async Zfj(){new Promise(w=>{this.GDj=w});this.efi();this.dc.ghj(this.abk,this.aEi,this.yzi);await this.CDj();this.GDj();this.HCf()}efi(){const w=this.dc.deleteDatabase(this.$ak);u.TaskExtensions.tb(w,z=>{z.result?b.ULS.sendTraceTag(507872217,306,50,"FormulaByExampleSuggestionCache.deleteV1Database: successfully deleted old database."):
b.ULS.sendTraceTag(507872216,306,15,"FormulaByExampleSuggestionCache.deleteV1Database: call to delete old database had failed.")},this.dc.Aa)}async CDj(){let w,z;const E=new Promise(M=>{z=M});try{w=this.dc.PRi(this.jbh)}catch(M){b.ULS.sendTraceTag(508065931,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to get forbidden formulas from indexedDB. error: ${M}`)}if(w)return u.TaskExtensions.tb(w,M=>{M=M.result;try{const G=JSON.parse(M);for(const A of G){const N=new t;for(const K of A.bEi)12096E5<
this.bEe-K.forbiddingDateTime||N.set(K.formula,K.forbiddingDateTime);this.SFa.set(A.target,N)}G&&0<G.length&&b.ULS.sendTraceTag(508065929,306,20,`FormulaByExampleSuggestionCache.loadSavedCacheState: successfully non-empty loaded forbidden formulas save state from indexedDB. forbiddenFormulasByTarget size: ${this.SFa.size}`)}catch(G){b.ULS.sendTraceTag(508065928,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to parse forbidden formulas from indexedDB. error: ${G}`)}finally{z()}},
this.dc.Aa),E;b.ULS.sendTraceTag(508065930,306,50,"FormulaByExampleSuggestionCache.loadSavedCacheState: getSavedStateTask is undefined.");z()}t2h(w,z){switch(w.state){case "DECLINE":case "UNDO":this.eId(w.suggestion);break;case "IGNORE":z=this.GLd(w.suggestion);if(!this.KSd.has(z)){this.KSd.set(z,new Set([w.suggestion.formula]));break}z=this.KSd.get(z);z.has(w.suggestion.formula)?this.eId(w.suggestion):z.add(w.suggestion.formula);break;case "ACCEPT":z&&this.eId(w.suggestion)}}eId(w){let z;const E=
this.GLd(w);this.SFa.has(E)||(z=new t,this.SFa.set(E,z));z=this.SFa.get(E);z.set(this.YIf(w),this.bEe);this.raiseEvent("fbefr",new n(w));this.sce&&this.HCf()}HCf(){const w=[];for(const z of this.SFa){const [E,M]=z;w.push({["target"]:E,bEi:Array.from(M.entries(),G=>{var [A,N]=G;return{["formula"]:A,["forbiddingDateTime"]:N}})})}try{this.dc.MCk({key:this.jbh,value:JSON.stringify(w)}),b.ULS.sendTraceTag(508065927,306,50,"FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: successfully flushed forbidden formulas to indexedDB.")}catch(z){b.ULS.sendTraceTag(508065926,
306,50,`FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: failed to flush forbidden formulas to indexedDB. error: ${z}`)}}GLd(w){return this.Uqj?"Table"===w.kind?w.table.name:this.kj.FFf(w.zs,w.sheetId):this.s2i(w)}s2i(w){return"Table"===w.kind?this.r0c.FGa(w):this.kj.SOb(w.zs,w.zs.left-w.originCell.left,w.sheetId)}}Object(y.a)(e,"FormulaByExampleSuggestionCache",r.a,[770])},1464:function(y,r,a){a.d(r,"b",function(){return K});a.d(r,"a",function(){return I});y=a(0);var c=a(15),b=
a(27),f=a(2),k=a(329),x=a(209);r=a(1064);var d=a(367);class h extends r.a{constructor(){super();this.formulasCount=this.columnNames=this.additionalInputs=this.examples=null;this.invocationMethod=this.stateID=0;this.enableExplanations=this.cultureInfoNames=this.referenceRowValue=this.referenceRowExpression=this.timeoutInSeconds=this.guid=this.conditionalMinBranchExampleCount=this.enableConditional=this.supportedFunctions=null;this.H_=Object.assign(new d.a,{T_:h.getTypeName(),B_:h.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}}
Object(y.a)(h,"FormulaByExampleSignal",r.a,[]);var n=a(1465),m=a(67),u=a(1071),l=a(1102),t=a(117),e=a(1140),w=a(1139),z=a(1),E=a(976),M=a(561);const G=z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRAILThresholdQuantum",35),A=z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleAsyncSignalGenerationTimeoutDuration",5E3);a=z.EwaSettings.isChangeGateEnabled("OfficeVSO:8501373_CalcTsFuncsFirstSlice")&&z.EwaSettings.isChangeGateEnabled("OfficeVSO:8625930_FBEWithCalcTSFuncsFirstSlice");
const N={TEXTSPLIT:a,TEXTSLICE:!1,FINDN:!1,TEXTAFTER:a,TEXTBEFORE:a},K={iDd:"editRange",dW:"triggerCommand",mye:"triggerKind",CCf:"flowId",x1f:"isInExplicitTable",a1g:"tableInnerRange",z2f:"isNewRowPrediction",e1f:"isHeaderLess",cXg:"showNow",Ygg:"newColumnHypothesis",xTf:"headerRow"};class I{constructor(L,J,B,Y){this.AId=Y;this.IG=!1;this.dc=L;this.formulaByExampleManager=J;this.NVh=B;this.kj=l.a.getInstance(this.dc);this.IG=Object(u.a)(this.dc);this.mLj=z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalNumberOfAdditionalInputRows",
30);this.bYg=null!=this.AId;c.ULS.sendTraceTag(528758226,306,50,"FormulaByExampleCommandHandler.ctor: FBE command handler created")}gd(){return!1}executeCommand(L,J,B){L=!1;J=J.command;switch(J){case 1928326585:var Y=B&&B[K.mye]?B[K.mye]:0;L=B[K.CCf];if(0===Y)return c.ULS.sendTraceTag(524940245,306,15,"FormulaByExampleManager.executeCommand: triggerFormulaByExample command called for execution with NoTrigger value."),this.kj.Xp(L,1),m.Task.Va(!0);const U=!B||!B[K.iDd],O=this.KPi(B,U),C=B[K.a1g],X=
B[K.x1f],S=B[K.dW],ea=B[K.z2f],Oa=B[K.e1f],Ha=this.COi(O,C),Za=B[K.cXg],fa=B[K.Ygg];B=B[K.xTf];B={aQc:O,nU:X,valueType:Ha,zs:C,sheetId:E.a.mY(this.dc.wYc),RK:ea,dW:S,sZc:Za,jsj:fa,headerRow:B};U||2!==Y||this.formulaByExampleManager.c7j(L,B);if(this.bYg&&(Y=this.$Gf(O,X))&&this.AId.Rnj(Y))return c.ULS.sendTraceTag(508036636,306,50,"FormulaByExampleCommandHandler.executeCommand: column is locked, not triggering FBE (no signal)"),this.dc.R3(L,"signal lock"),m.Task.Va(!0);L=this.triggerFormulaByExample(O,
C,U,L,X,Oa,B)}return L?m.Task.Va(!0):Object(x.a)(J)}Rc(L,J){switch(J.command){case 1928326585:return this.dc.TZa();default:return!1}}td(){return!1}COi(L,J){var B;if(z.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")){J=this.dc.Ora("FormulaByExampleCommandHandler.getDefaultColumnValueType",new b.Range(J.top,L.left,J.bottom,L.left,!0,!0));try{for(;J.$$mn();){const Y=J.$$cu().cell.py;if(0!==Y)return Y}}catch(Y){throw Error(`Error while iterating over cells: ${Y}`);}finally{J&&
J.dispose()}}return null===(B=this.dc.Ob(L))||void 0===B?void 0:B.cell.py}KPi(L,J){c.ULS.sendTraceTag(537161928,306,50,`FormulaByExampleCommandHandler.getEditedRange: flow triggered from: ${J?"Ribbon":"AutoDetect"}`);return J?this.dc.getActiveCell():L[K.iDd]}triggerFormulaByExample(L,J,B,Y,U,O,C){if(!this.dc.Uoj)return c.ULS.sendTraceTag(537161927,306,10,"FormulaByExampleCommandHandler.TriggerFormulaByExample: augmentationLoopManager instance is null"),this.kj.Xp(Y,13,{reason:"AugmentationLoopManager instance is null"}),
this.dc.R3(Y,"AL is undefined"),!0;let X=J;if(z.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")&&(X=J.Xe(this.dc.getLoadedRange()),!X))return c.ULS.sendTraceTag(508363683,306,20,"FormulaByExampleCommandHandler.TriggerFormulaByExample: tableRange does not intersect loaded range"),this.kj.Xp(Y,13,{reason:"tableRange does not intersect loaded range"}),this.dc.R3(Y,"tableRange does not intersect loaded range"),!0;B=this.LRi(L,X,B,Y,U,O,C);void B.then(S=>{if(S){if(this.bYg){const ea=
this.$Gf(L,U);ea&&this.JQj(Y,ea,S.examples,J)}c.ULS.sendTraceTag(537161926,306,50,`FormulaByExampleCommandHandler.TriggerFormulaByExample: calling SubmitOperationSignal for flowId: ${Y}, isInExplicitTable: ${U}.`);this.dc.t1k(S,"FormulaByExample");this.kj.Xp(Y,12);this.NVh.TV(L,1);this.IG&&Object(u.f)("SIGNALSENT",Y)}else this.kj.Xp(Y,13,{reason:"Signal is null"})});return!0}JQj(L,J,B,Y){const U=[];for(const O of B){B=new b.Range(O.output.row,Y.left,O.output.row,Y.right,!0,!0);if(0<U.length){const C=
U[U.length-1];if(C.bottom+1===B.top){C.gAf(B);continue}}U.push(B)}this.AId.y5j(L,J,U);c.ULS.sendTraceTag(508036635,306,50,"FormulaByExampleCommandHandler.notifyLockManagerOnSignalSent: SignalLocksManager has been updated with the signal sent")}$Gf(L,J){return J?(J=this.dc.dg(L,!1),J?this.kj.Gyc(J.name,L.left):(c.ULS.sendTraceTag(508036634,306,15,"FormulaByExampleCommandHandler.getColumnKeyFromEditRange: explicit table is null"),null)):this.kj.SOb(L,L.left,E.a.mY(this.dc.la))}async LRi(L,J,B,Y,U,O,
C){var X,S;C=await this.gLi(J,L,Y,C);if(!C)return null;let ea,Oa=void 0,Ha=void 0;if(U){const Za=this.dc.dg(L,!1);if(!Za)return c.ULS.sendTraceTag(537161925,306,15,"FormulaByExampleCommandHandler.TriggerFormulaByExample: table returned null for given edit range."),this.kj.Xp(Y,13,{reason:"Table returned null for given edit range"}),this.dc.R3(Y,"table return null for table suggestion"),null;ea=this.zMi(Za);if(z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)){Ha=J.top-1;const fa=null===(S=null===(X=Za.z4)||void 0===X?void 0:X.HeadersList[L.left-J.left])||void 0===S?void 0:S.Name;fa&&(L=Object(M.b)(fa),Oa=`${Za.name}[[#Headers],[${L}]]`)}}else this.dc.UZa()&&(ea=this.yMi(J,L),z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&(Ha=O?J.top:J.top-1,Oa=`\$${L.toString().charAt(0)}\$${Ha}`));if(!ea)return this.dc.R3(Y,"no column names found"),null;z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)&&!Oa&&(c.ULS.sendTraceTag(508347742,306,15,`FormulaByExampleCommandHandler.TriggerFormulaByExample: failed to generate referenceRowExpression. isHederLessTable: ${O}, isInExplicitTable: ${U}`),Ha=Oa=void 0);B=Object(f.a)(new h,{formulasCount:1,examples:C.examples,additionalInputs:C.additionalInputs,columnNames:ea,stateID:this.dc.Cw,invocationMethod:B?0:1,guid:Y.toString(),supportedFunctions:N,enableConditional:z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleConditionals",
!1),referenceRowExpression:Oa,referenceRowValue:Ha,cultureInfoNames:z.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")?{userInterfaceCulture:void 0,dataCulture:this.dc.$.dataCultureTag}:void 0,enableExplanations:z.EwaSettings.isChangeGateEnabled("OfficeVSO:8697329_FormulaByExampleExplanationsAlwaysGenerated")||z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1)});c.ULS.sendTraceTag(528758225,306,50,"FormulaByExampleCommandHandler.getFormulaByExampleSignalFromTable: signal generated.");
return B}async gLi(L,J,B,Y){return await this.hLi(L,J,B,Y)}zMi(L){var J;const B=[],Y=L.name;if(z.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){var U=null===(J=L.z4)||void 0===J?void 0:J.HeadersList;if(!U)return c.ULS.sendTraceTag(508363682,306,15,"FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames."),null;for(var O of U)U=O.Index,L=O.Name,L=z.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?Object(M.b)(L):
L,B.push({column:U+1,name:`${Y}[@[${L}]]`})}else{O=E.a.Gja(L);L=this.dc.LXa(L);if(!O||!L)return c.ULS.sendTraceTag(524940244,306,15,`FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames. is tableRange null: ${!O}, is colNamesCurrentTable null: ${!L}`),null;O=O.left;for(U of L)L=z.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?Object(M.b)(U):U,B.push({column:O,name:`${Y}[@[${L}]]`}),O++}return B}yMi(L,J){const B=[];J=new b.Range(J.top,
L.left,J.top,L.right,!0,!0);L=this.dc.Ora("FormulaByExample.getColumnNamesMapFromInputRange",J);for(J=J.left;L.$$mn();){const Y={column:J++,name:`${b.Range.dK(L.$$cu().range.left)+w.b}`};B.push(Y)}return B}async hLi(L,J,B,Y){J=J.left;try{const U=await this.BRi(L,J,B);return await this.ubi(L,J,U,Y,B)}catch(U){return c.ULS.sendTraceTag(508909329,306,10,`FormulaByExampleCommandHandler.getByExamplesInputsFromRangeAsync: failed to generate byExampleInputs. ${U}`),null}}async BRi(L,J,B){const Y=new Set,
U=this.dc.Ora("FormulaByExample.getForbiddenColumnsFromRangeAsync",L),O=C=>{var X=C.range;const S=X.left;S===J||Y.has(S)||(X=new b.Range(X.top,J,X.top,J,!1,!1),this.Zoj(C,X)&&(Y.add(S),this.kj.uNc(B,S-(this.dc.displayRtl?L.right:L.left))))};try{return await this.wbh(U,O),Y}catch(C){throw Error(`getForbiddenColumnsFromRangeAsync failed with reason: ${C}`);}}async ubi(L,J,B,Y,U){const O=[],C=[],X=L.right,S=new Set;let ea=[],Oa=!1,Ha=null;const Za=z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleTrackNonUniformColumns",
!1)?new Set:null;L=this.dc.Ora("FormulaByExample.createValidExamplesFromRangeAsync",L);let fa=!1;const la=new Map,ba=aa=>{if(504848446!==Y.dW||aa.range.top!==Y.aQc.top){var oa=aa.range.left,Na=oa===J;Na&&aa.text?Ha=this.Cjf(aa):Na||B.has(oa)||(aa.text&&(Oa=!0),ea.push(this.Cjf(aa)));aa=this.hdl(aa,la);fa||(fa=aa);oa===X&&(Oa&&(Ha?(O.push({output:Ha,inputs:ea}),S.add(Ha.rawValueJson),null===Za||void 0===Za?void 0:Za.add(Ha.numberFormatCategory)):C.length<this.mLj&&C.push({output:null,inputs:ea})),
ea=[],Oa=!1,Ha=null)}};try{await this.wbh(L,ba);if(S.size<e.a)return c.ULS.sendTraceTag(509683013,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column does not have enough distinct examples with inputs."),this.dc.R3(U,"not enough examples with non-empty inputs"),null;if(Za){const aa={["isUniformColumn"]:1===Za.size,["dataTypes"]:Array.from(Za).sort().join(","),["flowId"]:U};c.ULS.sendTraceTag(507581650,306,20,`Formula By Example Uniform Column Data: ${JSON.stringify(aa)}`);
if(z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleSuppressNonUniformSignals",!1)&&1<Za.size)return c.ULS.sendTraceTag(507581649,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column has non uniform data, suppressing signal."),this.dc.R3(U,"column has non uniform data"),null}if(this.dc.SZa()){const aa=la.get(J),oa={["isFormulaUser"]:fa,["hasFormulaColumn"]:Array.from(la.entries()).some(Na=>{[,Na]=Na;return"HasNonFormulaCell"!==Na&&1===Na.size}),["outputColumnDataState"]:aa&&
"HasNonFormulaCell"===aa?"NonFormulaColumn":1===aa.size?"FormulaColumn":"MixedFormulasColumn",["flowId"]:U};c.ULS.sendTraceTag(507557075,306,20,`Formula By Example Formula User And Columns Hypothesis Data: ${JSON.stringify(oa)}`)}return{examples:O,additionalInputs:C}}catch(aa){throw this.dc.R3(U,"createValidExamplesFromRangeAsync failed, log 4vv2r"),Error(`createValidExamplesFromRangeAsync failed with reason: ${aa}`);}}async wbh(L,J){const B=performance.now();let Y=B;try{for(;L.$$mn();){if(performance.now()-
B>A)throw Error("Timeout");performance.now()-Y>G&&(await E.a.Ell(),Y=performance.now());J(L.$$cu())}}catch(U){throw Error(`Error while iterating over cells: ${U}`);}finally{L&&L.dispose()}}hdl(L,J){if(!this.dc.SZa())return!1;const B=L.range.left;if(!L.text||!L.Jx)return J.set(B,"HasNonFormulaCell"),!1;if("HasNonFormulaCell"===J.get(B))return!0;J.has(B)||J.set(B,new Set);J.get(B).add(L.formulaBarText);return!0}Zoj(L,J){const B=L.WL,Y=L.range,U=this.dc.wCe,O=this.dc.la;if(!O)return c.ULS.sendTraceTag(509743199,
306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned null. Expected to be an object of type Sheet."),!1;if(!(z.EwaSettings.isChangeGateEnabled("OfficeVSO:7251463_FBEFixJsCrashOnNullActiveSheet")||O instanceof t.a))return c.ULS.sendTraceTag(509743198,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned object of type other then Sheet. Expected to be an object of type Sheet."),!1;if(!this.dc.lGc(L.cell.oi,B))return!1;if(L=this.dc.extractReferences(B,
O.name,U,!0,Y))for(const C of L.Items)if(E.a.sFi(C.Range).equals(J))return!0;return!1}Cjf(L){let J;if(1===L.Qh.type){J=parseFloat(L.Qh.value);var B=this.dc.Bja(L.cell.oi);Object(k.c)(B)?B=B.value.isDate?4:B.value.isTime?5:1:(c.ULS.sendTraceTag(522840207,0,10,`FormulaByExampleCommandHandler.createAugLoopCell: CalcManager's getNumberFormat method failed on the given cell, falling back to number format. failureReason: ${B.reason}`),B=1)}else J=L.text,B=0;return Object.assign(new n.a,{row:L.range.top,
column:L.range.left,displayText:L.text,rawValueJson:JSON.stringify(J),numberFormatCategory:B.toString()})}}Object(y.a)(I,"FormulaByExampleCommandHandler",null,[29])},1506:function(y,r,a){a.r(r);a.d(r,"FormulaByExampleAutoSuggestActor",function(){return t});y=a(0);var c=a(15),b=a(1034),f=a(83),k=a(1071),x=a(1464),d=a(1140),h=a(1102),n=a(397),m=a(1),u=a(976),l=a(27);class t{constructor(e,w){this.mRc=this.Hqd=this.IG=!1;this.CDa=null;this.Ouc=!1;this.Yra=0;this.Eq=null;this.pZb=new Map;this.Fce=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",
!1);this.WU=(z,E)=>{E.committed?(this.Eq&&(this.Yra++,this.Eq.WSg(this.Yra,this.Yra),this.Eq.Tfa(this.Yra,0)),this.Tlg(E.Lk,324156914)):this.vV()};this.o3=(z,E)=>{this.Tlg(E.G1.range,504848446,E.VHc)};this.Tlg=(z,E,M)=>{324156914===E&&this.D3g(z);if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")&&!this.dVd(z))this.vV(),this.dc.R3(this.Yra,"cell is invalid for FormulaByExample trigger - formula cell");else{var {zs:G,nU:A,RK:N,zka:K,headerRow:I}=this.Gja(z);G&&z.ld(G)?
(this.kTd(z,324156914,G,A),m.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")||this.dVd(z)?this.F9d(z,z,G,E,A,N,K,M,I):this.vV()):(this.vV(),this.dc.R3(this.Yra,G?"edited header cell":"no table found"))}};this.D3g=z=>{if(this.dc.SZa()){var E=new l.Range(z.top,z.left-1,z.bottom,z.left,!1,!1);(E=this.dc.t2i(E))&&(E.usedRange.ld(z)?this.Hxj(E,z.left,z)&&this.Vdg(E,z.left-E.usedRange.left):this.Vdg(E,z.left-E.usedRange.left))}};this.Vdg=(z,E)=>{this.pZb.has(z.name)?this.pZb.get(z.name).add(E):
this.pZb.set(z.name,new Set([E]))};this.ivj=z=>{const E=this.dc.dg(z,!1);return E&&this.pZb.has(E.name)?this.pZb.get(E.name).has(z.left-E.usedRange.left):!1};this.G$d=(z,E)=>{z=E.destinationRange;if(1804571062===E.command||z.left!==z.right)this.vV();else{var M=new l.Range(z.top,z.right,z.top,z.right,!1,!1),{zs:G,nU:A,RK:N,zka:K,headerRow:I}=this.Gja(M);G?(this.kTd(M,E.command,G,A),this.F9d(M,z,G,E.command,A,N,K,!1,I)):this.vV()}};this.QOc=(z,E)=>{if((z=E.wof)&&1===z.length)if(z=z[0],z.wU)if(this.dc.Iy(z))if((E=
E.Ti)&&1804571062!==E&&1766348718!==E){z.isSingle&&this.D3g(z);var {zs:M,nU:G,RK:A,zka:N,headerRow:K}=this.Gja(z);if(M){c.ULS.sendTraceTag(507855043,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: passed all conditions to trigger FBE event.
        ribbonCommand = ${b.a[E]}
        destinationRange.height = ${z.height}`);var I=z.center;this.kTd(I,E,M,G);this.F9d(I,z,M,E,G,A,N,!1,K)}else this.vV(),c.ULS.sendTraceTag(507855044,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: no table contains the range")}else this.vV(),c.ULS.sendTraceTag(507872195,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste. ribbonCommand = ${b.a[E]}`);else this.vV(),c.ULS.sendTraceTag(507881249,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: destinationRange not fully contained in viewport");
else this.vV(),c.ULS.sendTraceTag(507881250,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single column. destinationRange.width = ${z.width}`);else this.vV(),c.ULS.sendTraceTag(508380383,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single range. destinationRanges?.length = ${null===z||void 0===z?void 0:z.length}`)};this.dCd=()=>{var z=this.uEk(this.XK.originCell,this.XK.zs);if(0===z)this.vV(),this.kj.Xp(h.b,1),this.dc.R3(this.Yra,"output column doesn't have enough distinct examples");
else{var E=this.kj.jLf();this.kj.Xp(E,3);this.XK.knb&&this.Eq&&this.Eq.WSg(E,this.XK.knb);c.ULS.sendTraceTag(537161929,306,50,`FormulaByExampleAutoSuggestActor.tryTriggeringFormulaByExample: triggering FormulaByExample for cell edit. Trigger kind: ${z}, FlowId: ${E}`);this.IG&&Object(k.f)("EDITCOMMIT",E);var M=new f.a(1928326585,1,2,6,null);z={[x.b.iDd]:this.XK.originCell,[x.b.dW]:this.XK.dW,[x.b.mye]:z,[x.b.CCf]:E,[x.b.a1g]:this.XK.zs,[x.b.x1f]:this.XK.nU,[x.b.z2f]:this.XK.RK,[x.b.e1f]:this.XK.zka,
[x.b.cXg]:this.XK.Rwj,[x.b.Ygg]:this.XK.nU&&this.ivj(this.XK.originCell),[x.b.xTf]:this.XK.headerRow};this.dc.Gb(M,z);this.vV()}};this.c6j=(z,E)=>{z=this.XK.yWh;E=E.Lk.toString();z.has(E)&&(z.delete(E),0===z.size&&this.dCd())};if(!m.EwaSettings.isChangeGateEnabled("OfficeVSO:8899836_FBELegacySignalsSuppressed")||!this.Fce)if(this.dc=e,this.IG=w,this.vV(),this.dc.WS(this.WU),m.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")&&this.dc.qH(this.o3),this.Ouc=m.EwaSettings.isChangeGateEnabled("OfficeVSO:8231994_FBECalcGridUnreliableFix"),
this.Eq=this.dc.Eq,this.Ouc||this.dc.kod(this.c6j),m.EwaSettings.isChangeGateEnabled("OfficeVSO:7395435_FormulaByExampleTriggerOnCSEPaste")&&this.dc.Flc(this.G$d),(this.mRc=m.EwaSettings.isChangeGateEnabled("OfficeVSO:8329262_FormulaByExamplePostPaste"))&&this.dc.MFb(this.QOc),this.kj=h.a.getInstance(this.dc),this.Hqd=this.dc.UZa())this.dc.bgj(),this.Wle=m.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1)}Hxj(e,w,z){var E;e=u.a.Gja(e);w=new l.Range(e.top,
w,e.bottom,w,!1,!1);w=this.dc.Ora("FormulaByExampleAutoSuggestActor:isTableColumnBlank",w);try{for(;w.$$mn();){const M=w.$$cu();if(!M.range.equals(z)&&(null===(E=M.Qh)||void 0===E?0:E.value))return!1}}finally{w&&w.dispose()}return!0}Gja(e){var w;const z=this.dc.dg(e,!1);if(z)return e=null===(w=z.z4)||void 0===w?void 0:w.HeadersList,{zs:u.a.Gja(z),nU:!0,RK:!1,zka:!e};if(this.Hqd){const {n2b:E,RK:M,zka:G,headerRow:A}=this.rZi(e);if(E)return{zs:E,nU:!1,RK:M,zka:G,headerRow:A}}return{zs:null,nU:!1,RK:!1,
zka:!1}}rZi(e){var w=new l.Range(e.top-this.Wle,e.left,e.bottom,e.right,!0,!0),z=this.dc.R2k(new n.a(w,u.a.mY(this.dc.la)),6);if(!z)return null;const E=new Map;for(var M of z)for(var G of M.table.interpretations)if(2===G.orientation&&.5<G.confidence){w=new l.Range(G.tableLocation.top+G.headerRowCount,G.tableLocation.left+G.headerColumnCount,Math.max(G.tableLocation.bottom,w.bottom),G.tableLocation.right,!0,!0);e=!G.tableLocation.ld(e);z=0===G.headerRowCount;if(1===G.headerRowCount)for(G=w.left;G<=
w.right;G++){M=new l.Range(w.top-1,G,w.top-1,G,!1,!1);const A=this.dc.Ob(M);A?E.set(A.range.left,A.cell.text):c.ULS.sendTraceTag(507581085,306,15,`FormulaByExampleAutoSuggestActor.getRangeTableInnerRange: formatted cell for header row is null. table inner range: ${w} cell range: ${M}`)}return{n2b:w,RK:e,zka:z,headerRow:E}}return{n2b:null,RK:!1,zka:!1,headerRow:null}}F9d(e,w,z,E,M,G,A,N,K){this.HRg(e,w,z,E,M,G,A,N,K);e=[];this.Ouc&&e.push(324156914);this.mRc&&e.push(237279923,-185374993,-958589048,
808159687,42074747,-875588320,264209770);e.includes(E)?(this.n4b(),this.CDa=this.dc.iKa(()=>{m.EwaSettings.isChangeGateEnabled("OfficeVSO:8235022_FBEVerifyCellNotFormulaAfterConsistent")&&!this.dVd(this.XK.originCell)?(this.vV(),this.kj.Xp(h.b,1),this.dc.R3(this.Yra,"cell is invalid for FormulaByExample trigger - formula cell")):this.dCd()})):(this.n4b(),this.dCd())}kTd(e,w,z,E){E?(E=this.dc.dg(e,!1),this.kj.Plg(w,E.name,e.left-(this.dc.da.rtl?z.right:z.left),e.top-z.top)):this.kj.Qlg(w,z,e.left-
(this.dc.da.rtl?z.right:z.left),e.top-z.top,u.a.mY(this.dc.wYc))}dVd(e){var w=this.dc.Ob(e);if(!w)return c.ULS.sendTraceTag(524120778,306,15,`FormulaByExampleAutoSuggestActor.isCellValidForTriggeringFormulaByExample: formattedCell is null. investigation hints: is cell null = ${!e}`),this.kj.Xp(h.b,1,{reason:"Didn't trigger since the formattedCell is null."}),!1;if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:8666049_FBEUseClientGridFormulaMetadata"))return w.cell.Jx?(this.kj.Xp(h.b,1,{reason:"Didn't trigger since edited cell content is a formula."}),
!1):!0;e=this.dc.lGc(w.cell.oi,w.WL);(w=null!==e&&!e)||this.kj.Xp(h.b,1,{reason:`Didn't trigger since edited cell content is a formula or isFormulaCell returned null. isFormulaText is null:${null==e}`});return w}uEk(e,w){e=e.left;w=new l.Range(w.top,e,w.bottom,e,!0,!0);return this.tEk(w)}tEk(e){var w;const z=new Set;let E=0;e=this.dc.Ora("FormulaByExampleAutoSuggestActor:Table",e);try{for(;e.$$mn();){const M=e.$$cu();if(null===(w=M.Qh)||void 0===w?0:w.value)if(z.add(M.Qh.value),E++,z.size>=d.a)return 2}}finally{e&&
e.dispose()}E>=d.a?(c.ULS.sendTraceTag(523368219,306,50,"FormulaByExampleAutoSuggestActor.searchForSufficientExamplesInOutputColumn: Table has sufficient example amount - but not enough distinct examples."),this.kj.Xp(h.b,1,{reason:"Didn't trigger since there aren't enough distinct outputs"})):this.kj.Xp(h.b,1,{reason:"Didn't trigger since there aren't enough examples"});return 0}n4b(){this.CDa&&(this.CDa(),this.CDa=null,this.Eq&&324156914===this.XK.dW&&this.dc.R3(this.XK.knb,"consistent block cache callback cancelled"))}vV(){this.HRg(null,
null,null,null,null,null,null);(this.mRc||this.Ouc)&&this.n4b()}HRg(e,w,z,E,M,G,A,N,K){this.XK={originCell:e,yWh:new Set(null===w||void 0===w?void 0:w.M8e(w.gu).map(I=>I.toString())),dW:E,zs:z,nU:M,RK:G,zka:A,Rwj:N,headerRow:K,knb:324156914===E?this.Yra:null}}}Object(y.a)(t,"FormulaByExampleAutoSuggestActor",null,[])},1507:function(y,r,a){r=a(490);a=a(1508);a=a.Di?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);r(a,{insert:"head",Oj:!1});y.exports=a.Fk||{}},1508:function(y,r,a){r=a(489)(!1);r.push([y.i,
'.ewa-ac{position:absolute;z-index:102;margin-top:1px;width:auto}.ewa-ac .ewa-ac-param{white-space:nowrap;margin-bottom:3px;direction:ltr}.ewa-ac .ewa-ac-param function_param_table{position:absolute}.ewa-ac .ewa-ac-param .ewa-function-help-link{text-decoration:underline}.ewa-lb{position:absolute;border:1px solid #a2a6ab;overflow-x:hidden;overflow-y:auto;cursor:default;background-color:#fff;color:#262626;font-size:12px;font-family:"Segoe UI";z-index:102;height:auto;margin:0 8px;touch-action:manipulation;vertical-align:middle}.ewa-lb.ewa-fb-refactor{position:relative;margin:0}.ewa-lb table{left:0;right:0;border-collapse:collapse}.ewa-lb table td{white-space:nowrap}.ewa-lb table td div.clip16x16{margin:0 0 0 2px}.ewa-lb table td.list-item{height:24px;padding:0 8px}.ewa-lb table td.list-item-selected{background-color:#d3f0e0}@media screen and (-ms-high-contrast:active){.ewa-lb table td.list-item-selected{border:2px solid #fff}}.ewa-lb table.list-table-touch td.list-item{height:35px}div#suggested_cells_list_box{margin:0}div#suggested_cells_list_box .list-table .ewa-suggested-cell-name{float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@font-face{font-family:"Segoe UI Semibold";font-weight:600;src:local("Segoe UI Semibold"),local("Segoe UI")}.ewa-lb table td.columnName-header{color:#666;font-size:12px;font-family:"Segoe UI Semibold";text-align:left;padding:3px 8px;text-overflow:ellipsis}.ewa-tt{background-color:#f7f7f7;border:1px solid #a2a6ab;color:#444;height:auto;vertical-align:middle;width:auto;z-index:102;font-size:8pt;margin:0;padding-bottom:3px;padding-top:2px}.ewa-root-ltr .ewa-tt{text-align:left;padding-left:5px;padding-right:7px}.ewa-root-rtl .ewa-tt{text-align:right;padding-left:7px;padding-right:5px}.ewa-dlg-function-link-container .ewa-fdb-help-link,.ewa-tt-ltr .ewa-fdb-help-link,.ewa-tt-rtl .ewa-fdb-help-link{color:#00f;text-decoration:underline}.ewa-function-link-container .ewa-function-udf-name,.ewa-function-link-container-udf .ewa-function-help-link{display:none}.ewa-root.rtl .ewa-function-link-container{text-align:left}',
""]);y.exports=r},1509:function(y,r,a){r=a(490);a=a(1510);a=a.Di?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);r(a,{insert:"head",Oj:!1});y.exports=a.Fk||{}},1510:function(y,r,a){r=a(489)(!1);r.push([y.i,".ewa-fb-fluent .ewa-rteLine .formula-highlight-1,.ewa-gridKeyHandler .formula-highlight-1{color:#006cbe}.ewa-fb-fluent .ewa-rteLine .formula-highlight-1::selection{color:#b2e3ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2,.ewa-gridKeyHandler .formula-highlight-2{color:#bc2f32}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2::selection{color:#ffcfe1}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3,.ewa-gridKeyHandler .formula-highlight-3{color:#7c53ac}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3::selection{color:#e9d4ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4,.ewa-gridKeyHandler .formula-highlight-4{color:#0f700f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4::selection{color:#98ff87}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5,.ewa-gridKeyHandler .formula-highlight-5{color:#bf0077}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5::selection{color:#fcf}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6,.ewa-gridKeyHandler .formula-highlight-6{color:#b5490f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6::selection{color:#ffda00}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7,.ewa-gridKeyHandler .formula-highlight-7{color:#00758f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7::selection{color:#3df5e8}",
""]);y.exports=r},192:function(y,r,a){function c(ca,bb){Object(fe.e)(()=>{var Hb;const Vb=ca.getCellBounds(null===(Hb=ca.Ob(null))||void 0===Hb?void 0:Hb.cell,!0);Vb&&(Hb=Vb?new Sys.UI.Bounds(Vb.x+Vb.width,Vb.y+Vb.height,0,0):null)&&bb.Qub(["DatePickerFloatie"],Hb,fc.a.Hb)})}function b(ca){const bb=Object(pa.f)(ca);ca=Object(Fa.a)(ca);var Hb=bb.Ej,Vb=bb.cellTextEditBox.N2f;Vb=bb.rv||Vb&&ca;ca=f((Vb?ca:Hb).Za.domElement);Hb=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8597123_RemoveIndentationInFormulaBar");
Hb||(ca.left+=12);if(Vb)Vb={top:0,left:0,right:innerWidth,bottom:innerHeight};else if(Hb&&(ca.left+=12),Vb=f(bb.domElement),cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7845089_fixFormulaAssistancePositoningInFreezePanes")&&bb.rb.mj&&(Hb=bb.rb,Vb.top-=Hb.height,Vb.left-=Hb.width),{zoom:Hb}=Object(ub.a)(),1!==Hb)for(var Ec of[ca,Vb])for(const rd in Ec)Ec[rd]*=Hb;return Fc?(Ec=bb.nv(bb.ha.oa.activeCell),{target:ca,bounds:Vb,activeCellAndGridZoom:{top:Ec?Ec.top:0,bottom:Ec?Ec.bottom:0,zoomNumber:bb.aM}}):
{target:ca,bounds:Vb}}function f(ca){const {top:bb,left:Hb,right:Vb,bottom:Ec}=ta.HelperMethods.isStandardZoomCssSupportedByBrowser?Cc.DOMElementExtensions.lib({element:ca,di:!0}):ca.getBoundingClientRect();return{top:bb,left:Hb,right:Vb,bottom:Ec}}function k(ca){switch(ca.type){case Pe.a.NamedRange:return dc.DefinedNameInfoType.NamedRange;case Pe.a.Table:return dc.DefinedNameInfoType.Table;case Pe.a.Lambda:return dc.DefinedNameInfoType.Lambda;default:return dc.DefinedNameInfoType.Other}}function x(ca){var bb;
if(ca){var Hb=new uf(ca.kind===dc.HighlightKind.CellRef);ca=null===(bb=null===ca||void 0===ca?void 0:ca.rangeInfo)||void 0===bb?void 0:bb.positionKindInfo;if(!ca)return Hb;Hb.qka=ca.firstRow===dc.PositionKind.Absolute;Hb.pka=ca.firstColumn===dc.PositionKind.Absolute;Hb.Aua=ca.secondRow===dc.PositionKind.Absolute;Hb.zua=ca.secondColumn===dc.PositionKind.Absolute;return Hb}}function d(ca,bb){return ca===bb?{kind:"equal"}:{kind:"different",diff:fb.a.N6e(ca,bb)}}function h(ca){[ca.clientResult,ca.serverResult].forEach(bb=>
{Object(Pd.c)(bb)||"success"!==bb.kind||(bb.value=fb.a.m0(bb.value),bb.unformattedValue=fb.a.m0(bb.unformattedValue))})}function n(ca,bb,Hb){if(ca.has(bb))return ca.get(bb);Hb=Hb();ca.set(bb,Hb);return Hb}function m(ca,bb,Hb,Vb,Ec){if(!Vb)return Ec();if(ca.has(bb))return ca.get(bb);Vb=Ec();ca.set(bb,Vb);ca.set(Hb,Vb);return Vb}function u(ca){return JSON.stringify({text:ca.text,index:ca.index,length:ca.length})}function l(ca){return Object(Pd.c)(ca)?"Undefined text":""===ca?"Empty text":null}function t(ca){return"Failure"!==
ca.kind?{kind:"Success",value:{cell:{col:ca.cell.FirstColumn,row:ca.cell.FirstRow},value:e(ca),formatted:ca.format}}:{kind:"Failure",reason:{cell:{col:ca.cell.FirstColumn,row:ca.cell.FirstRow,cols:ca.cell.LastColumn-ca.cell.FirstColumn+1,rows:ca.cell.LastRow-ca.cell.FirstRow+1},kind:ca.value.toString(),innerKind:"Unknown"}}}function e(ca){if("ExcelAppError"===ca.kind)return{kind:8,type:ca.value};switch(typeof ca.value){case "number":return{kind:1,_valueXL:ca.value};case "string":return{kind:2,value:ca.value};
case "boolean":return{kind:4,_valueXL:ca.value?1:0}}}function w(ca){const bb=/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(ca)||"ROW()"===ca||cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&bb.test(ca)}function z(ca,bb,Hb,Vb){bb=new nf.a(562,0,Ue(ca,bb,Hb,Vb),18,null);ca=ca.userOperationManager.enqueueOperation(bb,null);Va.ULS.shipAssertTag(507331929,0,!!ca,"RangeAndSheetNameExtractor.InvokeWebMethodRequest: queueItem is null after scheduling the web method call.")}
function E(ca,bb,Hb){if(ca===bb)return Hb;if(bb.textContent!==bb.parentElement.textContent)for(;null!==bb.previousSibling;)bb=bb.previousSibling,Hb+=bb.textContent.length,"div"===bb.nodeName.toLowerCase()&&(Hb+=1);return E(ca,bb.parentElement,Hb)}function M(ca){return null!==ca&&void 0!==ca?ca:"cache"}function G(ca){return Object(Pd.b)(ca)&&Object(Pd.b)(ca.FormulaInfo)&&Object(Pd.b)(ca.FormulaInfo.Formula)&&(1===ca.FormulaInfo.FormulaType||2===ca.FormulaInfo.FormulaType)&&1<ca.FormulaInfo.Formula.length&&
ca.FormulaInfo.Formula!==ca.Text}function A(ca){return{["formula"]:ca.FormulaInfo.Formula,["formulaTokens"]:ca.FormulaInfo.Formula,["formulaType"]:ca.FormulaInfo.FormulaType,["value"]:ca.Text,["unformattedValue"]:ca.Value,["valueType"]:ca.ValueType,["hasError"]:ca.HasError,["ifmt"]:ca.Ifmt,["ifmtStamped"]:ca.IfmtStamped,["row"]:ca.Row,["col"]:ca.Col}}function N(ca,bb){return ca===bb?{kind:"equal"}:Object(Pd.c)(ca)&&Object(Pd.c)(bb)?{kind:"empty",source:"both"}:Object(Pd.c)(ca)||Object(Pd.c)(bb)?{kind:"empty",
source:Object(Pd.c)(ca)?"cse":"immediate"}:{kind:"different",diff:fb.a.N6e(ca,bb)}}async function K(ca){const bb=await Zb.a.resolve(uc.FormulaAnonymizerService),Hb=wb.Range.Hc(ca.row,ca.col);return Object.assign({},ca,{formula:bb.anonymize(ca.formula,Hb),formulaTokens:fb.a.m0(ca.formulaTokens),value:fb.a.m0(ca.value),unformattedValue:fb.a.m0(ca.unformattedValue)})}function I(ca){if(Object(Pd.b)(ca)&&Object(Pd.b)(ca.table)&&Object(Pd.b)(ca.table.interpretations)){var bb={sheetId:ca.table.analyzedRange.sheetId,
analyzedRange:Object($b.ib)(ca.table.analyzedRange.range),interpretations:ca.table.interpretations.map(L)};a:{switch(ca.metadataState){case 2:ca=dc.RecognizedTablesMetadataState.Valid;break a;case 4:ca=dc.RecognizedTablesMetadataState.Invalid;break a;case 6:ca=dc.RecognizedTablesMetadataState.All;break a}ca=void 0}bb={rangeTableInfo:bb,metadataState:ca}}else bb=null;return bb}function L(ca){if(ca){var bb=Object($b.ib)(ca.tableLocation);var Hb=ca.confidence,Vb=ca.headerRowCount,Ec=ca.headerColumnCount;
a:{switch(ca.orientation){case 0:ca=dc.TableOrientation.none;break a;case 1:ca=dc.TableOrientation.rowMajor;break a;case 2:ca=dc.TableOrientation.columnMajor;break a}ca=void 0}bb={tableLocation:bb,confidence:Hb,headerRowCount:Vb,headerColumnCount:Ec,orientation:ca}}else bb=null;return bb}function J(ca,bb,Hb){const Vb=ca.Cw,Ec=ca.WQ();ca.iKa(()=>{const rd=ca.Cw-Vb,Id=ca.WQ(),W=Ec===Id,Ra=[],nc=cc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FbeEcsMismatchesMaxExamplesPerLog",5);let yc=0;for(const Me of bb){if(Ra.length>=
nc)break;var Fd=ca.Ob(Me.range);if(!Fd){yc++;continue}const ff=Me.text,jf=Me.value,Lf=kf[Me.kind],Ef=Fd.text,jg=Fd.Qh.value;Fd=Ve[Fd.Qh.type];if(ff===Ef)var $d=Of.NoMismatch;else $d=/^#+$/.test(Ef),$d=/^#+$/.test(ff)||$d?jf===jg?Of.NoMismatch:Of.HashesValueMismatch:Of.Mismatch;$d!==Of.NoMismatch&&Ra.push({["cseText"]:fb.a.XW(ff),["cseValue"]:fb.a.XW(jf),["cseKind"]:Lf,["ecsText"]:fb.a.XW(Ef),["ecsValue"]:fb.a.XW(jg),["ecsType"]:Fd,["isHashesValue"]:$d===Of.HashesValueMismatch,["areValuesEqual"]:jf===
jg})}0<Ra.length&&Va.ULS.sendTraceTag(67707660,0,20,"ECS mismatch detected! "+JSON.stringify({["flowId"]:Hb,["stateIdDiff"]:rd,["isSameRequestId"]:W,["requestIdBeforeEvent"]:Ec,["requestIdAfterEvent"]:Id,["correctCellsCount"]:bb.length-Ra.length,["cellsWithMismatchCount"]:Ra.length,["mismatches"]:Ra}));0<yc&&Va.ULS.sendTraceTag(508704130,0,50,"FormulaByExampleEcsMismatchDetection:checkForEcsMismatch: "+yc+" cells not loaded. flowId: "+Hb)})}function B(ca){return wb.Range.Hc(ca.row+1,ca.col+1)}function Y(ca,
bb){ca=1===ca.Qh.type?parseFloat(ca.Qh.value):ca.Qh.value;return Pg(bb)===ca}function U(ca){return"Table"===ca.kind?ca.formula:ca.CId}function O(ca,bb){if(ca===bb)return!0;if(!ca||!bb||ca.kind!==bb.kind||ca.ow!==bb.ow||ca.uCe!==bb.uCe||ca.source.trigger!==bb.source.trigger)return!1;switch(ca.kind){case "Success":return C(ca,bb);case "Loading":return ca.index===bb.index&&ca.length===bb.length;default:return ca}}function C(ca,bb){return ca.ow===bb.ow&&ca.index===bb.index&&ca.length===bb.length}function X(ca,
bb,Hb){if(ca===bb)return Hb;if(bb.textContent!==bb.parentElement.textContent)for(;null!==bb.previousSibling;)bb=bb.previousSibling,Hb+=bb.textContent.length,"div"===bb.nodeName.toLowerCase()&&(Hb+=1);return X(ca,bb.parentElement,Hb)}function S(ca,bb){return ca.text===bb.text&&ca.index===bb.index&&ca.length===bb.length}a.r(r);var ea={};a.r(ea);a.d(ea,"CellAutoCompleteControl",function(){return Dd});var Oa={};a.r(Oa);a.d(Oa,"CellAutoCompleteReadoutHandler",function(){return $c});var Ha={};a.r(Ha);a.d(Ha,
"DatePickerCommandHandler",function(){return ec});var Za={};a.r(Za);a.d(Za,"DatePickerControl",function(){return rb});var fa={};a.r(fa);var la={};a.r(la);a.d(la,"FormulaAssistanceManager",function(){return Kf});var ba={};a.r(ba);a.d(ba,"FormulaAssistanceReadoutHandler",function(){return sb});var aa={};a.r(aa);a.d(aa,"FormulaAssistanceValuePreviewCommandHandler",function(){return Gc});var oa={};a.r(oa);a.d(oa,"FormulaAssistanceValuePreviewRequester",function(){return Fb});var Na={};a.r(Na);var Ia=
{};a.r(Ia);var Sa={};a.r(Sa);a.d(Sa,"FormulaByExampleCardUIControl",function(){return oc});var Pa={};a.r(Pa);a.d(Pa,"FormulaByExamplePluginTriggersManager",function(){return cf});var za={};a.r(za);a.d(za,"FormulaByExamplePluginValidator",function(){return Wf});a.d(za,"FormulaByExamplePluginValidatorProxy",function(){return Hf});var wa={};a.r(wa);var db={};a.r(db);a.d(db,"FormulaByExampleSignalLocksManager",function(){return ra});var Ba={};a.r(Ba);a.d(Ba,"FormulaColumnPreviewManager",function(){return Qb});
var Ka={};a.r(Ka);a.d(Ka,"FunctionInfoManager",function(){return Ee});var da={};a.r(da);a.d(da,"GotoCtrlClick",function(){return pb});var sa={};a.r(sa);var mb={};a.r(mb);a.d(mb,"KeptTelemetryHandler",function(){return zc});var Ma={};a.r(Ma);a.d(Ma,"SetCellEstimationPrefetcher",function(){return Td});var hb=a(133),$a=a(0),Va=a(15),xa=a(91),ia=a(267),Z=a(7),ta=a(12),pa=a(25);class Ga extends ia.a{constructor(ca,bb){super(document.createElement("div"));this.MY=this.Htc=this.CLb=this.DLb=this.Ltc=this.ELb=
!1;this.eP=null;this.visible=void 0;this.zoom=null;this.O9d=(Hb,Vb)=>{this.yt(Hb,Vb)};this.EYa=()=>{this.qd.Za.mI=!0};this.lKa=()=>{this.autoComplete(!0)};this.yjg=()=>{this.qd.Za.focus()};this.onActiveCellChanged=()=>{pa.f(this.$).inRangePicker||(this.Hh=!1)};this.$=ca;this.zoom=bb;pa.f(ca)&&pa.f(ca).ha&&pa.f(this.$).ha.add_activeCellChanged(this.onActiveCellChanged)}get zoomManager(){return this.zoom.zoomManager}get BI(){return this.HD.BI}get Hh(){return this.HD.Hh}set Hh(ca){this.HD.Hh=ca}get qd(){return this.eP}set qd(ca){(this.eP=
ca)&&this.eP.VBe.add(this)}get_visible(){return void 0!==this.visible?this.visible:this.visible=super.get_visible()}set_visible(ca){if(this.visible===ca)return ca;this.visible=ca;return super.set_visible(ca)}yt(){this.ENa(!1);this.HD.yt()}dispose(){this.$&&pa.f(this.$)&&pa.f(this.$).ha&&pa.f(this.$).ha.remove_activeCellChanged(this.onActiveCellChanged);this.$=null;super.dispose()}Ok(ca,bb,Hb){ca=!1;if((this.FKb||(void 0===Hb?0:Hb))&&!this.ylb()&&this.get_visible()&&this.Hh)switch(this.Bze(bb),bb){case 1872288872:this.Hh=
!1;ca=!0;break;case -798660877:this.HD.GC(1);ca=!0;break;case 137938150:this.HD.GC(-1);ca=!0;break;case 2091832999:this.HD.GC(this.BI-1);ca=!0;break;case 742457698:this.HD.GC(-(this.BI-1));ca=!0;break;case 125627505:ca=this.autoComplete(!1);break;case 267796030:ca=this.autoComplete(!1)}return ca}ENa(ca){if(this.Hh||ca){var bb=pa.f(this.$),Hb=this.eP.Za.domElement;ca=this.zoomManager.sh(Hb.offsetHeight);var Vb=this.zoomManager.sh(Hb.offsetTop);Hb=this.zoomManager.sh(Hb.offsetLeft);bb=bb.rv;$get(this.$.Oc+
Z.a.Uvd,this.$.domElement);var Ec=document.getElementById("EditorContainer");var rd=new Sys.UI.Point(bb?this.HD.yId:0,bb?-5:Ga.H6i),Id=this.domElement;Id.style.top=ta.HelperMethods.$c(Ec.offsetTop+rd.y+(bb?0:ca+Vb));Id.style.left=ta.HelperMethods.$c(Ec.offsetLeft+Hb+rd.x)}}C8b(ca){this.HD&&(ca&&!this.MY?(this.HD.Aha(this.yjg),this.HD.rlc(this.EYa),this.HD.RFb(this.lKa),this.MY=!0):this.MY&&(this.HD.sma(this.yjg),this.HD.aUc(this.EYa),this.HD.H3b(this.lKa),this.MY=!1))}Bze(ca){switch(ca){case -798660877:case 137938150:case 2091832999:case 742457698:this.ELb=
!0;break;case 125627505:this.DLb=!0;break;case 267796030:this.CLb=!0}}}Ga.yId=0;Ga.H6i=1;Object($a.a)(Ga,"AutoCompleteControl",ia.a,[226]);var Ca=a(10);class kb{}kb.bpi="ewa-ac";kb.ovf="ewa-fb-refactor";kb.Qri="ewa-lb";kb.Ysi="ewa-suggested-cell-name";kb.vnb="list-item";kb.yXb="list-item-selected";kb.AXb="list-table";kb.BXb="list-table-touch";kb.rtl="rtl";kb.c0g="suggested_cells_list_box";Object($a.a)(kb,"AutoCompleteClassNames",null,[]);class eb extends Sys.EventArgs{constructor(ca,bb,Hb,Vb){bb=
void 0===bb?0:bb;Hb=void 0===Hb?"":Hb;Vb=void 0===Vb?"":Vb;super();this.length=ca;this.selectedIndex=bb;this.EL=Hb;this.description=Vb}}Object($a.a)(eb,"ListEventArgs",Sys.EventArgs,[]);class Yb{constructor(ca,bb){this.tjh=ca;this.sjh=bb}get Oqa(){return this.tjh}get Ard(){return this.sjh}}Object($a.a)(Yb,"CellAutoCompleteItem",null,[306]);var Gb=a(6),Mb=a(1289),Rb=a(560),$b=a(44),cc=a(1),fb=a(28);class Sb extends Mb.a{constructor(ca,bb,Hb){super(ca,bb);this.Us=null;this.yJc=0;this.h$=this.fnb=null;
this.$Ja=(Vb,Ec)=>{if(Vb=this.Us.items)if(1===Vb.length&&this.Us.FKb.length<Vb[0].Oqa.length&&this.Us.zHa&&fb.a.MG(Vb[0].Oqa,this.Us.FKb)&&(Ec.newValue=Vb[0].Oqa),this.qd&&cc.EwaSettings.Ra(128)){let rd=-1;1<Vb.length?rd=this.Us.pBc(this.qd.text,!0):1===Vb.length&&(this.Us.zHa||this.Us.hDc)&&(rd=0);if(0<=rd&&Vb.length>rd&&Vb[rd].Ard){const Id=$b.H(Vb[rd].Ard);Id&&pa.f(this.$).Eb.xIa(Id)&&(Ec.sZf=!0,Ec.fdf=Vb[rd].Ard)}}};this.h0b=()=>{this.Us.zHa=!1};this.qd.zFb(this.$Ja);this.Us=Hb;this.h$=this.Df.pf(this.qd.Za.domElement);
this.h$.Ea("mousedown",this.h0b)}get vFc(){return!1}get pIa(){return this.Us.Hh}set pIa(ca){this.Us.Hh=ca}get FDc(){return!1}get key(){return Rb.a.Aud}dispose(){this.qd.TTc(this.$Ja);super.dispose()}mra(ca){ca&&!this.Us.Hh||super.mra(ca)}Ok(ca,bb){this.Us.qd=this.qd;this.yJc=ca.keyCode;if(this.qd.isEditing){const Hb=this.qd.text;fb.a.equals(this.fnb,Hb,!1)||(this.fnb=Hb)}else this.fnb=null;if(237279923===bb)return this.Us.Hh=!1;cc.EwaSettings.Ra(128)&&17===this.yJc&&this.Us.zHa&&(this.Us.hDc=!0);
return super.Ok(ca,bb)}zjg(){var ca;if(!cc.EwaSettings.isChangeGateEnabled("OfficeVSO:5172529_CheckForShuttingDownInAutocompletionTimedCallback")||!Gb.AFrameworkApplication.Sf)if(this.Us.qd=this.qd,this.Us.zHa=!1,this.qd.isEditing){const bb=!fb.a.equals(this.fnb,this.qd.text,!0),Hb=this.qd.aWd;Hb||!bb&&229!==this.yJc?Hb&&(this.Us.Hh&&(this.Us.Hh=!1),null===(ca=this.Us.A0a)||void 0===ca?void 0:ca.cancel()):this.Us.pLh(this.yJc)}else this.fnb=null}Nh(){}wg(){this.pIa=!1;this.Us.set_visible(!1);this.fnb=
null;this.Us.zHa=!1;this.Us.hDc=!1;this.Us.A0a&&this.Us.A0a.cancel()}yAg(ca,bb){return this.Us.Ok(ca,bb)}}Object($a.a)(Sb,"CellAutoCompleteListAutoCompleteBehavior",Mb.a,[]);var kc=a(39),na=a(1123),fc=a(70),Cc=a(17),tc=a(138),nb=a(1142);class tb extends na.a{constructor(ca,bb){super(ca,bb,new nb.a(kb.vnb,kb.yXb,kb.AXb,kb.BXb));this.XBc=!1;this.xDb=this.z1=null;this.JDf=!1;this.visible=void 0;this.UMa(!0);this.JDf=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:5893822_FixFormulaBarXOffsetCrash")}get yId(){const ca=
document.getElementById(this.$.Oc+Z.a.wId);return!this.JDf||ca?Cc.DOMElementExtensions.getBoundingClientRect({element:ca}).x:0}get xg(){return this.xDb}set xg(ca){this.xDb=ca}get Hh(){return void 0!==this.visible?this.visible&&0<this.z1.length:(this.visible=Cc.DOMElementExtensions.isVisible(this.uh))&&0<this.z1.length}set Hh(ca){this.visible!==ca&&(Cc.DOMElementExtensions.setVisible(this.uh,ca),Cc.DOMElementExtensions.setVisible(this.$vb,ca),this.visible=ca);const bb=pa.f(this.$).view;ca?this.XBc||
(bb.Ks(this.zrd.O9d),this.XBc=!0):(this.z1.length=0,this.XBc&&(bb.xs(this.zrd.O9d),this.XBc=!1))}iMc(){var ca=460;const bb=pa.f(this.$);var Hb=bb.domElement,Vb=this.$vb.style;const Ec=this.uh.offsetTop+this.Vo.offsetHeight*this.Vo.sectionRowIndex-this.uh.scrollTop;Vb.width="auto";Vb.whiteSpace="nowrap";Vb.position="absolute";const rd=Hb.offsetLeft+Hb.offsetWidth-(this.domElement.offsetLeft+this.uh.offsetLeft+this.uh.offsetWidth+3);Hb=this.domElement.offsetLeft-3-(Hb.offsetLeft+this.yId);ca=Math.min(this.$vb.offsetWidth,
ca,Math.max(rd,Hb));Cc.DOMElementExtensions.SG(this.$vb,ca);Vb.whiteSpace="";Vb.position="absolute";Ec+3>this.uh.offsetTop+this.uh.offsetHeight||Ec<this.uh.offsetTop||(ca=this.uh.offsetLeft-3-this.$vb.offsetWidth,Vb=this.uh.offsetLeft+this.uh.offsetWidth+3,Cc.DOMElementExtensions.updatePosition(this.$vb,Hb>rd!==bb.rtl?ca:Vb,Ec,!1))}GC(ca){super.GC(ca);this.iMc()}yt(){this.iMc()}uSa(){const ca=this.Dl,bb=this.uh,Hb=3===fc.a.Hb||kc.a.ot,Vb=Hb?this.BJa:this.BI;this.Hh=!0;bb.style.height="auto";this.zrd.set_visible(!0);
this.oFb(ca,Hb);this.z1.length>Vb&&(Cc.DOMElementExtensions.P4(bb,Math.floor(bb.offsetHeight*Vb/this.z1.length)),bb.style.overflowY="auto");Cc.DOMElementExtensions.SG(bb,ca.offsetWidth+(this.z1.length>Vb?tc.a.Gt:0))}}Object($a.a)(tb,"AutoCompleteListBox",na.a,[]);class La extends tb{constructor(ca,bb,Hb,Vb){super(ca,bb);this.fic=null;this.Mc=Hb;this.Us=Vb;this.z1=[]}get Vo(){return this.fic}set Vo(ca){this.c7a(this.Vo);this.fic=ca;const bb=this.c7a(this.Vo);this.xg=ca?bb.innerText:null;this.Wme(ca)}get Hh(){return super.Hh}set Hh(ca){super.Hh=
ca;ca||(this.Vo=null)}get $vb(){return null}get zrd(){return this.Us}dispose(){super.dispose();this.fic=null}B2k(ca){this.Lya(!1);const bb=document.createElement("table");bb.classList.add(this.Nva);bb.y8e=Z.a.gDa;const Hb=document.createElement("tbody");for(let Vb=0,Ec=this.z1.length;Vb<Ec;Vb++){const rd=document.createElement("tr"),Id=document.createElement("td");Id.classList.add(this.z0a);const W=document.createElement("span");W.classList.add(La.Bud);W.setAttribute(Z.a.y6e,ca[this.z1[Vb]].Oqa);
W.innerText=ca[this.z1[Vb]].Oqa;Id.appendChild(W);rd.appendChild(Id);Hb.appendChild(rd)}bb.appendChild(Hb);this.Mc.HH(this.uh);this.uh.appendChild(bb);this.Dl=Cc.DOMElementExtensions.wq(this.domElement,this.Nva);this.Lya(!0);this.uSa()}OAi(ca,bb){if(ca&&ca.length){var Hb=[];if(bb)for(let Vb=0,Ec=ca.length;Vb<Ec;Vb++)fb.a.MG(ca[Vb].Oqa,bb)&&Hb.push(Vb);this.z1=Hb;this.B2k(ca)}else this.Hh=!1,this.fic=null}iMc(){}lTh(ca,bb,Hb){let Vb=Math.min(ca,Math.max(200,Hb));bb&&ca<Hb&&(Vb+=tc.a.Gt);Cc.DOMElementExtensions.SG(this.uh,
Vb);bb&&(Vb-=tc.a.Gt);return Vb}uSa(){super.uSa();var ca=Cc.DOMElementExtensions.wq(this.get_element(),this.Nva),bb=this.z1.length>this.BI,Hb=pa.f(this.$);if(Hb=Hb.Ob(Hb.ha.oa.activeCell))for(ca=this.lTh(ca.offsetWidth,bb,Hb.width),bb=this.uh.getElementsByClassName(La.Bud),Hb=0;Hb<bb.length;Hb++)bb[Hb].style.maxWidth=ta.HelperMethods.$c(ca);else Va.ULS.sendTraceTag(537167964,0,15,"CellAutoCompleteListBox.AdjustHeightAndWidth: Can't retrive FormattedCell of the Current Active Cell.")}onItemClick(ca){if(ca=
super.onItemClick(ca)){const bb=pa.f(this.$);bb.Bu(!1);bb.focus()}return ca}}La.Bud=kb.Ysi;Object($a.a)(La,"CellAutoCompleteListBox",tb,[]);var wb=a(27),Wa=a(74),Fa=a(139),Da=a(183),ja=a(53),Qa=a(42),Ob=a(330),Ub=a(20),Zb=a(65),uc=a(5),Hc;let Dd=Hc=class extends Ga{constructor(ca,bb,Hb,Vb,Ec){super(ca,Ec);this.$Oa=null;this.zud=[];this.hDc=this.zHa=!1;this.GRe=this.Sn=null;this.lrf=()=>{this.z6.OAi(this.items,this.$Oa);this.raiseEvent("ACLBUpdated",new eb(this.items.length));this.show()};a(1507);
this.je=bb;this.domElement.className=kb.bpi;bb=document.createElement("div");bb.classList.add(kb.Qri);bb.classList.add(Ub.a.YD);bb.id=kb.c0g;this.domElement.appendChild(bb);Cc.DOMElementExtensions.setVisible(this.domElement,!1);Ob.d(this.style,this.$.isChromeRtl);this.edf=$get(kb.c0g,this.domElement);this.z6=new La(this.$,this.edf,Hb,this);this.C8b(!0);this.$.domElement.appendChild(this.domElement);Fa.b(this.$,rd=>{this.VGb(ca,rd)});this.VGb(ca,pa.f(ca).Rb);this.wnj=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8554518_ChangeHandleKeyDownConditionOrder");
Vb.Ea(this)}Aod(ca){this.addHandler("ACLBUpdated",ca)}Mie(ca){this.removeHandler("ACLBUpdated",ca)}Vq(ca){this.addHandler("ACLBSelectionChanged",ca)}vr(ca){this.removeHandler("ACLBSelectionChanged",ca)}wEh(ca){this.addHandler("ACLBMatchedItem",ca)}ptk(ca){this.removeHandler("ACLBMatchedItem",ca)}get HD(){return this.z6}get FKb(){return this.$Oa}get xg(){return this.z6.xg}get items(){return this.Sn}get A0a(){return this.GRe}get activeCell(){return pa.f(this.$).ha.oa.activeCell}p_g(ca){for(let bb=0;bb<
ca.length;bb++)if(fb.a.isLetter(ca.charCodeAt(bb)))return!0;return!1}ylb(){return!this.items}dispose(){if(this.$){this.C8b(!1);const ca=pa.f(this.$);ca&&ca.view.xs(this.O9d)}xa.a.xd([this.z6,this.A0a]);xa.a.xd(this.zud);this.zud=this.edf=this.z6=this.qd=null;super.dispose()}Ok(ca,bb){let Hb=!1;if(this.tRk())switch(bb){case -798660877:if(1===this.items.length&&this.xg)break;this.HD.GC(1);this.raiseEvent("ACLBSelectionChanged",new eb(this.items.length,this.pBc(this.xg),this.xg));Hb=this.autoComplete(!1);
break;case 137938150:if(1===this.items.length&&this.xg)break;this.HD.GC(-1);this.raiseEvent("ACLBSelectionChanged",new eb(this.items.length,this.pBc(this.xg),this.xg));Hb=this.autoComplete(!1);break;case 2091832999:this.HD.GC(this.BI-1);Hb=this.autoComplete(!1);break;case 742457698:this.HD.GC(-(this.BI-1));Hb=this.autoComplete(!1);break;case 125627505:this.qd.Za.caretPosition=this.qd.text.length;this.Hh=!1;Hb=!0;break;case 267796030:this.autoComplete(!0);break;default:Hb=super.Ok(ca,bb)}return Hb}show(){this.items&&
this.items.length&&(this.z6.Vo=this.xg?this.HD.Dl.rows[this.pBc(this.xg)]:null,this.Hh=0<this.z6.z1.length,this.ENa(!0),this.z6.iMc())}pLh(ca){const bb=!!this.qd&&!Wa.f(this.$.la);this.hDc=this.zHa=!1;this.qd&&!this.qd.isEditing?this.set_visible(!1):bb&&!this.Kci(this.activeCell)&&this.SVk(ca)}Kci(ca){var bb;return null===(bb=Zb.a.Cb(uc.DataValidationControlService))||void 0===bb?void 0:bb.vCd(ca)}autoComplete(ca){if(!this.qd||!this.Hh)return!1;const bb=this.$Oa;if(this.xg){var Hb=Cc.DOMElementExtensions.zca(Cc.DOMElementExtensions.wq(this.z6.Vo,
La.Bud),Z.a.y6e,"");const Vb=Hb.substring(bb.length,Hb.length);ca?this.qd.text=Hb:this.qd.insertTextAt(Vb,bb.length,this.qd.text.length)}Hb=pa.f(this.$);Hb.rv&&(Hb=Hb.Rb,Hb.text=this.qd.text,Hb.setCaretPosition(this.qd.Za.caretPosition));ca?this.Hh=!1:this.qd.Za.selectRange(bb.length,this.qd.text.length);return!0}pBc(ca,bb){bb=void 0===bb?!1:bb;if(!this.z6.Dl)return-1;const Hb=this.z6.Dl.children[0],Vb=Hb.children.length;let Ec;for(let rd=0;rd<Vb;++rd)if(Ec=Hb.children[rd],fb.a.equals(Ec.innerText.trim(),
ca,bb))return rd;return-1}Jyh(ca,bb,Hb,Vb,Ec,rd,Id){const W=Hb.originalText.replace(Hc.xhg,String.fromCharCode(32)),Ra=new wb.Range(ca.top-1,ca.left,ca.bottom-1,ca.right,!1,!1),nc=Id?Id.jt(Hb.range):null;(!Hb.AC||Hb.range.left===ca.left)&&1<W.length&&!Vb.Bb(W.toUpperCase())&&fb.a.MG(W,bb)&&!fb.a.equals(W,bb,!0)&&!Hc.XBf(bb)&&this.p_g(W)&&(!Ec&&!nc||!Ec&&nc.equals(Id.jt(Ra))||Ec&&Hb.range.ld(rd)&&Hb.range.top!==rd.top)&&(ca=Hb.formulaBarText,fb.a.equals(ca,Hb.text,!1)||!ca)&&(ca={},ca.FirstRow=Hb.range.top-
1,ca.FirstColumn=Hb.range.left-1,Hb=new Yb(W,ca),Vb.add(W.toUpperCase(),Hb))}SVk(ca){this.Sn=this.d2i();this.A0a&&this.A0a.cancel();0<this.qd.text.length&&0!==ca?this.items&&((1<this.items.length||this.Hh)&&this.Sji(),8!==ca&&127!==ca&&46!==ca&&(1===this.items.length?this.mej():this.z6.Vo&&this.autoComplete(!1))):this.Hh=!1}Sji(){this.Hh?this.lrf():this.GRe=Da.AsyncMethodContext.Ax(this.lrf,500,ja.a.bWh,this.A0a)}mej(){Va.ULS.shipAssertTag(537167966,0,!this.ylb()&&1===this.items.length,"Invalid Items");
const ca=this.items[0].Oqa,bb=this.qd.text,Hb=ca.substring(bb.length,ca.length);0<Hb.length&&(this.qd.appendText(Hb),this.qd.Za.selectRange(bb.length,this.qd.text.length),this.raiseEvent("ACLBMatchedItem",new eb(this.items.length,0,ca)),this.zHa=!0)}d2i(){this.Sn=null;const ca=new Qa.a(!1);var bb=this.activeCell;this.$Oa=this.qd.text.replace(Hc.xhg,String.fromCharCode(32));const Hb=this.je.jt(bb),Vb=bb.ld(Hb);if(Hc.XBf(this.$Oa)||!this.p_g(this.$Oa))return this.items;const Ec=new wb.Range(1,bb.left,
bb.top-1,bb.left,!1,!1);var rd=new wb.Range(bb.top+1,bb.left,Ca.a.sf,bb.left,!1,!1);let Id;const W=pa.f(this.$);rd=W.Np("CellAutoCompleteControl.GetSuggestedCells",rd);try{const Ra=W.Np("CellAutoCompleteControl.GetSuggestedCells2",Ec);try{for(const nc of[Ra,rd])for(;nc.$$mn();)Id=nc.$$cu(),this.Jyh(bb,this.$Oa,Id,ca,Vb,Hb,this.je)}finally{Ra&&Ra.dispose()}}finally{rd&&rd.dispose()}this.Sn=Array(ca.values.length);for(bb=0;bb<this.items.length;bb++)this.items[bb]=ca.values[bb];this.items.sort((Ra,nc)=>
Ra.Oqa.localeCompare(nc.Oqa));return this.items}VGb(ca,bb){ca&&bb&&this.zud.push(new Sb(ca,bb,this))}tRk(){return this.wnj?this.FKb&&!this.ylb()&&this.Hh?this.get_visible():!1:this.FKb&&!this.ylb()&&this.get_visible()&&this.Hh}static get xhg(){return Hc.rTe||(Hc.rTe=new RegExp(String.fromCharCode(160),"g"))}static XBf(ca){ca=0<ca.length?ca.charCodeAt(0):-1;return 35===ca||61===ca||43===ca||45===ca||64===ca}};Dd.rTe=null;Dd=Hc=Object(hb.__decorate)([Object(Zb.d)(uc.CellAutoCompleteControlService,{we:"transient"}),
Object(hb.__param)(0,Object(uc.EwaControlService)()),Object(hb.__param)(1,Object(uc.TableManagerService)()),Object(hb.__param)(2,Object(uc.HtmlSanitizationHelperService)()),Object(hb.__param)(3,Object(uc.CellAutoCompleteReadoutHandlerService)()),Object(hb.__param)(4,Object(uc.ZoomService)())],Dd);Object($a.a)(Dd,"CellAutoCompleteControl",Ga,[225,226,227,4]);var jc=a(13);let $c=class{constructor(ca){this.Rcb=null;this.erg=(bb,Hb)=>{1<Hb.length&&(bb=jc.a.instance.ia(858),this.ariaLiveNotifier.jDg(bb,
Hb.length))};this.frg=(bb,Hb)=>{Va.ULS.shipAssertTag(537167961,0,0<=Hb.selectedIndex&&0<=Hb.length&&Hb.selectedIndex<Hb.length,"Invalid ListEventArgs: SelectedIndex/Length");Va.ULS.shipAssertTag(537167960,0,!!Hb.EL,"ListEventArgs: SelectedValue should not be null");this.ariaLiveNotifier.Nkk(Hb.EL,Hb.selectedIndex+1,Hb.length)};this.grg=(bb,Hb)=>{this.ariaLiveNotifier.L3(Hb.EL)};this.ariaLiveNotifier=ca}dispose(){this.jze();this.Rcb=null}Ea(ca){ca&&(this.Rcb=ca,ca.Aod(this.erg),ca.Vq(this.frg),ca.wEh(this.grg))}jze(){this.Rcb&&
(this.Rcb.Mie(this.erg),this.Rcb.vr(this.frg),this.Rcb.ptk(this.grg))}};$c=Object(hb.__decorate)([Object(Zb.d)(uc.CellAutoCompleteReadoutHandlerService),Object(hb.__param)(0,Object(uc.AriaLiveNotifierService)())],$c);Object($a.a)($c,"CellAutoCompleteReadoutHandler",null,[724,4]);var ud=a(209),Ud=a(67);let ec=class{constructor(ca){this.Rci=ca}gd(){return!1}executeCommand(ca,bb){ca=!1;bb=bb.command;switch(bb){case 1159342996:this.Rci.l7b(!0),ca=!0}return ca?Ud.Task.Va(!0):ud.a(bb)}Rc(ca,bb){switch(bb.command){case 1159342996:return cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8841835_DatePickerEnabled");
default:return!1}}td(){return!1}};ec=Object(hb.__decorate)([Object(Zb.d)(uc.DatePickerCommandHandlerService),Object(hb.__param)(0,Object(uc.DatePickerService)())],ec);Object($a.a)(ec,"DatePickerCommandHandler",null,[29]);var Db=a(128),ic=a(606),Pc=a(92),Ed=a(1065),de=a(282),se=a(641),Fe=a(159),fe=a(114),Tc=a(2),ed=a(328),pd=a(186),Kb;let rb=Kb=class extends Ed.a{constructor(ca,bb,Hb,Vb){var Ec,rd,Id;super(ca,Kb.featureName);this.qFc=!1;this.kVa=()=>{this.qFc&&Object(fe.e)(()=>{this.DF.jC();this.qFc=
!1;this.Dd.detach("scroll");this.da.view.xs(this.kVa)})};this.onActiveCellChanged=async()=>{cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePickerFloatie",!1)&&(this.kVa(),pd.a(async()=>{!this.DF.mlb()&&await Object(se.b)(this.grid.Ob(null))&&(Va.ULS.sendTraceTag(508610529,0,100,"DatePickerControl.onActiveCellChanged: Date Picker Floatie is to be shown"),this.nWg())},100)())};this.YJa=async(W,Ra)=>{this.kVa();!this.hLb&&await Object(se.a)(Ra)&&(Va.ULS.sendTraceTag(509147206,0,50,
"DatePickerControl.onCellEditStarted: Encountered Date in cell, Date Picker service already available, showing date picker"),this.Qsc.start(),this.l7b())};this.XJa=()=>{this.VBd()};this.wu=()=>{var W;Object(Fe.g)(null===(W=this.grid.Rb)||void 0===W?void 0:W.text)&&this.VBd()};this.rIk=W=>{var Ra,nc=this.da.Rb,yc=this.da.Ob(null);if(yc){var Fd=null===(Ra=this.Yd)||void 0===Ra?void 0:Ra.config;if(!Fd){this.nle("DatePickerControl.SetCellDate: calc config unavailable",nc);return}W=excelOnlineCalc.date.dateTime(W.getFullYear(),
W.getMonth()+1,W.getDate(),W.getHours(),W.getMinutes(),W.getSeconds(),0,W.getMilliseconds(),0);W=Fd.datepack.toNum(Fd,W);Fd=Fd.mathpack.toNumber(W);this.hLb=!1;if(this.tYf||this.$.oda){W=this.$e.WNd(yc,{ValidMembers:32,NumberFormat:4});if(!W.success&&W.NJa){this.nle(`DatePickerControl.SetCellDate: Conversion to ribbon number format failed, LogData:  ${`
            reason: ${W.reason},
            format: ${W.NJa}`}`,nc);return}yc=this.$e.pEi(Fd.toString(),W.NJa,yc.cell.S0);if(!yc.success){this.nle("DatePickerControl.SetCellDate:formatStringValueWithFormatString failed",nc);return}nc.text=yc.fI;this.tYf=!1}else nc.text=Fd.toString();this.qFc?(nc=Object(Tc.a)(new ed.a,{Text:nc.text}),this.da.setCell(nc,this.da.ha.oa.activeRange,0,127,null),this.kVa()):nc.endEdit(!0,"DatePickerControl.SetCellDate",0);Va.ULS.sendTraceTag(509110228,0,50,"DatePickerControl.setCellDate: User selected Date using Date Picker")}this.Qea()};
this.nle=(W,Ra)=>{Va.ULS.sendTraceTag(508956939,0,10,W);Ra.endEdit(!0,"DatePickerControl.SetCellDate Failed",0);this.Qea()};this.Dmi=()=>{this.Qsc&&(this.Qsc.stop(),Va.ULS.sendTraceTag(508823174,0,50,`DatePickerControl: Time taken to render DatePicker: ${this.Qsc.Kc}`))};this.Qea=W=>{Object(fe.e)(()=>{this.hLb=!1;Db.FocusManager.instance().fm(ic.AFrame.yX);Pc.a.Ssb(Cc.DOMElementExtensions.TPb(this.$.Wf),fc.a.Hb,W,this.$,this.da)})};this.lzg=()=>{Db.FocusManager.instance().fm(ic.AFrame.rZ)};this.$=
ca;this.da=pa.f(this.$);this.Yd=bb;this.$e=Hb;this.DF=Vb;null===(Ec=this.da.Rb)||void 0===Ec?void 0:Ec.Uq(this.XJa);null===(rd=this.da.Rb)||void 0===rd?void 0:rd.qH(this.YJa);null===(Id=this.da.Rb)||void 0===Id?void 0:Id.lSa(this.wu);this.da.ha.add_activeCellChanged(this.onActiveCellChanged);this.Qsc=this.$.Vb.Pg("DialogShown","DatePickerRender")}dispose(){var ca,bb,Hb;this.VBd();this.kVa();null===(ca=this.da.Rb)||void 0===ca?void 0:ca.QI(this.YJa);null===(bb=this.da.Rb)||void 0===bb?void 0:bb.gq(this.XJa);
null===(Hb=this.da.Rb)||void 0===Hb?void 0:Hb.a4a(this.wu);this.da.ha.remove_activeCellChanged(this.onActiveCellChanged);super.dispose()}get tf(){return de.a.dnf}nWg(){c(this.grid,this.DF);this.qFc=!0;this.da.view.Ks(this.kVa);this.Dd.Ea("scroll",this.kVa)}l7b(ca){this.tYf=void 0===ca?!1:ca;this.Dvk(this.da.ha.oa.activeCell)}VBd(){this.hLb&&Object(fe.e)(()=>{appChrome.hideDatePicker();this.hLb=!1})}Dvk(ca){ca=void 0===ca?null:ca;const bb=()=>{this.Oub(ca,Vb=>{appChrome.renderDatePicker(this.domElement,
Vb.y,Vb.x,Vb.y+Vb.height,Vb.x+Vb.width,!0,this.OLi(),this.rIk,this.Qea,this.lzg,this.Ztb,this.da.rtl)});this.hLb=!0;this.Dmi()},Hb=()=>{Object(fe.e)(()=>{bb()})};Object(fe.b)()&&window.requestIdleCallback?window.requestIdleCallback(bb,{timeout:100}):Hb()}OLi(){var ca,bb=new Date,Hb=null===(ca=this.da.Ob(null))||void 0===ca?void 0:ca.cell;if((null===Hb||void 0===Hb?0:Hb.cellValue)&&this.Yd.j_f(Hb.oi)&&1===Hb.py){ca=this.Yd.config;Hb=parseInt(Hb.cellValue,10);if(!Hb||0>=Hb)return bb;bb=ca.mathpack.fromNumber(Hb);
bb=ca.datepack.fromNum(ca,bb,0);bb=new Date(bb.yr,bb.mon-1,bb.dom)}return bb}Hm(){this.lzg()}fo(){this.Qea()}};rb=Kb=Object(hb.__decorate)([Object(Zb.d)(uc.DatePickerService),Object(hb.__param)(0,Object(uc.EwaControlService)()),Object(hb.__param)(1,Object(uc.CalcManagerService)()),Object(hb.__param)(2,Object(uc.FormatCellsActionService)()),Object(hb.__param)(3,Object(uc.ContextMenuControllerService)())],rb);Object($a.a)(rb,"DatePickerControl",Ed.a,[4]);var rc=a(379),ld=a(83);Object(Zb.b)(uc.FormulaAssistanceHelpClickHandlerService)(async()=>
{const ca=await Zb.a.resolve(uc.EwaControlService);return(bb,Hb,Vb)=>{if(Hb||(void 0===Vb?0:Vb))a:if(Hb){if(bb&&(!bb||bb.startsWith("http://")||bb.startsWith("https://"))){if(cc.EwaSettings.Ra(147)&&(Hb=Zb.a.Cb(uc.SafeLinksService))&&Hb.rza(bb))break a;ta.HelperMethods.Rg(bb,"_blank",rc.a)}}else ta.HelperMethods.r3(ca.bJ,"XLWAEndUser_"+bb,ca.ZL);else Hb=new ld.a(-859308420,fc.a.Hb,ca.xc,0,null),ca.Ia.Gb(Hb,{[fc.a.Wc]:Z.a.VF,[fc.a.Bf]:"HelpID="+bb})}});var Tb=a(29),Wc=a(170),Ac=a(242);class nd extends Sys.EventArgs{constructor(ca,
bb){super();this.functionName=ca;this.gEf=bb}}Object($a.a)(nd,"FormulaAssistanceFunctionChangedEventArgs",Sys.EventArgs,[]);class qd extends Sys.EventArgs{constructor(ca){super();this.BOg=ca}}Object($a.a)(qd,"FormulaAssistanceSelectedParameterChangedEventArgs",Sys.EventArgs,[]);var Xd=a(306);class Hd{constructor(ca,bb,Hb,Vb,Ec){this.NEc=this.ATa=!1;this.$=ca;this.formulaAssistanceUIControl=bb;this.zDf=Hb;this.nne=Vb;this.dRf=void 0===Ec?null:Ec;this.NEc=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug")}get ij(){return this.ATa}set ij(ca){this.ATa!==
ca&&(ca?Xd.a(this.$).hl(this):Xd.a(this.$).XC(this),this.ATa=ca)}get tf(){return this.nne}get ud(){return this.formulaAssistanceUIControl.getRootElement(this.zDf)}Nj(ca,bb){ca=!1;bb||(pa.f(this.$).Ej.Za.mI=!0,ca=this.formulaAssistanceUIControl.focus(this.zDf));return ca}zk(ca){const bb=this.ud;return!(void 0===bb||null===bb)&&Cc.DOMElementExtensions.Ki(bb,ca)}Hm(){this.dRf&&this.dRf();const ca=pa.f(this.$).Ej.Za;this.selection=ca.selection;ca.removeSelection()}fo(){pa.f(this.$).Ej.Za.selection=this.selection}dispose(){Xd.a(this.$).XC(this)}}
Object($a.a)(Hd,"FormulaAssistanceFocusManager",null,[24,4]);var Zc=a(16),Jc=a(94),gc=a(155),dd=a(309),Bb=a(165);class pc{constructor(ca){this.a7=ca;this.j2=this.Dre=this.Vp=!1;this.onKeyDown=bb=>this.j2||"Space"!==bb.code&&" "!==bb.key||!bb.altKey||!bb.ctrlKey?!1:(this.kvc(),bb.stopPropagation(),bb.preventDefault(),!0);this.g0a=bb=>{if(!this.j2)return!1;if(bb.eventName===Zc.a.nd){const Hb=bb.Ha.ctrlKey?1:bb.Ha.shiftKey?50:10;switch(bb.Ha.keyCode){case Jc.a.T7a:this.Sda(0,-Hb);break;case Jc.a.Gza:this.Sda(0,
Hb);break;case Jc.a.RNa:this.Sda(-Hb,0);break;case Jc.a.exb:this.Sda(Hb,0);break;case Jc.a.iW:case Jc.a.vo:this.Dre=!0;break;default:return!1}}bb.eventName===Zc.a.Ye&&this.Dre&&this.lca(!0);bb.Ha.preventDefault();return!0};this.h1b=bb=>{if(!this.j2)return!1;bb.Ha.preventDefault();this.lca();return!0};this.onBlur=()=>{if(!this.j2)return!1;this.lca();return!0};this.Jy=gc.a.instance;this.Gce=dd.a.instance}Ea(ca){(this.root=ca)&&!this.Vp&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Vp=
!0)}detach(){this.root&&this.Vp&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Vp=!1)}kvc(){this.root&&(this.a7.otg("move",!0),this.root.focus(),this.j2=!0,this.Dre=!1,this.Yz(),this.g6d||this.izd(),this.root.appendChild(this.g6d))}lca(ca){this.j2&&(this.j2=!1,this.a7.lXj(void 0===ca?!1:ca),this.aie(),this.Ehe())}Yz(){this.Jy.capture(this.g0a,null);this.Gce.Vy(Zc.a.Sd,this.root,this.h1b,!0);this.root.addEventListener("blur",this.onBlur)}Ehe(){this.Jy.releaseCapture();this.Gce.fz(Zc.a.Sd,
this.root,this.h1b,!0);this.root.removeEventListener("blur",this.onBlur)}aie(){var ca;null===(ca=this.g6d)||void 0===ca?void 0:ca.remove()}Sda(ca,bb){const Hb=this.a7.getPosition();Hb.x+=ca;Hb.y+=bb;this.a7.setPosition(Hb)}izd(){this.g6d=Bb.a(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",!0,"")}}Object($a.a)(pc,"FormulaAssistanceMoveAdapter",null,[]);var wc=a(393);class cd{constructor(ca){this.a7=ca;this.startOffset={x:0,y:0};this.CZg=!0;this.Vp=!1}tka(){return this.Vp&&!!this.handle}V1a(ca){const bb=
this.a7.getPosition();this.CZg=bb.renderDown;this.startOffset.x=bb.x-ca.clientPoint.x;this.startOffset.y=bb.y-ca.clientPoint.y;this.a7.otg("drag");return!0}ywa(ca){this.a7.setPosition({x:ca.clientPoint.x+this.startOffset.x,y:ca.clientPoint.y+this.startOffset.y,renderDown:this.CZg});return!0}xwa(){}wwa(){}Ea(ca,bb){this.handle=bb;this.root=ca;this.handle&&(this.handle.style.cursor="move",wc.a.instance.x9(this.handle,this,!1),this.Vp=!0)}detach(){this.Vp&&this.handle&&(this.handle.style.cursor="",wc.a.instance.Rfa(this.handle,
this),this.Vp=!1)}}Object($a.a)(cd,"FormulaAssistanceDragAdapter",null,[776]);class Vd{get getPosition(){return this.znh}get setPosition(){return this.bYe}constructor(ca){this.formulaAssistanceTelemetryManager=ca;this.Vp=!1;this.anc=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.H$b={[xb.Drag]:0,[xb.Move]:0};this.Mfg=new pc(this);this.Xqf=new cd(this)}Ea(ca,bb,Hb,Vb){this.znh=Hb;this.bYe=Vb;this.Mfg.Ea(ca);this.Xqf.Ea(ca,bb);this.Vp=!0}detach(){this.Vp&&
(this.Xqf.detach(),this.Mfg.detach(),this.Vp=!1)}clear(){var ca;null===(ca=this.bYe)||void 0===ca?void 0:ca.call(this,null);this.detach();this.oke()}otg(ca,bb){this.H$b[ca]++;if(void 0===bb?0:bb)this.$de=document.activeElement}lXj(ca){this.$de&&((void 0===ca||ca)&&this.$de.focus(),this.$de=null)}oke(){const ca=this.formulaAssistanceTelemetryManager.Lha,bb=this.H$b[xb.Drag],Hb=this.H$b[xb.Move];0<bb&&(this.formulaAssistanceTelemetryManager.wha("d"),this.anc||(ca.argumentAssistanceDragTotalCounter+=
bb),this.H$b[xb.Drag]=0);0<Hb&&(this.formulaAssistanceTelemetryManager.wha("m"),this.anc||(ca.argumentAssistanceMoveTotalCounter+=Hb),this.H$b[xb.Move]=0)}}Object($a.a)(Vd,"FormulaAssistanceDragControl",null,[]);var xb;(function(ca){ca.Drag="drag";ca.Move="move"})(xb||(xb={}));Object($a.b)("FormulaAssistanceDragMode",xb);var ub=a(115);const Fc=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaAssistantMinifiedState",!1);var xd;(function(ca){ca[ca.ArgumentAssistanceCard=0]="ArgumentAssistanceCard";
ca[ca.AutoCompleteMenu=1]="AutoCompleteMenu";ca[ca.ValuePreview=2]="ValuePreview"})(xd||(xd={}));class Ic extends ia.a{constructor(ca,bb,Hb){super(Ic.jJd());this.$=ca;this.formulaAssistanceUIControl=bb;this.formulaAssistanceTelemetryManager=Hb;this.isExpanded=!0;this.p0a=this.TA=null;this.Itc=this.EA=!1;this.Gki=0;this.Jqd=!1;this.setPosition=Vb=>{this.formulaAssistanceUIControl.setFixedPosition(Vb);this.formulaAssistanceUIControl.updatePosition(xd.ArgumentAssistanceCard)};this.getPosition=()=>this.formulaAssistanceUIControl.getPosition();
this.Nlb=cc.EwaSettings.kGc();this.Nd=()=>{this.visible=!1};this.onIsExpandedChange=Vb=>{this.Edl(Vb);Vb?this.formulaAssistanceTelemetryManager.wha("e"):this.formulaAssistanceTelemetryManager.wha("c")};this.onDismissClick=()=>{this.dismiss();this.grid.Ej.Za.focus()};this.Nne=Vb=>{var Ec=this.$;Vb=Vb.functionName;const rd={};rd[Z.a.MF]="ArgumentAssistanceCard";const Id={};Id.FunctionName=Vb;rd[Z.a.Pwc]=Id;Ec.Dc(802602464,0,8,rd);this.formulaAssistanceTelemetryManager.wha("gf")};this.yt=()=>{this.formulaAssistanceUIControl.updatePosition(xd.ArgumentAssistanceCard)};
this.wg=()=>{this.a7.clear();this.M7k();this.Jqd=!1};this.EKk();this.TA=new Hd(this.$,this.formulaAssistanceUIControl,xd.ArgumentAssistanceCard,de.a.yDf);this.grid=Object(pa.f)(ca);this.grid.view.Ks(this.yt);this.grid.ha.Vq(this.Nd);this.a7=new Vd(this.formulaAssistanceTelemetryManager);this.grid.cellTextEditBox.Uq(this.wg)}ZDh(ca){this.addHandler("FAFunctionNameUpdated",ca)}Usk(ca){this.removeHandler("FAFunctionNameUpdated",ca)}cGh(ca){this.addHandler("FAParameterSelectionChangedOld",ca)}Luk(ca){this.removeHandler("FAParameterSelectionChangedOld",
ca)}bGh(ca){this.addHandler("FAParameterSelectionChanged",ca)}Kuk(ca){this.removeHandler("FAParameterSelectionChanged",ca)}get visible(){return this.EA}set visible(ca){ca||this.dismiss();this.EA=ca}dismiss(){this.EA=!1;this.formulaAssistanceUIControl&&(this.a7.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.p0a=null,this.TA.ij=!1)}show(ca){this.EA=this.Jqd=!0;ca=this.Dek(ca);this.formulaAssistanceUIControl&&(this.formulaAssistanceTelemetryManager.RMa(["argumentAssistanceRender"]),
this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,ca,()=>b(this.$)),this.rxk(),this.Nak(ca),this.a7.Ea(this.formulaAssistanceUIControl.getCalloutElement(xd.ArgumentAssistanceCard),this.formulaAssistanceUIControl.getDraggableElement(xd.ArgumentAssistanceCard),this.getPosition,this.setPosition),this.Nlb&&"Full"!==ca.kind||(this.TA.ij=!0),this.formulaAssistanceTelemetryManager.o1(["argumentAssistanceRender"]),this.formulaAssistanceTelemetryManager.DMb("argumentAssistanceOverall"))}Ok(ca,
bb){if(1872288872===bb){if(this.visible)return this.Itc=!0;this.Itc&&(this.formulaAssistanceTelemetryManager.wha("2ndEsc"),this.Itc=!1)}else this.Itc=!1;return!1}dYa(ca){return this.visible&&1872288872===ca?(this.formulaAssistanceTelemetryManager.wha("esc"),this.dismiss(),!0):!1}dispose(){this.$&&this.grid&&(this.grid.ha&&this.grid.ha.vr(this.Nd),this.grid.view.xs(this.yt),this.grid.cellTextEditBox.gq(this.wg));xa.a.vb(this.TA);this.$=null}Dek(ca){switch(ca.kind){case "Minimal":return this.zek(ca);
case "Full":return this.uek(ca)}}zek(ca){return{kind:"Minimal",functionRenderingInfo:ca}}uek(ca){const bb={kind:"Full",isExpanded:!1,callbacks:null,functionRenderingInfo:null};bb.functionRenderingInfo=ca;bb.isExpanded=this.isExpanded;this.ppk(bb);return bb}ppk(ca){ca.callbacks={onIsExpandedChange:null,onHelpLink:null,onFeedback:null,onDismissClick:null};ca.callbacks.onHelpLink=this.HSi(ca.functionRenderingInfo);ca.callbacks.onIsExpandedChange=this.onIsExpandedChange;ca.callbacks.onFeedback=this.Nne;
ca.callbacks.onDismissClick=this.onDismissClick}HSi(ca){return()=>{void Zb.a.resolve(uc.FormulaAssistanceHelpClickHandlerService).then(bb=>bb(ca.helpID,ca.isUDF));this.formulaAssistanceTelemetryManager.wha("lm")}}EKk(){const ca=Wc.a.get(Z.a.t8e);ca?this.isExpanded="false"!==ca:(this.isExpanded=Ic.Cdi,this.formulaAssistanceTelemetryManager.$Hk());this.formulaAssistanceTelemetryManager.aIk(this.isExpanded)}Nak(ca){switch(ca.kind){case "Minimal":this.Pak(ca.functionRenderingInfo);break;case "Full":this.Kak(ca)}}Pak(ca){var bb=
ca.functionName;if(this.p0a&&fb.a.equals(this.p0a,bb,!0)){bb="";const Hb=ca.parameters.activeParam;0<=Hb&&Hb<ca.parameters.params.length&&(bb=ca.parameters.params[Hb]);this.raiseEvent("FAParameterSelectionChanged",new qd([bb]))}else this.p0a=bb,ca=ca.parameters.params.join(", "),this.raiseEvent("FAFunctionNameUpdated",new nd(bb,[ca]))}Kak(ca){var bb=ca.functionRenderingInfo.functionName;this.p0a&&fb.a.equals(this.p0a,bb,!0)?(bb=Ac.a.map(ca.functionRenderingInfo.signatures,Hb=>{let Vb="";0<=Hb.signatureParams.activeParam&&
Hb.signatureParams.activeParam<Hb.signatureParams.params.length&&(Vb=Hb.signatureParams.params[Hb.signatureParams.activeParam]);return Vb}),this.raiseEvent("FAParameterSelectionChanged",new qd(bb))):(this.p0a=bb,ca=Ac.a.map(ca.functionRenderingInfo.signatures,Hb=>Hb.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",new nd(bb,ca)))}Edl(ca){this.isExpanded=ca;try{Wc.a.BB(Z.a.t8e,ca.toString(),ic.AFrame.tza)}catch(bb){Va.ULS.sendTraceTag(512267714,0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${bb.message}`)}}static jJd(){return document.createElement("div")}rxk(){const ca=
this.getPosition().renderDown?"rd":"ru";this.formulaAssistanceTelemetryManager.wha(ca)}M7k(){this.Jqd&&2===++this.Gki&&this.$.Dc(953250532,-1,0,null)}}Ic.Cdi=!0;Object($a.a)(Ic,"FormulaArgumentAssistanceControl",ia.a,[736]);var bd=a(961),yb=a(181);const Oc=[Object(yb.d)("featureNameField","FormulaSmartSuggestions"),Object(yb.d)("ver","1.0.0")],kd={eventName:"Office.Excel.FormulaSmartSuggestions.Seen",eventFlags:bd.a,dataFields:[...Oc,Object(yb.a)("isFeatureSeen",!0)]},Rc={eventName:"Office.Excel.FormulaSmartSuggestions.Tried",
eventFlags:bd.a,dataFields:[...Oc,Object(yb.a)("isFeatureTried",!0)]},Xb={eventName:"Office.Excel.FormulaSmartSuggestions.Succeeded",eventFlags:bd.a,dataFields:[...Oc,Object(yb.a)("isFeatureSucceeded",!0)]};var dc=a(662),Vc;(function(ca){ca[ca.Dismissed=0]="Dismissed";ca[ca.Smart=1]="Smart";ca[ca.Simple=2]="Simple";ca[ca.Mixed=3]="Mixed"})(Vc||(Vc={}));Object($a.b)("UIState",Vc);class yd extends ia.a{constructor(ca,bb,Hb){super(yd.jJd());this.$=ca;this.formulaAssistanceUIControl=bb;this.formulaAssistanceTelemetryManager=
Hb;this.MIa=Tb.a.LGc();this.TA=this.clearContentNotifier=this.qd=this.da=null;this.Jtc=this.Ktc=this.Htc=this.CLb=this.DLb=this.Ltc=this.ELb=!1;this.LM=null;this.d4=0;this.mue=this.UZc=this.f6a=this.bfc=this.EA=!1;this.T9b=Vc.Dismissed;this.onRestoreFocus=()=>{};this.dismiss=()=>{this.EA=!1;this.Dlb&&this.f6a&&this.WZa&&(this.Jtc=!0);this.uEj();this.lda&&this.qd.isEditing&&this.FTc();this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.domElement),this.TA.ij=!1,this.T9b=
Vc.Dismissed)};this.Z6i=()=>{this.raiseEvent("FAFocusOnSmartSuggestionsCard",null)};this.twa=()=>{var Vb;const Ec=this.da.ha.oa.selectedRanges,rd=null===(Vb=this.formulaAssistanceTelemetryManager.WK)||void 0===Vb?void 0:Vb.Lk;Ec.some(Id=>Id.contains(rd))&&this.formulaAssistanceTelemetryManager.A1d++};this.n3=(Vb,Ec)=>{0==Ec.Fq&&(170==Ec.jg.operation.operationName&&this.formulaAssistanceTelemetryManager.$Jc++,this.$.userOperationManager.kn(this.n3),this.IHc&&this.clearContentNotifier&&this.clearContentNotifier.q3b(this.twa))};
this.R$d=(Vb,Ec)=>{0==Ec.Fq&&(12==Ec.jg.operation.operationName&&this.$.userOperationManager.Kp(this.n3),this.$.userOperationManager.kn(this.R$d))};this.KWj=()=>{this.dismiss();this.da.Ej.Za.focus()};this.Nne=()=>{const Vb={};Vb[Z.a.MF]=this.$ug?"SmartSuggestionsCard":this.nue?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.$.Dc(802602464,0,8,Vb)};this.wg=()=>{this.WZa&&this.ZHh()};this.qVj=(Vb,Ec)=>{this.Rwb(Ec);this.Ltc=!0};this.Nd=()=>{this.visible=!1};this.pVj=Vb=>{this.Htc=!0;
this.Swd(Vb)};this.Gj=()=>{this.dismiss()};this.yt=()=>{this.formulaAssistanceUIControl.updatePosition(xd.AutoCompleteMenu)};this.da=pa.f(this.$);this.TA=new Hd(this.$,this.formulaAssistanceUIControl,xd.AutoCompleteMenu,de.a.BDf,this.Z6i);this.da.view.Ks(this.yt);this.da.ha.Vq(this.Nd);this.$.qa.mh(this.Gj);this.WZa=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:5523443_FormulaSuggestionsCardUserInteractionTelemetry");this.Dlb=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:6650011_LogSuggestionsDismissal");
this.IHc=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7629619_RefiningKeptTelemetry");!this.MIa&&this.IHc&&(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:9011101_RemoveServiceNameClearContentNotifier")?void Zb.a.Bd(uc.ClearContentNotifierService).then(Vb=>{this.clearContentNotifier=Vb}):this.$.ra.Vc(313,Vb=>{this.clearContentNotifier=Vb}));this.WZa&&this.da.cellTextEditBox.Uq(this.wg)}YDh(ca){this.addHandler("FACardOpened",ca)}Tsk(ca){this.removeHandler("FACardOpened",ca)}UDh(ca){this.addHandler("FAFocusOnSmartSuggestionsCard",
ca)}Psk(ca){this.removeHandler("FAFocusOnSmartSuggestionsCard",ca)}XDh(ca){this.addHandler("FormulaAutoCompleteShown",ca)}Ssk(ca){this.removeHandler("FormulaAutoCompleteShown",ca)}dGh(ca){this.addHandler("SelectedRowChanged",ca)}Muk(ca){this.removeHandler("SelectedRowChanged",ca)}Aod(ca){this.addHandler("ListBoxUpdated",ca)}Mie(ca){this.removeHandler("ListBoxUpdated",ca)}dispose(){this.$&&(this.$.userOperationManager.kn(this.n3),this.$.userOperationManager.kn(this.R$d),this.da&&(this.da.ha&&this.da.ha.vr(this.Nd),
this.da.cellTextEditBox&&this.WZa&&this.da.cellTextEditBox.gq(this.wg),this.da.view.xs(this.yt)),this.$.qa&&this.$.qa.xh(this.Gj));this.IHc&&this.clearContentNotifier&&this.clearContentNotifier.q3b(this.twa);xa.a.vb(this.TA);this.$=null}kDh(ca){this.addHandler("CVIC",ca)}ksk(ca){this.removeHandler("CVIC",ca)}get visible(){return this.EA}set visible(ca){ca||this.dismiss();this.EA=ca}get lda(){return this.bfc}get nue(){var ca,bb;return(null===(bb=null===(ca=this.LM)||void 0===ca?void 0:ca.items[0])||
void 0===bb?void 0:bb.type)===dc.SuggestionKind.Smart}get $ug(){return 1===this.LM.items.length&&this.nue}Ok(ca,bb){if(!this.visible)return!1;this.Bze(bb);let Hb;return(Hb=this.q9i(bb)).sCc?Hb.result:this.uRk(bb)}dYa(ca){if(!this.visible)return!1;let bb=!1;switch(ca){case 1872288872:this.lda&&this.FTc();this.Dlb&&this.nue&&(this.formulaAssistanceTelemetryManager.o1(["autoCompleteSmartSuggestionActiveDismissing"]),this.Ktc=!0);this.visible=!1;bb=!0;break;case -798660877:this.Rwb(this.EQb(this.d4+1));
bb=!0;break;case 137938150:this.Rwb(this.EQb(this.d4-1));bb=!0;break;case 2091832999:this.Rwb(this.EQb(this.d4+8));bb=!0;break;case 742457698:this.Rwb(this.EQb(this.d4-8));bb=!0;break;case 125627505:case 267796030:this.Swd(this.LM.items[this.d4]),bb=!0}return bb}show(ca){this.qd=this.da.Ej;this.EA=!0;this.d4=0;this.LM=ca;0<this.LM.items.length&&(this.render(),this.Rwb(this.EQb(this.d4)),this.Dlb?this.WZa&&(this.LM.items[0].type===dc.SuggestionKind.Smart?(this.f6a||this.formulaAssistanceTelemetryManager.RMa(["autoCompleteSmartSuggestionActiveDismissing",
"autoCompleteSmartSuggestionAccepted"]),this.f6a=!0):this.f6a&&(this.Jtc=!0)):this.LM.items[0].type===dc.SuggestionKind.Smart&&this.WZa&&(this.f6a=!0));this.formulaAssistanceTelemetryManager.Gwk(ca.items)}FTc(){this.bfc=!1;this.qd.ZBd()}uRk(ca){return[1872288872,-798660877,137938150,2091832999,742457698,125627505,267796030].includes(ca)}q9i(ca){return this.lda?125627505===ca||267796030===ca?(this.Swd(this.LM.items[this.d4]),{sCc:!0,result:!1}):!this.$ug||-798660877!==ca&&137938150!==ca?{sCc:!1}:{sCc:!0,
result:!1}:{sCc:!1}}render(){this.formulaAssistanceTelemetryManager.RMa(["autoCompleteRender"]);this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,this.HRi(),()=>b(this.$)),this.Dik(),this.TA.ij=!0,this.wmi())}wmi(){this.formulaAssistanceTelemetryManager.o1(["autoCompleteRender"]);this.formulaAssistanceTelemetryManager.DMb("autoCompleteOverall");const ca=this.LM.items.some(Hb=>Hb.type===dc.SuggestionKind.Smart),bb=this.LM.items.some(Hb=>Hb.type===
dc.SuggestionKind.Simple);ca&&bb?this.formulaAssistanceTelemetryManager.DMb("autoCompleteOverallSimpleAndSmart"):ca?this.formulaAssistanceTelemetryManager.DMb("autoCompleteOverallSmartOnly"):bb&&this.formulaAssistanceTelemetryManager.DMb("autoCompleteOverallSimpleOnly")}Dik(){const ca=this.T9b;this.T9b=this.M3i(this.LM.items);ca!==Vc.Dismissed&&ca!==Vc.Smart||this.T9b!==Vc.Simple&&this.T9b!==Vc.Mixed||this.raiseEvent("FormulaAutoCompleteShown")}rjk(){var ca;if(0!==this.LM.items.length){var bb=0<=
this.d4?this.d4:0,Hb=this.LM.items[bb];Hb={EL:Hb.label,description:null!==(ca=Hb.detail)&&void 0!==ca?ca:"",selectedIndex:bb+1,length:this.LM.items.length};this.raiseEvent("SelectedRowChanged",Hb)}}Swd(ca){if(this.qd&&this.visible){var bb=ca.textEdit;this.ekj(this.qd.text,bb);this.qd.Za.caretPosition=bb.range.start.character+bb.newText.length;cc.EwaSettings.poj()&&this.qd.One();this.lda&&(this.bfc=!1,this.WZa&&(this.Dlb&&this.formulaAssistanceTelemetryManager.o1(["autoCompleteSmartSuggestionAccepted"]),
this.mue=this.UZc=!0),this.MIa||this.GRg(),this.da.dFa.KHk(),this.qd.endEdit(!0,"FormulaAutoCompleteControl.CommitAutoCompletion",0),this.MIa&&this.GRg());this.visible=!1;this.raiseEvent("CVIC",{shouldRequestAutocompleteOnCommit:ca.shouldRequestAutocompleteOnCommit});this.formulaAssistanceTelemetryManager.Fwk(ca.kind)}}GRg(){const ca={Lk:this.da.ha.oa.activeCell,cellText:this.da.Rb.text,committed:!0,TEa:null};this.MIa?this.formulaAssistanceTelemetryManager.UKk(ca):(this.formulaAssistanceTelemetryManager.WK=
ca,this.formulaAssistanceTelemetryManager.z1d=this.$.qa.la.sheetId,this.formulaAssistanceTelemetryManager.ZJc=this.$.fa.Je,this.$.userOperationManager.Kp(this.R$d),this.IHc&&this.clearContentNotifier&&this.clearContentNotifier.wFb(this.twa))}ZHh(){this.Dlb&&this.Jtc&&!this.Ktc&&!this.UZc&&(this.formulaAssistanceTelemetryManager.Rqa.dismissSmartSuggestionImplicitlyCounter++,this.Jtc=!1);this.f6a&&(this.formulaAssistanceTelemetryManager.kQ.smartSuggestionShownCounter++,this.f6a=!1,Object(bd.c)(kd));
this.UZc&&(this.formulaAssistanceTelemetryManager.kQ.smartSuggestionSelectedCounter++,this.UZc=!1,Object(bd.c)(Rc));this.mue&&(this.formulaAssistanceTelemetryManager.kQ.smartSuggestionCommittedCounter++,this.mue=!1)}HRi(){const ca={completionItems:this.LM.items,activeItemIndex:this.d4,callbacks:null};this.wok(ca);return ca}wok(ca){ca.callbacks={onCompletionItemSelected:null,onCompletionItemCommitted:null,onFeedback:null,onDismiss:null,onRestoreFocus:null};ca.callbacks.onCompletionItemSelected=this.qVj;
ca.callbacks.onCompletionItemCommitted=this.pVj;ca.callbacks.onFeedback=this.Nne;ca.callbacks.onDismiss=this.KWj;ca.callbacks.onRestoreFocus=this.onRestoreFocus}mfk(ca){this.bfc=!0;const bb=ca.textEdit.newText;this.qd.q4(bb.substring(this.qd.text.length-ca.textEdit.range.start.character,bb.length))}Rwb(ca){const bb=this.d4;this.d4=ca;const Hb=this.LM.items[ca];this.lda&&this.FTc();bb!==ca&&this.render();Hb.type!==dc.SuggestionKind.Smart||this.da.Ej.text.includes("\n")||this.mfk(Hb);this.rjk()}EQb(ca){return 0>
ca?0:Math.min(ca,this.LM.items.length-1)}ekj(ca,bb){this.qd.text=ca.substring(0,bb.range.start.character)+bb.newText+ca.substring(bb.range.end.character,ca.length);this.da.rv&&(this.da.Rb.text=this.qd.text)}uEj(){this.ELb&&(this.formulaAssistanceTelemetryManager.Rqa.selectByArrowKeyCounter++,this.ELb=!1);this.Ltc&&(this.formulaAssistanceTelemetryManager.Rqa.selectByMouseHoverCounter++,this.Ltc=!1);this.DLb&&(this.formulaAssistanceTelemetryManager.Rqa.commitByTabKeyCounter++,this.DLb=!1);this.CLb&&
(this.formulaAssistanceTelemetryManager.Rqa.commitByEnterKeyCounter++,this.CLb=!1);this.Htc&&(this.formulaAssistanceTelemetryManager.Rqa.commitByMouseClickCounter++,this.Htc=!1);this.Dlb&&this.Ktc&&(this.formulaAssistanceTelemetryManager.Rqa.dismissSmartSuggestionExplicitlyCounter++,this.Ktc=!1)}Bze(ca){switch(ca){case -798660877:case 137938150:case 2091832999:case 742457698:this.ELb=!0;break;case 125627505:this.DLb=!0;break;case 267796030:this.CLb=!0}}static jJd(){return document.createElement("div")}M3i(ca){return ca.reduce((bb,
Hb)=>bb|=Hb.type===dc.SuggestionKind.Simple?Vc.Simple:Vc.Smart,Vc.Dismissed)}}Object($a.a)(yd,"FormulaAutoCompleteControl",ia.a,[734,4,735]);var Pd=a(308),re=a(368),ue=a(255);class He{constructor(ca,bb){var Hb,Vb;this.lp=ca;this.$=bb;this.m0c=new Map;this.wvb=null;this.o_b=()=>{this.Xwc.resolve(this.lp.Yr);this.B5g()};this.fng=()=>{this.Xwc.reject(null);this.B5g()};this.wg=()=>{this.lp.cVc();this.L0d=null;this.m0c.clear();this.M0e()};this.u_j=(Ec,rd)=>{if(rd!==this.A8f)Va.ULS.sendTraceTag(509678923,
0,15,"onGetTableColHeadersSuccess called with a tableName different than the one saved for last request"),this.$Ma.reject();else if(Object(ue.a)(Ec))this.$Ma.reject();else{var Id=Ec.Result;Object(Pd.b)(Id)&&0!==Id.length?(this.m0c.set(rd,Id),void this.$Ma.resolve(Ec.Result)):this.$Ma.reject()}};this.t_j=()=>{this.$Ma.reject()};null===(Vb=null===(Hb=pa.f(this.$))||void 0===Hb?void 0:Hb.cellTextEditBox)||void 0===Vb?void 0:Vb.Uq(this.wg);this.yYk=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:6476169_skipGetFieldInfoListContextIfContextLoaded")}getRichValueFieldListContext(ca,
bb,Hb,Vb){const Ec={dia:ca,Mqf:bb};var rd;if(rd=Object(Pd.b)(this.L0d))rd=this.L0d,rd=!(Ec.dia.firstRow===rd.dia.firstRow&&Ec.dia.firstColumn===rd.dia.firstColumn&&Ec.dia.lastRow===rd.dia.lastRow&&Ec.dia.lastColumn===rd.dia.lastColumn&&Ec.dia.sheetName===rd.dia.sheetName&&Ec.Mqf===rd.Mqf);rd&&this.lp.cVc();this.L0d=Ec;this.yYk&&this.lp.sWd||this.lp.Fib(Object($b.jb)(ca),Hb,Vb,bb);this.Xwc=new Pd.a;this.lp.sWd?this.Xwc.resolve(this.lp.Yr):this.Knk();return this.Xwc.promise}getTableColHeaders(ca){if(this.wvb&&
3>=this.wvb.status&&ca===this.A8f)return this.$Ma.promise;this.$Ma=new Pd.a;if(this.m0c.has(ca))this.$Ma.resolve(this.m0c.get(ca));else{this.M0e();this.A8f=ca;const bb=this.$.wc.getItemByName(ca).ll;this.wvb=Object(re.v)(this.$.ma.sa,bb,Hb=>this.u_j(Hb,ca),this.t_j,null,null)}return this.$Ma.promise}dispose(){var ca,bb;null===(bb=null===(ca=pa.f(this.$))||void 0===ca?void 0:ca.cellTextEditBox)||void 0===bb?void 0:bb.gq(this.wg)}Knk(){this.lp.ood(this.o_b);this.lp.aEh(this.fng)}B5g(){this.lp.zie(this.o_b);
this.lp.Wsk(this.fng)}M0e(){Object(Pd.b)(this.wvb)&&(Gb.AFrameworkApplication.od.dy(this.wvb.sx),this.wvb=null)}}Object($a.a)(He,"ServerDataProvider",null,[]);var bf=a(85),af=a(1072);a(193);var Pe=a(1659);class wf{constructor(ca){this.nei={};this.$=ca}get mei(){const ca=[];if(!this.$.wc||!this.$.wc.items)return ca;let bb=0;for(const Hb of this.$.wc.items)if(Hb&&(3===Hb.type&&Hb.usedRange||2===Hb.type)){const Vb={tooltip:Hb.sheetName+bf.a.exclamation+Hb.usedRange.toString(),name:Hb.name,namedRange:this.d4h(Hb.usedRange),
sheetName:Hb.sheetName,type:this.R3h(Hb.type)};ca.push(Vb);this.nei[Hb.name.toUpperCase()]=Vb;++bb;if(!cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7395300_FixTableAutoCompleteMissingInfo")&&bb===af.a.Neg){Va.ULS.sendTraceTag(537162076,0,15,`Maximum number of defined names reached for formula assistance: ${af.a.Neg}`);break}}return ca}d4h(ca){if(null!=ca&&void 0!=ca)return{top:ca.top,left:ca.left,bottom:ca.bottom,right:ca.right,maxRows:ca.maxRows,maxColumns:ca.maxColumns,sheetName:void 0}}R3h(ca){switch(ca){case 2:return dc.DefinedNameInfoType.Table;
case 3:return dc.DefinedNameInfoType.NamedRange;default:return dc.DefinedNameInfoType.Invalid}}}Object($a.a)(wf,"DefinedNameInfoManager",null,[]);var xf=a(154),Cf=a(373),tf=a(742),Jf=a(397);const dg={index:0,length:0};class uf{constructor(ca){this.zua=this.Aua=this.pka=this.qka=!1;this.y_a=ca}}Object($a.a)(uf,"MarqueeRangeData",null,[]);class lf{constructor(ca,bb,Hb,Vb){this.U3k=ca;this.P1g=bb;this.CHc=void 0===Vb?!1:Vb;Hb?(this.y_a=Hb.y_a,this.qka=Hb.qka,this.pka=Hb.pka,this.Aua=Hb.Aua,this.zua=
Hb.zua):Va.ULS.shipAssertTag(510255180,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object($a.a)(lf,"MarqueeMetadata",null,[]);a(1509);const Pf=Tb.a.hs()?"rgba(0, 108, 190, {0});rgba(188, 47, 50, {0});rgba(124, 83, 172, {0});rgba(15, 112, 15, {0});rgba(191, 0, 119, {0});rgba(181, 73, 15, {0});rgba(0, 117, 143, {0})".split(";"):"rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";"),
Rf=Pf.map(ca=>String.format(ca,1));class Mf{constructor(ca,bb,Hb,Vb){this.$=ca;this.pluginScheduler=bb;this.VA=Hb;this.formulaAssistanceTelemetryManager=Vb;this.IYa=this.y0g=!1;this.sO=null;this.XJa=()=>{this.IYa=!1;this.sO=null};this.da=pa.f(ca);this.da.Rb.Uq(this.XJa);this.p5g=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7686593_checkPotentialFormulaBeforeX10HighlightingEnabled")}eW(ca,bb,Hb){var Vb;ca.Za.addEventLogRecord("FormulaHighlightsControl.TryUpdateFormulaHighlights");if(this.y0g||ca.lda)return!1;
const Ec=isNullOrUndefined(bb)?ca.text:bb;if(this.p5g){if(!Fe.f(Ec))return this.hAe(Object(Pd.b)(bb))}else if(1>=Ec.length)return this.hAe(Object(Pd.b)(bb));Hb=this.Z3i(ca,bb,Hb);Hb=null===(Vb=this.LLd(Ec,Hb))||void 0===Vb?void 0:Vb.formulaHighlights;if(!Hb)return Va.ULS.sendTraceTag(512349465,0,50,"FormulaHighlightsControl.tryUpdateFormulaHighlights: formulaHighlights is null (might be an invalid formula)"),this.hAe(Object(Pd.b)(bb));const {M0c:rd,xCg:Id,vCg:W,dKj:Ra}=this.CJf(Hb,Ec);this.kNk(ca,
rd,!!bb);bb=ca.Za.text;if(!fb.a.equals(bb,Ec,!1))return Va.ULS.shipAssertTag(38114182,0,!1,`FormulaHighlightsControl.tryUpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${bb.length}], updatedTextLength [${Ec.length}]`),bb=ca.Za.caretPosition,ca.Za.text=Ec,ca.Za.caretPosition=bb,!0;this.highlightRanges(Id,W,3,Ra);return this.IYa=!0}Rfg(ca,bb,Hb){if(!ca||!bb||!Hb)return Va.ULS.shipAssertTag(512349463,0,!!ca,"FormulaHighlightsControl.MoveMarqueeRange: cellContentEditor is null"),
Va.ULS.shipAssertTag(512349462,0,!!bb,"FormulaHighlightsControl.MoveMarqueeRange: highlightState is null"),Va.ULS.shipAssertTag(512349461,0,!!Hb,"FormulaHighlightsControl.MoveMarqueeRange: newRange is null"),!1;const Vb=Object(xf.a)(lf,bb.metadata);if(!Vb)return Va.ULS.shipAssertTag(512349460,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: marqueeMetadata is null"),!1;var Ec=Vb.U3k,rd=Vb.P1g;let Id=this.da.Eb.C_f(Hb)?Hb.Azc(Vb.pka,Vb.qka):Hb.Nca(Vb.pka,Vb.qka,Vb.zua,Vb.Aua);if(!Id)return Va.ULS.shipAssertTag(512349459,
0,!1,"FormulaHighlightsControl.MoveMarqueeRange: newText is null"),!1;const W=rd.indexOf("!");-1!==W&&(Id=rd.substring(0,W+1)+Id);if(!ca.Za.changeTextInExistingTextPart(Ec,rd,Id))return Va.ULS.shipAssertTag(38926105,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: failed to change the text part"),!1;Vb.P1g=Id;Ec=!0;rd=this.da.rb.lac;for(const Ra of rd)(rd=pa.f(this.$).Ub.sQ(3,Ra,bb.mia))?(rd.range=Hb,rd.metadata=Vb):(Va.ULS.shipAssertTag(512349458,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: highlightStateInPane is null"),
Ec=!1);this.da.Ub.update(!1,!1);this.da.rv&&(this.da.cellTextEditBox.Za.text=ca.text);this.da.cellTextEditBox.f2b(new Cf.a({AFc:!0}));return Ec}btj(ca){if(3!==ca.xq)return Va.ULS.shipAssertTag(512349457,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: not HighlightDivIndex.Marquee."),!1;ca=Object(xf.a)(lf,ca.metadata);return ca?ca.y_a&&!ca.CHc:(Va.ULS.shipAssertTag(512349456,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: marqueeMetadata is null."),!1)}vvb(ca,bb){Va.ULS.sendTraceTag(512349455,
0,50,"FormulaHighlightsControl.suspendResumeFormulaHighlights: "+(bb?"suspending":"resuming")+" formula highlights");bb&&this.IYa&&(this.IYa=!1,this.highlightRanges(null,null),ca.Za.SYh());this.y0g=bb}dispose(){this.da&&this.da.Rb&&this.da.Rb.gq(this.XJa)}pUf(ca){this.formulaAssistanceTelemetryManager.RMa(["highlightPreviewRanges"]);var bb=this.LLd(ca,dg);if(isNullOrUndefined(bb))this.NEc&&this.highlightRanges(null,null);else{var Hb=this.rNd(),Vb=[],Ec=new Qa.a(!1),rd=[];bb=bb.formulaHighlights;for(const Id of bb)if(bb=
Id.kind,bb===dc.HighlightKind.CellRef||bb===dc.HighlightKind.NamedRange||bb===dc.HighlightKind.StructRef)bb=$b.D(Id.rangeInfo.range),Object(Pd.b)(bb)&&(Vb.push(new Jf.a(bb,Hb)),this.dzc(bb,Ec,1),rd.push(new lf(Id.span.start,ca.substring(Id.span.start,Id.span.end),x(Id),!0)));this.highlightRanges(Vb,Ec,3,rd);this.formulaAssistanceTelemetryManager.o1(["highlightPreviewRanges"],!0)}}R2i(ca,bb){bb=void 0===bb?[]:bb;var Hb;const Vb=null===(Hb=this.LLd(ca,dg))||void 0===Hb?void 0:Hb.formulaHighlights.filter(W=>
!bb.includes(W.kind));if(!Vb)return null;const {M0c:Ec,xCg:rd,vCg:Id}=this.CJf(Vb,ca);return{M0c:Ec,highlightRanges:W=>W?this.highlightRanges(rd,Id,28):this.TYh()}}TYh(){this.highlightRanges(null,null,28)}zdl(ca,bb){ca&&this.formulaAssistanceTelemetryManager.DId.formulaHighlightsCounter++;bb&&this.formulaAssistanceTelemetryManager.DId.parenthesesCouplingCounter++}hAe(ca){this.p5g&&!this.IYa||this.highlightRanges(null,null);return this.IYa&&(this.IYa=!1,ca)?!0:!1}Z3i(ca,bb,Hb){let Vb=Hb;Object(Pd.b)(bb)?
Object(Pd.b)(Hb)||(Vb={index:bb.length,length:0}):Vb=ca.Za.selection;return Vb}LLd(ca,bb){if(this.Dvj({content:ca,selection:bb}))return this.sO.result;this.formulaAssistanceTelemetryManager.RMa(["formulaHighlightsRequest"]);const Hb=this.pluginScheduler.syncRequester().formulaHighlighting({content:ca,caretPosition:bb.index,selectionLength:bb.length},this.VA.X2a,null);this.sO={content:ca,selection:bb,result:Hb};this.formulaAssistanceTelemetryManager.o1(["formulaHighlightsRequest"]);return Hb}dzc(ca,
bb,Hb){let Vb=bb.getItem(ca.toString());Vb||(Vb=Pf[bb.count%Pf.length],bb.add(ca.toString(),Vb));return String.format(Vb,Hb)}qFb(ca,bb,Hb,Vb,Ec,rd){Ec=void 0===Ec?null:Ec;rd=void 0===rd?null:rd;Va.ULS.shipAssertTag(512349453,0,Hb<=Vb,"FormulaHighlightsControl.AddTextPart: startIndex cannot be larger than endIndex");Hb<Vb&&(bb=bb.substring(Hb,Vb),Hb=Tb.a.hs()&&Ec?(Rf.indexOf(Ec)+1).toString():null,ca.push(Object(Tc.a)(new tf.a,{text:bb,color:Ec,backgroundColor:rd,highlightClass:Hb})))}highlightRanges(ca,
bb,Hb,Vb){Hb=void 0===Hb?3:Hb;Vb=void 0===Vb?null:Vb;Va.ULS.shipAssertTag(508350945,0,3===Hb||null===Vb,"FormulaHighlightsControl.HighlightRanges: marqueeMetadatas param was passed although the divIndex isn't maquee");const Ec=3===Hb&&Object(Pd.b)(Vb);ca&&ca.length?(Va.ULS.sendTraceTag(512349452,0,50,"FormulaHighlightsControl.HighlightRanges: number of ranges to highlight: "+ca.length),ca.reverse(),Ec&&Vb.reverse(),this.da.Ub.HL(ca,[Hb],!0,(rd,Id)=>{if(rd&&rd.range&&Id){Va.ULS.shipAssertTag(512349448,
0,bb.Bb(rd.range.toString()),`FormulaHighlightsControl.HighlightRanges: The range '${rd.range.toString()}' doesn't exist in the range to color dictionary`);var W=this.dzc(rd.range,bb,.1),Ra=this.dzc(rd.range,bb,1);this.$.frame&&this.$.frame.jI&&this.$.frame.jI.oU||(Id.style.background=W);Id.style.borderColor=Ra;Ec&&(Id.setAttribute(Z.a.ASb,rd.mia.toString()),rd.metadata=Vb[rd.mia])}else Va.ULS.shipAssertTag(512349451,0,!!rd,"FormulaHighlightsControl.HighlightRanges: state is null"),Va.ULS.shipAssertTag(512349450,
0,!!rd.range,"FormulaHighlightsControl.HighlightRanges: state.Range is null"),Va.ULS.shipAssertTag(512349449,0,!!Id,"FormulaHighlightsControl.HighlightRanges: div is null")})):0!==this.da.Ub.MJd([Hb]).length&&(ca=this.$.Vb.Uc("UserAction","HideRangesHighlightsStopwatch"),this.da.Ub.rl([Hb]),this.da.Ub.Rtb(new Jf.a(null,this.rNd()),[Hb]),ca.stop())}kNk(ca,bb,Hb){const Vb=ca.Za;Vb.mI=!0;var Ec=Vb.selection;const rd=Ec.index;Ec=rd+Ec.length;Vb.setTextFromTextParts(bb);bb=Vb.text.length;Vb.selectRange(Math.min(rd,
bb),Math.min(Ec,bb));Hb&&ca.f2b(new Cf.a);Vb.mI=!1}hXi(){return this.da.Nw&&this.da.Nw.lR?this.da.Nw.lR:this.$.la}rNd(){return this.hXi().sheetId}CJf(ca,bb){const Hb=[],Vb=new Qa.a(!1),Ec=[],rd=[],Id=[];let W=!1;var Ra=!1;let nc=0;const yc=this.rNd();for(const Fd of ca){this.qFb(Ec,bb,nc,Fd.span.start);switch(Fd.kind){case dc.HighlightKind.CellRef:case dc.HighlightKind.StructRef:case dc.HighlightKind.NamedRange:ca=$b.D(Fd.rangeInfo.range);if(isNullOrUndefined(ca)){Va.ULS.sendTraceTag(512349464,0,
10,`FormulaHighlightsControl.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${Fd.kind.toString()}`);this.qFb(Ec,bb,Fd.span.start,Fd.span.end);break}Ra=this.dzc(ca,Vb,1);this.qFb(Ec,bb,Fd.span.start,Fd.span.end,Ra,null);Hb.push(new Jf.a(ca,yc));rd.push({Start:Fd.span.start,End:Fd.span.end});Ra=Ec.length-1;Id.push(new lf(Ra,Ec[Ra].text,x(Fd)));Ra=!0;break;case dc.HighlightKind.Parentheses:this.qFb(Ec,bb,Fd.span.start,Fd.span.end,null,"rgb(229, 229, 229)"),
W=!0}nc=Fd.span.end}this.qFb(Ec,bb,nc,bb.length);this.zdl(Ra,W);return{M0c:Ec,xCg:Hb,vCg:Vb,dKj:Id}}Dvj(ca){return Object(Pd.b)(this.sO)&&this.sO.content===ca.content&&this.sO.selection.index===ca.selection.index&&this.sO.selection.length===ca.selection.length}}Object($a.a)(Mf,"FormulaHighlightsControl",null,[733,4]);var zf=a(88),df=a(81),Bf=a(684);Object(Zb.b)(uc.FormulaAssistanceManagerService,{we:"singleton"})(async ca=>{var bb,Hb=await Zb.a.resolve(uc.EwaControlService,ca);const Vb=await Zb.a.resolve(uc.TableManagerService,
ca),Ec=await Zb.a.resolve(uc.SharedUIControlsFactoryService,ca);var rd=null!==(bb=null===ca||void 0===ca?void 0:ca.xa)&&void 0!==bb?bb:0;rd=await Object(zf.e)(df.GetServiceTaskFactory.create(Hb.ra,449,Hb.Aa,rd));const Id=await Zb.a.resolve(Bf.f,ca),W=await Zb.a.resolve(uc.CalcManagerService,ca);bb=await Zb.a.resolve(uc.FormulaAssistanceReadoutHandlerService,ca);const Ra=await Zb.a.resolve(Bf.d,ca),nc=await Zb.a.resolve(uc.FunctionInfoManagerService,ca);ca=cc.EwaSettings.kGc()?await Zb.a.resolve(uc.DefinedNameManagerService,
ca):null;Hb=new Kf(Hb,nc,W,Id,rd,Ra,Ec.fkf(Hb,Vb),ca);bb.LLh(Hb.ayc);bb.MLh(Hb.dta);bb.NLh(Hb.dta);return Hb});class Kf{constructor(ca,bb,Hb,Vb,Ec,rd,Id,W){this.$=ca;this.XA=bb;this.Yd=Hb;this.pluginScheduler=Vb;this.formulaAssistanceUIControl=Ec;this.formulaAssistanceTelemetryManager=rd;this.lp=Id;this.VH=W;this.ZUd=this.isCellContentOnlyEqualDuringEdit=!1;this.eXb=null;this.IJc=-1;this.Rla=0;this.Nlb=!1;this.Vtj=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8842481_FAOnlyRequestInEdit");this.wqj=
cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8920295_FixNullDefinedNames");this.jd=(Ra,nc)=>{nc.Hg||nc.elb||this.pluginScheduler.notifier().notifyWorkbookClosing()};this.onActiveCellChanged=(Ra,nc)=>{this.da.isEditing||this.da.nk||this.Jhg(null===nc||void 0===nc?void 0:nc.cell)};this.onFunctionInfoLoaded=()=>{this.L8g();this.wma()};this.tWj=()=>{this.Kze();this.wma()};this.xjg=(Ra,nc)=>{var yc=this.qd;Ra=yc.text;yc=yc.Za.caretPosition;0<this.Rla&&this.formulaAssistanceTelemetryManager.Rqa.commitWhileRequestPending++;
this.formulaAssistanceTelemetryManager.RMa(["argumentAssistanceComputation","argumentAssistanceOverall"]);nc.shouldRequestAutocompleteOnCommit?this.POg(Ra,yc):this.Exk(Ra,yc)};this.wg=()=>{this.isCellContentOnlyEqualDuringEdit&&(this.formulaAssistanceTelemetryManager.kQ.isCellContentOnlyEqualDuringEditCounter++,this.isCellContentOnlyEqualDuringEdit=!1);this.ZUd&&(this.formulaAssistanceTelemetryManager.kQ.isCellContentFormulaCounter++,this.ZUd=!1);cc.EwaSettings.isChangeGateEnabled("OfficeVSO:6103891_dismissControlOnEditEnded")&&
this.UBd()};this.$Ja=(Ra,nc)=>{Object(fe.e)(()=>{this.MBk(nc.newValue)})};this.Ij=()=>{this.Kze()};this.Kze=()=>{const Ra=this.Nlb?this.JOi():this.lei.mei;this.pluginScheduler.notifier().setDefinedNamesInfo(Ra);Va.ULS.sendTraceTag(512278605,0,50,`FormulaAssistanceManager.updateDefinedNamesList updated defined names info with ${null===Ra||void 0===Ra?void 0:Ra.length} names}`)};this.Yig=(Ra,nc)=>{this.pluginScheduler.notifier().setActiveCellFormat(nc)};this.XA=bb;this.formulaAssistanceUIControl=Ec;
this.pluginScheduler=Vb;this.da=pa.f(this.$);this.Nlb=cc.EwaSettings.kGc()&&Object(Pd.b)(this.VH);this.lei=new wf(ca);this.Nlb?this.VH.R4e(this.tWj):this.da.za.Or(this.Ij);this.Kze();this.I9a=new Ic(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.Fga=new yd(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.sZk=Tb.a.qlb(ca);this.Fmj=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AuthoringPerCharExp",!1);this.bxj=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.x10AutocompleteWrapperPluginIsEnabled",
!1);this.L9a=new Mf(this.$,this.pluginScheduler,this,this.formulaAssistanceTelemetryManager);this.Yd=Hb;this.tij();this.da.cellTextEditBox.Uq(this.wg);this.XA.qlc(this.onFunctionInfoLoaded);this.XA.yka?this.L8g():this.XA.Egb({})}get dta(){return this.Fga}get ayc(){return this.I9a}get WA(){return this.L9a}get X2a(){return this.qd.bvj?dc.PluginGroup.Python:dc.PluginGroup.Excel}get qd(){return this.da.Ej}get Eb(){return this.da.Eb}dispose(){var ca;if(this.$){const bb=this.da;bb&&(bb.ha&&bb.ha.wxa(this.onActiveCellChanged),
!this.Nlb&&bb.za&&bb.za.Gq(this.Ij));this.$.ro(this.jd)}null===(ca=this.Yd)||void 0===ca?void 0:ca.Crk(this.Yig);this.da.cellTextEditBox.gq(this.wg);this.Fga.ksk(this.xjg);this.XA&&this.XA.Bie(this.onFunctionInfoLoaded);this.qd&&this.qd.TTc(this.$Ja);xa.a.vb(this.I9a);xa.a.vb(this.Fga);this.Fga=this.I9a=this.XA=this.$=null}iyk(){this.IJc=-1;this.eXb=null}UBd(){this.Fga.visible=!1;this.I9a.visible=!1}Ok(){this.wma();return!1}wma(){if((!this.Vtj||this.da.isEditing)&&!this.qd.oV)if(this.formulaAssistanceTelemetryManager.Krd.formulaAssistanceRequestAttemptedCounter++,
this.lSk()){var ca=this.qd,bb=ca.text;ca=ca.Za.caretPosition;bb.startsWith("=")&&(this.ZUd=!0,1===bb.length&&(this.isCellContentOnlyEqualDuringEdit=!0));this.formulaAssistanceTelemetryManager.RMa("argumentAssistanceComputation autoCompleteComputation autoCompleteComputationNoResult argumentAssistanceOverall autoCompleteOverall autoCompleteOverallSmartOnly autoCompleteOverallSimpleOnly autoCompleteOverallSimpleAndSmart".split(" "));this.POg(bb,ca);this.Fmj&&this.Pxk(bb,ca)}else this.formulaAssistanceTelemetryManager.Krd.formulaAssistanceRequestOptimizedCounter++}POg(ca,
bb){const Hb=this.pluginScheduler.batchRequester().functionSuggestionAndArgumentAssistance({functionSuggestion:{content:ca,caretPosition:bb},argumentAssistance:{content:ca,caretPosition:bb},inCellSuggestion:{content:ca,caretPosition:bb}},this.X2a,null);this.Rla+=1;this.eXb=ca;this.IJc=bb;Hb.then(Vb=>{--this.Rla;"Done"===Vb.kind&&(this.yQf(Vb.payload.argumentAssistance),this.$7i(Vb.payload.functionSuggestion,ca));return null})}Pxk(ca,bb){bb={content:ca,caretPosition:bb,enableAutocompleteWrapperPlugin:this.bxj&&
!this.sZk};bb=this.pluginScheduler.requester().runPerCharacterExperiment(bb,this.X2a,null);this.Rla+=1;bb.then(Hb=>{--this.Rla;if("Done"===Hb.kind)for(const Vb of Hb.payload.results)Vb.kind===dc.PerCharacterExperimentResultKind.AutocompleteWrapperPluginResult&&this.da.dFa.FRg(Vb.value,ca);return null})}Exk(ca,bb){const Hb={content:ca,caretPosition:bb};this.eXb=ca;this.IJc=bb;ca=this.pluginScheduler.requester().argumentAssistance(Hb,this.X2a,null);this.Rla+=1;ca.then(Vb=>{--this.Rla;"Done"===Vb.kind&&
this.yQf(Vb.payload)})}lSk(){var ca=this.qd;const bb=ca.text;ca=ca.Za.caretPosition;return this.Fga.visible&&fb.a.equals(bb,this.eXb,!0)&&!Fe.e(bb)&&ca===this.IJc?!1:!0}SBk(){void this.pluginScheduler.requester().runExperiment({},this.X2a,null)}yQf(ca){ca&&this.qd.isEditing?(this.formulaAssistanceTelemetryManager.o1(["argumentAssistanceComputation"]),this.I9a.show(ca)):this.I9a.dismiss()}$7i(ca,bb){ca&&0<ca.items.length&&this.qd.isEditing&&this.qd.text===this.eXb?this.Eb.tU(this.da.ha.oa.activeCell)?
(this.formulaAssistanceTelemetryManager.kQ.smartSuggestionWouldSuggestInsidePivotCounter++,this.Fga.dismiss()):(this.formulaAssistanceTelemetryManager.o1(["autoCompleteComputation"]),this.Fga.show(ca)):this.Fga.dismiss();this.da.dFa.FRg(ca,bb);ca&&0!==ca.items.length||this.formulaAssistanceTelemetryManager.o1(["autoCompleteComputationNoResult"])}MBk(ca){ca={content:ca,isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};void this.pluginScheduler.requester().runAuthoringExperiment(ca,
this.X2a,null)}Jhg(ca){var bb;const Hb=this.da.ha.oa.activeCell;if(Hb){var Vb=this.Yd.RJb(Hb,!1);if(Vb){var Ec=this.$.qa,rd=Vb.sheet.index;0>=Ec.count||0>rd||rd>=Ec.count?Va.ULS.sendTraceTag(512278608,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${Ec.count}, currentSheetIndex = ${rd}.`):(rd=Ec=null,void 0!==this.Yd&&null!==this.Yd&&(ca=null!==(bb=null===ca||void 0===ca?void 0:ca.cell)&&void 0!==bb?bb:this.da.za.ft(Hb))&&(bb=this.Yd.ALf(ca.oi),void 0!==
bb&&null!==bb&&(Ec=bb.FormatString,rd=bb.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:Vb.range.col,rowIndex:Vb.range.row,sheetIndex:this.$.qa.getItem(Vb.sheet.index).sheetId,docName:Vb.sheet.document.name,docPath:Vb.sheet.document.path,formatString:Ec,builtIn:rd}),Va.ULS.sendTraceTag(512278607,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged sent notification to the scheduler. col: ${Vb.range.col}, row: ${Vb.range.row}`))}else Va.ULS.sendTraceTag(537162002,0,50,"FormulaAssistanceManager.NotifyActiveCellChanged ISheetGridCell location is null")}else Va.ULS.sendTraceTag(512278609,
0,50,"FormulaAssistanceManager.NotifyActiveCellChanged activeCell range is null")}L8g(){const ca=this.XA.fEf;this.pluginScheduler.notifier().setFunctionsInfo(ca);Va.ULS.sendTraceTag(512278606,0,50,`FormulaAssistanceManager.updateSchedulerFunctionList update functions info with ${null===ca||void 0===ca?void 0:ca.length} functions}`)}tij(){this.da.ha.JCa(this.onActiveCellChanged);this.Yd.wCh(this.Yig);const ca=this.da.Ob(null);this.Jhg(ca);this.qd.zFb(this.$Ja);this.SBk();this.Fga.kDh(this.xjg);this.pluginScheduler.setServerDataProvider(new He(this.lp,
this.$));this.wma();this.$.Sj(this.jd)}JOi(){const ca=this.VH.getItems(bb=>Object(Pd.b)(bb));return this.wqj&&Object(Pd.c)(ca)?[]:ca.map(bb=>{var Hb=bb.name;a:switch(bb.type){case Pe.a.NamedRange:case Pe.a.Table:var Vb=bb.referenceSheetName&&bb.topLeft&&bb.bottomRight?`${bb.referenceSheetName}!${bb.topLeft}:${bb.bottomRight}`:bb.reference;break a;default:Vb=bb.comment}var Ec=k(bb);a:switch(bb.type){case Pe.a.NamedRange:case Pe.a.Table:var rd=Object($b.E)(bb.topLeft);const Id=Object($b.E)(bb.bottomRight);
rd={top:rd.top,left:rd.left,bottom:Id.bottom,right:Id.right,maxRows:rd.maxRows,maxColumns:rd.maxColumns,sheetName:bb.referenceSheetName};break a;default:rd=null}return{name:Hb,tooltip:Vb,type:Ec,namedRange:rd,sheetName:bb.referenceSheetName,reference:bb.reference}})}}Object($a.a)(Kf,"FormulaAssistanceManager",null,[722,4]);var Vf;let sb=Vf=class{constructor(ca,bb){this.ariaLiveNotifier=ca;this.$=bb;this.DWa=this.TFa=this.cta=null;this.hrg=(Hb,Vb)=>{this.Mkk(Vb.functionName,Vb.gEf)};this.jrg=(Hb,Vb)=>
{this.Jkk(Vb.gEf,Vb.BOg,Vb.mzl)};this.irg=(Hb,Vb)=>{Hb=[];for(var Ec of Vb.BOg)void 0!==Ec&&null!==Ec&&(Vb=Ec.trim())&&Hb.push(Vb);if(Hb.length){Ec="";for(Vb=0;Vb<Hb.length;Vb++){const rd=this.atd(Hb[Vb]),Id=Vf.Zce(Vb,Hb.length);Ec+=rd+Id;Id&&(Ec+=this.ariaLiveNotifier.P0a)}this.ariaLiveNotifier.readText(Ec)}};this.krg=(Hb,Vb)=>{this.ariaLiveNotifier.Okk(Vb.EL,Vb.description,Vb.selectedIndex.toString(),Vb.length.toString())};this.drg=(Hb,Vb)=>{this.ariaLiveNotifier.jDg(Vb.description,Vb.length)};
this.Smg=()=>{this.ariaLiveNotifier.gLa(jc.a.instance.ia(884),Z.a.gDa)};this.Gmg=()=>{this.ariaLiveNotifier.readText(jc.a.instance.ia(885))};this.Omg=()=>{this.ariaLiveNotifier.readText(jc.a.instance.ia(886))}}dispose(){this.jze();this.DWa=this.TFa=this.cta=null}LLh(ca){ca&&(this.cta=ca,this.cta.ZDh(this.hrg),this.cta.cGh(this.jrg),this.cta.bGh(this.irg))}MLh(ca){ca&&(this.TFa=ca,this.TFa.YDh(this.Smg),this.TFa.UDh(this.Gmg),this.TFa.XDh(this.Omg))}NLh(ca){ca&&(this.DWa=ca,this.DWa.dGh(this.krg),
this.DWa.Aod(this.drg))}jze(){var ca,bb,Hb;this.cta&&(this.cta.Usk(this.hrg),this.cta.Luk(this.jrg),this.cta.Kuk(this.irg));this.DWa&&(this.DWa.Muk(this.krg),this.DWa.Mie(this.drg));null===(ca=this.TFa)||void 0===ca?void 0:ca.Tsk(this.Smg);null===(bb=this.TFa)||void 0===bb?void 0:bb.Psk(this.Gmg);null===(Hb=this.TFa)||void 0===Hb?void 0:Hb.Ssk(this.Omg)}Mkk(ca,bb){if(bb){let Hb="";for(let Vb=0;Vb<bb.length;Vb++)Hb+=ca+this.ariaLiveNotifier.P0a+this.atd(bb[Vb])+Vf.Zce(Vb,bb.length);Hb+=jc.a.instance.ia(883)+
this.ariaLiveNotifier.P0a;this.ariaLiveNotifier.readText(Hb)}}Jkk(ca,bb,Hb){if(ca){let Ec="",rd=0;if(bb){for(let Id=0;Id<bb.length;Id++){if(Hb>=ca[Id].split(this.$.listSeparator).length){rd++;continue}var Vb=bb[Id].trim();if(!Vb)return;Vb=this.atd(Vb);const W=Vf.Zce(Id-rd,bb.length-rd);Ec+=Vb+W;W&&(Ec+=this.ariaLiveNotifier.P0a)}this.ariaLiveNotifier.readText(Ec)}}}atd(ca){if(!ca)return"";var bb=ca.split(this.$.listSeparator);ca="";for(const Hb of bb){if(Vf.Bpj(Hb))ca+=Hb;else{const Vb=(bb=Vf.duj(Hb))?
Hb.replace("[","").replace("]",""):Hb;ca+=String.format(bb?jc.a.instance.Ib(59):jc.a.instance.Ib(58),Vb)}ca+=this.ariaLiveNotifier.P0a}return ca}static Zce(ca,bb){return ca>=bb||1===bb?(Va.ULS.shipAssertTag(537161997,0,ca<bb,"FormulaAssistanceControl.PositionInList: requested item index >= list length."),""):String.format(jc.a.instance.Ib(55),ca+1,bb)+"\r\n"}static Bpj(ca){return fb.a.contains(ca,af.a.Qrf,!0)}static duj(ca){return ca.trimStart().startsWith(af.a.S8j)||ca.trimEnd().endsWith(af.a.R8j)}};
sb=Vf=Object(hb.__decorate)([Object(Zb.d)(uc.FormulaAssistanceReadoutHandlerService),Object(hb.__param)(0,Object(uc.AriaLiveNotifierService)()),Object(hb.__param)(1,Object(uc.EwaControlService)())],sb);Object($a.a)(sb,"FormulaAssistanceReadoutHandler",null,[721,4]);let Gc=class{constructor(ca){this.formulaAssistanceValuePreview=ca}gd(){return!1}executeCommand(ca,bb){ca=!1;bb=bb.command;switch(bb){case -46938080:this.formulaAssistanceValuePreview.trigger(),ca=!0}return ca?Ud.Task.Va(!0):ud.a(bb)}Rc(ca,
bb){return-46938080===bb.command}td(){return!1}};Gc=Object(hb.__decorate)([Object(Zb.d)(uc.FormulaAssistanceValuePreviewCommandHandlerService),Object(hb.__param)(0,Object(Bf.e)())],Gc);Object($a.a)(Gc,"FormulaAssistanceValuePreviewCommandHandler",null,[29]);var ad=a(124),Wd=a(36),je=a(61);class Ie{constructor(ca,bb){this.$=ca;this.da=bb;this.isEnabled=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ValuePreviewValidation",!1)}get xEi(){Object(Pd.c)(this.zMe)&&(this.zMe=Zb.a.resolve(uc.FormulaAnonymizerService,
{xa:1}));return this.zMe}async uXh(ca,bb,Hb,Vb,Ec){if(this.isEnabled&&("Success"===bb.kind||"Failure"===bb.kind)){var rd=bb.evaluatedFormula;if(!Object(Pd.c)(rd)&&""!==rd){var Id={};Id.locale=this.BKf();var W=this.da.ha.oa.activeCell;Object(Pd.b)(W)?Id.anonymizationOrigin="activeCell":(Id.anonymizationOrigin="A1",W=wb.Range.Hc(0,0));try{const Ra=await this.xEi;Id.formula=Ra.anonymize(ca.text,W);Id.subFormula=Ra.anonymize(rd,W)}catch(Ra){Id.formula="FAIL",Id.subFormula="FAIL"}Id.clientResult=this.DK(bb);
try{const Ra=this.AOd(),nc=await Vb(ca.text,rd,Ec),yc=this.AOd();Id.serverResult=this.DK(nc);Id.diagnostics=this.g1h(Id.clientResult,Id.serverResult);Id.stateId={beforeX10:Hb,beforeServer:Ra,server:nc.stateId,afterServer:yc}}catch(Ra){Id.diagnostics={kind:"error",message:Ra}}"Success"===bb.kind&&(Id.isVolatile=bb.isVolatile);h(Id);Va.ULS.sendTraceTag(508831819,1,20,`ValuePreviewResultValidator.checkClientResultVsServer, result: ${JSON.stringify(Id)}`)}}}AOd(){return{latest:this.$.fa.Je,successful:this.$.fa.Cw}}BKf(){const ca=
{ui:this.$.O4,data:this.$.dataCultureTag},bb=Zb.a.Cb(uc.InstantaneousSupportInformationManagerService);Object(Pd.b)(bb)&&(ca.calcLcid=bb.Ze.Lcid);return ca}DK(ca){switch(ca.kind){case "Failure":return{kind:"failure",reason:ca.reason};case "Success":return{kind:"success",value:ca.value,unformattedValue:ca.unformattedValue,operKind:ca.operKind};default:return{kind:"unexpected"}}}g1h(ca,bb){return"unexpected"===ca.kind||"unexpected"===bb.kind?{kind:"unexpected"}:"success"===ca.kind&&"success"===bb.kind?
this.k1h(ca,bb):"failure"===ca.kind&&"failure"===bb.kind?{kind:"equal"}:{kind:"failure",source:"failure"===ca.kind?"client":"server"}}k1h(ca,bb){const Hb=d(ca.value,bb.value);if("equal"===Hb.kind)return Hb;const Vb=ca.unformattedValue,Ec=bb.unformattedValue,rd=d(Vb,Ec);return 2===ca.operKind&&2===bb.operKind&&2===Math.abs(Vb.length-Ec.length)&&(ca=Vb.length>Ec.length?"client":"server",Vb.trim()===Ec.trim())?{kind:"padded",source:ca}:{kind:"different",diff:Hb.diff,unformatted:rd}}}Object($a.a)(Ie,
"ResultValidator",null,[]);var Je=a(172),$e=a(327),Ib=a(33);class Nb{constructor(ca){this.sfg=ca;this.lZ=Object.assign({},Af);this.igb=[];this.KLc=-1;(this.rfg=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:5999949_formulaTelemetryMetriThresholds"))&&ca&&(this.lZ.countAboveThresholds={},ca.forEach(bb=>this.lZ.countAboveThresholds[bb]=0))}static get W0c(){return Ib.a.zb.me.m}p6a(){this.KLc=Nb.W0c}n1(ca,bb){bb=void 0===bb?null:bb;if(-1!==this.KLc||Object(Pd.b)(bb))ca?(this.Pkc(Nb.W0c-(bb||this.KLc)),
this.KLc=-1):this.lZ.failedCount++}KGd(){this.lZ.excludingFirstAction=Nb.rBf(this.igb);this.igb.push(this.lZ.firstAction);this.lZ.includingFirstAction=Nb.rBf(this.igb)}Pkc(ca){this.lZ.count?1E3>this.lZ.count&&this.igb.push(ca):this.lZ.firstAction=ca;this.rfg&&this.sfg&&this.sfg.forEach(bb=>{ca>bb&&this.lZ.countAboveThresholds[bb]++});this.lZ.count++}static rBf(ca){const bb=Object.assign({},Bc);0<ca.length&&($e.b(ca),bb.median=ca[Math.floor(.5*ca.length)],bb.P75=ca[Math.floor(.75*ca.length)],bb.P95=
ca[Math.floor(.95*ca.length)],bb.max=ca[ca.length-1],bb.average=ca.reduce((Hb,Vb)=>Hb+Vb)/ca.length);return bb}}Object($a.a)(Nb,"PerformanceMeasurement",null,[]);const Bc={average:0,max:0,median:0,P75:0,P95:0},Af={count:0,countAboveThresholds:void 0,failedCount:0,firstAction:0,includingFirstAction:Object.assign({},Bc),excludingFirstAction:Object.assign({},Bc)};class gf{constructor(ca){this.$=ca;this.UP=this.TKb=null;this.usage={};this.qVc={};this.performance={};this.details={};this.Ula=-1;this.jd=
(bb,Hb)=>{Hb.Hg||Hb.elb||this.$.sendBeaconTraceTag(388818255,50,!1,this.q9b())};this.editBox=Object(pa.f)(this.$).Rb;ca.Sj(this.jd)}static getInstance(ca){return gf.instance||(gf.instance=new gf(ca))}set trigger(ca){this.TKb=ca;this.Ula=Nb.W0c}set $Kg(ca){this.UP=ca}b4b(ca){Object(Pd.c)(this.details.color)&&(this.details.color={});Object(Pd.c)(this.details.color[ca])&&(this.details.color[ca]=0);this.details.color[ca]++}setResult(ca,bb){if(Object(Pd.c)(this.TKb))Va.ULS.sendTraceTag(512258439,0,15,
"ValuePreviewTelemetry.setResult - currentTrigger undefined");else if("Failure"!==ca.kind||ca.timeout){var Hb=bb===this.editBox?"cellEditor":"formulaBar",Vb=this.TKb;bb=this.UP;var Ec=this.Ula;Object(Pd.c)(this.usage[Hb])&&(this.usage[Hb]={});Object(Pd.c)(this.usage[Hb][Vb])&&(this.usage[Hb][Vb]={success:0,error:0,loading:0,timeout:0});Hb=this.usage[Hb][Vb];switch(ca.kind){case "Success":8===ca.operKind?Hb.error++:(this.umk(ca.value),Hb.success++);this.TKb=this.UP=null;this.Ula=-1;this.o1(bb,Ec);
break;case "Loading":Hb.loading++;break;case "Failure":this.TKb=this.UP=null,this.Ula=-1,ca.timeout&&Hb.timeout++}}}umk(ca){if(!Object(Pd.c)(this.UP)){Object(Pd.c)(this.qVc[this.UP])&&(this.qVc[this.UP]=[]);var bb=this.qVc[this.UP];1E3>bb.length&&bb.push(ca.length)}}o1(ca,bb){if(-1!==bb){ca=null!==ca&&void 0!==ca?ca:"cache";this.mQb(`${ca}_request`).n1(!0,bb);var Hb=this.mQb(`${ca}_overall`);window.requestAnimationFrame(()=>{Hb.n1(!0,bb)})}}mQb(ca){return this.performance[ca]=this.performance[ca]||
new Nb(Qe)}q9b(){const ca={};Object.keys(this.performance).forEach(bb=>{this.performance[bb].KGd();var Hb=this.performance[bb];ca[bb]={metrics:Hb.lZ,durations:Hb.igb}});return`{"usage":${JSON.stringify(this.usage)},"resultLengths":${JSON.stringify(this.qVc)},"performance":${JSON.stringify(ca)},"details":${JSON.stringify(this.details)}}`}}Object($a.a)(gf,"ValuePreviewTelemetry",null,[]);const Qe=[50,80,100,130,150,170,200],Aa=(ca,bb)=>{bb=void 0===bb?!1:bb;const Hb=gf.instance;if(Object(Pd.c)(ca))return bb&&
Hb.b4b("none"),null;if("string"==typeof ca){ca=Je.a.sMc[ca.toLowerCase()];if(Object(Pd.c)(ca))return bb&&Hb.b4b("badString"),null;bb&&Hb.b4b("string");return ca}if("number"==typeof ca)return bb&&Hb.b4b("number"),null;bb&&Hb.b4b("other");return null};class Fb{constructor(ca,bb){this.$=ca;this.pluginScheduler=bb;this.sO=new Ta(u);this.$Yc=!0;this.aqj=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8544629_ValuePreviewFailureCaching");this.uIc=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8561808_ValuePreviewSnapshotActiveCell");
this.wuf=async(Hb,Vb,Ec)=>new Promise((rd,Id)=>{const W={Formula:Vb,IsWholeFormula:Hb===Vb,ActiveCell:this.T0i(Ec)};var Ra=this.$.ma.sa;rd=this.U4j(rd);Id=this.T4j(Id);const nc=Ra.$a(1,null);nc.evaluationParameters=W;je.h(Ra,"EvaluatePartialFormula",nc,rd,Id,null,null,128)});this.U4j=Hb=>Vb=>{if(Object(Pd.c)(Vb.Result))Hb({kind:"Failure",reason:"No result",stateId:Vb.StateId});else{var Ec=Vb.Result,rd=l(Ec.Value);Object(Pd.b)(rd)?Hb({kind:"Failure",reason:rd,stateId:Vb.StateId}):Hb({kind:"Success",
value:Ec.Value,unformattedValue:Ec.UnformattedValue,operKind:Ec.OperKind,color:Ec.Color,stateId:Vb.StateId})}};this.T4j=Hb=>Vb=>{Vb=ad.a.te(Vb.data);Vb=Wd.a.pc(Vb);Hb(`Request failed, Errors: ${Vb}`)};this.da=Object(pa.f)(this.$);this.VA=Zb.a.Cb(uc.FormulaAssistanceManagerService);this.bLg=new Ie(this.$,this.da);this.Yw=gf.getInstance(ca)}clearCache(){this.sO.clear()}async Bke(ca,bb,Hb){this.$Yc=void 0===Hb?!1:Hb;ca=this.request(ca);let Vb;Hb=new Promise(Ec=>{Vb=window.setTimeout(()=>{Ec({kind:"Failure",
timeout:!0})},bb)});return Promise.race([ca,Hb]).finally(()=>{window.clearTimeout(Vb)})}async request(ca){return n(this.sO,ca,async()=>{var bb;let Hb=null;var Vb=null;this.uIc&&(Hb=Object($b.r)(this.da.ha.oa.activeCell,this.$),Vb={sheetName:null===(bb=this.$.la)||void 0===bb?void 0:bb.sheetId,namedObjectName:null,firstRow:Hb.FirstRow,firstColumn:Hb.FirstColumn});Vb=this.uIc?Object.assign({},ca,{activeCell:Vb}):ca;bb=this.bLg.AOd();Vb=await this.pluginScheduler.requester().valuePreview(Vb,this.VA?
this.VA.X2a:dc.PluginGroup.Excel,null);if("Done"!==Vb.kind)return"Superseded"===Vb.kind&&this.sO.delete(ca),null;Vb=Vb.payload;if(Object(Pd.c)(Vb))return{kind:"Failure"};this.$Yc&&(this.Yw.$Kg="client",void this.bLg.uXh(ca,Vb,bb,this.wuf,Hb));switch(Vb.kind){case "Failure":return this.aqj&&this.sO.delete(ca),{kind:"Failure"};case "Success":return Vb.isVolatile&&this.sO.delete(ca),this.xil(Vb);case "Unavailable":return void this.GHj(ca.text,Vb),this.sO.delete(ca),this.Lxk({text:ca.text,index:Vb.index,
length:Vb.length},ca,ca.text,Vb.evaluatedFormula,Hb,!Vb.isVolatile)}})}xil(ca){ca=Object.assign({},ca,{color:Aa(ca.color,this.$Yc)});const bb=l(ca.value);return Object(Pd.b)(bb)?(Va.ULS.sendTraceTag(509871621,1,15,`FormulaAssistanceValuePreviewRequester.validateClientSuccessResult: formula failure:${bb}, kind:${ca.kind}`),{kind:"Failure"}):ca}async Lxk(ca,bb,Hb,Vb,Ec,rd){return m(this.sO,ca,bb,rd,()=>(new Promise(async(Id,W)=>{try{const Ra=await this.wuf(Hb,Vb,Ec);this.$Yc&&(this.Yw.$Kg="server");
"Success"===Ra.kind?Id({kind:"Success",value:Ra.value,index:ca.index,length:ca.length,color:Ra.color,operKind:Ra.operKind}):(Va.ULS.sendTraceTag(508831818,1,50,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula failed, ${Ra.reason}`),Id({kind:"Failure"}))}catch(Ra){Va.ULS.sendTraceTag(520495426,1,15,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula rejected, ${Ra}`),W(Ra)}})).catch(()=>{this.sO.delete(ca);this.sO.delete(bb);return{kind:"Failure"}}))}async GHj(ca,
bb){var Hb=await Zb.a.resolve(uc.FormulaAnonymizerService,{xa:1});const Vb=wb.Range.Hc(0,0);ca=Hb.anonymize(ca,Vb);Hb=Hb.anonymize(bb.evaluatedFormula,Vb);Va.ULS.sendTraceTag(507799744,1,50,`FormulaAssistanceValuePreviewRequester.logUnavailableResult: ${JSON.stringify({formula:ca,evaluatedFormula:Hb,reason:bb.reason})}`)}T0i(ca){const bb=Object($b.r)(this.da.ha.oa.activeCell,this.$);if(this.uIc&&Object(Pd.b)(ca)){const Hb=Object($b.f)(ca,bb);0<Hb.length&&Va.ULS.sendTraceTag(507777487,1,20,`FormulaAssistanceValuePreviewRequester.getSheetCell: cell diffs: ${Hb.join(",")}`)}return this.uIc?
ca:bb}}Object($a.a)(Fb,"FormulaAssistanceValuePreviewRequester",null,[]);class Ta{constructor(ca){this.e1c=ca;this.map=new Map}has(ca){ca=this.e1c(ca);return this.map.has(ca)}get(ca){ca=this.e1c(ca);return this.map.get(ca)}set(ca,bb){ca=this.e1c(ca);this.map.set(ca,bb);return this}delete(ca){ca=this.e1c(ca);return this.map.delete(ca)}clear(){this.map.clear()}}Object($a.a)(Ta,"RequestMap",null,[]);Object(Zb.b)(uc.FormulaAssistanceValuePreviewRequesterService,{we:"singleton"})(async ca=>{const bb=await Zb.a.resolve(uc.EwaControlService,
ca);ca=await Zb.a.resolve(Bf.f,ca);return new Fb(bb,ca)});Object(Zb.b)(uc.FormulaAuthoringHelperService)(async ca=>{await Zb.a.resolve(uc.ExcelOnlineCalc,ca);return excelOnlineCalc.FormulaAuthoringHelperSingletonGlobal.instance()});var Eb;let oc=Eb=class extends Ed.a{constructor(ca){super(ca,Eb.featureName);this.HXf=!0}get tf(){return de.a.zId}show(ca,bb,Hb,Vb,Ec,rd,Id,W){rd=void 0===rd?null:rd;return this.Oub(void 0===Id?null:Id,Ra=>{appChrome.renderFormulaSuggestionCard(ca,bb,this.domElement,Ra.y,
Ra.x,Ra.y+Ra.height,Ra.x+Ra.width,Hb,Vb,Ec,rd,this.Ztb,W?{explanationKey:W.explanationKey,replacements:W.explanationReplacements,notifyExplanationSuccessful:W.RNc}:void 0)})}yte(ca,bb,Hb,Vb,Ec,rd,Id,W,Ra,nc,yc){return this.Oub(yc,Fd=>{appChrome.renderRowNumberingSuggestionCard(ca,bb,this.domElement,Fd.y,Fd.x,Fd.y+Fd.height,Fd.x+Fd.width,Hb,Vb,Ec,rd,Id,W,Ra,nc,this.Ztb)})}TV(ca,bb,Hb){cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",!1)&&(this.X0&&ca.equals(this.p1d)||
(this.X0&&document.body.removeChild(this.X0),this.p1d=ca,ca=this.grid.Ob(ca),ca=this.grid.getCellBounds(ca.cell,!0),this.X0=document.createElement("div"),this.X0.setAttribute("style",`position:fixed;
        left: ${ca.x+ca.width}px;
        top: ${ca.y+ca.height/2}px`),document.body.appendChild(this.X0)),ca=new ld.a(-847286761,0,this.$.xc,0,null),this.$.Ia.Gb(ca,{["CalloutName"]:15,["Target"]:this.X0,["NewState"]:bb,["Reason"]:Hb}))}};oc=Eb=Object(hb.__decorate)([Object(Zb.d)(uc.FormulaByExampleCardControlService),Object(hb.__param)(0,Object(uc.EwaControlService)())],oc);Object($a.a)(oc,"FormulaByExampleCardUIControl",Ed.a,[720]);class Lc{constructor(ca,bb,Hb){this.pluginScheduler=ca;this.Eq=bb;this.s8a=Hb;this.PAd=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",
!1)}async sJg(ca,bb){var Hb,Vb,Ec,rd;let Id={status:"failure"};this.Eq.Tfa(bb,0);var W={context:Object($b.ib)(ca)};this.PAd&&this.s8a.DWk(ca);W=await this.pluginScheduler.requester().columnFormulaSuggestion(W,dc.PluginGroup.Excel,bb.toString());"Done"===W.kind&&(null===(Hb=W.payload)||void 0===Hb?0:Hb.suggestions)&&W.payload.suggestions[0]&&(Hb=W.payload.suggestions[0],W=Hb.metadata,"ColumnFormulaSuggestion"===Hb.kind?(this.Eq.Tfa(bb,5,{formula:W.rawFormula,H1:W.anonymizedFormula,CL:null!==(Vb=W.seenCount)&&
void 0!==Vb?Vb:null,q2:null!==(Ec=W.isCacheHit)&&void 0!==Ec?Ec:null,Wka:null!==(rd=W.latestOutcome)&&void 0!==rd?rd:null}),Id=this.KRi(Hb),this.PAd&&this.s8a.rXg(ca,`formula found: "${Hb.metadata.rawFormula||Hb.formula}"`)):("no formula found"===Hb.reason?this.Eq.Tfa(bb,1,{errorMessage:null,CL:W.seenCount,q2:W.isCacheHit,Wka:W.latestOutcome}):this.Eq.Tfa(bb,1,{errorMessage:Hb.reason,CL:null,q2:null,Wka:null}),Id.flowId=Number(Hb.suggestionID),this.PAd&&this.s8a.rXg(ca,Hb.reason)));this.Eq.xgb(bb);
return Id}async Yhg(ca,bb){await this.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:ca,suggestionOutcome:{outcome:bb}});return!0}KRi(ca){if(!ca||!ca.evalResults)return{status:"failure",flowId:ca?Number(ca.suggestionID):void 0};const bb=ca.evalResults.map(Hb=>{if("FormulaSuggestionEvalFailureResult"===Hb.kind)return{kind:"Failure",cell:Object($b.fb)(Hb.cell),value:Hb.error};let Vb,Ec;switch(Hb.value.kind){case "number":Ec="Success";Vb=Hb.value.num;break;case "string":Ec="Success";Vb=Hb.value.text;
break;case "boolean":Ec="Success";Vb=Hb.value.flag;break;case "error":Ec="ExcelAppError",Vb=Hb.value.errorValue}return{kind:Ec,cell:Object($b.fb)(Hb.cell),value:Vb,format:Hb.formatted}});return{status:"success",flowId:Number(ca.suggestionID),columnRange:Object($b.fb)(ca.columnRange),tableName:ca.tableName,tableColumnName:ca.tableColumnName,suggestions:[{formula:ca.formula,H1:ca.metadata.formulaAnonymized,cells:bb,tableName:ca.tableName,explanation:{explanationKey:ca.metadata.explanationKey,explanationReplacements:ca.metadata.explanationReplacements},
metadata:ca.metadata}]}}}Object($a.a)(Lc,"FormulaByExamplePluginCommunicator",null,[737]);var Jd=a(256);class Ab{constructor(ca,bb){this.da=ca;this.Yd=bb;this.Lrf=new Set;this.WU=(Hb,Vb)=>{if(Hb=this.da.Eb.dg(Vb.Lk,!1))if(Vb=this.Q3i(Hb,Vb.Lk.left))this.Lrf.has(Vb)?(this.Rxh(),this.da.Rb.zZ(this.WU)):this.Lrf.add(Vb)};this.Rxh=()=>{Jd.a.UN("XLS-FormulaByExample-Treatment;XLS-FormulaByExample-Control")};this.Q3i=(Hb,Vb)=>{const Ec=this.Yd.LXa(Hb);if(!Ec)return null;const rd=Hb.usedRange,Id=Vb-rd.left;
return 0>Id||Id>=Ec.length?(Va.ULS.sendTraceTag(537161876,306,10,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${rd}, columnNumber: ${Vb}, `+`areAllTableHeadersAvailable: ${this.Yd.d6e(Hb,Ec)}`),null):(Vb=Ec[Id])?Hb.name+"_"+Vb:null};this.da.Rb.WS(this.WU)}}Object($a.a)(Ab,"FormulaByExampleScorecardTriggerReporter",null,[]);var Uc;(function(ca){ca.PreviewAlreadyShowing="PreviewAlreadyShowing";ca.StrictDataMismatch="StrictDataMismatch";ca.LackingPrefetchedResults=
"LackingPrefetchedResults";ca.RangeNotLoaded="RangeNotLoaded";ca.InvalidCalcResults="InvalidCalcResults";ca.ErrorsInEvaluation="ErrorsInEvaluation";ca.InternalPreviewError="InternalPreviewError";ca.WorkbookModelUpdateFailed="WorkbookModelUpdateFailed";ca.FailedToPreviewActiveCell="FailedToPreviewActiveCell";ca.Unknown="Unknown"})(Uc||(Uc={}));Object($a.b)("FormulaPreviewErrorKind",Uc);var Od=a(118);class le{constructor(){this.bOb=new Map}static getInstance(){le.instance||(le.instance=new le);return le.instance}djl(ca){this.bOb.has(ca)||
this.bOb.set(ca,new Map)}mark(ca,bb,Hb){Hb=void 0===Hb?performance.now():Hb;cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8883232_FormulaByExample_AllowPerformanceTracker")&&(this.djl(ca),this.bOb.get(ca).set(bb,Hb))}measure(ca,bb,Hb){if(!cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8883232_FormulaByExample_AllowPerformanceTracker"))return null;var Vb=this.bOb.get(ca);if(Vb){const Ec=Vb.get(bb);Vb=Vb.get(Hb);if(Ec&&Vb)return Vb-Ec}Va.ULS.sendTraceTag(507278856,306,10,`FormulaByExamplePerformanceTracker.measure: Failed to measure time between ${bb} and ${Hb} for flow ${ca}`);
return null}QYh(ca){cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8883232_FormulaByExample_AllowPerformanceTracker")&&this.bOb.delete(ca)}}Object($a.a)(le,"FormulaByExamplePerformanceTracker",null,[]);var ge=le;class ze{constructor(ca,bb,Hb){this.$=ca;this.Tdb=bb;this.BId=Hb;this.Lw=null;this.x3=ge.getInstance();this.QWc=()=>{Va.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const Vb={};Vb[Z.a.MF]="FormulaByExampleCard";
this.$.Dc(802602464,0,8,Vb)};this.fRb=()=>{};this.hea=(Vb,Ec)=>{0===Ec.Fq&&576!==Ec.jg.operation.operationName&&(this.Lw&&this.Lw.R7(`UserOperation: ${Od.a(Ec.jg.operation.operationName)}`),this.$.userOperationManager.kn(this.hea))}}async qXk(ca,bb,Hb,Vb){Vb=void 0===Vb?!1:Vb;const Ec={ate:!1,h0f:!1,hDa:{softIgnoreCount:0,softIgnoreReasons:[],didReshow:!1,didPrime:!1},L9:null};try{const rd=Object($b.G)(bb.columnRange),Id=Hb.cells.map(t),W=await this.BId.sXk(Hb.formula,rd,ca,yc=>{this.fRb(yc,ca,bb,
Hb)},{stateId:0,results:Id},Vb);if(!W.success)return{Rde:{pZ:"UNSEEN",cIb:`FormulaByExampleUIManager.showSuggestionPreview failed: ${W.error}`},nGd:Ec};this.Lw=W.Lw;Object(fe.d)(()=>{this.x3.mark(bb.flowId,"SuggestionShown")},this.$.Aa);const Ra=this.$.isFeedbackEnabled?this.QWc:null;let nc;if(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8874300_FormulaByExample_ShowRowNumberingCard")&&w(Hb.H1)){Ec.L9={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:1E4<
Hb.cells.length};const yc=Ec.L9;nc=()=>this.Tdb.yte(Hb.formula,rd.toString(),()=>{this.Lw.Tpa("CardUI")},()=>{yc.isAcceptAsValues=!0;this.Lw.Tpa("CardUI")},yc.disableApplyAsValue,()=>this.Lw.FEa("CardUI"),Fd=>{yc.maxTooltipOpenDurationMS=Math.max(yc.maxTooltipOpenDurationMS,Fd)},()=>{yc.isFurtherExplanationHyperlinkClicked=!0},Ra,()=>Ec.ate=!0,ca)}else nc=()=>this.Tdb.show(Hb.formula,rd.toString(),()=>this.Lw.Tpa("CardUI"),()=>this.Lw.FEa("CardUI"),Ra,()=>Ec.ate=!0,ca,Hb.explanation&&Hb.explanation.explanationReplacements?
Object.assign({},Hb.explanation,{RNc:yc=>{Ec.h0f=yc}}):void 0);nc();this.Lw.S4e((yc,Fd)=>{Ec.hDa.softIgnoreCount++;Ec.hDa.softIgnoreReasons.push(Fd.reason);this.Tdb.hide()});this.Lw.Sod(()=>{Ec.hDa.didReshow=!0;nc()});Ec.hDa.didPrime=this.Lw.didPrime;this.$.userOperationManager.Kp(this.hea);return this.Lw.z4b.then(yc=>{this.x3.mark(bb.flowId,"UserResponded");this.Tdb.hide();this.$.userOperationManager.kn(this.hea);Object(fe.d)(()=>{this.x3.mark(bb.flowId,"SuggestionHidden");const Fd=this.x3.measure(bb.flowId,
"UserResponded","SuggestionHidden");Va.ULS.sendTraceTag(507274432,306,20,`FormulaByExampleManager.showSuggestionPreview: UserResponded_SuggestionHidden took ${Fd} MS for flow ${bb.flowId}`);this.x3.QYh(bb.flowId)},this.$.Aa);return{Rde:yc,nGd:Ec}})}catch(rd){return{Rde:{pZ:"UNSEEN",cIb:`FormulaByExampleUIManager.showSuggestionPreview failed: ${rd}`},nGd:Ec}}}DWk(ca){this.Tdb.TV(ca,7)}rXg(ca,bb){this.Tdb.TV(ca,8,bb)}}Object($a.a)(ze,"FormulaByExampleUIManager",null,[]);var Le=a(191),nf=a(213);Object(Zb.b)(uc.FormulaByExamplePluginTriggersService)(async ca=>
{const bb=await Zb.a.resolve(uc.EwaControlService,ca),Hb=await Zb.a.resolve(uc.FormulaColumnPreviewManagerService,ca),Vb=await Zb.a.resolve(uc.CalcManagerService,ca),Ec=await Zb.a.resolve(uc.FormulaByExampleCardControlService,ca),rd=pa.f(bb);let Id=null;if(await Tb.a.UZa(bb)){var W=await Zb.a.resolve(uc.TableIntelligenceManagerService,ca);!cc.EwaSettings.PQ()||Id?Id=W.Hja():Va.ULS.sendTraceTag(507093954,0,15,"TableIntelligenceManagerService is not available due to null dependency")}ca=await Zb.a.resolve(Bf.f,
ca);W=await Zb.a.resolve(uc.FormulaByExamplePluginValidatorService);return new cf(bb,rd,new Ab(rd,Vb),Ec,Id,Hb,ca,W,Vb)});class cf{constructor(ca,bb,Hb,Vb,Ec,rd,Id,W,Ra){this.$=ca;this.da=bb;this.XB=Vb;this.K6a=Ec;this.BId=rd;this.Yd=Ra;this.x3=ge.getInstance();this.CDa=null;this.knb=0;this.R1k=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.cKa=(nc,yc)=>{const Fd=performance.now(),$d=yc.G1.range,Me=yc.VHc;let ff=!0;const jf=()=>{ff=!1;
this.da.Rb.gq(jf)},Lf=this.TNd();this.da.Rb.Uq(jf);void this.YQc.sJg($d,Lf).then(Ef=>{ff&&"failure"!==Ef.status&&(this.x3.mark(Ef.flowId,"EventTriggered",Fd),void this.zqg(Ef,$d,Lf,Me,{Ppf:"EditStart"}))})};this.WU=(nc,yc)=>{nc=performance.now();yc.committed&&this.lPg(yc.Lk,this.TNd(),!1,"EditEnd",nc)};this.onPaste=(nc,yc)=>{nc=performance.now();var Fd=yc.wof;Fd&&1===Fd.length&&(Fd=Fd[0],Fd.wU&&(yc=yc.Ti)&&1804571062!==yc&&1766348718!==yc&&this.da.Iy(Fd)&&this.lPg(Fd.center,this.TNd(),!0,"Paste",
nc))};this.W9d=(nc,yc,Fd)=>{Va.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${nc} originalFlowId=${yc} isTableSuggestion=${Fd}`);void this.YQc.Yhg(nc,"UNDO")};if(this.MEi=Tb.a.eIa(this.$))this.Wle=cc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1),this.s8a=new ze(this.$,this.XB,this.BId),this.YQc=new Lc(Id,W.lPf("Plugin"),this.s8a),
this.da.Rb.qH(this.cKa),this.da.Rb.WS(this.WU),this.$.ra.Vc(254,nc=>{nc.MFb(this.onPaste)})}TNd(){return++this.knb}lPg(ca,bb,Hb,Vb,Ec){Hb=void 0===Hb?!0:Hb;this.n4b();this.CDa=this.da.za.iKa(()=>{const rd=()=>{this.Yd.r3b(rd);void this.YQc.sJg(ca,bb).then(Id=>{this.x3.mark(Id.flowId,"EventTriggered",Ec);Hb&&void this.zqg(Id,ca,bb,!1,{Ppf:Vb})})};this.Yd.yFb(rd)})}async zqg(ca,bb,Hb,Vb,Ec){Vb=void 0===Vb?!1:Vb;var rd,Id;if("failure"!==ca.status){this.x3.mark(ca.flowId,"PluginResponded");var W=this.x3.measure(ca.flowId,
"EventTriggered","PluginResponded");if(Hb===this.knb&&ca.suggestions&&0<ca.suggestions.length)if(Hb=ca.suggestions[0],!(2E3>W))Va.ULS.sendTraceTag(507070214,306,20,"FormulaByExamplePluginTriggersManager.onPluginResponse: Plugin response with formula took too long to arrive and thus ignoring it. Data: "+JSON.stringify({["flowId"]:ca.flowId,["formulaAnonymized"]:Hb.H1,["timeToPluginResponse"]:W,["augloopTime"]:Hb.metadata.augloopTime}));else if(this.EUi(bb)&&this.R1k){var {Rde:Ra,nGd:nc}=await this.s8a.qXk(bb,
ca,Hb,Vb),yc=null!=Hb.tableName&&""!==Hb.tableName,Fd=Hb.metadata.izl;"UNSEEN"!==Ra.pZ&&("ACCEPT"===Ra.pZ&&((null===(rd=nc.L9)||void 0===rd?0:rd.isAcceptAsValues)?this.sKh(this.rKd(bb),Hb.cells,ca.tableName):this.cKh(this.rKd(bb),Hb.formula,bb),this.j2a=($d,Me)=>{0===Me.Fq&&(170===Me.jg.operation.operationName&&this.W9d(ca.flowId,Fd,yc),this.$.userOperationManager.kn(this.j2a),this.j2a=null)},this.$.userOperationManager.Kp(this.j2a)),await this.YQc.Yhg(ca.flowId,Ra.pZ),bb=Object($b.G)(ca.columnRange),
Ec={["flowId"]:ca.flowId,["originalFlowId"]:Fd,["caller"]:Ra.cIb,["displayTrigger"]:Ec.Ppf,["formulaAnonymized"]:Hb.H1,["originalFormulaAnonymized"]:Hb.H1,["suggestionOutcome"]:Ra.pZ,["annotationRange"]:bb.toString(),["isFullyInViewport"]:this.da.Iy(bb),["isCachedSuggestion"]:Hb.metadata.q2,["showFormulaClicked"]:nc.ate,["seenCount"]:Hb.metadata.CL+1,["Performance"]:{["EventTriggered_PluginResponded"]:this.x3.measure(ca.flowId,"EventTriggered","PluginResponded"),["PluginResponded_SuggestionShown"]:this.x3.measure(ca.flowId,
"PluginResponded","SuggestionShown"),["SuggestionShown_UserResponded"]:this.x3.measure(ca.flowId,"SuggestionShown","UserResponded")},["isSuggestionOnTable"]:yc,["sheetId"]:Object(Wa.d)(this.$.qa.la),["dataCulture"]:this.$.O4,["UICulture"]:this.$.dataCultureTag,["previewEvents"]:{["softIgnoreCount"]:nc.hDa.softIgnoreCount,["softIgnoreReasons"]:nc.hDa.softIgnoreReasons,["didReshow"]:nc.hDa.didReshow,["didPrime"]:nc.hDa.didPrime},["formulaExplanation"]:{explanationSuccessful:nc.h0f,explanationKey:null===
(Id=Hb.explanation)||void 0===Id?void 0:Id.explanationKey},["RowNumbering"]:nc.L9?{["isAcceptAsValues"]:nc.L9.isAcceptAsValues,["maxTooltipOpenDurationMS"]:nc.L9.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:nc.L9.isFurtherExplanationHyperlinkClicked,["disableApplyAsValue"]:nc.L9.disableApplyAsValue}:null,["IsPlugin"]:!0},Va.ULS.sendTraceTag(388780100,306,20,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(Ec)}`))}}}cKh(ca,bb,Hb){bb=
Object(Tc.a)(new ed.a,{Text:bb});this.da.setCell(bb,Hb,1,127,null,0,{range:ca,origin:Hb},2)}sKh(ca,bb,Hb){ca={FirstRow:ca.top-1,FirstColumn:ca.left-1,LastRow:ca.bottom-1,LastColumn:ca.right-1,SheetName:this.$.qa.la.name,NamedObjectName:Hb};bb=bb.map(Vb=>[Vb.value.toString()]);this.Q5c(ca,bb)}Q5c(ca,bb){const Hb=new nf.a(163,0,(Vb,Ec,rd)=>{const Id=this.$.ma.sa,W=Id.$a(0);W.rangeToSet=ca;W.rangeValues=bb;return je.h(Id,"SetRange",W,(Ra,nc,yc)=>{Vb(Ra,nc,yc)},(Ra,nc,yc)=>{Ec(Ra,nc,yc)},rd,this.$.ma.sa.mc(),
0)},65);this.$.userOperationManager.enqueueOperation(Hb,null)}EUi(ca){ca=this.rKd(ca);return null===ca||void 0===ca?void 0:ca.Xe(this.da.Ek)}rKd(ca){const bb=this.Gja(ca);return bb?new wb.Range(bb.zs.top,ca.left,bb.zs.bottom,ca.right,!0,!0):null}Gja(ca){const bb=this.da.Eb.dg(ca,!1);if(bb)return{zs:Object(Le.a)(bb),nU:!0,RK:!1};if(this.K6a){const {n2b:Hb,RK:Vb}=this.aTi(ca);if(Hb)return{zs:Hb,nU:!1,RK:Vb}}return null}aTi(ca){const bb=new wb.Range(ca.top-this.Wle,ca.left,ca.bottom,ca.right,!0,!0),
Hb=this.K6a.yXa(new Jf.a(bb,Object(Wa.d)(this.$.la)),6);if(!Hb)return null;for(const Vb of Hb)for(const Ec of Vb.table.interpretations)if(2===Ec.orientation&&.5<Ec.confidence)return{n2b:this.w8h(Ec,bb),RK:!Ec.tableLocation.ld(ca)};return{n2b:null,RK:!1}}w8h(ca,bb){return new wb.Range(ca.tableLocation.top+ca.headerRowCount,ca.tableLocation.left+ca.headerColumnCount,Math.max(ca.tableLocation.bottom,bb.bottom),ca.tableLocation.right,!0,!0)}n4b(){var ca;null===(ca=this.CDa)||void 0===ca?void 0:ca.call(this);
this.CDa=null}}Object($a.a)(cf,"FormulaByExamplePluginTriggersManager",null,[]);const Te={CZ:null,Oea:null,formula:null,H1:null,errorMessage:null,q2:null,CL:null,Wka:null};let Wf=class{constructor(){this.g1b=new Map;this.uXb=new Map;this.DHd=new Map}lPf(ca){return new Hf(this,ca)}Tfa(ca,bb,Hb,Vb){bb=bb?this.g1b:this.uXb;if(!bb.has(ca))if(0===Hb)bb.set(ca,Object.assign({},Te));else return;const Ec=bb.get(ca);switch(Hb){case 0:Ec.CZ=performance.now();break;case 2:bb.set(ca,Object.assign({},Ec,Vb));
break;case 3:case 1:case 5:Ec.Oea=performance.now();bb.set(ca,Object.assign({},Ec,Vb));break;case 4:Ec.q2||(Ec.Oea=performance.now(),bb.set(ca,Object.assign({},Ec,Vb)))}}xgb(ca){if("BothComplete"===this.qBc(ca))this.eag(ca);else{const bb=window.setTimeout(()=>{"BothComplete"!==this.qBc(ca)&&(this.g1b.has(ca)||this.uXb.has(ca))&&this.eag(ca)},15E3);this.DHd.set(ca,bb)}}eag(ca){var bb=this.g1b.get(ca);const Hb=this.uXb.get(ca);var Vb=(null===Hb||void 0===Hb?void 0:Hb.errorMessage)||(null===bb||void 0===
bb?void 0:bb.q2)===(null===Hb||void 0===Hb?void 0:Hb.q2)&&(null===bb||void 0===bb?void 0:bb.CL)===(null===Hb||void 0===Hb?void 0:Hb.CL)&&(null===bb||void 0===bb?void 0:bb.Wka)===(null===Hb||void 0===Hb?void 0:Hb.Wka);Vb="BothComplete"===this.qBc(ca)&&Vb&&(null===bb||void 0===bb?void 0:bb.formula)===(null===Hb||void 0===Hb?void 0:Hb.formula)&&(null===bb||void 0===bb?void 0:bb.errorMessage)===(null===Hb||void 0===Hb?void 0:Hb.errorMessage);const Ec="AwaitTask failed - no annotation found"===(null===
bb||void 0===bb?void 0:bb.errorMessage)&&(null===Hb||void 0===Hb?void 0:Hb.CZ)&&!(null===Hb||void 0===Hb?0:Hb.Oea);Vb||Ec?Va.ULS.sendTraceTag(84165970,306,20,`FBE plugin validator compared successfully: ${JSON.stringify({["flowID"]:ca,["pluginStartTime"]:bb.CZ,["pluginEndTime"]:bb.Oea,["legacyStartTime"]:Hb.CZ,["legacyEndTime"]:Hb.Oea,["pluginRequestDuration"]:bb.Oea-bb.CZ,["legacyRequestDuration"]:Hb.Oea-Hb.CZ,["firstStartReported"]:bb.CZ<Hb.CZ?"Plugin":"Legacy",["error"]:bb.errorMessage,["formula"]:bb.H1,
["isCacheHit"]:bb.q2,["seenCount"]:bb.CL,["latestOutcome"]:bb.Wka})}`):this.Qsj(null===Hb||void 0===Hb?void 0:Hb.errorMessage)&&(bb={["flowId"]:ca,["pluginStartTime"]:null===bb||void 0===bb?void 0:bb.CZ,["pluginEndTime"]:null===bb||void 0===bb?void 0:bb.Oea,["legacyStartTime"]:null===Hb||void 0===Hb?void 0:Hb.CZ,["legacyEndTime"]:null===Hb||void 0===Hb?void 0:Hb.Oea,["successfulFlows"]:this.qBc(ca),["pluginError"]:null===bb||void 0===bb?void 0:bb.errorMessage,["legacyError"]:null===Hb||void 0===Hb?
void 0:Hb.errorMessage,["pluginFormula"]:null===bb||void 0===bb?void 0:bb.H1,["legacyFormula"]:null===Hb||void 0===Hb?void 0:Hb.H1,["pluginCacheHit"]:null===bb||void 0===bb?void 0:bb.q2,["legacyCacheHit"]:null===Hb||void 0===Hb?void 0:Hb.q2,["pluginSeenCount"]:null===bb||void 0===bb?void 0:bb.CL,["legacySeenCount"]:null===Hb||void 0===Hb?void 0:Hb.CL,["pluginLatestOutcome"]:null===bb||void 0===bb?void 0:bb.Wka,["legacyLatestOutcome"]:null===Hb||void 0===Hb?void 0:Hb.Wka},Va.ULS.sendTraceTag(84165957,
306,20,`FBE plugin validator comparison failure: ${JSON.stringify(bb)}`));this.g1b.delete(ca);this.uXb.delete(ca);if(bb=this.DHd.get(ca))clearTimeout(bb),this.DHd.delete(ca)}qBc(ca){var bb=this.uXb.get(ca),Hb=this.g1b.get(ca);ca=null===Hb||void 0===Hb?void 0:Hb.CZ;Hb=null===Hb||void 0===Hb?void 0:Hb.Oea;const Vb=null===bb||void 0===bb?void 0:bb.CZ,Ec=null===bb||void 0===bb?void 0:bb.Oea;bb=null!==(null===bb||void 0===bb?void 0:bb.q2)||null!==(null===bb||void 0===bb?void 0:bb.errorMessage);return ca&&
Hb&&Vb&&Ec&&bb?"BothComplete":ca&&Hb?"PluginComplete":Vb&&Ec&&bb?"LegacyComplete":"NoneComplete"}Qsj(ca){return"signal lock"!==ca&&"AL is undefined"!==ca&&"tableRange does not intersect loaded range"!==ca&&"table return null for table suggestion"!==ca&&"column has non uniform data"!==ca&&"consistent block cache callback cancelled"!==ca}};Wf=Object(hb.__decorate)([Object(Zb.d)(uc.FormulaByExamplePluginValidatorService)],Wf);Object($a.a)(Wf,"FormulaByExamplePluginValidator",null,[]);class Hf{constructor(ca,
bb){this.w$g=ca;this.vHc="Plugin"===bb;this.vHc||(this.b9f=new Map)}Tfa(ca,bb,Hb){(ca=this.kPf(ca))&&this.w$g.Tfa(ca,this.vHc,bb,Hb)}xgb(ca){(ca=this.kPf(ca))&&this.w$g.xgb(ca)}WSg(ca,bb){this.vHc||this.b9f.set(ca,bb)}kPf(ca){return this.vHc?ca:this.b9f.get(ca)}}Object($a.a)(Hf,"FormulaByExamplePluginValidatorProxy",null,[]);var ib=a(976);Object(Zb.b)(uc.FormulaByExampleServiceProxyService,{we:"singleton"})(async ca=>{const bb=await Zb.a.resolve(uc.EwaControlService,ca),Hb=await Tb.a.UZa(bb),[Vb,
Ec,rd,Id,W]=await Promise.all([Zb.a.resolve(uc.CalcManagerService,ca),Zb.a.resolve(uc.AugmentationLoopManagerService,ca),Hb?Zb.a.resolve(uc.TableIntelligenceManagerService,ca):Promise.resolve(null),Zb.a.resolve(uc.FormatCellsActionService,ca),cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)?Zb.a.resolve(uc.IndexedDBService):Promise.resolve(null)]);if(cc.EwaSettings.PQ()&&(!rd||!Ec))return null;let Ra,nc;Ra=await Zb.a.resolve(uc.FormulaByExamplePluginTriggersService,
ca);nc=await Zb.a.resolve(uc.FormulaByExamplePluginValidatorService,ca);ca=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1)?await Zb.a.resolve(Bf.f,ca):null;return new ib.a(bb,Vb,Ec,rd,Id,Ra,Hb,W,nc,ca)});class xc extends Map{constructor(ca){super();this.N8=ca}set(ca,bb){if(!this.has(ca)&&this.size>=this.N8){const [Hb]=this.entries().next().value;this.delete(Hb)}return super.set(ca,bb)}has(ca){if(super.has(ca)){const bb=this.get(ca);this.delete(ca);
super.set(ca,bb);return!0}return!1}}Object($a.a)(xc,"LimitedSizeHotMap",Map,[]);const Kc=ca=>`${ca.top}_${ca.left}`;let ra=class{constructor(ca){this.dc=ca;this.O2a=new Map;this.wqb=new Map;this.hMj=cc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMinRowsForLocks",3);this.oLj=cc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaxLocksPerSession",3);this.yMa=new xc(this.oLj);this.Mnc=!1;this.y5j=(bb,Hb,Vb)=>{if(Vb.reduce((Id,W)=>Id+W.bottom-W.top+1,0)<
this.hMj)Va.ULS.sendTraceTag(508036641,0,50,"FormulaByExampleSignalLocksManager.onSignalSent: not enough rows to lock by");else{this.yMa.has(Hb)&&this.yMa.delete(Hb);for(const Id of Vb){var Ec=this.dc.Ora("FormulaByExampleSignalLocksManager.onSignalSent",Id);const W={o$f:Id,B2d:new Map};try{for(;Ec.$$mn();){const Ra=Ec.$$cu(),nc=Ra.Qh.value;W.B2d.set(Kc(Ra.range),nc)}}finally{Ec&&Ec.dispose()}if(rd)rd.p$f.push(W);else{Ec=Vb[0].clone();Vb.reduce((Ra,nc)=>{Ra.union(nc);return Ra},Ec);var rd={sheetId:ib.a.mY(this.dc.la),
columnId:Hb,VZk:Ec,p$f:[W]}}}this.O2a.set(bb,rd);this.wqb.set(bb,window.setTimeout(()=>{this.O2a.has(bb)&&(this.O2a.delete(bb),this.wqb.delete(bb),Va.ULS.sendTraceTag(508036640,0,50,`FormulaByExampleSignalLocksManager.onSignalSent: pending lock timed out, deleting lock for column ${rd.columnId}`))},2E4))}};this.wYj=bb=>{const Hb=this.wqb.get(bb);Hb&&(window.clearTimeout(Hb),this.wqb.delete(bb));this.O2a.has(bb)&&(Va.ULS.sendTraceTag(508036639,0,50,`FormulaByExampleSignalLocksManager.onFormulaFound: pending lock found and deleted for column ${this.O2a.get(bb).columnId}`),
this.O2a.delete(bb))};this.xYj=bb=>{const Hb=this.wqb.get(bb);Hb&&(window.clearTimeout(Hb),this.wqb.delete(bb));if(bb=this.O2a.get(bb))this.yMa.set(bb.columnId,bb),Va.ULS.sendTraceTag(508036638,0,50,`FormulaByExampleSignalLocksManager.onFormulaNotFound: pending lock found, column locked: ${bb.columnId}`),this.I$g()};this.onBlockCacheItemChanged=(bb,Hb)=>{Hb=Hb.he.block;bb=Hb.Fd;Hb=this.IUi(bb,ib.a.mY(Hb.la));for(const Vb of Hb){Hb=Vb.p$f;for(const Ec of Hb)if(Ec.o$f.ld(bb)){Hb=Ec.o$f.clone().Xe(bb);
Hb=this.dc.Ora("FormulaByExampleSignalLocksManager.onBlockCacheItemChanged",Hb);try{for(;Hb.$$mn();){const rd=Hb.$$cu(),Id=rd.Qh.value,W=Kc(rd.range);Ec.B2d.has(W)&&Ec.B2d.get(W)!==Id&&(this.yMa.delete(Vb.columnId),Va.ULS.sendTraceTag(508036637,0,50,`FormulaByExampleSignalLocksManager.onBlockCacheItemChanged: existing lock's rows content changed, column unlocked: ${Vb.columnId}, columnChanged: ${rd.range.left}`),this.I$g())}}finally{Hb&&Hb.dispose()}}}}}Rnj(ca){return this.yMa.has(ca)}I$g(){!this.Mnc&&
0<this.yMa.size?(this.dc.$t(this.onBlockCacheItemChanged),this.dc.Pbb(this.onBlockCacheItemChanged),this.Mnc=!0):this.Mnc&&0===this.yMa.size&&(this.dc.yu(this.onBlockCacheItemChanged),this.dc.n3b(this.onBlockCacheItemChanged),this.Mnc=!1)}IUi(ca,bb){const Hb=[];for(const Vb of this.yMa.values())Vb.sheetId===bb&&Vb.VZk.ld(ca)&&Hb.push(Vb);return Hb}};ra=Object(hb.__decorate)([Object(Zb.d)(uc.FormulaByExampleSignalLocksManagerService),Object(hb.__param)(0,Object(uc.FormulaByExampleServiceProxyService)())],
ra);Object($a.a)(ra,"FormulaByExampleSignalLocksManager",null,[715]);var jb=a(1287),vc=a(329),md=a(1141),Qd=a(140),v=a(453);Object(Zb.b)(uc.FormulaColumnPreviewManagerService,{we:"singleton"})(async ca=>{const [bb,Hb,Vb]=await Promise.all([Zb.a.resolve(uc.EwaControlService,ca),Zb.a.resolve(uc.FormatCellsActionService,ca),Zb.a.resolve(uc.CalcManagerService,ca)]);ca=pa.f(bb);return new Qb(ca,ca.KI,Vb,Hb)});class Qb{constructor(ca,bb,Hb,Vb){this.da=ca;this.KI=bb;this.Yd=Hb;this.$e=Vb;this.HLb=[];this.LBd=
[]}async sXk(ca,bb,Hb,Vb,Ec,rd){var Id=!0,W=!0;Id=void 0===Id?!1:Id;W=void 0===W?!1:W;rd=void 0===rd?!1:rd;if(this.KI.isActive)return Dc("PreviewAlreadyShowing");let Ra;if(Ec)Ra=Ec;else{Ec=await this.vuf(bb,ca,Hb,W,void 0);if(!Ec.success)return Ec.error;Ra=Ec.results}if(Id&&!this.R$g(Ra))return Dc("StrictDataMismatch");if(!this.p3c(Ra).isSuccess)return Dc("WorkbookModelUpdateFailed");Ec=Ra.results.find(nc=>"Success"===nc.kind&&nc.value.cell.row+1===this.da.ha.oa.activeCell.top&&nc.value.cell.col+
1===this.da.ha.oa.activeCell.left);if(!Ec)return Dc("FailedToPreviewActiveCell");try{const nc=await this.KI.q4(bb,yc=>this.fRb(yc,ca,Hb,bb,Id,W,nc,Vb),{PreviewCellsRange:{FirstRow:bb.top,FirstColumn:bb.left,LastRow:bb.bottom,LastColumn:bb.right},RetainCellTextOnPreview:!0},this.da.Rb.isEditing?{pL:Sd(Ec.value).toString(),sZc:rd}:void 0);nc.Sod(()=>{this.p3c(Ra,!1)});void nc.z4b.then(yc=>{"ACCEPT"===yc.pZ&&this.p3c(Ra,!0)});return{success:!0,Lw:nc}}catch(nc){return Dc("InternalPreviewError",nc)}}async vuf(ca,
bb,Hb,Vb,Ec){ca=ca.Xe(this.da.Ek);if(!ca)return{success:!1,error:Dc("RangeNotLoaded")};const rd=await this.Yd.u1(null,ca,Hb,bb,!0);if(!this.mGc(rd))return{success:!1,error:Dc("InvalidCalcResults")};const Id=this.iuf(rd);return 0===Id.size||1===Id.size&&Id.has("Unavailable")?{success:!0,results:rd}:Vb?this.Loi(Id,bb,Ec,ca,Hb):{success:!1,error:Dc("ErrorsInEvaluation",Id)}}async Loi(ca,bb,Hb,Vb,Ec){if(!(1===ca.size&&ca.has("PreviousFailure")||2===ca.size&&ca.has("PreviousFailure")&&ca.has("Unavailable")))return{success:!1,
error:Dc("ErrorsInEvaluation",ca)};ca=this.leh(Hb);bb=await this.Yd.u1(ca,Vb,Ec,bb,!0);if(!this.mGc(bb))return{success:!1,error:Dc("InvalidCalcResults")};Vb=this.iuf(bb);return 0===Vb.size||1===Vb.size&&Vb.has("Unavailable")?{success:!0,results:bb}:{success:!1,error:Dc("ErrorsInEvaluation",Vb)}}fRb(ca,bb,Hb,Vb,Ec,rd,Id,W){const Ra=ca.he.block,nc=Vb.Xe(Ra.Fd);if(!nc)return!1;this.HLb.push(Ra);this.LBd.push(nc);this.FWf&&!this.FWf.contains(nc)&&this.CBh(nc);void Id.z4b.then(()=>{this.xGg(nc)});const yc=
async()=>{const Fd=await this.STj(bb,Hb,Ec,rd);null===W||void 0===W?void 0:W(ca,Fd);this.Yd.r3b(yc)};this.Yd.yFb(yc);return!1}CBh(ca){this.Adf(ca,!0)}xGg(ca){this.Adf(ca,!1)}Adf(ca,bb){for(let Vb=ca.top;Vb<=ca.bottom;Vb++)for(let Ec=ca.left;Ec<=ca.right;Ec++){var Hb=wb.Range.Hc(Vb,Ec);if(Hb=this.da.Ob(Hb))Hb.cell.Ate=bb&&!Hb.cell.pL}}async STj(ca,bb,Hb,Vb){if(!this.HLb.length)return null;const Ec=()=>{this.HLb=[];this.LBd=[]},rd=this.LBd.reduce((Id,W)=>{Id.union(W);return Id});ca=await this.vuf(rd,
ca,bb,Vb,this.HLb.map(Id=>Id.Fd));if(!ca.success)return Ec(),Dc("ErrorsInEvaluation",ca.error);if(Hb&&!this.R$g(ca.results))return Ec(),Dc("StrictDataMismatch");Hb=this.p3c(ca.results);if(!Hb.isSuccess)return Ec(),Dc("WorkbookModelUpdateFailed");this.xGg(rd);if(Hb.isDirty)for(const Id of this.HLb)this.KI.xYb(Id);Ec();return null}p3c(ca,bb){bb=void 0===bb?!1:bb;var Hb=void 0===Hb?!1:Hb;var Vb;let Ec=!1,rd;for(const yc of ca.results){if(!Object(jb.a)(yc)){if("Unavailable"===yc.reason.kind)continue;
return{isSuccess:!1,isDirty:Ec}}if(ca=this.da.Ob(id(yc.value.cell)))if(bb)ca.cell.text=ca.cell.pL,(null===(Vb=ca.cell.H1b)||void 0===Vb?0:Vb.HorizontalAlignment)&&ca.cell.RV(ca.cell.H1b.HorizontalAlignment,!0,!0);else{var Id=yc.value.formatted,W=Md(yc.value.value.kind);Id=this.$e.n7(Id,W,md.a,ca);if(Object(vc.c)(Id)){W=ca.cell;if(W.g3a){var Ra=W.g3a;var nc=Id.value.numFmt;Ra=Ra.Start===nc.Start&&Ra.End===nc.End&&Ra.Separator===nc.Separator}else Ra=W.pL===Id.value.text;Ra||(Ec=!0);W.pL=Id.value.text;
W.g3a=Id.value.numFmt;Ra=1===ca.Qh.type?parseFloat(ca.Qh.value):ca.Qh.value;nc=Sd(yc.value);W.cLg=nc===Ra;Ra=new v.a;Ra.HorizontalAlignment=0===ca.cell.horizontalAlignment?Id.value.horizontalAlignment:null;W.H1b=Ra;Hb&&(rd?rd.union(id(yc.value.cell)):rd=id(yc.value.cell))}else return{isSuccess:!1,isDirty:Ec}}}this.FWf=rd;return{isSuccess:!0,isDirty:Ec}}R$g(ca){const bb=new Set;ca=ca.results;for(const Vb of ca.entries()){const [Ec,rd]=Vb;if(!Object(jb.a)(rd)){var Hb=id(rd.reason.cell);if(this.da.hd.wda(Hb)){ca.splice(Ec,
1);bb.add("Contains hidden rows");continue}if(!this.da.Iy(Hb)){ca.splice(Ec,1);bb.add("Contains unavailable cells outside of view");continue}return{success:!1,sTc:["Unexpected unavailable cell"]}}Hb=rd.value;const Id=this.da.Ob(id(Hb.cell));if(!Id)continue;const W=Id.Qh.type;if(0!==W)if(2===W){if(2!==Hb.value.kind||Hb.value.value!==Id.Qh.value)return{success:!1,sTc:["String value mismatch"]}}else{if(1===W&&(1!==Hb.value.kind||Hb.value._valueXL!==parseFloat(Id.Qh.value)))return{success:!1,sTc:["Number value mismatch"]};
if(4===W&&(8!==Hb.value.kind||Hb.value.type!==parseFloat(Id.Qh.value)))return{success:!1,sTc:["Error value mismatch"]}}}return{success:!0,sTc:Array.from(bb)}}leh(ca){const bb=[];for(const Hb of ca){ca=new Qd.a("FormulaColumnPreviewManager.GenerateConstantCellsCloneWrites",this.da,Hb);try{for(;ca.moveNext();){const Vb=ca.get_current();bb.push({row:Vb.cell.wC,column:Vb.cell.YF,Qh:Vb.Qh,formulaBarText:Vb.Qh.value,text:Vb.cell.text,oi:Vb.cell.oi})}}finally{ca&&ca.dispose()}}return bb}iuf(ca){const bb=
new Set;ca=ca.results;for(const Hb of ca)Object(jb.a)(Hb)||bb.add(Hb.reason.kind);return bb}mGc(ca){return(ca=ca.results)&&ca.length?!0:!1}}Object($a.a)(Qb,"FormulaColumnPreviewManager",null,[718]);const Dc=(ca,bb)=>({success:!1,error:{kind:ca,data:bb}}),id=ca=>new wb.Range(ca.row+1,ca.col+1,ca.row+1,ca.col+1,!0,!0),Md=ca=>{switch(ca){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}},Sd=ca=>{ca=ca.value;return 1===ca.kind?ca._valueXL:8===ca.kind?Ca.a.Mgb[ca.type-1]:
ca.value};var ne=a(41),Ce=a(429),Ge=a(266);Object(Zb.b)(uc.FunctionInfoManagerService,{we:"singleton"})(async ca=>{ca=await Zb.a.resolve(uc.EwaControlService,ca);return new Ee(ca)});class Ee extends ne.a{constructor(ca){super();this.knh=[];this.jEf={};this.WId={};this.C_=null;this.Gga=[];this.EWa={};this.IWd=this.Pcd=!1;this.Lvj=Tb.a.Kvj();this.lng=(bb,Hb)=>{Va.ULS.sendTraceTag(537161987,0,50,"FunctionInfoManager.OnGetFunctionListPartialSucceeded");this.Xmg(bb,!!Hb&&1!==Hb.FilterType,!0)};this.kng=
()=>{Va.ULS.sendTraceTag(537161986,0,50,"FunctionInfoManager.OnGetFunctionListPartialFailed -  reset varaible to ensure we will re-issue the webservice call");this.C_=null};this.Wmg=bb=>{Va.ULS.sendTraceTag(537161985,0,50,"FunctionInfoManager.OnFullFunctionListLoaded - full list was loaded");this.Kge(bb.kta,!0,!1)};this.jng=bb=>{Va.ULS.sendTraceTag(537161984,0,50,"FunctionInfoManager.OnGetFunctionListFullSucceeded");this.Xmg(bb,!0,!1)};this.Qb=ca}qlc(ca){this.addHandler("FunctionInfoLoaded",ca)}Bie(ca){this.removeHandler("FunctionInfoLoaded",
ca)}get yka(){return this.Pcd}get fEf(){return this.C_}get hyc(){return this.Gga}get $(){return this.Qb}dispose(){const ca=Zb.a.Cb(uc.InstantaneousSupportInformationManagerService);ca&&ca.Cie(this.Wmg);this.Qb=null;super.dispose()}Hke(){this.Pcd=!1;this.C_=null;this.IWd=!0;this.Lvj&&this.Egb(null)}Egb(ca,bb){bb=void 0===bb?!1:bb;if(this.yka)this.EBg();else{Va.ULS.sendTraceTag(537161991,0,50,`Retrieving the list of function names for culture '${this.$.ta.UICultureTag}' from the server.`);let Vb=null;
(Vb=Zb.a.Cb(uc.InstantaneousSupportInformationManagerService))||Va.ULS.sendTraceTag(537161990,0,50,"instantaneousSupportInformationManager == null");if((null===Vb||void 0===Vb?0:Vb.kta)&&0<Vb.kta.length)cc.EwaSettings.Ra(114)?Vb.fEi(this.jng):this.Kge(Vb.kta,!0,!1);else{var Hb=this.$.ma.sa.mc();ca&&(this.$.fa.yc||bb)&&!this.IWd&&(bb?Ce.a(this.$.userOperationManager,(Ec,rd,Id)=>je.o(this.$.ma.sa,ca,Ge.c(Ec,this.lng),Ge.b(rd,this.kng),Id,ca,Hb),Ec=>new nf.a(130,0,Ec,16),null):je.o(this.$.ma.sa,ca,this.lng,
this.kng,null,ca,Hb));!this.yka&&this.$.fa.yc&&(Vb?(Va.ULS.sendTraceTag(537161989,0,50,`FunctionInfoManager.EnsureFunctionInfoAsync - Functions not loaded yet, wait for them. IsFullyLoaded=${this.yka}, IsSessionActive=${this.$.fa.yc}`),Vb.m4e(this.Wmg)):(Va.ULS.sendTraceTag(537161988,0,50,"FunctionInfoManager.EnsureFunctionInfoAsync - instantaneousSupportInformationManager is null"),je.o(this.$.ma.sa,{FilterType:0},this.jng,null,null,null,Hb),this.IWd=!1))}}}eJf(ca){return 0>ca||ca>=this.C_.length?
null:this.C_[ca]}fJf(ca){return Qa.a.Od(this.WId,ca.toUpperCase())}Hib(ca){return Qa.a.Od(this.EWa,ca)}S0f(ca){return!ca.GroupUI}Xmg(ca,bb,Hb){const Vb=ue.a(ca);Va.ULS.sendTraceTag(537161955,0,50,`FunctionInfoManager.OnFunctionListSucceeded: areNonStatusMessagesPresentInResult=${Vb}`);Vb?(pa.f(this.$).endEdit(!1,"FunctionInfoManager.OnFunctionListSucceeded"),this.$.fa.ur(ca.Errors)):this.Kge(ca.Result,bb,Hb)}Kge(ca,bb,Hb){Va.ULS.sendTraceTag(537161954,0,50,`FunctionInfoManager.RefreshFunctionList: functionsInfo count = ${ca.length}, isCategorized = ${bb}, partialResult = ${Hb} IsFullyLoaded = ${this.yka}`);
this.yka||(this.C_=ca,this.WPh(bb),this.Pcd=!Hb,this.EBg())}EBg(){this.raiseEvent("FunctionInfoLoaded")}WPh(ca){var bb=jc.a.instance.ia(1032),Hb=[];this.EWa={};this.Gga=[];this.EWa[bb]=Hb;const Vb=jc.a.instance.ia(1033),Ec=[];this.Gga.push(bb);this.Gga.push(Vb);for(let Id=0,W=this.C_.length;Id<W;Id++){bb=this.C_[Id];bb.IsCompatibility||Ec.push(bb);var rd=bb.NameUI;const Ra=bb.NameDataStrings;this.jEf[Ra.toUpperCase()]||(this.jEf[Ra.toUpperCase()]=bb);this.WId[rd.toUpperCase()]||(this.WId[rd.toUpperCase()]=
bb);if(!this.S0f(bb)){if(ca){rd=bb.GroupUI;let nc=Qa.a.Od(this.EWa,rd);nc||(nc=[],this.EWa[rd]=nc,this.Gga.push(rd));nc.push(bb)}bb.IsCommonlyUsed&&Hb.push(bb);bb.IsCompatibility||this.knh.push(Ra)}}this.EWa[Vb]=Ec;ca&&(Ee.tFg(Hb,[2,3,0,5,4,9,1,7,8,6]),Hb=Array(14),Hb[0]=0,Hb[1]=1,Hb[2]=7,Hb[3]=11,Hb[4]=5,Hb[5]=2,Hb[6]=6,Hb[7]=10,Hb[8]=9,Hb[9]=3,Hb[10]=4,Hb[11]=13,Hb[12]=12,Hb[13]=8,Ee.tFg(this.Gga,Hb),Hb=[],Hb.push(...this.Gga),Hb.splice(13,1),this.Gga=Hb);Hb=(Id,W)=>Id.NameUI.localeCompare(W.NameUI);
this.C_=[...this.C_];this.C_.sort((Id,W)=>Id.NameDataStrings.localeCompare(W.NameDataStrings));for(let Id=1,W=this.Gga.length;Id<W&&ca;Id++)this.EWa[this.Gga[Id]].sort(Hb);for(let Id=0,W=this.C_.length;Id<W;Id++)this.C_[Id].FunctionIndex=Id}static tFg(ca,bb){const Hb=[...ca];for(let Vb=0;Vb<Hb.length&&Vb<bb.length;Vb++)ca[Vb]=Hb[bb[Vb]]}}Object($a.a)(Ee,"FunctionInfoManager",ne.a,[716,717,4]);const Ue=(ca,bb,Hb,Vb)=>(Ec,rd,Id)=>{const W=pa.f(ca),Ra=ca.ma.sa.mc();Ec=Ge.c(Ec,We(Hb,Vb));rd=Ge.b(rd,ya(Vb));
return ca.qa.la?je.x(ca.ma.sa,bb,ca.qa.la.name,Ec,rd,Id,W,Ra):je.w(ca.ma.sa,bb,-1,Ec,rd,Id,W,Ra)},We=(ca,bb)=>Hb=>{ue.a(Hb)?bb(Hb):(Hb=Hb.Result,Hb=$b.n(Hb.Ranges[0],Hb.SheetName),ca(Hb))},ya=ca=>bb=>{ca(bb)};class Cb{constructor(ca){this.pluginScheduler=ca;this.jbc=new qa;this.ZWc=new Map}async b0j(ca){ca=this.a0j(ca);let bb;const Hb=new Promise(Vb=>{bb=window.setTimeout(()=>{Va.ULS.sendTraceTag(507127896,0,15,"GotoCtrlClickRequester.onHoverRequestWithTimeout: request timed out after 1000ms");Vb({kind:dc.GotoCtrlClickResultKind.Failure})},
1E3)});return Promise.race([ca,Hb]).finally(()=>{window.clearTimeout(bb)})}async a0j(ca){var bb=this.jbc.get(ca.index);if(bb)return bb;bb=await this.pluginScheduler.requester().gotoCtrlClick(ca,dc.PluginGroup.Excel,null);if("Done"!==bb.kind)return"Superseded"===bb.kind&&this.jbc.delete(ca.index),null;ca=bb.payload;if(Object(Pd.c)(ca))return{kind:dc.GotoCtrlClickResultKind.Failure};switch(ca.kind){case dc.GotoCtrlClickResultKind.RangeResolutionFailure:case dc.GotoCtrlClickResultKind.NoReferenceFound:case dc.GotoCtrlClickResultKind.Failure:return ca;
case dc.GotoCtrlClickResultKind.ReferenceFound:return this.jbc.set(ca.span,ca),ca;default:return Va.ULS.sendTraceTag(507339545,0,15,"GotoCtrlClickRequester.request: unexpected GotoCtrlClickResultKind"),null}}Q0i(ca,bb,Hb,Vb){this.ZWc.has(bb)?Hb(this.ZWc.get(bb)):z(ca,bb,Ec=>{this.ZWc.set(bb,Ec);Hb(Ec)},Vb)}clearCache(){this.jbc.clear();this.ZWc.clear()}}Object($a.a)(Cb,"GotoCtrlClickRequester",null,[]);class qa{constructor(){this.map=new Map}TZk(ca){return JSON.stringify({start:ca.start,end:ca.end})}z_g(ca){const {start:bb,
end:Hb}=JSON.parse(ca);return{start:bb,end:Hb}}get(ca){for(const bb of this.map.keys()){const Hb=this.z_g(bb);if(ca>=Hb.start&&ca<=Hb.end)return this.map.get(bb)}}set(ca,bb){ca=this.TZk(ca);this.map.set(ca,bb);return this}delete(ca){for(const bb of this.map.keys()){const Hb=this.z_g(bb);if(ca>=Hb.start&&ca<=Hb.end)return this.map.delete(bb)}return!1}clear(){this.map.clear()}}Object($a.a)(qa,"RequestCache",null,[]);class qb{constructor(ca,bb,Hb,Vb){this.$=ca;this.onHoverEnter=bb;this.onHoverLeave=
Hb;this.i9d=Vb;this.X1a=(Ec,rd)=>{switch(rd.state){case 0:(rd=this.getSelection(rd.event,Ec))?(this.Xzd=rd,this.onHoverEnter(Ec,rd)):(this.aUb=void 0,this.Lpc());break;case 1:this.Lpc();this.onHoverLeave(Ec);break;case 2:break;default:return rd}};this.LNc=Ec=>{this.aUb!==Ec.ctrlKey&&(this.aUb=Ec.ctrlKey,this.i9d(this.aUb))};this.da=Object(pa.f)(this.$);this.editBox=this.da.cellTextEditBox;this.formulaBar=Object(Fa.a)(this.$);this.Aj()}Lpc(){this.Xzd=void 0}dispose(){this.Bi()}Aj(){this.editBox.FFb(this.X1a);
this.formulaBar.FFb(this.X1a);document.addEventListener("keyup",this.LNc,{capture:!0});document.addEventListener("keydown",this.LNc,{capture:!0})}Bi(){this.editBox.v3b(this.X1a);this.formulaBar.v3b(this.X1a);document.removeEventListener("keyup",this.LNc,{capture:!0});document.removeEventListener("keydown",this.LNc,{capture:!0})}getSelection(ca,bb){ca=new Sys.UI.Point(ca.clientX,ca.clientY);{bb=bb.Za.qg;var Hb=void 0,{x:Vb,y:Ec}=ca;Hb=void 0===Hb?document:Hb;ca=-1;let rd=null;void 0!==Hb.caretPositionFromPoint?
(Hb=Hb.caretPositionFromPoint(Vb,Ec),null!==Hb&&(ca=Hb.offset,rd=Hb.offsetNode)):void 0!==Hb.caretRangeFromPoint&&(Hb=Hb.caretRangeFromPoint(Vb,Ec),null!==Hb&&(ca=Hb.startOffset,rd=Hb.startContainer));null===rd||-1===ca?(Va.ULS.sendTraceTag(507339543,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),bb=-1):bb.contains(rd)?bb=E(bb,rd,ca):(Va.ULS.sendTraceTag(507339542,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),bb=-1)}if(!bb||-1===bb)return null;bb=
{index:bb,length:0};return this.Hre(bb)?bb:null}Hre(ca){return!this.Xzd||!this.poi(this.Xzd,ca)}poi(ca,bb){return ca.index===bb.index&&ca.length===bb.length}}Object($a.a)(qb,"GotoCtrlClickHandler",null,[4]);var bc;(function(ca){ca.client="client";ca.server="server"})(bc||(bc={}));Object($a.b)("ResultOrigin",bc);const R=[50,80,100,130,150,170,200];class cb{constructor(ca){this.$=ca;this.UP=null;this.usage={};this.rVc={};this.performance={};this.Ula=-1;this.jd=(bb,Hb)=>{Hb.Hg||Hb.elb||this.$.sendBeaconTraceTag(104412034,
50,!1,this.q9b())};this.editBox=Object(pa.f)(this.$).Rb;ca.Sj(this.jd)}static getInstance(ca){return cb.instance||(cb.instance=new cb(ca))}ZPf(ca){Object(Pd.c)(this.UP)||(Object(Pd.c)(this.rVc[this.UP])&&(this.rVc[this.UP]={success:0,error:0}),this.rVc[this.UP][ca?"success":"error"]++,this.qLj(ca),this.UP=null)}setResult(ca,bb){bb=this.jPd(bb);switch(ca.kind){case dc.GotoCtrlClickResultKind.NoReferenceFound:bb.noRef++;break;case dc.GotoCtrlClickResultKind.ReferenceFound:bb.resolvedRef++;break;case dc.GotoCtrlClickResultKind.RangeResolutionFailure:bb.unresolvedRef++;
break;case dc.GotoCtrlClickResultKind.Failure:bb.failure++}}b6i(ca,bb){this.Ula=Nb.W0c;this.UP=bb;this.jPd(ca).click++}formatApplied(ca){this.jPd(ca).formatApplied++}qLj(ca){if(-1!==this.Ula){var bb=M(this.UP);this.mQb(`${bb}_request`).n1(ca,this.Ula);var Hb=this.mQb(`${bb}_overall`);window.requestAnimationFrame(()=>{Hb.n1(ca,this.Ula)});this.Ula=-1}}jPd(ca){ca=ca===this.editBox?"cellEditor":"formulaBar";Object(Pd.c)(this.usage[ca])&&(this.usage[ca]={noRef:0,resolvedRef:0,unresolvedRef:0,failure:0,
formatApplied:0,click:0});return this.usage[ca]}mQb(ca){return this.performance[ca]=this.performance[ca]||new Nb(R)}q9b(){const ca={};Object.keys(this.performance).forEach(bb=>{this.performance[bb].KGd();var Hb=this.performance[bb];ca[bb]={metrics:Hb.lZ,durations:Hb.igb}});return`{"usage":${JSON.stringify(this.usage)},"resultSourceCount":${JSON.stringify(this.rVc)},"performance":${JSON.stringify(ca)}}`}}Object($a.a)(cb,"GotoCtrlClickTelemetry",null,[]);const zb={underline:!0,bold:!0};class V{constructor(ca){this.$=
ca;this.yvg=void 0}dispose(){this.hide()}show(ca,bb){ca=Object.assign({},bb,{ow:ca});this.GMa(ca)&&(this.Yma(ca)&&this.hide(),this.Zq=ca,this.dKh())}hide(){this.Zq&&(this.Jqk(),this.Zq=void 0)}GMa(ca){var bb;if(!(bb=!this.Zq)){bb=this.Zq;if(bb===ca)ca=!0;else if(bb&&ca&&bb.ow===ca.ow&&bb.kind!==ca.kind)if(bb.kind===dc.GotoCtrlClickResultKind.ReferenceFound&&ca.kind===dc.GotoCtrlClickResultKind.ReferenceFound){var Hb=bb.sheetRange,Vb=ca.sheetRange;ca=!!Hb&&!!Vb&&Hb.sheetName===Vb.sheetName&&Hb.firstColumn===
Vb.firstColumn&&Hb.firstRow===Vb.firstRow&&Hb.lastRow===Vb.lastRow&&Hb.lastColumn===Vb.lastColumn&&Hb.namedObjectName===Vb.namedObjectName&&bb.span.start===ca.span.start&&bb.span.end===bb.span.end}else ca=!0;else ca=!1;bb=!ca}return bb}Yma(ca){var bb;if(bb=this.Zq)bb=this.Zq,bb=!(bb.ow===ca.ow&&bb.span.start===ca.span.start&&bb.span.end===ca.span.end);return bb}dKh(){const ca=this.Zq.ow,bb=this.Zq.span;this.yvg=ca.Za.getFormattedText();ca.Za.formatText(bb.start,bb.end-bb.start,zb);ca.Za.style.cursor=
"pointer";cb.getInstance(this.$).formatApplied(ca)}Jqk(){const ca=this.Zq.ow,bb=this.Zq.span,Hb=ca.text;Hb.length<bb.end?Va.ULS.shipAssertTag(507339544,0,!1,`GotoCtrlClickControl.removeGotoFormat - unexpected editor state: ${Hb.length}:${bb.start}:${bb.end}`):(ca.isEditing?this.cKk(ca):ca.Za.setFormattedText(this.yvg),ca.Za.style.cursor="text")}cKk(ca){ca=ca.Za;ca.mI=!0;const bb=ca.selection,Hb=bb.index,Vb=ca.text.length;ca.selectRange(Math.min(Hb,Vb),Math.min(Hb+bb.length,Vb));this.Zq.ow.eW(null);
ca.mI=!1}showCallout(ca){const bb=new ld.a(-847286761,fc.a.Hb,ca.xc,0,null);ca.Ia.Gb(bb,{["CalloutName"]:24})}}Object($a.a)(V,"GotoCtrlClickControl",null,[4]);var Ea=a(156);let pb=class{constructor(ca,bb,Hb){this.$=ca;this.pluginScheduler=bb;this.da=Hb;this.onHoverEnter=async(Vb,Ec)=>{this.JKb=Vb;this.ksc=Ea.a.instance.pf(Vb.Za.domElement);this.ksc.Ea("mouseup",this.lO);this.ksc.Ea("mousedown",this.iL,!0);void this.mgk({text:Vb.text,index:Ec.index,length:Ec.length},this.requester.b0j.bind(this.requester),
Vb)};this.onHoverLeave=()=>{this.reset()};this.i9d=Vb=>{var Ec;(this.aUb=Vb)&&(null===(Ec=this.sfb)||void 0===Ec?void 0:Ec.kind)===dc.GotoCtrlClickResultKind.ReferenceFound?this.show(this.zl.ow,this.sfb):this.hide()};this.k9i=async Vb=>{this.sfb=Vb;const Ec=this.zl.ow;switch(Vb.kind){case dc.GotoCtrlClickResultKind.RangeResolutionFailure:case dc.GotoCtrlClickResultKind.Failure:this.hide();Va.ULS.sendTraceTag(507339546,0,15,`GotoCtrlClick.handleResult: Request Failed with error: ${dc.GotoCtrlClickResultKind[Vb.kind]}`);
break;case dc.GotoCtrlClickResultKind.NoReferenceFound:this.hide();break;case dc.GotoCtrlClickResultKind.ReferenceFound:cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8846243_GotoCtrlClickTeachingCallout")&&this.control.showCallout(this.$);this.aUb&&this.show(Ec,Vb);break;default:return Vb}cb.getInstance(this.$).setResult(Vb,Ec)};this.lO=Vb=>{var Ec;Vb.ctrlKey&&(null===(Ec=this.sfb)||void 0===Ec?void 0:Ec.kind)===dc.GotoCtrlClickResultKind.ReferenceFound&&(Ec=(Vb=$b.jb(this.sfb.sheetRange))?"client":
"server",cb.getInstance(this.$).b6i(this.JKb,Ec),Vb?this.WJg(Vb):(Vb=this.sfb.span,this.requester.Q0i(this.$,this.JKb.text.substring(Vb.start,Vb.end),this.WJg,this.S4j)))};this.iL=Vb=>{Vb.ctrlKey&&(Vb.preventDefault(),Vb.stopPropagation())};this.WJg=Vb=>{this.JKb.isEditing&&this.JKb.endEdit(!0,"GotoCtrlClick.resetAndPerformGoto",1);this.reset();this.da.lj(Vb,null,null,null,60,"GotoCtrlClick");cb.getInstance(this.$).ZPf(!0)};this.S4j=()=>{Va.ULS.sendTraceTag(507331928,0,15,"GotoCtrlClick.onServerOperationFailure: Request Failed");
cb.getInstance(this.$).ZPf(!1)};this.reset=()=>{var Vb;this.hide();this.JKb=this.sfb=this.zl=void 0;null===(Vb=this.ksc)||void 0===Vb?void 0:Vb.XH();this.ksc=void 0;this.handler.Lpc();this.requester.clearCache()};this.Py=()=>{this.handler.Lpc();this.requester.clearCache()};this.control=new V(this.$);this.requester=new Cb(this.pluginScheduler);this.handler=new qb(this.$,this.onHoverEnter,this.onHoverLeave,this.i9d);this.Aj()}dispose(){this.Bi();this.handler.dispose();this.control.dispose()}Aj(){this.da.Rb.Uq(this.reset);
this.da.ha.JCa(this.reset);this.$.fa.qF(this.Py)}Bi(){this.da.Rb.gq(this.reset);this.da.ha.wxa(this.reset);this.$.fa.wG(this.Py)}async mgk(ca,bb,Hb){this.zl=Hb=Object.assign({},ca,{ow:Hb});ca=await bb(ca);!Object(Pd.c)(ca)&&this.YYd(Hb)&&await this.k9i(ca)}show(ca,bb){this.control.show(ca,bb)}hide(){this.control.hide()}YYd(ca){return this.zl?this.zl.text===ca.text&&this.zl.index===ca.index&&this.zl.length===ca.length&&this.zl.ow===ca.ow:!1}};pb=Object(hb.__decorate)([Object(Zb.d)(uc.GotoCtrlClickService),
Object(hb.__param)(0,Object(uc.EwaControlService)()),Object(hb.__param)(1,Object(Bf.f)()),Object(hb.__param)(2,Object(uc.GridViewService)())],pb);Object($a.a)(pb,"GotoCtrlClick",null,[4]);Object(Zb.b)(uc.ImmediateFormulaCellComparisonService,{we:"singleton"})(async()=>Jb);const Jb=async(ca,bb)=>{if(G(ca)&&G(bb)){var Hb=A(ca),Vb=A(bb);bb=await K(Hb);ca=await K(Vb);{const Ec=N(Hb.value,Vb.value);"different"!==Ec.kind?Hb=Ec:(Hb=N(Hb.unformattedValue,Vb.unformattedValue),Hb={kind:"different",diff:Ec.diff,
unformatted:Hb})}bb={cse:bb,immediate:ca,diagnostic:Hb,cellValueFix:cc.EwaSettings.lFc()};Va.ULS.sendTraceTag(507646813,1,20,`ImmediateCellComparison.compareCells, result: ${JSON.stringify(bb)}`)}};let zc=class{constructor(ca,bb){this.$=ca;this.clearContentNotifier=bb;this.keptData={suggestionsKept:0,suggestionsCommitted:0,suggestionsChanged:0,suggestionsReverted:0,suggestionsDeleted:0};this.wg=(Hb,Vb)=>{this.q$g()&&Vb.committed&&Vb.Lk.equals(this.Hva.suggestion.Lk)&&this.Hva.suggestion.cellText!==
Vb.cellText&&this.keptData.suggestionsChanged++};this.twa=()=>{var Hb;if(this.q$g()){var Vb=this.da.ha.oa.selectedRanges,Ec=null===(Hb=this.Hva)||void 0===Hb?void 0:Hb.suggestion.Lk;Vb.some(rd=>rd.contains(Ec))&&this.keptData.suggestionsDeleted++}};this.n3=(Hb,Vb)=>{0===Vb.Fq&&(170===Vb.jg.operation.operationName&&this.keptData.suggestionsReverted++,this.$.userOperationManager.kn(this.n3))};this.da=pa.f(this.$)}qMd(){this.keptData.suggestionsKept=this.QTi();return this.keptData}ttg(ca){this.keptData.suggestionsCommitted++;
this.Hva={suggestion:ca,stateId:this.$.fa.Je};this.Aj()}Aj(){this.da.cellTextEditBox.Uq(this.wg);this.clearContentNotifier.wFb(this.twa);this.$.userOperationManager.Kp(this.n3)}Bi(){this.da.cellTextEditBox.gq(this.wg);this.clearContentNotifier.q3b(this.twa)}q$g(){this.Bi();if(null!==this.Hva&&1===this.$.fa.Je-this.Hva.stateId)return!0;this.Hva=null;return!1}QTi(){return this.keptData.suggestionsCommitted-(this.keptData.suggestionsChanged+this.keptData.suggestionsDeleted+this.keptData.suggestionsReverted)}};
zc=Object(hb.__decorate)([Object(Zb.d)(uc.KeptTelemetryHandlerService,{we:"transient"}),Object(hb.__param)(0,Object(uc.EwaControlService)()),Object(hb.__param)(1,Object(uc.ClearContentNotifierService)())],zc);Object($a.a)(zc,"KeptTelemetryHandler",null,[]);const Mc="PrefetchNotStarted;PrefetchResultCleared;Ctor;EvalInProgress;ResultUnavailable;RangeNotFoundInPrefetchResult;FinalizeNumberFormattedValueFailed;EvalOnCloneFailed;EvalFormulaRangeOnClonedModelFailed;SetCellPrefetchPluginFailed;SetCellPrefetchPluginRequestFailed;Invalid input to Plugin;SetCellPrefetchPlugin: getValueFromCellValue failed;SetCellPrefetchPlugin GetActiveCellFormat result or value is null;SetCellPrefetchPlugin EvalOnCloneResult failed;offScreenCanvasRender: renderValue failed;offScreenCanvasRender: renderHashesValue failed;Invalid OperKind;UndefinedCell;UnsupportedNonEditMode".split(";");
var od;let Td=od=class{constructor(ca,bb,Hb,Vb){this.Rs=Hb;this.PBj=Vb;this.OZa=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8606468_FinalizeToPrefetchCG");this.r2=cc.EwaSettings.lFc();this.pRc=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetCellPrefetchPluginEnabled",!1);this.o3=()=>{this.pRc?this.UQ=Object(vc.a)({message:"PrefetchNotStarted"}):this.OZa?this.P2=Object(vc.a)({message:"PrefetchNotStarted"}):this.YIa=Object(vc.a)({message:"PrefetchNotStarted"})};this.Zlg=(Ec,rd)=>{Ec=
this.da.ha.oa.activeCell;const Id=this.da.Ob(Ec);null!=Id&&this.Odk(Ec,rd.text,Id.cell.oi,Id.cell.aB.Snc,this.da.$.activeItemName)};this.Yd=ca;this.da=bb;this.P2=Object(vc.a)({message:"Ctor"});this.YIa=Object(vc.a)({message:"Ctor"});this.UQ=Object(vc.a)({message:"Ctor"});ca=cc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SetCellEstimationPrefetchMsDebounce",100);this.Odk=pd.a((Ec,rd,Id,W,Ra)=>this.prefetch({text:rd,range:Ec,ifmt:Id,stateId:W,sheetName:Ra}),ca);this.da.Rb.Jp(this.o3);this.da.Ej.lod(this.Zlg)}dispose(){this.da.Ej.XTc(this.Zlg);
this.da.Rb.zp(this.o3);this.Zef()}zGf(ca){if(Object(vc.b)(this.YIa))return Object(vc.a)(this.YIa.reason.message);if(od.Fqd(ca,this.YIa.value.key)){for(const bb of this.YIa.value.results.results)if(Object(vc.c)(bb)&&od.Pvj(ca,bb))return bb;return Object(vc.a)("RangeNotFoundInPrefetchResult")}return Object(vc.a)("ResultUnavailable")}yGf(ca,bb){return this.pRc?Object(vc.b)(this.UQ)?Object(vc.a)(this.UQ.reason.message):od.Fqd(ca,this.UQ.value.key)?Object(vc.c)(this.UQ)?bb?Object(vc.d)({key:this.UQ.value.key,
INb:void 0,evaluatedResult:this.UQ.value.evaluatedResult}):this.UQ:Object(vc.a)("RangeNotFoundInPrefetchResult"):Object(vc.a)("ResultUnavailable"):Object(vc.b)(this.P2)?Object(vc.a)(this.P2.reason.message):od.Fqd(ca,this.P2.value.key)?Object(vc.c)(this.P2)?bb?Object(vc.d)({key:this.P2.value.key,INb:void 0,evaluatedResult:this.P2.value.evaluatedResult}):this.P2:Object(vc.a)("RangeNotFoundInPrefetchResult"):Object(vc.a)("ResultUnavailable")}Zef(){this.pRc?this.UQ=Object(vc.a)({message:"PrefetchResultCleared"}):
this.OZa?this.P2=Object(vc.a)({message:"PrefetchResultCleared"}):this.YIa=Object(vc.a)({message:"PrefetchResultCleared"})}prefetch(ca){if(this.pRc)if(this.da.$.isEditMode){this.UQ=Object(vc.a)({message:"EvalInProgress",key:ca});const bb=this.da.Ob(ca.range);(null===bb||void 0===bb?0:bb.cell)?void this.PBj(1).then(Hb=>{var Vb;if(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8910435_MoveActiveCellToPrefetcherPlugin")){var Ec=this.da.ha.oa.activeCell;Va.ULS.shipAssertTag(507250331,0,Ec.top===ca.range.top&&
Ec.left===ca.range.left,"SetCellEstimationPrefetcher.prefetch: prefetchParams range is not the same as activeCell range");Ec=this.da.$.qa.getItemByName(ca.sheetName);const rd=this.Yd.RJb(ca.range,!1);Hb.notifier().setActiveCell({colIndex:ca.range.left-1,rowIndex:ca.range.top-1,sheetIndex:Wa.d(Ec),docPath:rd.sheet.document.path,docName:rd.sheet.document.name})}Ec={text:ca.text,textMaxWidth:bb.cell.textMaxWidth,ifmt:ca.ifmt,font:bb.cell.S0};Hb=Hb.requester().setCellPrefetch(Ec,dc.PluginGroup.Excel,
void 0);null===(Vb=null===Hb||void 0===Hb?void 0:Hb.then(rd=>{"Done"===rd.kind&&rd.payload?this.j$i(ca,rd.payload):this.UQ=Object(vc.a)({message:"SetCellPrefetchPluginFailed",key:ca})}))||void 0===Vb?void 0:Vb.catch(rd=>{this.UQ=Object(vc.a)({message:"SetCellPrefetchPluginRequestFailed",key:ca});Va.ULS.sendTraceTag(507610177,0,50,`SetCellEstimationPrefetcher.prefetch: setCellPrefetch request rejected with error ${rd}`)})}):this.UQ=Object(vc.a)({message:"UndefinedCell",key:ca})}else this.UQ=Object(vc.a)({message:"UnsupportedNonEditMode",
key:ca});else this.OZa?this.P2=Object(vc.a)({message:"EvalInProgress",key:ca}):this.YIa=Object(vc.a)({message:"EvalInProgress",key:ca}),this.Yd.u1([],ca.range,ca.range,ca.text,!0).then(bb=>{if(this.OZa){var Hb=this.da.Ob(ca.range);bb=bb.results[0];if("Success"===bb.kind&&Hb){const Vb=this.Rs.fPb(bb.value);let Ec=void 0;this.r2&&(Ec=this.Rs.ePb(bb.value,this.Yd.config.mathpack));Hb=this.Yd.n7(bb.value.formatted,Vb,Hb.cell.textMaxWidth,Hb.cell.S0,ca.ifmt,!1,Ec);this.P2="Success"===Hb.kind?Object(vc.d)({key:ca,
INb:Hb.value,evaluatedResult:bb.value}):Object(vc.a)({message:"FinalizeNumberFormattedValueFailed"})}else this.P2=Object(vc.a)({message:"EvalOnCloneFailed"})}else this.YIa=Object(vc.d)({key:ca,results:bb})}).catch(bb=>{this.P2=Object(vc.a)({message:"EvalFormulaRangeOnClonedModelFailed"});Va.ULS.sendTraceTag(509219811,0,50,`SetCellEstimationPrefetcher.prefetch: evalFormulaRangeOnClonedModel promise rejected with error ${bb}`)})}j$i(ca,bb){if(bb.failureMessage&&void 0!==bb.failureMessage)this.Juj(bb.failureMessage)&&
(this.UQ=Object(vc.a)({message:bb.failureMessage}));else{const Hb={cell:{row:bb.evaluatedResult.cell.firstRow,col:bb.evaluatedResult.cell.firstColumn},value:bb.evaluatedResult.value.value,formatted:bb.evaluatedResult.formatted};bb=this.YAi(ca,Hb,bb.numberFormattedText);this.UQ=Object(vc.d)({key:ca,INb:bb,evaluatedResult:Hb})}}YAi(ca,bb,Hb){const Vb=this.Rs.fPb(bb);var Ec={units:bb.formatted.units,color:bb.formatted.color,alignment:bb.formatted.alignment};const rd=this.Rs.HJf(Ec),Id=this.Rs.TIf(Ec),
W=this.Rs.rId(bb.formatted,Ec);Ec=excelOnlineCalc.numfmt.isHashesValue(Ec);let Ra=void 0;this.r2&&(Ra=this.Rs.ePb(bb,this.Yd.config.mathpack));return{text:Hb,valueType:Vb,fontColor:Id,format:ca.ifmt,horizontalAlignment:rd,numFmt:W,isHashesValue:Ec,cellValue:Ra}}Juj(ca){const bb=0<=Mc.findIndex(Hb=>Hb===ca);if(!bb)throw Error(`SetCellEstimationPrefetcher.handleSetCellResponse: failureMessage ${ca} is not a valid failure message.`);return bb}static Fqd(ca,bb){return ca.text===bb.text&&ca.range.toString()===
bb.range.toString()&&ca.ifmt===bb.ifmt&&ca.stateId===bb.stateId&&ca.sheetName===bb.sheetName}static Pvj(ca,bb){return ca.range.top-1===bb.value.cell.row&&ca.range.left-1===bb.value.cell.col}};Td=od=Object(hb.__decorate)([Object(Zb.d)(uc.SetCellEstimationPrefetcherService),Object(hb.__param)(0,Object(uc.CalcManagerService)()),Object(hb.__param)(1,Object(uc.GridViewService)()),Object(hb.__param)(2,Object(uc.CalcInterfaceAdapterService)()),Object(hb.__param)(3,Object(Bf.f)({CU:!0}))],Td);Object($a.a)(Td,
"SetCellEstimationPrefetcher",null,[714,4]);var Zd=a(430),xe=a(1048);class pe extends Zd.a{constructor(ca){super();this.$=ca;this.ri()}create(){(ca=>Zb.a.resolve(uc.CalcManagerService).then(bb=>setTimeout(()=>ca(bb),0)))(ca=>{ca=this.$.ra.Tb(294)||this.$.ra.zc(294,new xe.RelativeAndAbsoluteReferencesManager(ca));this.Uf(ca)})}static Ea(ca){ca.ra.zc(295,new pe(ca))}}Object($a.a)(pe,"RelativeAndAbsoluteReferencesManagerFactory",Zd.a,[]);var Re=a(9),pf=a(325);class vf extends Zd.a{constructor(ca){super();
this.RDk="formulaAssistance";this.$=ca;this.ri()}create(){let ca=this.$.ra.Tb(448);ca?this.Uf(ca):void Object(pf.loadChunkWithDynamicScriptLoader)(this.RDk,{xa:this.Cc}).then(()=>{ca=this.$.ra.Tb(448);ca||(ca=this.$.ra.zc(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:this.$.isFeedbackEnabled})),this.$.cvd(()=>{const bb={};bb.isFeedbackAllowed=this.$.isFeedbackEnabled;ca.updateContext(bb)}));this.Uf(ca)})}static Ea(ca){ca.ra.zc(449,new vf(ca))}}Object($a.a)(vf,"FormulaAssistanceUIControlFactory",
Zd.a,[]);var Qf=a(1138),yf=a(222),Df=a(259),pg=a(59);class Zf{constructor(ca){this.scheduler=ca;this.eyb=void 0}async aWf(){this.eyb||(this.eyb=await Zb.a.resolve(uc.AugmentationLoopManagerService));return this.eyb}async registerOnAnnotation(ca,bb,Hb,Vb){var Ec;const rd=(W,Ra)=>{(0,this.scheduler.alAnnotationNotifier()[ca])(Ra.annotation).catch(nc=>{Va.ULS.sendTraceTag(508048724,0,10,`IALInterop.onAnnotationReceived: Failed to send annotation to x10 handlers. ${nc}`)})},Id=null!==(Ec=this.eyb)&&void 0!==
Ec?Ec:await this.aWf();return null===Id||void 0===Id?void 0:Id.register(Id.RT().NV(Hb).LV(()=>{}).activateAnnotation({annotationType:bb,ls:Vb,dO:rd}).build())}async sendSignal(ca){var bb;const Hb=null!==(bb=this.eyb)&&void 0!==bb?bb:await this.aWf();return null===Hb||void 0===Hb?void 0:Hb.qvb(ca)}}Object($a.a)(Zf,"ALProvider",null,[]);class Tg{constructor(ca){this.$il=ca;this.value=void 0}bE(){void 0===this.value&&(this.value=this.$il());return this.value}reset(){this.value=void 0}}Object($a.a)(Tg,
"ResettableLazy",null,[]);class Wg extends Tg{constructor(ca,bb,Hb){Hb=void 0===Hb?Date.now:Hb;super(async()=>{var Vb=Hb(),Ec=ca();const rd=Hb()-Vb;Ec=await Ec;Vb=Hb()-Vb-rd;this.log(rd,Vb);return Ec});this.name=bb}log(ca,bb){Va.ULS.sendTraceTag(507314634,0,50,`TrackableAsyncLazy(EWA): name: ${this.name}, syncTime: ${ca}, asyncTime: ${bb}`)}reset(){throw Error("Resetting a TrackableAsyncLazy is not allowed");}}Object($a.a)(Wg,"TrackableAsyncLazy",Tg,[]);class ph{constructor(){this.rYd=new Map;this.QBj=
new Tg(async()=>(await Zb.a.resolve(uc.TableIntelligenceManagerService,{xa:0})).Hja());this.rYd.set(dc.PluginFactoryName.FormulaByExamplePlugin,new Tg(async()=>{const ca=await Zb.a.resolve(uc.EwaControlService);return Tb.a.UZa(ca)}));this.rYd.set(dc.PluginFactoryName.TestPlugin,new Tg(async()=>!0))}async getRecognizedRangeTablesInfo(ca,bb,Hb,Vb,Ec){var rd,Id;if(null===(Id=await (null===(rd=this.rYd.get(Vb))||void 0===rd?void 0:rd.bE()))||void 0===Id||!Id)return Va.ULS.sendTraceTag(507794771,306,50,
`x10TableIntelligenceService.getRecognizedRangeTablesInfo: plugin ${Vb} is not licensed for user`),[];ca=bb?new Jf.a(Object($b.D)(bb),ca):null;a:{switch(Hb){case dc.RecognizedTablesMetadataState.Valid:Hb=2;break a;case dc.RecognizedTablesMetadataState.Invalid:Hb=4;break a;case dc.RecognizedTablesMetadataState.All:Hb=6;break a}Hb=void 0}return(await this.QBj.bE()).yXa(ca,Hb,Ec).map(I)}}Object($a.a)(ph,"X10TableIntelligenceProvider",null,[]);class Ug extends Zd.a{constructor(ca){super();this.$=ca;this.ozd=
null;this.Apk=new Wg(...[async()=>{const bb=await this.kjj.bE();this.$.ra.zc(413,bb);return bb},"registeredPluginScheduler"]);this.kjj=new Wg(...[async()=>{await Zb.a.resolve(uc.ExcelOnlineCalc,{xa:this.Cc});const bb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();var Hb=await Zb.a.resolve(uc.DynamicScriptLoaderProviderIdentifier,{xa:this.Cc});excelOnlineCalc.x10.resolveScriptLoaderPromise(Hb.Iz());bb.registerALProvider(new Zf(bb));bb.registerTableIntelligenceProvider(new ph);excelOnlineCalc.x10.setX10Features(this.APf());
Hb=(await Promise.all([excelOnlineCalc.x10.ensureGroupAttached(dc.PluginAttachGroup.Core),Tb.a.qlb(this.$)?excelOnlineCalc.x10.ensureGroupAttached(dc.PluginAttachGroup.SmartSuggestionsAutoComplete):0])).reduce((Vb,Ec)=>Vb+Ec,0);(await Zb.a.resolve(Bf.d,{xa:this.Cc})).MR.anyPluginInitialized=0<Hb;return bb},"initializedPluginScheduler"]);this.ri()}create(){Va.ULS.sendTraceTag(537154643,0,50,"PluginSchedulerFactory.Create: Loading scheduler slice");cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8763136_UseNewXPlatEwaX10Init")?
this.Apk.bE().then(ca=>{this.Uf(ca)},ca=>{Va.ULS.sendTraceTag(507381790,0,10,"PluginSchedulerFactory.Create: Error loading scheduler slice: "+ca)}):Qf.a.then(this.i$h(),ca=>{this.Uf(ca)})}i$h(){if(this.ozd)return this.ozd;const ca=Df.a.jfb(yf.a.none,"LoadResource","x10Scheduler loading",cc.EwaSettings.Og()?null:pg.telemetryManager());(bb=>Zb.a.resolve(uc.CalcManagerService,{xa:this.Cc}).then(Hb=>setTimeout(()=>bb(Hb),0)))(()=>{this.fDj(bb=>{const Hb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();
bb=bb.Iz();bb=zf.c(Ud.Task.Va(bb));Hb.registerALProvider(new Zf(Hb));cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8479330_enableTableIntelligenceInX10")&&Hb.registerTableIntelligenceProvider(new ph);const Vb=this.APf();cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7913510_sendSchedulerFeaturesNOtification")&&Hb.notifier().setSchedulerFeatures(Vb.map(Ec=>dc.SchedulerFeature[Ec]));Promise.all([excelOnlineCalc.x10.ensureGroupAttachedLegacy(bb,dc.PluginAttachGroup.Core,Vb),Tb.a.qlb(this.$)?excelOnlineCalc.x10.ensureGroupAttachedLegacy(bb,
dc.PluginAttachGroup.SmartSuggestionsAutoComplete,Vb):0]).then(Ec=>Ec.some(rd=>0<rd)).then(Ec=>{this.$.ra.zc(413,Hb);ca.setResult(Hb);this.$.ra.Vc(491,rd=>{rd.MR.anyPluginInitialized=Ec})})})});return this.ozd=ca.task}fDj(ca){void Zb.a.resolve(uc.DynamicScriptLoaderProviderIdentifier,{xa:this.Cc}).then(bb=>ca(bb))}APf(){const ca=[];fh.forEach((bb,Hb)=>{bb(this.$)&&ca.push(Hb)});return ca}static Ea(ca){ca.ra.zc(414,new Ug(ca))}}Object($a.a)(Ug,"PluginSchedulerFactory",Zd.a,[]);const fh=new Map([["ArgumentAssistance",
()=>!0],["SimpleAutoComplete",()=>!0],["SmartSuggestionsAutoComplete",ca=>Tb.a.qlb(ca)],["ValuePreview",()=>Tb.a.xka()],["ColoredReferences",()=>!0],["ParenthesisCoupling",()=>!0],["SyntaxErrors",()=>Tb.a.yUb()],["EnumAutoComplete",()=>!0],["GotoCtrlClick",()=>Tb.a.X0f()]]),rg={selectByArrowKeyCounter:0,selectByMouseHoverCounter:0,commitByTabKeyCounter:0,commitByEnterKeyCounter:0,commitByMouseClickCounter:0,commitWhileRequestPending:0,dismissSmartSuggestionExplicitlyCounter:0,dismissSmartSuggestionImplicitlyCounter:0},
jh={formulaAssistanceRequestAttemptedCounter:0,formulaAssistanceRequestOptimizedCounter:0},zh={argumentAssistanceCardInitialMode:void 0,argumentAssistanceCollapseCounter:0,argumentAssistanceExpandCounter:0,argumentAssistanceLearnMoreCounter:0,argumentAssistanceDragCounter:0,argumentAssistanceDragTotalCounter:0,argumentAssistanceMoveCounter:0,argumentAssistanceMoveTotalCounter:0,argumentAssistanceCardIsInitialModeDefault:!1},zg={smartSuggestionShownCounter:0,smartSuggestionSelectedCounter:0,smartSuggestionCommittedCounter:0,
smartSuggestionKeptCounter:0,smartSuggestionChangedCounter:0,smartSuggestionDeletedCounter:0,smartSuggestionRevertedCounter:0,isCellContentOnlyEqualDuringEditCounter:0,isCellContentFormulaCounter:0,smartSuggestionWouldSuggestInsidePivotCounter:0},Zg={parenthesesCouplingCounter:0,formulaHighlightsCounter:0},ab={dialogCommittedCounter:0,dialogShownCounter:0,argsDialogOpenedByRibbonCounter:0,argsDialogOpenedByDialogCounter:0,argsDialogCommittedCounter:0},Ua={argumentAssistanceFlight:void 0,autoCompleteUIFlight:void 0,
smartFormulaBarAutoCompletePluginFlight:void 0,anyPluginInitialized:void 0,formulaAssistanceRedesignFlight:void 0,smartFormulaSuggestionsFeatureEnabled:void 0,parenthesesCouplingFlight:void 0,coloredReferencesFlight:void 0,uILocale:void 0,dataLocale:void 0,country:void 0,formulaAssistanceUiPositionFlight:void 0,argumentAssistanceUxFlight:void 0};var hd;(function(ca){ca.RenderDown="rd";ca.RenderUp="ru";ca.Expand="e";ca.Collapse="c";ca.Drag="d";ca.Move="m";ca.GiveFeedback="gf";ca.InitialModeExpanded=
"ie";ca.InitialModeCollapsed="ic";ca.LearnMore="lm";ca.ESC="esc";ca.SecondESC="2ndEsc"})(hd||(hd={}));Object($a.b)("argumentAssistanceUsageActions",hd);var qe=a(58),Ae=a(48),ef=a(113);const Tf={["argumentAssistanceOverall"]:[50,80,100,130,150,170,200],["autoCompleteOverall"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteOverallSimpleAndSmart"]:[50,80,100,130,150,170,200],["autoCompleteOverallSmartOnly"]:[50,80,100,130,150,170,200],["autoCompleteOverallSimpleOnly"]:[50,80,100,130,150,170,
200],["tryUpdateHighlightsFromCellContentEditor"]:[50,80,100,130,150,170,200],["autoCompleteComputation"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteComputationNoResult"]:[50,80,100,130,150,170,200,250,300,350,400]};class Nf{constructor(ca,bb){this.$=ca;this.NYg=bb;this.MIa=Tb.a.LGc();this.WK=null;this.ZJc=-1;this.z1d=null;this.A1d=this.$Jc=0;this.Lha=Object.assign({},zh);this.kQ=Object.assign({},zg);this.Rqa=Object.assign({},rg);this.Krd=Object.assign({},jh);this.DId=Object.assign({},
Zg);this.MR=Object.assign({},Ua);this.bHb={};this.Uhb=Object.assign({},ab);this.JGb=[];this.anc=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.JUa={};this.wg=(Hb,Vb)=>{null!=this.WK&&(1==Math.abs(this.ZJc-this.$.fa.Je)&&(Hb=this.$.qa.la.sheetId,Vb.committed&&Vb.Lk.equals(this.WK.Lk)&&this.z1d===Hb&&this.WK.cellText!==Vb.cellText&&this.$Jc++),1<=Math.abs(this.ZJc-this.$.fa.Je)&&(this.WK=null,this.ZJc=-1,this.z1d=null));0<Object.keys(this.JUa).length&&
(Va.ULS.sendTraceTag(509658956,0,50,`FormulaAssistanceTelemetryManager.onEditEnded: current edit's completion items data: ${JSON.stringify(this.JUa)}`),this.JUa={})};this.jd=(Hb,Vb)=>{Vb.Hg||Vb.elb||(this.ASg(),this.TMk(),this.$.sendBeaconTraceTag(88392384,50,!1,"{0}",this.getJsonForLogging()))};this.Aqb=new ef.a;ca.Sj(this.jd);this.MIa||pa.f(this.$).Ej.Uq(this.wg);this.ASg();this.gHj()}dispose(){!this.MIa&&this.$&&pa.f(this.$).Ej.gq(this.wg)}RMa(ca){ca.forEach(bb=>{this.Aqb.Bb(bb)||this.Aqb.ga(bb,
new Nb(Tf[bb]));this.Aqb.pa(bb).p6a()})}o1(ca,bb){bb=void 0===bb?!0:bb;ca.forEach(Hb=>{this.Aqb.Bb(Hb)&&this.Aqb.pa(Hb).n1(bb)})}aIk(ca){this.wha(ca?"ie":"ic")}$Hk(){this.Lha.argumentAssistanceCardIsInitialModeDefault=!0}DMb(ca){window.requestAnimationFrame(()=>{this.o1([ca])})}Gwk(ca){ca.forEach(bb=>{bb=dc.CompletionItemKind[bb.kind];this.M$g(bb);this.bHb[bb].shownCounter++;this.JUa[bb].shownCounter++})}Fwk(ca){ca=dc.CompletionItemKind[ca];this.M$g(ca);this.bHb[ca].committedCounter++;this.JUa[ca].committedCounter++}wha(ca){if(this.anc){const bb=
this.JGb.length;0===bb||this.JGb[bb-1][0]!==ca?this.JGb.push([ca,1]):this.JGb[bb-1][1]++}else switch(ca){case "e":this.Lha.argumentAssistanceExpandCounter++;break;case "c":this.Lha.argumentAssistanceCollapseCounter++;break;case "d":this.Lha.argumentAssistanceDragCounter++;break;case "m":this.Lha.argumentAssistanceMoveCounter++;break;case "lm":this.Lha.argumentAssistanceLearnMoreCounter++;break;case "ie":this.Lha.argumentAssistanceCardInitialMode="Expanded";break;case "ic":this.Lha.argumentAssistanceCardInitialMode=
"Collapsed"}}UKk(ca){this.NYg.ttg(ca)}gHj(){Va.ULS.sendTraceTag(509140996,0,50,`FormulaAssistanceTelemetryManager.SessionDetails: ${qe.a.Nc(this.MR)}`)}getJsonForLogging(){return"{"+this.oT("SessionDetails",this.MR)+","+this.oT("ArgumentAssistanceUsage",this.Lha)+","+this.oT("argumentAssistanceOrderedActions",this.JGb)+","+this.oT("FormulaSuggestionsUsage",this.kQ)+","+this.oT("FunctionDialogUsage",this.Uhb)+","+this.oT("AutocompleteCardInteraction",this.Rqa)+","+this.oT("AutocompleteRenderOptimization",
this.Krd)+","+this.oT("AutocompleteUsageByKind",this.bHb)+","+this.oT("FormulaHighlightsUsage",this.DId)+","+this.y0i()+"}"}TMk(){if(this.MIa){var ca=this.NYg.qMd();this.kQ.smartSuggestionKeptCounter=ca.suggestionsKept;this.kQ.smartSuggestionChangedCounter=ca.suggestionsChanged;this.kQ.smartSuggestionDeletedCounter=ca.suggestionsDeleted;this.kQ.smartSuggestionRevertedCounter=ca.suggestionsReverted}else this.kQ.smartSuggestionChangedCounter=this.$Jc,this.kQ.smartSuggestionDeletedCounter=this.A1d,this.kQ.smartSuggestionKeptCounter=
this.kQ.smartSuggestionCommittedCounter-this.$Jc-this.A1d;for(ca=0;ca<this.kQ.smartSuggestionKeptCounter;ca++)Object(bd.c)(Xb)}ASg(){this.MR.argumentAssistanceFlight="T";this.MR.autoCompleteUIFlight=this.JIf("Microsoft.Office.Excel.","AutoCompleteNewUI");this.MR.smartFormulaBarAutoCompletePluginFlight="T";this.MR.formulaAssistanceRedesignFlight="T";this.MR.coloredReferencesFlight="T";this.MR.parenthesesCouplingFlight="T";this.MR.formulaAssistanceUiPositionFlight="T";this.MR.smartFormulaSuggestionsFeatureEnabled=
Tb.a.qlb(this.$);this.MR.argumentAssistanceUxFlight="T";this.MR.uILocale=this.$.O4;this.MR.dataLocale=this.$.dataCultureTag;this.MR.country=JSON.parse(this.$.ta.SessionStartInfoJson).LocationCountry}y0i(){const ca=[];for(const bb of this.Aqb)bb.value.KGd(),ca.push(`"${bb.key}":${qe.a.Nc(bb.value.lZ)}`);return`"PerfMeasurements": {${ca.join(",")}}`}JIf(ca,bb){return fb.a.contains(this.$.ta.FlightHolder.FlightId,bb,!0)?cc.EwaSettings.getBooleanFeatureGate(ca+bb,!1)?"T":"C":"None"}oT(ca,bb){return`"${ca.toString()}":${Ae.c(bb)}`}M$g(ca){this.bHb[ca]||
(this.bHb[ca]={shownCounter:0,committedCounter:0});this.JUa[ca]||(this.JUa[ca]={shownCounter:0,committedCounter:0})}}Object($a.a)(Nf,"FormulaAssistanceTelemetryManager",null,[756]);class wg extends Zd.a{constructor(ca){super();this.$=ca;this.ri()}static Ea(ca){ca.ra.zc(492,new wg(ca))}create(){void Zb.a.resolve(uc.KeptTelemetryHandlerService).then(ca=>{var bb;this.Uf(null!==(bb=this.$.ra.Tb(491))&&void 0!==bb?bb:this.$.ra.zc(491,new Nf(this.$,ca)))})}}Object($a.a)(wg,"FormulaAssistanceTelemetryManagerFactory",
Zd.a,[]);var Uf=a(936),lg=a(43),Kg=a(1464);class If extends Ed.a{constructor(ca){super(ca,If.featureName);this.HXf=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")}static init(ca){If.Wa?Va.ULS.sendTraceTag(509122372,1,15,"FormulaSuggestionUIControl.init: unexpected call after already being inited."):If.Wa=new If(ca)}static instance(){return If.Wa}get tf(){return de.a.zId}show(ca,bb,Hb,Vb,Ec,rd,Id,W){rd=void 0===rd?null:rd;return this.Oub(void 0===Id?null:Id,Ra=>{appChrome.renderFormulaSuggestionCard(ca,
bb,this.domElement,Ra.y,Ra.x,Ra.y+Ra.height,Ra.x+Ra.width,Hb,Vb,Ec,rd,this.Ztb,W?{explanationKey:W.explanationKey,replacements:W.explanationReplacements,notifyExplanationSuccessful:W.RNc}:void 0)})}yte(ca,bb,Hb,Vb,Ec,rd,Id,W,Ra,nc,yc){return this.Oub(yc,Fd=>{appChrome.renderRowNumberingSuggestionCard(ca,bb,this.domElement,Fd.y,Fd.x,Fd.y+Fd.height,Fd.x+Fd.width,Hb,Vb,Ec,rd,Id,W,Ra,nc,this.Ztb)})}TV(ca,bb,Hb){cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",
!1)&&(this.X0&&ca.equals(this.p1d)||(this.X0&&document.body.removeChild(this.X0),this.p1d=ca,ca=this.grid.Ob(ca),ca=this.grid.getCellBounds(ca.cell,!0),this.X0=document.createElement("div"),this.X0.setAttribute("style",`position:fixed;
        left: ${ca.x+ca.width}px;
        top: ${ca.y+ca.height/2}px`),document.body.appendChild(this.X0)),ca=new ld.a(-847286761,0,this.$.xc,0,null),this.$.Ia.Gb(ca,{["CalloutName"]:15,["Target"]:this.X0,["NewState"]:bb,["Reason"]:Hb}))}}Object($a.a)(If,"FormulaByExampleCardUIControl",Ed.a,[720]);class hg extends Uf.a{constructor(ca){super(ca)}oq(){Va.ULS.sendTraceTag(528758224,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler init flow started.");const ca=df.GetServiceTaskFactory.Ne(this.$.ra,
453,454,1),bb=Object(zf.d)(Zb.a.resolve(uc.FormulaByExampleServiceProxyService,{xa:this.Cc})),Hb=Object(zf.d)(Zb.a.resolve(uc.FormulaByExampleSignalLocksManagerService,{xa:this.Cc}));lg.TaskExtensions.tb(lg.TaskExtensions.jl([ca,bb,Hb],this.Aa),()=>{if(!cc.EwaSettings.PQ()||ca.result&&bb.result&&Hb.result){var Vb=new Kg.a(bb.result,ca.result,If.instance(),Hb.result);this.fn([Vb]);Va.ULS.sendTraceTag(537161924,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler initialized successfully")}else this.fn([])},
this.Aa)}static Ea(ca){Uf.a.cw(455,new hg(ca))}}Object($a.a)(hg,"FormulaByExampleCommandHandlerFactory",Uf.a,[]);var gh=a(103),mc=a(1071);class sd{constructor(ca,bb,Hb,Vb,Ec){this.kind=ca;this.value=bb;this.formatted=Hb;this.numFmt=Vb;this.cellStyle=Ec}get displayText(){var ca;return null!==(ca=this.formatted)&&void 0!==ca?ca:this.value}}Object($a.a)(sd,"CloneEvaluatedEdit",null,[]);class ie{constructor(ca,bb,Hb){this.status=ca;this.YMb=void 0===bb?null:bb;this.drb=Hb}}Object($a.a)(ie,"FormulaByExampleFormulaEvalResult",
null,[]);var te=a(1102),Ve;(function(ca){ca[ca.none=0]="none";ca[ca.number=1]="number";ca[ca.string=2]="string";ca[ca.boolean=3]="boolean";ca[ca.error=4]="error"})(Ve||(Ve={}));Object($a.b)("CellValueType",Ve);var kf;(function(ca){ca[ca.none=0]="none";ca[ca.number=1]="number";ca[ca.string=2]="string";ca[ca.boolean=4]="boolean";ca[ca.error=8]="error";ca[ca.range=16]="range";ca[ca.array=32]="array";ca[ca.missing=64]="missing";ca[ca.blank=128]="blank";ca[ca.rich=256]="rich"})(kf||(kf={}));Object($a.b)("OperKind",
kf);var Of;(function(ca){ca[ca.NoMismatch=0]="NoMismatch";ca[ca.Mismatch=1]="Mismatch";ca[ca.HashesValueMismatch=2]="HashesValueMismatch"})(Of||(Of={}));Object($a.b)("EcsMismatchResult",Of);class Sf extends Set{constructor(ca){super();this.N8=ca}add(ca){if(this.has(ca))return this;if(this.size>=this.N8){const bb=this.entries().next().value[0];this.delete(bb)}return super.add(ca)}has(ca){const bb=super.has(ca);return bb?(this.delete(ca),super.add(ca),!0):bb}}Object($a.a)(Sf,"LimitedSizeSet",Set,[]);
class fg{constructor(ca,bb){this.dc=null;this.BUg=this.I0f=this.IG=!1;this.v1d=null;this.wee=(Hb,Vb,Ec)=>{if(!this.mGc(Hb))return Object(mc.h)(Vb,"Result object from EvalOnClone API is empty or null.",this.kj,8),new ie(2);const rd=this.til(Hb,Vb);if(!Ec&&"OnlyPreviousFailureFound"===rd.reason)return new ie(4);if(!rd.success)return Object(mc.h)(Vb,`Evaluated results from calc do not match the user data in the grid or had errors from calc. reason: ${rd.reason}`,this.kj,8),Va.ULS.sendTraceTag(537161880,
0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone:Formula results from Calc.ts do not match grid data."),new ie(2);this.kj.Xp(Vb.flowId,11);Va.ULS.sendTraceTag(537161879,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: EvalFormulaRange CSE: Result received from calc.");return new ie(0,Hb.results,rd.drb)};this.dc=ca;this.IG=bb;this.kj=te.a.getInstance(this.dc);this.I0f=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2");this.BUg=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7549840_DontShowFBESuggestionsWithErrorInTriggerCell")}Fje(ca){this.v1d&&
this.S7g(this.v1d,!0,void 0,void 0,ca)}fKk(ca,bb,Hb,Vb,Ec){Hb=void 0===Hb?null:Hb;Vb=void 0===Vb?!1:Vb;bb=ca.range.Xe(bb);return bb?this.tuf(ca,bb,Hb).then(rd=>{this.IG&&!Vb&&ca.flowId&&Object(mc.f)("CALCULATIONED",ca.flowId,Ec);if(2===rd.status)return rd;Va.ULS.sendTraceTag(537161881,0,50,"FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: evalFormulaRangeOnClone CSE: Result received from calc.");this.v1d=rd;return this.S7g(rd,Vb,ca.flowId,Ec)}).catch(rd=>{Object(mc.h)(ca,`failed to setFormulaPreviewOnRangeModel, error in calc API: ${rd.toString()}`,
this.kj,8);return Promise.reject(`FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Unable to EvalFormulaRange, e: ${rd.toString()}`)}):(Object(mc.h)(ca,"Annotation range does not intersect loaded range",this.kj,6),Promise.reject("FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Annotation range does not intersect loaded range."))}async tuf(ca,bb,Hb){let Vb,Ec;Hb=fg.sEi(void 0===Hb?null:Hb);this.kj.Xp(ca.flowId,7);try{return cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7974673_FBECircularReferenceFixCalcMitigation")?
(Vb=await this.dc.u1(null,bb,ca.originCell,ca.formula,!0),Ec=this.wee(Vb,ca,!1),4===Ec.status&&(Va.ULS.sendTraceTag(508683744,0,50,`FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: previous failure found, with no other errors, retry with cloneWrites. flow id: ${ca.flowId}`),Vb=await this.dc.u1(Hb,bb,ca.originCell,ca.formula,!0),Ec=this.wee(Vb,ca,!0))):(Vb=await this.dc.u1(Hb,bb,ca.originCell,ca.formula,!0),Ec=this.wee(Vb,ca,!0)),Ec}catch(rd){return Object(mc.h)(ca,`failed to EvalFormulaRangeOnClone, error in calc API: ${rd.toString()}`,
this.kj,8),Promise.reject(`FormulaByExampleModelUpdater:EvalFormulaOnRange: Unable to EvalFormulaRange, e: ${rd.toString()}`)}}S7e(ca,bb,Hb){var Vb;if(ca){var Ec=[];for(const W of ca){if(!ib.a.LFc(W))continue;var rd=W;ca=B(rd.value.cell);var Id=this.dc.Ob(ca);if(!Id)continue;rd=this.dLd(rd);Id=Id.cell;const Ra=Id.pL;(null===(Vb=rd.cellStyle)||void 0===Vb?0:Vb.HorizontalAlignment)&&Id.RV(rd.cellStyle.HorizontalAlignment,!0,!0);Ra||Va.ULS.sendTraceTag(508179167,0,50,`FormulaByExampleModelUpdater:applyFormulaCSE: cell CSE failed for flow ${Hb}`);
Id.text=Ra;Id.formulaBarText=bb;Ec.push({text:Ra,value:rd.value,kind:rd.kind,range:ca})}J(this.dc,Ec,Hb)}}static sEi(ca){const bb=Hb=>({row:Hb.cell.wC,column:Hb.cell.YF,Qh:Hb.Qh,formulaBarText:Hb.Qh.value,text:Hb.cell.text,oi:Hb.cell.oi});return ca?ca.map(bb):null}mGc(ca){return(ca=ca.results)&&ca.length?!0:!1}S7g(ca,bb,Hb,Vb,Ec){var rd=ca.YMb;for(const Id of rd){if(!ib.a.LFc(Id)){"Unavailable"!==Id.reason.kind&&(ca.status|=2);continue}rd=Id.value.cell;if(!rd){ca.status|=2;continue}rd=B(rd);if(Ec&&
!rd.ld(Ec))continue;rd=this.dc.Ob(rd);if(!rd){ca.status|=2;continue}const W=rd.cell,Ra=this.dLd(Id);W.pL=Ra.displayText;W.g3a=Ra.numFmt;W.H1b=Ra.cellStyle;cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")&&(W.cLg=Y(rd,Id));ca.status|=1}this.IG&&!bb&&Hb&&Object(mc.f)("MODELUPDATED",Hb,Vb);return ca}til(ca,bb){let Hb=null,Vb=!1,Ec=!1,rd=!1,Id=!1,W=!1,Ra=!1,nc=!1,yc=!1,Fd=!1;ca=ca.results;const $d=new Sf(5);var Me=ca.entries();for(const ff of Me){Me=ff[0];const jf=this.uil(ff[1],
bb);jf.zmb&&(Vb=jf.FLb);jf.s_d&&(Ec=!0,rd||(rd=jf.isInViewport),W||(W=jf.isInViewport&&!jf.LUb));Id||(Id=jf.LUb);Ra||(Ra=jf.FSf);Hb=null!==Hb&&void 0!==Hb?Hb:jf.HTa;nc||(nc=jf.z3f);yc||(yc=jf.J2f);jf.FLb&&(jf.Y6e||jf.X6e)&&$d.add(`grid: ${jf.Y6e}, clone: ${jf.X6e}`);(jf.s_d||jf.LUb)&&ca.splice(Me,1);Fd||jf.deg||(Fd=!0)}Vb?this.kj.Xp(bb.flowId,10):this.kj.Xp(bb.flowId,9);return Hb?{success:!1,reason:Hb}:nc?{success:!1,reason:"OnlyPreviousFailureFound"}:{success:!0,drb:{["hasUnavailableCells"]:Ec,["hasUnexpectedUnavailableCellsInViewport"]:W,
["hasHiddenRows"]:Id,["hasUnavailableCellsInViewport"]:rd,["hasErrorCells"]:Ra,["hasNumFmtInSuggestion"]:yc,["formattedResultsGridComparisons"]:[...$d],["renderedPreviewIsDirty"]:Fd}}}uil(ca,bb){var Hb;const Vb={zmb:!1,s_d:!1,isInViewport:!1,LUb:!1,z3f:!1,HTa:null,FSf:!1,FLb:!1,J2f:!1,deg:!1};if(!ib.a.LFc(ca)){ca=ca.reason;var Ec=wb.Range.Hc(ca.cell.row+1,ca.cell.col+1);Vb.zmb=Ec.equals(bb.originCell);this.fBf(Vb,Ec);if("Unavailable"===ca.kind)return Vb.s_d=!0,Vb;if("PreviousFailure"===ca.kind)return Vb.z3f=
!0,Vb;Vb.HTa=JSON.stringify({kind:ca.kind,innerKind:ca.innerKind});Vb.HTa=null!==(Hb=Vb.HTa)&&void 0!==Hb?Hb:"failure in calc";return Vb}var rd=B(ca.value.cell);Vb.zmb=rd.equals(bb.originCell);this.fBf(Vb,rd);Hb=this.dc.Ob(rd);if(!Hb){if(Vb.isInViewport&&!Vb.LUb)return Vb.HTa="formatted grid cell is null",Vb;Va.ULS.sendTraceTag(509682371,0,50,"FormulaByExampleModelUpdater:validateCalcResultMatchesCellData: did not fail suggestion when a formatted grid cell is null as this cell is hidden or not in view.");
return Vb}Ec=this.dLd(ca,this.I0f?Hb:null);if(8===Ec.kind)return Vb.FSf=!0,this.BUg&&Vb.zmb&&(Vb.HTa=`suggestion has error of kind ${Ec.value} in cell.`),Vb;const Id=Hb.text;if(!Id)return Vb.FLb=!0,Vb;const W=Ec.displayText;Vb.FLb=Y(Hb,ca);Vb.X6e=fb.a.XW(W);Vb.Y6e=fb.a.XW(Id);Vb.deg=Hb.cell.g3a?Hb.cell.g3a===ca.value.value.numFmt:Hb.cell.pL===ca.value.value.formattedText;Vb.FLb||(rd=bb.$_f(rd)?Vb.zmb?"MODIFIEDEXAMPLE":"EXAMPLE":Vb.zmb?"MODIFIEDRESTOFRANGE":"RESTOFRANGE",Object(mc.g)(Vb.J2f?"numFmtMismatch":
"textMismatch",Id,W.toString(),Hb.cell.oi,"evalFormulaOnCloneToShowPreview",bb,rd,Y(Hb,ca),Hb.cell.numFmt,Ec.numFmt),Vb.HTa="data strings do not match");return Vb}fBf(ca,bb){ca.isInViewport=this.dc.Iy(bb);ca.LUb=this.dc.hd.wda(bb)}dLd(ca,bb){const Hb=ca.value.value,Vb=Pg(ca).toString();if(bb&&!Hb.formattedText&&""!==Hb.formattedText){ca=ca.value.formatted;var Ec=lh(Hb.kind);ca=this.dc.n7(ca,Ec,md.a,bb);Object(vc.c)(ca)&&(Hb.formattedText=ca.value.text,Hb.numFmt=ca.value.numFmt,Ec=new v.a,Ec.HorizontalAlignment=
0===bb.cell.horizontalAlignment?ca.value.horizontalAlignment:null,Hb.cellStyle=Ec)}return new sd(Hb.kind,Vb,Hb.formattedText,Hb.numFmt,Hb.cellStyle)}}Object($a.a)(fg,"FormulaByExampleModelUpdater",null,[]);const Pg=ca=>{ca=ca.value.value;return 1===ca.kind?ca._valueXL:8===ca.kind?Ca.a.Mgb[ca.type-1]:ca.value},lh=ca=>{switch(ca){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}};var Qg=a(1286),tg=a(1285);class Dh extends tg.a{constructor(ca,bb,Hb,Vb){super(ca,bb,Hb,
Vb);this.kind="Table"}get table(){void 0===this.Pab&&(this.Pab=this.dc.dg(this.originCell,!1));return this.Pab}set table(ca){this.Pab=ca}get zs(){return this.table?ib.a.Gja(this.table):null}}Object($a.a)(Dh,"FormulaByExampleTableSuggestion",tg.a,[808]);var Gg=a(1139),gg=a(1212),Hg=a(1140),Lg=a(1288),qh=a(1244),Dg=a(1439);class mh{constructor(ca){this.tQf=!1;this.dc=ca}Qxh(ca){"ACCEPT"===ca?this.dc.Dc(-458824895,-1,0,null):"DECLINE"===ca?this.dc.Dc(-1726708382,-1,0,null):"IGNORE"===ca&&(this.tQf?this.dc.Dc(-1227021552,
-1,0,null):this.tQf=!0)}}Object($a.a)(mh,"FormulaByExampleSurveyManager",null,[]);const Rg=[Object(yb.d)("featureNameField","FormulaByExample"),Object(yb.d)("ver","1.0.0")],xg={eventName:"Office.Excel.FormulaByExample.Seen",eventFlags:bd.a,dataFields:[...Rg,Object(yb.a)("isFeatureSeen",!0)]},nh={eventName:"Office.Excel.FormulaByExample.Tried",eventFlags:bd.a,dataFields:[...Rg,Object(yb.a)("isFeatureTried",!0)]},Ah={eventName:"Office.Excel.FormulaByExample.Succeeded",eventFlags:bd.a,dataFields:[...Rg,
Object(yb.a)("isFeatureSucceeded",!0)]};var sh=a(143),eg=a(142);class th extends Sys.EventArgs{constructor(ca){super();this.suggestion=ca}}Object($a.a)(th,"FormulaByExampleAnnotationArrivedEventArgs",Sys.EventArgs,[]);class uh{constructor(ca,bb,Hb){this.formulaByExampleManager=ca;this.tna=bb;this.kj=Hb;this.CFf=Vb=>"Table"===Vb.kind?this.kj.Gyc(Vb.table.name,Vb.column):this.kj.SOb(Vb.zs,Vb.column,Vb.sheetId);this.E9d=(Vb,Ec)=>{Vb=Ec.suggestion;Ec=this.CFf(Vb);this.kJb.has(Ec)&&this.kJb.get(Ec).E9d(U(Vb))};
this.yYj=(Vb,Ec)=>{Vb=Ec.suggestion;Ec=this.CFf(Vb);let rd;this.kJb.has(Ec)?(rd=this.kJb.get(Ec),rd.E3g(U(Vb),Vb.anonymizedFormula,Vb.flowId)):(rd=new ka(Ec,Vb),this.kJb.set(Ec,rd))};this.kJb=new Map;this.formulaByExampleManager.TCh(this.E9d);this.tna.UCh(this.yYj)}}Object($a.a)(uh,"FormulaByExamplePostSuggestionSpiesManager",null,[]);class ka{constructor(ca,bb){this.aqd=ca;this.WJc=null;this.Cge=new Map;this.E3g(U(bb),bb.anonymizedFormula,bb.flowId)}E3g(ca,bb,Hb){this.N0f(ca)||(this.Cge.set(ca,new ac(ca,
bb,Hb,!0)),this.WJc=ca)}E9d(ca){if(this.WJc){var bb=this.NMf(this.WJc);bb?(ca!==this.WJc&&(bb.foc=!0,this.hag(bb)),this.N0f(ca)&&(ca=this.NMf(ca),ca.Hej(),ca.foc&&(ca.rle=!0),this.hag(ca))):Va.ULS.sendTraceTag(508687501,306,50,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: failed to get latest rejected formula records for column ${this.aqd}`)}else Va.ULS.sendTraceTag(508687502,306,15,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: unexpected state - latest rejected formula is null for column ${this.aqd}`)}NMf(ca){return this.Cge.get(ca)}N0f(ca){return this.Cge.has(ca)}hag(ca){Va.ULS.sendTraceTag(137687059,
306,20,`FormulaByExampleColumnSpy.logRejectedFormulaRecords: ${JSON.stringify({["anonymousColumnId"]:this.aqd,["suggestionFlowId"]:ca.Q1k,["formulaAnonymized"]:ca.H1,["inPatternEditsPostSuggestion"]:ca.pej,["brokePattern"]:ca.foc,["resumedPattern"]:ca.rle,["latestEditInPattern"]:ca.VJc})}`)}}Object($a.a)(ka,"ColumnSpy",null,[]);class ac{constructor(ca,bb,Hb,Vb){this.WAa=ca;this.bec=bb;this.jvh=Hb;this.YNe=0;this.did=this.S7c=!1;this.sRe=Vb}get formula(){return this.WAa}get H1(){return this.bec}get Q1k(){return this.jvh}get pej(){return this.YNe}Hej(){this.YNe++}get foc(){return this.S7c}set foc(ca){if(this.S7c=
ca)this.VJc=!1}get rle(){return this.did}set rle(ca){if(this.did=ca)this.VJc=!0}get VJc(){return this.sRe}set VJc(ca){this.sRe=ca}}Object($a.a)(ac,"ColumnSpyFormulaRecords",null,[]);class Xc extends ne.a{constructor(ca,bb,Hb){super();this.cYg=Hb;this.WK=this.rC=this.tna=this.DJa=this.dc=null;this.N_a=this.IG=!1;this.Lw=null;this.bte=!1;this.dOb=null;this.CVg=!1;this.Leg=2E3;this.KDf=null;this.O9g=0;this.$qd=!1;this.UDc=[];this.Eq=null;this.pKj=1E4;this.Fce=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",
!1);this.VUj=Vb=>{Va.ULS.sendTraceTag(520987789,306,50,`FormulaByExampleManager.onCloseCallback: closeReason = ${qh.a[Vb]}`)};this.KEi=(Vb,Ec)=>{var rd,Id,W,Ra,nc,yc;Va.ULS.sendTraceTag(528758222,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation received.");(Vb=Ec.annotation)?(Ec=parseInt(Vb.guid,10),0>Ec||cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7417755_FormulaByExampleVerifyDuplicatedAnnotation")&&!this.kj.z0f(Ec)||(Va.ULS.sendTraceTag(526984792,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: received annotation's flowId: ${Ec}, containsRowPlaceholder: ${null===
(Id=null===(rd=Vb.generatedFormula)||void 0===rd?void 0:rd.formula)||void 0===Id?void 0:Id.includes(Gg.b)}`),this.kj.Xp(Ec,14),rd=this.Zbk(Ec),Id=this.dc,Id=rd.nU?new Dh(Id,Vb,Ec,rd):new Gg.a(Id,Vb,Ec,rd),this.Eq&&(this.Eq.Tfa(Ec,4,{formula:null===(W=Vb.generatedFormula)||void 0===W?void 0:W.formula,H1:null===(Ra=Vb.generatedFormula)||void 0===Ra?void 0:Ra.anonymizedFormula}),this.Eq.xgb(Ec)),this.raiseEvent("fbeaa",new th(Id)),Object(Dg.b)(Id)||this.dc.UZa()?(this.IG&&!this.N_a&&Object(mc.f)("ANNOTATIONRECEIVED",
Id.flowId),null!=Id.errorMessage?(Va.ULS.sendTraceTag(527005666,306,10,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived with error message: ${Id.errorMessage}, flowId: ${Id.flowId}`),this.kj.Xp(Id.flowId,15,{reason:"Annotation arrived with error message"})):Id.formula?(null===(yc=this.cYg)||void 0===yc?void 0:yc.wYj(Id.flowId),Va.ULS.sendTraceTag(509679808,306,20,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with a formula suggestion arrived. flowId: ${Id.flowId} isTableSuggestion: ${Object(Dg.b)(Id)}}`),
this.kj.Xp(Id.flowId,16,{BMc:Id.formula}),this.WK=Id,(W=this.tna.kba(Id))?this.CVg||1!==Id.invocationMethod?Id.xz<Hg.a?Va.ULS.sendTraceTag(528758220,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have enough examples to prompt a suggestion."):(Va.ULS.sendTraceTag(527005665,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with formula suggestion arrived. trying to suggest/apply it. flowID: ${Id.flowId}`),0===Id.invocationMethod?this.eKk(W):
(Ra=Object(mc.c)(Id.flowId),Ra>this.Leg?(Va.ULS.sendTraceTag(509636688,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived after the maximal wait time for suggestions. flowId: ${Id.flowId}, duration: ${Ra}`),this.kj.Xp(Id.flowId,6,{reason:"annotation arrived after the maximal wait time for suggestions"})):(Ra=this.AVg(W,rd),Ra.value?this.C4g(W,!1,`${(null===rd||void 0===rd?0:rd.dW)?ib.a.wKd(rd.dW):"UnknownCommand"} - UponAnnotationReceived`,rd):(Va.ULS.sendTraceTag(509636687,
306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: shouldShowPreview returned false for suggestion with flowId: ${Id.flowId}, reason: ${Ra.reason}`),this.kj.Xp(Id.flowId,6,{reason:Ra.reason}))))):Va.ULS.sendTraceTag(523850754,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: session supports suggestions from cache only. returning early after caching suggestion."):Va.ULS.sendTraceTag(509678998,306,15,`FormulaByExampleManager.formulaByExampleAnnotationHandler: failed to cache suggestion for flowId: ${Id.flowId}.`)):
(Va.ULS.sendTraceTag(528758221,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have any formula suggestions. deleting existing entry, if any. flowId: ${Id.flowId}`),this.tna.Kfb(Id),this.rC.TV(Id.originCell,2),this.kj.Xp(Id.flowId,15),null===(nc=this.cYg)||void 0===nc?void 0:nc.xYj(Id.flowId))):Va.ULS.sendTraceTag(509204251,306,10,"FormulaByExampleManager.formulaByExampleAnnotationHandler: range table suggestions should not be created in this session."))):Va.ULS.sendTraceTag(537161922,
306,15,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation is null.")};this.QWc=()=>{Va.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const Vb={};Vb[Z.a.MF]="FormulaByExampleCard";this.dc.Dc(802602464,0,8,Vb)};this.Zsg=Vb=>{this.bte=!0;Va.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${Vb}`)};this.fRb=Vb=>{Va.ULS.sendTraceTag(528758219,
306,50,"FormulaByExampleManager.HandleNewBlocksDuringPreview: new block arrived during preview mode.");const Ec=Vb.he.block,rd=this.WK.zs,Id=this.WK.range.Xe(Ec.Fd);this.DJa.Fje(Id);const W=(new wb.Range(rd.top,rd.left,rd.bottom,rd.right,!0,!0)).Xe(Ec.Fd),Ra=Array.from(this.dc.Eca(W,Ec));Va.ULS.sendTraceTag(537161886,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting skeleton for preview cells in new block ${Vb.he.hash}.`);this.UDc.includes(Vb.he.hash)||this.yAe(Id,!0);const nc=
()=>{this.uuf(this.WK,W,Ra).then(yc=>{Va.ULS.sendTraceTag(537161885,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting calculated data into model and demanding re-render for block ${Vb.he.hash}.`);this.UDc.includes(Vb.he.hash)||this.yAe(Id,!1);yc.drb.renderedPreviewIsDirty&&this.dc.xYb(Vb.he.block);Va.ULS.sendTraceTag(512508567,306,50,`FormulaByExampleManager.handleNewBlocksDuringPreview: new FormulaByExample suggestion block rendered during preview. results: ${JSON.stringify({["flowId"]:this.WK.flowId,
["originalFlowId"]:this.WK.fV.flowId,["formulaAnonymized"]:this.WK.anonymizedFormula,["originalFormulaAnonymized"]:this.WK.fV.anonymizedFormula,["annotationRange"]:this.WK.range.toString(),["previewCellsMetadata"]:yc.drb})}`);return!0}).catch(yc=>{Object(mc.h)(this.WK,`Exception when rendering new block during preview. ${yc}`);Va.ULS.sendTraceTag(537161884,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: caught exception: ${yc}.`)})};if(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8198794_FBEPreviewAwaitsDataFlushToCalc")){const yc=
()=>{this.dc.r3b(yc);nc()};this.dc.yFb(yc)}else nc();return!0};this.lGg=()=>{this.dc.kn(this.j2a);this.j2a=null};this.hea=(Vb,Ec)=>{0!=Ec.Fq||cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8190374_FixDDARequestCloseFBE")&&576===Ec.jg.operation.operationName||(this.N_a&&this.Lw.R7(`UserOperation: ${ib.a.Ogh(Ec.jg.operation.operationName)}`),this.dc.kn(this.hea))};this.W9d=Vb=>{const Ec=Vb.suggestion.flowId;Va.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${Ec} originalFlowId=${Vb.suggestion.fV.flowId} isTableSuggestion=${Object(Dg.b)(Vb.suggestion)}`);
this.tna.HSg(Vb,"UNDO");this.Eq&&void this.dc.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:Ec,suggestionOutcome:{outcome:"UNDO"}})};this.CVg=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer");this.Leg=cc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalWaitingTimeForSuggestionsMs",2E3);this.$qd=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType");this.dc=ca;this.dOb=new Map;
this.rC=bb;this.kj=te.a.getInstance(this.dc);this.Sde=!1;ca.TZa()?this.init():Va.ULS.sendTraceTag(537161923,306,10,"FormulaByExampleManager.Ctor: not expected to be constructed when FG is off.")}c7j(ca,bb){const Hb=bb.aQc;this.dOb.set(ca,bb);this.Sde=!1;const Vb=this.tna.$3i(bb,ca);if(Vb){this.Eq&&(this.Eq.Tfa(ca,3,{formula:Vb.suggestion.formula,H1:Vb.suggestion.anonymizedFormula,q2:!0,CL:Vb.CL,Wka:Vb.state}),this.Eq.xgb(ca));this.kj.Xp(ca,4);Vb.suggestion.flowId=ca;Vb.suggestion.originCell=Hb;var Ec=
this.AVg(Vb,bb);Ec.value?(Va.ULS.sendTraceTag(529109774,306,50,"FormulaByExampleManager.onUserInput: A cached formula suggestion found for current input."),this.C4g(Vb,!0,`${bb.dW?ib.a.wKd(bb.dW):"UnknownCommand"} - FromCache`,bb)):(this.kj.Xp(ca,6,{reason:Ec.reason}),this.ljl(ca,Vb.suggestion,Hb))}else this.kj.Xp(ca,5),this.Eq&&this.Eq.Tfa(ca,2,{q2:!1,Wka:gg.b.unseen,CL:0})}TCh(ca){this.addHandler("fbeaa",ca)}ljl(ca,bb,Hb){cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")&&
this.dc.evalFormula(bb.formula,Hb,ib.a.mY(this.dc.la),excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(Vb=>{var Ec=this.dc.Ob(Hb);const rd=Ec.text;Ec=Ec.cell.oi;Vb=Vb.value.value.toString();fb.a.equals(rd,Vb,!1)?this.kj.Xp(ca,10):(Object(mc.g)("textMismatch",rd,Vb,Ec,"evalFormulaToVeriySuggestionWithoutShowingPreview",bb,bb.$_f(Hb)?"MODIFIEDEXAMPLE":"MODIFIEDRESTOFRANGE",null),this.kj.Xp(ca,9))}).catch(Vb=>{Vb=`Failed to evalFormula, error in calc API: ${Vb.toString()}`;Va.ULS.sendTraceTag(512341207,
306,50,`FormulaByExampleMangaer.verifySuggestionOnEditedCell: ${Vb}`);this.kj.Xp(ca,9,{reason:Vb})})}dispose(){this.dc.kn(this.hea);this.lGg();this.dc.gal();super.dispose()}init(){const {FormulaByExampleAutoSuggestActor:ca}=a(1506);this.dc.idh(this.VUj,{annotationType:Qg.a.getTypeName(),ls:!1,dO:this.KEi});this.IG=Object(mc.a)(this.dc);new ca(this.dc,this.IG);this.tna=new Dg.a(this.dc,this.rC,this.kj);this.DJa=new fg(this.dc,this.IG);this.KDf=new mh(this.dc);cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7959804_FormulaByExampleSpies")&&
new uh(this,this.tna,this.kj);this.Eq=this.dc.Eq;Va.ULS.sendTraceTag(528758223,306,50,"FormulaByExampleManager.init: init complete.")}Zbk(ca){if(!this.dOb.has(ca))return null;const bb=this.dOb.get(ca);this.dOb.delete(ca);return bb}eKk(ca){const bb=ca.suggestion;this.DJa.tuf(bb,bb.range,null).then(Hb=>{this.tqd(ca,1===Hb.status?Hb.YMb:null,!1);return null}).catch(()=>{Va.ULS.sendTraceTag(537161921,306,50,"FormulaByExampleManager.setFormulaOnRangeExplicit: client estimation failed for explicit by example flow.");
this.tqd(ca,null,!1)})}C4g(ca,bb,Hb,Vb){Va.ULS.sendTraceTag(527713160,306,20,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: starting flow to show a formula suggestion. isFromCache: ${bb} isTableSuggestion: ${Object(Dg.b)(ca.suggestion)} flowId: ${ca.suggestion.flowId})}`);const Ec=ca.suggestion;this.IG&&!this.N_a&&Object(mc.f)("CALCULATIONSTART",Ec.flowId,bb);const rd=this.WIf(Ec.zs);var Id=Promise.resolve();cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")&&
Ec.formula&&(Id=this.dc.localizeEnglishFormula(Ec.formula,this.dc.wYc,Ec.originCell).then(Ef=>{if(Object(vc.c)(Ef))return Ec.PEi=Ef.value,Promise.resolve();Ef=`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to print formula. error: ${JSON.stringify(Ef.reason.kind)}`;Va.ULS.sendTraceTag(508160210,306,10,Ef);return Promise.reject(Ef)}));Id=Id.then(()=>this.uuf(Ec,this.dc.getLoadedRange(),rd,bb));let W=0,Ra=null,nc=null,yc=!1,Fd=!1,$d=void 0,Me=!1,ff=null,jf=!1;const Lf=Id.then(Ef=>
{const jg={FirstRow:Ec.range.top,FirstColumn:Ec.range.left,LastRow:Ec.range.bottom,LastColumn:Ec.range.right};let Eg=void 0;if(this.$qd&&504848446===Vb.dW){const bh=Ef.YMb.find(ch=>B(ch.value.cell).equals(Ec.originCell));Eg=Pg(bh).toString()}return this.dc.q4(Ec.range,this.fRb,cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")?{PreviewCellsRange:jg,RetainCellTextOnPreview:!0}:void 0,Eg?{pL:Eg,sZc:Vb.sZc}:void 0).then(bh=>{this.N_a=!0;this.Lw=bh;this.Lw.S4e((og,qg)=>{this.rC.hide();
W++;1===W?Ra=qg.reason:nc=qg.reason});this.Lw.Sod(()=>{const og=this.cwg(Ec,Ec.generatedFormula.explanationReplacements);this.DJa.Fje();({WUd:jf,L9:ff}=this.$Vg(Ec,bh,ch,"Success"===og.kind?{explanationKey:Ec.generatedFormula.explanationKey,explanationReplacements:og.explanationReplacements,RNc:qg=>{Me=qg}}:void 0));jf||(this.Lw.R7("CardUI failure"),this.Vke());yc=!0});if(this.Lw.didPrime)this.DJa.Fje(),Fd=!0;else if(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8560939_FormulaByExampleAsYouTypeVerifiesContentOnEndEdit")&&
Eg){const og=(qg,Bh)=>{Va.ULS.sendTraceTag(6370629,306,20,JSON.stringify({flowId:Ec.flowId,Dsl:Eg===Bh.cellText,Esl:Bh.committed}));this.dc.zZ(og)};this.dc.WS(og)}let ch=null;ch=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7858168_FBEHideFeedbackButton")?this.dc.isFeedbackEnabled?this.QWc:null:this.QWc;const Fg=this.cwg(Ec,Ec.generatedFormula.explanationReplacements);"Failure"===Fg.kind&&"FG disabled"!==Fg.failureReason&&Va.ULS.sendTraceTag(507593605,306,10,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to parse explanation replacements. error: ${Fg.failureReason}, flowId: ${Ec.flowId}`);
({WUd:jf,L9:ff}=this.$Vg(Ec,bh,ch,"Success"===Fg.kind?{explanationKey:Ec.generatedFormula.explanationKey,explanationReplacements:Fg.explanationReplacements,RNc:og=>{Me=og}}:void 0));if(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8329602_AbortPreviewIfCardFailedToRender")&&!jf)return this.Lw.R7("CardUI failure"),this.Vke(),Promise.reject("Failed to show card UI");this.dc.Kp(this.hea);this.rC.TV(Ec.originCell,0);this.IG&&ib.a.rMg(()=>{var og,qg;Object(mc.f)("PREVIEWRENDERED",Ec.flowId,bb);const Bh=
{["flowId"]:Ec.flowId,["originalFlowId"]:Ec.fV.flowId,["displayTrigger"]:Hb,["formulaAnonymized"]:Ec.anonymizedFormula,["originalFormulaAnonymized"]:Ec.fV.anonymizedFormula,["annotationRange"]:Ec.range.toString(),["isFullyInViewport"]:this.dc.Iy(Ec.range),["isCachedSuggestion"]:bb,["exampleCount"]:Ec.xz,["originalExampleCount"]:Ec.fV.xz,["seenCount"]:ca.CL,["previewCellsMetadata"]:Ef.drb,["previewShownDurations"]:Object(mc.e)(bb,Ec.flowId),["isSuggestionOnTable"]:Object(Dg.b)(Ec),["isNewRowPrediction"]:!Object(Dg.b)(Ec)&&
Ec.aVb,["sheetId"]:Ec.sheetId,["areAllHeadersLoaded"]:Object(Dg.b)(Ec)?null===(og=Ec.table.z4)||void 0===og?void 0:og.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===(qg=Ec.zs)||void 0===qg?void 0:qg.toString(),["dataCulture"]:this.dc.$.dataCultureTag,["UICulture"]:this.dc.$.O4};this.dc.SZa()&&($d=this.MXh(Ef.YMb,Ec.originCell));Va.ULS.sendTraceTag(84165903,306,50,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: Suggestion shown, awaiting user decision. flowData: ${JSON.stringify(Bh)}`)},
this.dc.Aa);return bh.z4b})});Promise.all([Id,Lf]).then(Ef=>{var [jg,Eg]=Ef;this.Sde=!0;this.r9i(jg,Eg,ca,bb,Hb,{["softIgnoreCount"]:W,["softIgnoreReasons"]:[Ra,nc],["didReshow"]:yc,["didPrime"]:Fd},{qoi:$d},Me,ff)}).catch(Ef=>{Object(mc.h)(Ec,`Failed to show formula preview due to a promise (model update or preview render) rejection. rejection reason: ${Ef}`);Va.ULS.sendTraceTag(537161920,306,15,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: failed to show formula preview due to promise rejection. rejection reason: ${Ef}`);
this.rC.TV(Ec.originCell,5,Ef);ca.state=gg.b.unseen})}$Vg(ca,bb,Hb,Vb){if(cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8874300_FormulaByExample_ShowRowNumberingCard")&&this.cwj(ca.anonymizedFormula)){const Ec={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:ca.range.gu>this.pKj};return{WUd:this.rC.yte(ca.formula,ca.range.toString(),()=>{bb.Tpa("CardUI")},()=>{Ec.isAcceptAsValues=!0;bb.Tpa("CardUI")},Ec.disableApplyAsValue,()=>bb.FEa("CardUI"),
rd=>{Ec.maxTooltipOpenDurationMS=Math.max(Ec.maxTooltipOpenDurationMS,rd)},()=>{Ec.isFurtherExplanationHyperlinkClicked=!0},Hb,()=>this.Zsg(ca.flowId),ca.originCell),L9:Ec}}return{WUd:this.rC.show(ca.formula,ca.range.toString(),()=>{bb.Tpa("CardUI")},()=>bb.FEa("CardUI"),Hb,()=>this.Zsg(ca.flowId),ca.originCell,Vb),L9:null}}cwj(ca){const bb=/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(ca)||"ROW()"===ca||cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)&&bb.test(ca)}cwg(ca,bb){var Hb;if(!cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1))return{kind:"Failure",failureReason:"FG disabled"};if(!bb||0===bb.length)return{kind:"Failure",failureReason:"No explanation replacements"};const Vb=[];for(const Id of bb){if(!["ColumnName","LeftColumnName","RightColumnName","ColumnNames"].includes(Id.replacementPlaceHolder)){Vb.push(Id);continue}bb=[];"ColumnNames"!==Id.replacementPlaceHolder?bb.push(Id.replacementValue):
bb=Id.replacementValue.split(", ");let W=0;for(const Ra of bb){if(Object(Dg.b)(ca)){var Ec=this.dc.extractReferences(`=${Ra}`,this.dc.la.name,this.dc.wCe,!0,ca.originCell);if(!Ec||!Ec.Items||1!==Ec.Items.length)return{kind:"Failure",failureReason:`Failed to extract singular ref from column replacement. refs non null: ${!!Ec}, refs count: ${null===(Hb=null===Ec||void 0===Ec?void 0:Ec.Items)||void 0===Hb?void 0:Hb.length}`};const nc=Ec.Items[0];Ec=ca.table.z4.HeadersList.find(yc=>yc.Index===nc.Range.FirstColumn);
if(!Ec)return{kind:"Failure",failureReason:`Failed to find header for column replacement index in grid. ref: ${nc.Range.FirstColumn}`};bb[W]=Ec.Name}else{Ec=Ra.replace(Gg.b,"");var rd=Object($b.E)(`${Ec}:${Ec}`);if(!rd)return{kind:"Failure",failureReason:`Failed to parse column replacement ref. columnLetter: ${Ec}, columnName: ${Ra}`};rd=ca.headerRow.get(rd.left);bb[W]=rd?rd:Ec}W++}Vb.push({replacementPlaceHolder:Id.replacementPlaceHolder,replacementValue:bb.join(", ")})}return{kind:"Success",explanationReplacements:Vb}}MXh(ca,
bb){const Hb=this.dc.Ora("FormulaByExampleManager:checkIfPreviewResultsEqualOtherColumn",this.WK.zs);let Vb=null,Ec=!0,rd=0;const Id=[bb.left];let W;try{for(;Hb.$$mn();){const Ra=Hb.$$cu();W&&W!==Ra.range.top&&(Ec=!1,Vb=null);W=Ra.range.top;if(Ec)rd++;else if(Id.length===rd)return!1;if(!Id.includes(Ra.range.left)){if(!Vb){const nc=new wb.Range(Ra.range.top,bb.left,Ra.range.bottom,bb.left,!0,!0),yc=ca.find(Fd=>B(Fd.value.cell).equals(nc));Vb=Pg(yc).toString()}Ra.Qh.value.toString()===Vb||"0"===Vb&&
""===Ra.Qh.value.toString()||Id.push(Ra.range.left)}}}catch(Ra){throw Error(`Error while iterating over cells: ${Ra}`);}finally{Hb&&Hb.dispose()}return!0}uuf(ca,bb,Hb,Vb){return this.DJa.fKk(ca,bb,void 0===Hb?null:Hb,this.N_a,Vb).then(Ec=>{Va.ULS.sendTraceTag(537161887,306,50,`FormulaByExampleManager.EvaluateFormulaAndUpdateModel: model update completed. result: ${Ec.status}.`);switch(Ec.status){case 3:case 1:return 3===Ec.status&&Object(mc.h)(ca,"Preview shown, but only partially. some cells failed to evaluate."),
Promise.resolve(Ec);case 2:return Promise.reject("Calc estimation or model update failed");default:return Promise.reject("Calc estimation failed")}})}r9i(ca,bb,Hb,Vb,Ec,rd,Id,W,Ra){const nc=this.bte;this.Vke();const yc=Hb.suggestion;this.IG&&Object(mc.f)("USERINPUTARRIVED",yc.flowId,Vb);const Fd=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8215633_FixFBEFreezeFrameBigTable")?yc.range.Xe(this.dc.getLoadedRange()):yc.range;this.yAe(Fd,!1);this.rC.hide();ib.a.rMg(()=>{var $d,Me;this.IG&&Object(mc.f)("PREVIEWREMOVEDWITHCSE",
yc.flowId,Vb);const ff={["flowId"]:yc.flowId,["originalFlowId"]:yc.fV.flowId,["caller"]:bb.cIb,["displayTrigger"]:Ec,["formulaAnonymized"]:yc.anonymizedFormula,["originalFormulaAnonymized"]:yc.fV.anonymizedFormula,["suggestionOutcome"]:bb.pZ,["annotationRange"]:yc.range.toString(),["isFullyInViewport"]:this.dc.Iy(yc.range),["isCachedSuggestion"]:Vb,["showFormulaClicked"]:nc,["exampleCount"]:yc.xz,["originalExampleCount"]:yc.fV.xz,["seenCount"]:Hb.CL,["previewCellsMetadata"]:ca.drb,["previewShownDurations"]:this.IG?
Object(mc.e)(Vb,yc.flowId):"none",["previewRemovedDurations"]:this.IG?Object(mc.d)(Vb,yc.flowId):"none",["isSuggestionOnTable"]:Object(Dg.b)(yc),["isNewRowPrediction"]:!Object(Dg.b)(yc)&&yc.aVb,["sheetId"]:yc.sheetId,["areAllHeadersLoaded"]:Object(Dg.b)(yc)?null===($d=yc.table.z4)||void 0===$d?void 0:$d.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===(Me=yc.zs)||void 0===Me?void 0:Me.toString(),["dataCulture"]:this.dc.$.dataCultureTag,["UICulture"]:this.dc.$.O4,["previewEvents"]:rd,
["Hypotheses"]:{["areHypothesesEnabled"]:this.dc.SZa(),["isNewColumnHeuristic"]:yc.X1j,["previewEqualsOtherColumn"]:Id.qoi},["formulaExplanation"]:{explanationSuccessful:W,explanationKey:yc.generatedFormula.explanationKey},["RowNumbering"]:Ra?{["isAcceptAsValues"]:Ra.isAcceptAsValues,["maxTooltipOpenDurationMS"]:Ra.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:Ra.isFurtherExplanationHyperlinkClicked,["disableApplyAsValue"]:Ra.disableApplyAsValue}:null,["IsPlugin"]:!1};Va.ULS.sendTraceTag(388780100,
306,cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7896248_XLFBELogLevelImportant")?20:50,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(ff)}`);cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&ib.a.sendOtelEvent(xg);Object(mc.b)(yc.flowId)},this.dc.Aa);Va.ULS.sendTraceTag(523842074,306,50,`FormulaByExampleManager.handlePreviewResult: User ${bb.pZ} the formula via ${bb.cIb}`);this.tna.HSg(Hb,bb.pZ,null===Ra||void 0===Ra?void 0:
Ra.isAcceptAsValues);"ACCEPT"===bb.pZ?(this.tqd(Hb,ca.YMb,null===Ra||void 0===Ra?void 0:Ra.isAcceptAsValues),this.Eq&&void this.dc.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:yc.flowId,suggestionOutcome:{outcome:"ACCEPT"}}),cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&ib.a.sendOtelEvent(nh)):"IGNORE"===bb.pZ?this.Eq&&void this.dc.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:yc.flowId,suggestionOutcome:{outcome:"IGNORE"}}):"DECLINE"===bb.pZ&&(this.Eq&&
void this.dc.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:yc.flowId,suggestionOutcome:{outcome:"DECLINE"}}),this.O9g++,3===this.O9g&&gh.Health.instance.recordQosError(sh.a.LEi,[eg.a.NEi],!0,!0,!1,!1,{pua:!0}));this.KDf.Qxh(bb.pZ);this.dc.kn(this.hea)}Vke(){this.N_a=!1;this.Lw=null;this.bte=!1}tqd(ca,bb,Hb){const Vb=ca.suggestion;Hb?(this.DJa.S7e(bb,null,Vb.flowId),this.dc.u1(null,Vb.range,Vb.originCell,Vb.formula,!0).then(Ec=>{Ec=Ec.results.map(rd=>[this.I3h(rd)]);this.dc.Q5c({FirstRow:Vb.range.top-
1,FirstColumn:Vb.range.left-1,LastRow:Vb.range.bottom-1,LastColumn:Vb.range.right-1,SheetName:this.dc.wYc.name,NamedObjectName:"Table"===Vb.kind?Vb.table.name:null},Ec);Va.ULS.sendTraceTag(507604995,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied values on table, range: ${Vb.range}`)}).catch(Ec=>{Va.ULS.sendTraceTag(507585377,306,10,`FormulaByExampleManager.applySuggestionOnRange: failed to apply values on table, range: ${Vb.range} error: ${Ec}`);this.dc.Wi()})):(Hb=Object(Tc.a)(new ed.a,
{Text:Vb.formula}),this.dc.setCell(Hb,Vb.originCell,1,127,null,0,{range:Vb.range,origin:Vb.originCell},2),this.DJa.S7e(bb,Vb.formula,Vb.flowId),Va.ULS.sendTraceTag(537161883,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied formula on table, range: ${Vb.range}`));this.j2a=(Ec,rd)=>{0===rd.Fq&&(170==rd.jg.operation.operationName?this.W9d(ca):cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&ib.a.sendOtelEvent(Ah),this.lGg())};this.dc.Kp(this.j2a)}I3h(ca){if(!ib.a.LFc(ca))throw Error("FormulaByExampleManager.convertEvalOnCloneResultToString: EvalOnCloneResult is not successful.");
return Pg(ca).toString()}AVg(ca,bb){if(this.Fce)return{value:!1,reason:"Sessions shows plugin suggestions"};const Hb=ca.suggestion;bb=this.Gnj(Hb.flowId,bb.dW);return bb.value?ca.state===gg.b.decline?(this.rC.TV(ca.suggestion.originCell,6,Lg.a.wgh),Va.ULS.sendTraceTag(528758217,306,50,`FormulaByExampleManager.shouldShowPreview: user declined this suggestion before, not showing again. flowId: ${Hb.flowId}`),{value:!1,reason:"User declined this suggestion before."}):Hb.xz<Hg.a?(this.rC.TV(ca.suggestion.originCell,
6,Lg.a.dfh),Va.ULS.sendTraceTag(528758215,306,50,`FormulaByExampleManager.shouldShowPreview: cached suggestion does not have enough examples. not showing preview. flowId: ${Hb.flowId}`),{value:!1,reason:"Cached suggestion does not have enough examples."}):ca.state===gg.b.ignore&&2<=ca.CL?(this.rC.TV(ca.suggestion.originCell,6,Lg.a.vgh),Va.ULS.sendTraceTag(528758216,306,50,`FormulaByExampleManager.shouldShowPreview: user saw suggestion at least twice and ignored last time. not showing again. flowId: ${Hb.flowId}`),
{value:!1,reason:"User saw suggestion at least twice and ignored last time"}):cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.tna.crj(Hb)?(Va.ULS.sendTraceTag(509195993,306,20,`FormulaByExampleManager.shouldShowPreview: suggestion is forbidden. not showing preview. flowId: ${Hb.flowId}, anonymizedFormula: ${Hb.anonymizedFormula}`),{value:!1,reason:"Suggestion is forbidden as it wasn't wanted before."}):cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7300192_FBETextCellsUnsupported")&&
this.WIf(Hb.range).some(Vb=>this.dc.b_d(Vb.cell.oi))?{value:!1,reason:"At least 1 cell in the loaded suggestion range is formatted as Text"}:cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7464540_FBENoneValueTypesUnsupported")&&0===Hb.gei?{value:!1,reason:"suggestion's default value type cannot be none."}:cc.EwaSettings.isChangeGateEnabled("OfficeVSO:7669810_ValidateRangeIsInsideTableUponShowingSuggestion")&&Object(Dg.b)(Hb)&&!Hb.table?{value:!1,reason:"table suggestion's table object is null."}:{value:!0}:
(this.rC.TV(ca.suggestion.originCell,6,Lg.a.adh),{value:!1,reason:bb.reason})}yAe(ca,bb){if(ca)for(let Vb=ca.top;Vb<=ca.bottom;Vb++)for(let Ec=ca.left;Ec<=ca.right;Ec++){var Hb=wb.Range.Hc(Vb,Ec);if(Hb=this.dc.Ob(Hb))Hb.cell.Ate=bb&&!Hb.cell.pL}}Gnj(ca,bb){if(this.Sde)return Va.ULS.sendTraceTag(528758218,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview again as preview already was shown for the current edit. flowId: ${ca}`),{value:!1,reason:"Preview already shown for the latest edit."};
if(this.N_a)return Va.ULS.sendTraceTag(527005664,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as preview is already showing. flowId: ${ca}`),{value:!1,reason:"Preview is already showing."};if(this.$qd){if(504848446===bb&&!this.dc.isEditing())return Va.ULS.sendTraceTag(507855E3,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. can't show preview for this suggestion as user is not editing. flowId: ${ca}`),{value:!1,reason:"User is not editing."};
if(324156914===bb)return Va.ULS.sendTraceTag(507836041,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. preview shown only when editing, or by priming. flowId: ${ca}`),{value:!1,reason:"After edit preview only handled by preview priming."}}else if(this.dc.isEditing())return Va.ULS.sendTraceTag(524813027,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX disabled. can't show preview for this suggestion as user is editing. flowId: ${ca}`),{value:!1,reason:"User is editing."};
return{value:!0}}WIf(ca){const bb=[];this.UDc=[];const Hb=this.dc.y7(ca,this.dc.activeItemName);for(const Vb of Hb)bb.push(...this.dc.Eca(ca.Xe(Vb.Fd),Vb)),this.UDc.push(Vb.Yc);return bb}}Object($a.a)(Xc,"FormulaByExampleManager",ne.a,[753,4]);class Bd extends Zd.a{constructor(ca){super();this.$=ca;this.ri()}create(){Va.ULS.sendTraceTag(528758214,0,50,"FormulaByExampleManagerFactory.Create: starting service creation flow.");const ca=Object(zf.d)(Zb.a.resolve(uc.FormulaByExampleSignalLocksManagerService,
{xa:this.Cc})),bb=Object(zf.d)(Zb.a.resolve(uc.FormulaByExampleServiceProxyService,{xa:this.Cc}));lg.TaskExtensions.tb(lg.TaskExtensions.jl([bb,ca],this.Aa),()=>{Va.ULS.sendTraceTag(528758213,0,50,"FormulaByExampleManagerFactory.Create: augmentationLoopManager and calcManager creation tasks resolved.");if(!cc.EwaSettings.PQ()||bb.result&&ca.result){If.init(this.$);var Hb=new Xc(bb.result,If.instance(),ca.result);this.Uf(this.$.ra.Tb(453)||this.$.ra.zc(453,Hb));Va.ULS.sendTraceTag(537161882,0,50,"FormulaByExampleManagerFactory.Create: FormulaByExampleManager initialized successfully")}else this.Uf(null)},
this.Aa)}static Ea(ca){ca.ra.zc(454,new Bd(ca))}}Object($a.a)(Bd,"FormulaByExampleManagerFactory",Zd.a,[]);var we=a(233);class Cd{constructor(ca,bb,Hb){this.$=ca;this.ADf=bb;this.ariaLiveNotifier=Hb;this.ygj();this.editBox=Object(pa.f)(this.$).Rb}get Yw(){return gf.getInstance(this.$)}get zoomManager(){this.QRa||(this.QRa=Object(ub.a)());return this.QRa}dispose(){this.hide()}show(ca,bb,Hb,Vb){Vb=Object.assign({},bb,{ow:ca,uCe:Hb,source:Vb});if(!this.GMa(Vb))return!1;this.Yma(Vb)&&this.hide();this.Zq=
Vb;this.Yw.setResult(bb,ca);this.s4();Hb&&this.Ocj();return!0}hide(ca){if(!this.Zq||Object(Pd.b)(ca)&&ca!==this.Zq.ow)return!1;ca=this.Zq.uCe;this.Bhi();ca&&this.Oqk();this.Zq=void 0;return!0}GMa(ca){return!this.Zq||!O(this.Zq,ca)}Yma(ca){return this.Zq&&!C(this.Zq,ca)}Ocj(){const ca=this.Zq.length;0!==ca&&this.Zq.ow.Za.formatText(this.Zq.index,ca,{background:"rgba(202,234,216,0.6)"})}Oqk(){const ca=this.Zq.ow;ca.Za.formatText(0,ca.text.length,{background:!1});ca.eW(null)}s4(){let ca;switch(this.Zq.kind){case "Success":ca=
{isLoaded:!0,value:this.Zq.value,textColor:this.Zq.color};break;case "Loading":ca={isLoaded:!1,value:null,textColor:null};break;default:return}this.Vfl();this.ADf.renderValuePreview(this.Iv,this.C9b,ca);this.Qak(ca)}Bhi(){this.ADf.dismiss(this.Iv)}ygj(){this.Iv=document.createElement("div");this.C9b=document.createElement("div");this.C9b.style.position="absolute";this.C9b.style.visibility="hidden";this.$.domElement.appendChild(this.C9b)}Vfl(){var ca=this.Zq.ow;const bb=this.Zq.index,Hb=this.Zq.length;
var Vb=this.Zq.source;let Ec;switch(Vb.trigger){case "hover":Ec=ca.Za.getBounds(Vb.index,1);break;case "shortcut":Ec=ca.Za.getBounds(Vb.index);break;case "selection":Vb=ca.text.substring(bb,bb+Hb).indexOf("\n"),-1!==Vb?Ec=ca.Za.getBounds(bb,Vb):(Vb=ca.Za.getBounds(bb),ca=ca.Za.getBounds(bb,Hb),Ec={left:Vb.left,top:Vb.top,width:ca.right-Vb.left,height:ca.height})}this.Ufl(Ec)}Ufl(ca){const bb=new we.a(this.C9b.style);bb.dz.left=this.JZc(ca.left);bb.dz.top=this.JZc(ca.top);bb.dz.width=this.JZc(ca.width);
bb.dz.height=this.JZc(ca.height);bb.q0()}JZc(ca){var bb=this.Zq.ow;bb=Object(Pd.b)(this.zoomManager)&&bb===this.editBox;return ta.HelperMethods.$c(bb?this.zoomManager.sh(ca):ca)}Qak(ca){var {isLoaded:bb,value:Hb}=ca;bb?this.ariaLiveNotifier.readText(String.format(jc.a.instance.Ib(179),Hb)):this.ariaLiveNotifier.readText(jc.a.instance.ia(866))}}Object($a.a)(Cd,"FormulaAssistanceValuePreviewControl",null,[4]);class Q{constructor(ca){this.cache=ca}clearCache(){this.cache=void 0}}Object($a.a)(Q,"Cacheable",
null,[]);class Ja extends Q{constructor(ca,bb){super();this.$=ca;this.callbacks=bb;this.X1a=(Hb,Vb)=>{const Ec=this.da.Ej;if(!(0<(Ec.isEditing?Ec.Za.selection:{index:0,length:0}).length))switch(Vb.state){case 0:this.onHoverEnter(Hb,Vb.event);break;case 1:this.onHoverLeave(Hb);break;case 2:this.$_j(Hb);break;default:return Va.ULS.shipAssertTag(521446489,0,!1,"FormulaAssistanceValuePreviewHandler.onHoverChange unxpected HoverState"),Vb}};this.Ylg=(Hb,Vb)=>{const Ec=Vb.selection;Vb={source:"selection",
text:Vb.text,index:Ec.index,length:Ec.length};if(0<Ec.length)this.onSelectionChange(Hb,Vb);else this.hae(Hb,Vb)};this.da=Object(pa.f)(this.$);this.editBox=this.da.cellTextEditBox;this.Aj(this.editBox);this.formulaBar=Object(Fa.a)(this.$);Object(Pd.b)(this.formulaBar)?this.Aj(this.formulaBar):Object(Fa.b)(this.$,Hb=>{this.formulaBar=Hb;this.Aj(this.formulaBar);Va.ULS.sendTraceTag(509870663,1,50,"FormulaAssistanceValuePreviewHandler: formulaBar async")})}get Yw(){return gf.getInstance(this.$)}dispose(){this.Bi(this.editBox);
this.Bi(this.formulaBar)}trigger(){const ca=this.da.Ej,bb=ca.Za.selection;this.onSelectionChange(ca,{source:"shortcut",text:ca.text,index:bb.index,length:bb.length})}Aj(ca){ca.FFb(this.X1a);ca.lod(this.Ylg)}Bi(ca){null===ca||void 0===ca?void 0:ca.v3b(this.X1a);null===ca||void 0===ca?void 0:ca.XTc(this.Ylg)}onHoverEnter(ca,bb){var Hb=new Sys.UI.Point(bb.clientX,bb.clientY);{bb=ca.Za.qg;var Vb=void 0,{x:Ec,y:rd}=Hb;Vb=void 0===Vb?document:Vb;Hb=-1;let Id=null;void 0!==Vb.caretPositionFromPoint?(Vb=
Vb.caretPositionFromPoint(Ec,rd),null!==Vb&&(Hb=Vb.offset,Id=Vb.offsetNode)):void 0!==Vb.caretRangeFromPoint&&(Vb=Vb.caretRangeFromPoint(Ec,rd),null!==Vb&&(Hb=Vb.startOffset,Id=Vb.startContainer));null===Id||-1===Hb?(Va.ULS.sendTraceTag(521446491,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),bb=-1):bb.contains(Id)?bb=X(bb,Id,Hb):(Va.ULS.sendTraceTag(521446490,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),bb=-1)}if(-1!==bb)this.onSelectionChange(ca,
{source:"hover",text:ca.text,index:bb,length:0})}onHoverLeave(ca){this.hae(ca)}$_j(ca){this.hae(ca)}onSelectionChange(ca,bb){this.Hre(bb)&&!ca.lda&&(this.cache=bb,this.callbacks.eae(ca,{index:bb.index,length:bb.length,trigger:bb.source}),this.Yw.trigger=bb.source)}hae(ca,bb){this.sRk(bb)&&(this.clearCache(),this.callbacks.Z8(ca))}Hre(ca){return!this.cache||!S(this.cache,ca)}sRk(ca){return this.cache&&ca?"shortcut"!==this.cache.source||!S(this.cache,ca):!0}}Object($a.a)(Ja,"FormulaAssistanceValuePreviewHandler",
Q,[4]);class ob{constructor(ca){this.$=ca;this.E7b=0;this.H6a=!1;this.Gva=null;this.wg=()=>{this.da.cellTextEditBox.zZ(this.wg);this.m$()};this.da=Object(pa.f)(ca)}onShow(){this.H6a||(this.Gva=performance.now())}onHide(){this.H6a||null===this.Gva||(400<performance.now()-this.Gva&&(this.E7b++,this.Gva=null),2===this.E7b&&this.pye())}pye(){this.da.isEditing?this.da.cellTextEditBox.WS(this.wg):this.m$()}m$(){this.$.Dc(1684822464,-1,0,null);this.H6a=!0}}Object($a.a)(ob,"ValuePreviewSurveyHandler",null,
[]);class qc{constructor(ca,bb,Hb,Vb){this.$=ca;this.requester=bb;this.VVk=200;this.AJg=3E3;this.jda=cc.EwaSettings.isChangeGateEnabled("OfficeVSO:8550405_ValuePreviewDismissOnScroll");this.eae=async(Ec,rd)=>{const Id={text:Ec.text,index:rd.index,length:rd.length};void this.gAg(Id,this.$xk(Id),Ec,0===Id.length,rd.trigger)};this.Z8=()=>{this.hide()};this.reset=()=>{this.handler.clearCache();this.requester.clearCache();this.hide()};this.Py=()=>{this.handler.clearCache();this.requester.clearCache()};
this.yt=()=>{this.hide(this.da.Rb)};this.ONc=Ec=>{this.hide(Ec)};this.da=Object(pa.f)(this.$);this.control=new Cd(this.$,Hb,Vb);this.handler=new Ja(this.$,{eae:this.eae,Z8:this.Z8});this.e$=new ob(this.$);this.Aj()}get Yw(){return gf.getInstance(this.$)}trigger(){this.handler.trigger()}dispose(){this.Bi();this.handler.dispose();this.control.dispose()}Aj(){this.da.Rb.WS(this.reset);this.da.ha.add_activeCellChanged(this.reset);this.$.fa.qF(this.Py);this.jda&&(this.da.view.Ks(this.yt),this.da.cellTextEditBox.i4e(this.ONc),
Object(Fa.b)(this.$,ca=>{ca.i4e(this.ONc)}))}Bi(){var ca;this.da.Rb.zZ(this.reset);this.da.ha.remove_activeCellChanged(this.reset);this.$.fa.wG(this.Py);this.jda&&(this.da.view.xs(this.yt),this.da.cellTextEditBox.dHg(this.ONc),null===(ca=Object(Fa.a)(this.$))||void 0===ca?void 0:ca.dHg(this.ONc))}async gAg(ca,bb,Hb,Vb,Ec){this.zl=ca=Object.assign({},ca,{ow:Hb,HYc:Vb,trigger:Ec});bb=await bb;Object(Pd.c)(bb)||this.YYd(ca)&&void this.MQd(bb)}async MQd(ca){const bb=this.zl.text,Hb=this.zl.ow,Vb=this.zl.HYc,
Ec=this.zl.trigger;switch(ca.kind){case "Failure":this.Yw.setResult(ca,Hb);this.hide();break;case "Success":this.show(ca);break;case "Loading":this.show(ca);void this.gAg({text:bb,index:ca.index,length:ca.length},ca.promise,Hb,Vb,Ec);break;default:return ca}}$xk(ca){const bb=this.requester.Bke(ca,this.AJg,!0);let Hb;const Vb=new Promise(Ec=>{Hb=window.setTimeout(()=>{Ec(Object.assign({},ca,{kind:"Loading",promise:bb}))},this.VVk)});return Promise.race([bb,Vb]).finally(()=>{window.clearTimeout(Hb)})}show(ca){const bb=
this.zl.index,Hb=this.zl.ow,Vb=this.zl.HYc,Ec=this.zl.trigger;this.zl=void 0;if(this.Qvj(ca)&&(ca=this.control.show(Hb,ca,Vb,{trigger:Ec,index:bb}),!this.jda||ca))this.e$.onShow()}hide(ca){ca=this.control.hide(ca);this.zl=void 0;if(!this.jda||ca)this.e$.onHide()}YYd(ca){var bb;if(bb=this.zl)bb=this.zl,bb=bb.text===ca.text&&bb.index===ca.index&&bb.length===ca.length&&bb.ow===ca.ow&&bb.HYc===ca.HYc;return bb}Qvj(ca){switch(ca.kind){case "Success":return Object(Pd.b)(ca.value)&&""!==ca.value;case "Loading":return!0;
default:return ca}}}Object($a.a)(qc,"FormulaAssistanceValuePreview",null,[297,4]);class gd extends Zd.a{constructor(ca){super();this.$=ca;this.ri()}static Ea(ca){ca.ra.zc(497,new gd(ca))}create(){let ca=this.$.ra.Tb(496);ca&&this.Uf(ca);const bb=df.GetServiceTaskFactory.Ne(this.$.ra,448,449,this.Cc),Hb=Object(zf.d)(Zb.a.resolve(uc.FormulaAssistanceManagerService,{xa:this.Cc})),Vb=cc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?Object(zf.d)(Zb.a.resolve(uc.AriaLiveNotifierService,
{xa:this.Cc})):df.GetServiceTaskFactory.Ne(this.$.ra,211,212,this.Cc),Ec=Object(zf.d)(Zb.a.resolve(uc.FormulaAssistanceValuePreviewRequesterService));lg.TaskExtensions.tb(lg.TaskExtensions.jl([bb,Vb,Ec,Hb],this.Aa),()=>{ca=this.$.ra.Tb(496);ca||(ca=new qc(this.$,Ec.result,bb.result,Vb.result),this.$.ra.zc(496,ca));this.Uf(ca)},this.Aa,3)}}Object($a.a)(gd,"FormulaAssistanceValuePreviewFactory",Zd.a,[]);class td extends Uf.a{constructor(ca){super(ca)}oq(){const ca=df.GetServiceTaskFactory.Ne(this.$.ra,
496,497,this.Cc);lg.TaskExtensions.tb(ca,()=>{this.fn([new Gc(ca.result)])},this.Aa)}static Ea(ca){Uf.a.cw(515,new td(ca))}}Object($a.a)(td,"FormulaAssistanceValuePreviewCommandHandlerFactory",Uf.a,[]);String(oa);String(Na);window.___1717508028490_closurehack=oa;window.___1717508028490_closurehack=Na;Re.a.wb(pe.Ea);(()=>{Re.a.wb(ca=>{vf.Ea(ca)})})();(()=>{Re.a.wb(ca=>{Ug.Ea(ca)})})();(()=>{Re.a.wb(ca=>{wg.Ea(ca)})})();(()=>{Re.a.wb(ca=>{Bd.Ea(ca);hg.Ea(ca)})})();(()=>{Re.a.wb(ca=>{gd.Ea(ca);uc.FormulaAssistanceValuePreviewCommandHandlerService.Oa()||
td.Ea(ca)})})();String(ea);String(Oa);String(Ha);String(Za);String(fa);String(la);String(ba);String(aa);String(Na);String(Ia);String(Sa);String(Pa);String(za);String(wa);String(db);String(Ba);String(Ka);String(da);String(sa);String(mb);String(Ma);window.___1717508060452_closurehack=ea;window.___1717508060452_closurehack=Oa;window.___1717508060452_closurehack=Ha;window.___1717508060452_closurehack=Za;window.___1717508060452_closurehack=fa;window.___1717508060452_closurehack=la;window.___1717508060452_closurehack=
ba;window.___1717508060452_closurehack=aa;window.___1717508060452_closurehack=Na;window.___1717508060452_closurehack=Ia;window.___1717508060452_closurehack=Sa;window.___1717508060452_closurehack=Pa;window.___1717508060452_closurehack=za;window.___1717508060452_closurehack=wa;window.___1717508060452_closurehack=db;window.___1717508060452_closurehack=Ba;window.___1717508060452_closurehack=Ka;window.___1717508060452_closurehack=da;window.___1717508060452_closurehack=sa;window.___1717508060452_closurehack=
mb;window.___1717508060452_closurehack=Ma},976:function(y,r,a){a.d(r,"a",function(){return G});y=a(0);var c=a(191),b=a(25),f=a(29),k=a(74),x=a(44),d=a(114),h=a(491),n=a(118),m=a(961),u=a(1287);a(120);var l=a(68),t=a(210),e=a(61),w=a(213),z=a(36),E=a(45),M=a(15);class G{constructor(A,N,K,I,L,J,B,Y,U,O){this.$=A;this.Yd=N;this.hj=K;this.eD=I;this.$e=L;this.Zqj=B;this.indexedDB=Y;this.pluginScheduler=O;this.da=b.f(A);this.Eq=null===U||void 0===U?void 0:U.lPf("Legacy")}Wi(){const A=z.a.Cd(1,0,0,0,0,0,
"FormulaByExampleApplyAsValueFailed");E.a(this.da.$).Wi(A)}Q5c(A,N){const K=new w.a(163,0,(I,L,J)=>{const B=this.$.ma.sa,Y=B.$a(0);Y.rangeToSet=A;Y.rangeValues=N;return e.h(B,"SetRange",Y,(U,O,C)=>{M.ULS.sendTraceTag(507585379,306,20,"FormulaByExampleServiceProxy.SetRange: the operation has succeeded");I(U,O,C)},(U,O,C)=>{M.ULS.sendTraceTag(507585378,306,10,"FormulaByExampleServiceProxy.SetRange: the operation has failed");L(U,O,C)},J,this.$.ma.sa.mc(),0)},65);this.$.userOperationManager.enqueueOperation(K,
null)}WS(...A){return this.da.Rb.WS(...A)}zZ(...A){return this.da.Rb.zZ(...A)}qH(...A){return this.da.Rb.qH(...A)}QI(...A){return this.da.Rb.QI(...A)}dg(...A){return this.da.Eb.dg(...A)}t2i(A){return t.a(this.$,A,!1)}q4(...A){return this.da.KI.q4(...A)}xYb(...A){return this.da.KI.xYb(...A)}getLoadedRange(){return this.da.Ek}isEditing(){return this.da.isEditing}y7(...A){return this.da.za.y7(...A)}getActiveCell(){return this.da.ha.oa.activeCell}WQ(){return this.da.za.WQ}Gq(...A){return this.da.za.Gq(...A)}Or(...A){return this.da.za.Or(...A)}$t(...A){return this.da.za.$t(...A)}yu(...A){return this.da.za.yu(...A)}Pbb(...A){return this.da.za.Pbb(...A)}n3b(...A){return this.da.za.n3b(...A)}Flc(...A){return this.da.Flc(...A)}MFb(...A){this.NBk(N=>
{N.MFb(...A)})}Ob(...A){return this.da.Ob(...A)}Eca(...A){return this.da.Eca(...A)}Iy(...A){return this.da.Iy(...A)}setCell(...A){return this.da.setCell(...A)}Ora(...A){return this.da.Np(...A)}get hd(){return this.da.hd}iKa(...A){return this.da.za.iKa(...A)}evalFormula(...A){return this.Yd.evalFormula(...A)}u1(...A){return this.Yd.u1(...A)}lGc(...A){return this.Yd.lGc(...A)}b_d(...A){return this.Yd.b_d(...A)}LXa(...A){return this.Yd.LXa(...A)}EKh(...A){return this.Yd.d6e(...A)}extractReferences(...A){return this.Yd.extractReferences(...A)}Bja(...A){return this.Yd.Bja(...A)}kod(...A){return this.Yd.kod(...A)}yFb(...A){return this.Yd.yFb(...A)}r3b(...A){return this.Yd.r3b(...A)}localizeEnglishFormula(...A){return this.Yd.localizeEnglishFormula(...A)}Dc(...A){return this.$.Dc(...A)}Gb(...A){return this.$.Ia.Gb(...A)}Sj(...A){return this.$.Sj(...A)}sendBeaconTraceTag(...A){return this.$.sendBeaconTraceTag(...A)}kn(...A){return this.$.userOperationManager.kn(...A)}Kp(...A){return this.$.userOperationManager.Kp(...A)}get isFeedbackEnabled(){return this.$.isFeedbackEnabled}get Aa(){return this.$.Aa}get la(){return this.$.la}get activeItemName(){return this.da.$.activeItemName}get wYc(){var A;
return null===(A=this.$.qa)||void 0===A?void 0:A.la}get Cw(){return this.$.fa.Cw}get displayRtl(){return this.$.la.displayRtl}get wCe(){return this.$.workbookContext.WorkbookFileName}i5i(){return l.a(this.$)}static LFc(A){return Object(u.a)(A)}static sendOtelEvent(...A){return Object(m.c)(...A)}static Ogh(...A){return n.a(...A)}static rMg(...A){Object(d.d)(...A)}static wKd(...A){return Object(h.a)(...A)}static Ell(){return Object(d.g)()}static sFi(...A){return Object(x.I)(...A)}static mY(...A){return Object(k.d)(...A)}UZa(){return this.Zqj}eIa(){return f.a.eIa(this.$)}TZa(){return f.a.TZa(this.$)}SZa(){return f.a.SZa()}static Gja(...A){return Object(c.a)(...A)}bgj(){this.K6a=
this.eD.Hja()}R2k(...A){var N;return null===(N=this.K6a)||void 0===N?void 0:N.yXa(...A)}qId(...A){return this.$e.qId(...A)}n7(...A){return this.$e.n7(...A)}Ooj(){var A=[];return!!this.indexedDB&&this.indexedDB.Tf(...A)}ghj(...A){this.indexedDB.initialize(...A)}PRi(...A){return this.indexedDB.zta(...A)}MCk(...A){this.indexedDB.Qxa(...A)}deleteDatabase(...A){return this.indexedDB.deleteDatabase(...A)}idh(A,N){this.hj.register(this.hj.RT().NV("FormulaByExample").LV(A).activateAnnotation(N).build())}Uoj(){return!!this.hj}gal(){this.hj.unregister(...["FormulaByExample"])}t1k(...A){this.hj.qvb(...A)}R3(A,
N){this.Eq&&(this.Eq.Tfa(A,1,{errorMessage:N}),this.Eq.xgb(A))}NBk(A){this.$.ra.Vc(254,A)}}Object(y.a)(G,"FormulaByExampleServiceProxy",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.edt.js.map/32a3a2173b60bc4257383f4259b9cc5d/EwaTS.edt.js.map