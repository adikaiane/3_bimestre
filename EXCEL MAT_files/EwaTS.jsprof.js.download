'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[30],{720:function(y,r,a){a.r(r);y={};a.r(y);a.d(y,"JsSelfProfilerManager",function(){return Y});r={};a.r(r);var c=a(0),b=a(15),f=a(91),k=a(545),x=a(6),d=a(141),h=a(10),n=a(57),m=a(53),u=a(1),l=a(58);class t{constructor(O){this.hZk=O}getCustomProperties(O){const C=new Map;if(O.hasOwnProperty("startTimeInMs")&&O.hasOwnProperty("totalExecutionTimeInMs")){const X=O.startTimeInMs;O=this.hZk.retrieveSlowActionsBetweenTimeRange(X,
X+O.totalExecutionTimeInMs);C.set("actions",l.a.Nc(O))}return C}}Object(c.a)(t,"CallTreeCustomPropertiesRetriever",null,[]);class e{constructor(O){this.IBk=O}getCustomProperties(O){const C=new Map;if(O.hasOwnProperty("startTimeInMs")&&O.hasOwnProperty("totalExecutionTimeInMs")){const X=O.startTimeInMs;O=this.IBk.retrieveRumShepherdEventsBetweenTimeRange(X,X+O.totalExecutionTimeInMs);C.set("rumShepherdData",JSON.stringify(O))}return C}}Object(c.a)(e,"CallTreeRumShepherdCustomPropertiesRetriever",null,
[]);class w{constructor(){this.customProperties=new Map}addCustomProperty(O,C){this.customProperties.set(O,C)}getCustomProperties(){return this.customProperties}}Object(c.a)(w,"CustomPropertiesRetriever",null,[]);class z{isFeatureEnabled(O,C){return u.EwaSettings.getBooleanFeatureGate(O,C)}}Object(c.a)(z,"ExcelFeatureChecker",null,[]);class E{isProfilingEnabled(){return!0}}Object(c.a)(E,"ExcelProfilingFeatureChecker",null,[]);var M;(function(O){O[O.Manual=0]="Manual";O[O.Timed=1]="Timed";O[O.Continuous=
2]="Continuous";O[O.FullSession=3]="FullSession"})(M||(M={}));var G;(function(O){O[O.ProfilerStopped=0]="ProfilerStopped";O[O.PreProfilerStart=1]="PreProfilerStart"})(G||(G={}));class A{constructor(O,C){this.O5j=O;this.Q5j=C}onProfilerEvent(O){switch(O.eventId){case G.PreProfilerStart:this.O5j(u.EwaSettings.isChangeGateEnabled("OfficeVSO:6144046_KeepOldCollectedActions"));break;case G.ProfilerStopped:this.Q5j();break;default:b.ULS.sendTraceTag(537155529,0,15,`JSCPUIJSCPUProfilerObserver.OnProfilerEvent: got unhandled profilerEventId ${O.eventId}`)}}}
Object(c.a)(A,"JSCPUProfilerObserver",null,[]);var N=a(40);class K{filter(O){var C,X,S;const ea=!N.a.instance.TTSI||(null===(C=O.serializedFrames[0])||void 0===C?void 0:C.startTimeInMs)<N.a.instance.g$k;C=(null===(X=O.propertyBag)||void 0===X?void 0:X.actions)&&"[]"!==O.propertyBag.actions;O=0<(null===(S=O.serializedFrames[0])||void 0===S?void 0:S.totalExecutionTimeInMs);return ea&&O||C}}Object(c.a)(K,"CallTreeCustomFilterer",null,[]);var I=a(5),L=a(65),J=a(9);class B{constructor(O=-1){this.h$k=O;
this.W1c=void 0}setTTVRTime(O){this.W1c=O}filter(O){var C;return void 0===this.W1c?!0:this.W1c<this.h$k?!1:(null===(C=O.serializedFrames[0])||void 0===C?void 0:C.startTimeInMs)<=this.W1c}}Object(c.a)(B,"BootProfilerCallTreeFilterer",null,[]);Object(L.b)(I.JsSelfProfilerManagerService,{we:"singleton"})(async()=>{const [O,C]=await Promise.all([L.a.resolve(I.EwaControlService),L.a.resolve(I.InteractivityTrackerServiceIdentifier),L.a.resolve(I.OfficeOnlineCpuProfilingService)]);return new Y(O,C,0)});
Object(L.b)(I.JsSelfProfilerManagerSyncService,{we:"singleton"})(()=>new Y(J.a.h7,null,1));class Y{constructor(O,C,X){this.LHa=this.BZg=this.Fee=this.nrb=this.Gee=this.nAg=this.pAg=null;this.Bgk=new Set([G.PreProfilerStart,G.ProfilerStopped]);b.ULS.sendTraceTag(537155528,0,50,"JsSelfProfilerManager.Ctor: creating new JsSelfProfilerManager");this.$=O;this.LHa=C;this.zij();this.yij();this.Xzj=u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingSampleIntervalInMs",16);this.profilingIntervalInMs=
u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingWindowDurationInMs",1E4);this.nif=u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingIdleIntervalInMs",3E5);b.ULS.sendTraceTag(507593507,0,50,`JsSelfProfilerManager: starting profiler: ${X.toString()}`);switch(X){case 1:O=u.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.JsProfilerOnBootMaximumProfilingDurationMs",6E4);this.S_k(O);u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RelyOnRumTTVREventForBootProfiler",
!1)||this.$.fa.Nr(()=>{this.N0k()});break;case 0:this.v9j=u.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.ProfilerName",""),u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FullSessionJSProfiler",!1)?this.oNd("ExcelOnlineFullSessionProfiler",M.FullSession).start():this.x_k()}}dispose(){b.ULS.sendTraceTag(537155527,0,50,"JsSelfProfilerManager.Dispose");f.a.vb(this.BZg);this.Fee=this.$=null;this.Gee.clear();this.nrb.clear()}x_k(){const O=Math.random()*this.nif;b.ULS.sendTraceTag(537155526,
0,50,`JsSelfProfilerManager.Ctor: starting ContinuousSessionProfiler in: ${O}`);this.BZg=n.a.instance.create(()=>{this.oNd("ExcelOnlineContinuousSessionProfiler",M.Continuous).start()},O,m.a.jPk,!0)}S_k(O=1E4){b.ULS.sendTraceTag(537155524,0,50,"JsSelfProfilerManager.StartManualProfiler: Starting a new profiler");this.oNd("BootProfiler",M.Manual,O).start()}N0k(){var O=this.vMf("BootProfiler");O&&O.stop()}oAg(O){return this.nrb.has(O)}yij(){const O=new E;var C=u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldLogRawProfilerTrace",
!1);C={ulsInstance:new k.a,deObfuscationEndpoint:"ProfilerReporting.ashx",shouldCompressSerializedCallTrees:!1,shouldKeepSamplesOutsideOfProfilingInterval:!1,shouldSendAllCallTreesFromProfileInASingleRequest:!u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldSendEachCallTreeIndividuallyFromProfile",!1),shouldUseSendBeaconForSendingCallTrees:u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldUseSendBeaconForSendingCallTrees",!1),callTreeFilteringThresholdInMs:u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerCallTreeFilteringThresholdInMs",
-1),frameTotalExecutionTimeFilteringThresholdInMs:u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerFrameTotalExecutionTimeFilteringThresholdInMs",-1),shouldRecordFrameCounts:!0,deObfuscationRequestQueryParamsRetriever:this.$6h(),deObfuscationRequestBodyPropertiesRetriever:this.Z6h(),featureEnabledChecker:new z,useMainEventLoopForProfilerTraceProcessing:!1,profilerTraceProcessingWebWorkerSourceURL:this.$.ta.JSProfilerProcessingWebWorkerJsScriptUrl,shouldProcessProfileCapturedWhileUserIsIdle:u.EwaSettings.isChangeGateEnabled("OfficeVSO:6144063_ShouldProcessProfileCapturedWhileUserIsIdle"),
shouldLogRawProfilerTrace:C,profilerTraceLoggingChunkSize:C?u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ProfilerTraceLoggingChunkSize",30):0};this.Fee=this.pAg.retrievePackage(O,C).retrieveProfilerFactory()}$6h(){const O=new w;O.addCustomProperty(h.a.eBg,x.AFrameworkApplication.userType);O.addCustomProperty(x.AFrameworkApplication.NNa,x.AFrameworkApplication.userSessionId);O.addCustomProperty(h.a.o7d,this.$.ta.SkipAuthentication?h.a.rhg:null);O.addCustomProperty(h.a.ffe,this.$.ta.MachineCluster);
return O}Z6h(){const O=new w;O.addCustomProperty("appName","Excel");O.addCustomProperty("buildVersion",x.AFrameworkApplication.buildVersion);O.addCustomProperty("shouldUseSourceMaps","true");O.addCustomProperty("shouldFilterSensitiveResources","true");O.addCustomProperty("shouldUseJSSelfProfilerSpecificDeobfuscator","false");return O}u$h(O,C){const X=this.Xzj;return{samplingIntervalInMs:X,maximumNumberOfSamplesToTake:null!=C&&0<X?C/X:2E6,idleIntervalInMs:O===M.Continuous?this.nif:null,profilingIntervalInMs:O===
M.Manual?null:this.profilingIntervalInMs}}plf(O,C,X){const S=new w;S.addCustomProperty("ProfilerName",O);this.nAg.set(O,S);C=this.Fee.createProfiler(C,this.u$h(C,X),S);this.nrb.set(O,C);return{mAg:C,Qgk:S}}A8h(O,C,X){({mAg:C}=this.plf(O,C,X));O=this.B8h(O);C.subscribeProfilerObserver(O,this.Bgk);O=new K;C.subscribeCallTreeCustomFilterer(O);return C}kpk(O,C,X){function S(ea){(ea=ea.detail)&&"time"in ea&&"metric"in ea&&"visually-ready"===ea.metric&&(window.removeEventListener("Wac-AppLoadMetricReport",
S),u.EwaSettings.isChangeGateEnabled("OfficeVSO:8991167_WriteTTVROnCallTrees")?X.addCustomProperty("reachedTTVR",ea.time.toFixed(2)):X.addCustomProperty("reachedTTVR","true"),C.setTTVRTime(ea.time),O.stop())}window.addEventListener("Wac-AppLoadMetricReport",S)}i6h(O,C,X){const {mAg:S,Qgk:ea}=this.plf(O,C,X);u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RelyOnRumTTVREventForBootProfiler",!1)&&(O=u.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.AbsoluteTTVRTimeCutOff",-1),O=new B(O),
this.kpk(S,O,ea),S.subscribeCallTreeCustomFilterer(O));if(!u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AddRumShepherdDataToCallTree",!1))return S;O=u.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CollectRumShepherdComponentDataOnly",!1);O=rumShepherd.RumShepherdFactoryGlobal.createAndInitRumShepherdDataRetriever(!O);if(!O)return b.ULS.sendTraceTag(507368864,0,15,"JsSelfProfilerManager.createProfilerWithOptions.createBootProfiler.createAndInitRumShepherdDataRetriever returned null"),
S;O=new e(O);S.subscribeCallTreeCustomPropertiesRetriever(O);return S}vMf(O){return this.oAg(O)?this.nrb.get(O):(b.ULS.shipAssertTag(537155520,0,!1,`JsSelfProfilerManager.GetProfiler: Profiler with such name (${O}) does not exist`),null)}oNd(O,C,X=null){O=this.v9j||O;if(this.oAg(O))return this.vMf(O);b.ULS.sendTraceTag(537155521,0,50,"JsSelfProfilerManager.CreateProfiler: Creating a new profiler");return u.EwaSettings.i_a()?this.i6h(O,C,X):this.A8h(O,C,X)}B8h(O){var C=this.LHa;if(C){const X=C.Flf();
if(X){C=this.nrb.get(O);const S=new t(X);C.subscribeCallTreeCustomPropertiesRetriever(S);C=new A(ea=>{X.startCollectingSlowActions(ea)},Object(d.a)(X,X.stopCollectingSlowActions,"stopCollectingSlowActions"));this.Gee.set(O,C);return C}b.ULS.sendTraceTag(537155491,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: CreateSlowActionsRetriever returned null");return null}b.ULS.sendTraceTag(537155490,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: call to InteractivityTracker returned null");
return null}zij(){this.pAg=officeOnlineCpuProfiling.getJSCPUProfilingPackageRetriever();this.nAg=new Map;this.Gee=new Map;this.nrb=new Map}}Object(c.a)(Y,"JsSelfProfilerManager",null,[33,4]);var U=a(325);Object(L.b)(I.OfficeOnlineCpuProfilingService)(async()=>{await Object(U.loadChunkWithDynamicScriptLoader)("officeOnlineCpuProfiling",{xa:0});return officeOnlineCpuProfiling});window.jsprof=!0;String(y);String(r);window.___1717508060474_closurehack=y;window.___1717508060474_closurehack=r}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.jsprof.js.map/e3cfaef2533ff5fedbfa8711201c1e89/EwaTS.jsprof.js.map