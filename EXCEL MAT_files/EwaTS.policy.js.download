'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[45],{885:function(y,r,a){a.r(r);var c={};a.r(c);a.d(c,"SensitivityCommandHandler",function(){return l});var b=a(133),f=a(0),k=a(6),x=a(209);class d{}d.F0k="sbProtectForm14";d.I0k="SBStatusBarMarkAsReadOnly14";d.TBj="Info_16x16x32";d.EIb="QuickSearchCompletedToday_16x16x32";d.Lfe="CommonControlCheckboxCheck_16";d.O2g="On";d.visible="Visible";d.kDi="ImageIsVisible";d.fA="SourceControlId";d.menuItemId="MenuItemId";
d.menu="Menu";d.eqd="AppLockId";d.value="Value";d.Yi="LabelText";d.alt="Alt";d.DVf="Image16by16";d.cka="Image16by16Class";d.E0k="SBProtectForm_16";d.H0k="SBStatusBarMarkAsReadOnly_16";d.icon="Icon";d.iconColor="IconColor";d.customTooltip="CustomTooltip";d.Dkk="MipTagDynamicFillWithOutline_20";d.Ekk="MipTagLockDynamicFillWithOutline_20";d.Ckk="MipTagErrorOutline_20";d.Fkk="MipTagQuestionOutline_20";d.D1c="transparent";d.q$k="UILocation";Object(f.a)(d,"PolicyConstants",null,[]);var h=a(26),n=a(67),
m=a(5),u=a(65);let l=class{constructor(yb){this.$=yb}gd(){return!1}executeCommand(yb,Oc,kd){switch(Oc.command){case h.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(kd[d.eqd]=this.$.workbookContext.ExclusiveLockId),yb=k.AFrameworkApplication.Kb.pe(h.a.setSensitivity,2,kd),n.Task.Va(32===yb);case h.a.qZ:return yb=k.AFrameworkApplication.Kb.pe(h.a.qZ,2,kd),n.Task.Va(32===yb);case h.a.nV:return yb=k.AFrameworkApplication.Kb.pe(h.a.nV,2,kd),n.Task.Va(32===yb);default:return x.a(Oc.command)}}Rc(yb,
Oc){switch(Oc.command){case h.a.setSensitivity:case h.a.qZ:case h.a.nV:return!0;default:return!1}}td(yb,Oc,kd){switch(Oc){case "PopulateSensitivityFlyout":return 32===k.AFrameworkApplication.Kb.pe(h.a.Xla,2,kd);default:return!1}}};l=Object(b.__decorate)([Object(u.d)(m.SensitivityCommandHandlerService),Object(b.__param)(0,Object(m.EwaControlService)())],l);Object(f.a)(l,"SensitivityCommandHandler",null,[29]);var t=a(19);const e=Object(t.b)("Common.App.Policy.PolicyActor"),w=Object(t.c)(e);var z=a(1227),
E=a(1155),M=a(257);const G=Object(t.c)(E.a);var A=a(15),N=a(141),K=a(1209),I=a(663),L=a(661);class J{constructor(yb,Oc,kd=null){this.id=yb.Id;kd||(kd="");this.Flk=kd;this.sensitivityLabel=yb}}Object(f.a)(J,"AutoPolicyLabelData",null,[]);class B{constructor(yb,Oc){this.cT=yb;this.displayName=Oc}}Object(f.a)(B,"PolicyLabelRequestState",null,[]);class Y{constructor(){this.rne=this.s7d=""}}Object(f.a)(Y,"PolicyStrings",null,[]);var U=a(238),O=a(24);class C extends U.a{constructor(yb,Oc,kd){super(!1,!1,
!0);this.nBa=null;this.mbc=!1;this.xSc=Rc=>{let Xb="";1===Rc&&this.nBa&&(Xb=this.nBa);if(this.qy.QK()){const dc=this.$G;dc(Rc,this.KXe,Xb)}else this.$G(Rc,this.KXe,Xb)};this.Fog=Rc=>{this.nBa=Rc;Rc=this.validate();this.mbc!==Rc&&(this.mbc=Rc,this.BNa(Object(O.a)("SensitivityJustificationTitle"),this.qy.QK()?this.xSc.bind(this):this.xSc,this.GMf(this.mbc)))};this.qy=yb;this.KXe=Oc;this.$G=kd;this.uf=C.id;this.Ic(1,Object(O.a)("DialogChange"));this.i4(1,!1);this.hfa(0)}gte(){this.initializeAndShow(Object(O.a)("SensitivityJustificationTitle"),
this.qy.QK()?this.xSc.bind(this):this.xSc,this.GMf(this.mbc))}GMf(yb){return{["id"]:this.uf,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:Object(O.a)("SensitivityJustificationPlaceholder")}},["actionButtonProps"]:{["label"]:Object(O.a)("DialogChange"),["disabled"]:!yb},["infoMessage"]:Object(O.a)("SensitivityJustificationMessage"),["justificationIrrelevantLabel"]:Object(O.a)("SensitivityJustificationNoLongerApplies"),["justificationIncorrectLabel"]:Object(O.a)("SensitivityJustificationIncorrect"),
["justificationOtherLabel"]:Object(O.a)("SensitivityJustificationOther"),["onJustificationUpdated"]:this.qy.QK()?this.Fog.bind(this):this.Fog}}}C.id="JustificationDialog";Object(f.a)(C,"JustificationDialog",U.a,[]);class X extends U.a{constructor(yb,Oc,kd,Rc){super(!1,!1,!0);this.Gdg=(Xb,dc)=>{1===Xb&&dc.selectedLabel&&(Xb=dc.selectedLabel,""!==Xb&&(this.qy.QK()?(dc=this.HKe,dc(Xb)):this.HKe(Xb)))};this.qy=yb;if(Oc&&Rc){yb={["id"]:"MandatoryLabellingDialog"};this.HKe=Rc;this.Aed=kd;if(!k.AFrameworkApplication.ea.ka("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||
this.Aed&&""!==this.Aed)kd={["href"]:this.Aed,["target"]:"_blank"},yb.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:Object(O.a)("LearnMore"),["handler"]:kd,["customTooltip"]:Object(O.a)("LearnMoreTooltip")};kd={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(kd.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Oc});yb.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,
["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:kd};Oc={["id"]:"MandatoryLabellingDialog",["bodyControls"]:yb};yb.initialLabelText=Object(O.a)("MandatoryLabellingDialogInitialLabelText");yb.descriptionText=Object(O.a)("MandatoryLabellingDialogDescriptionText");this.initializeAndShow(Object(O.a)("MandatoryLabellingDialogBusinessBarTitle"),this.qy.QK()?this.Gdg.bind(this):this.Gdg,Oc)}else A.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}}Object(f.a)(X,
"MandatoryLabellingDialog",U.a,[]);var S=a(985);class ea{constructor(){this.gBb=!!k.AFrameworkApplication.ua&&k.AFrameworkApplication.ua.Ab.HN}Y8h(yb,Oc,kd){this.gBb&&new X(S.a.instance,yb,Oc,kd)}static get instance(){return ea.Wa||(ea.Wa=new ea)}}ea.Wa=null;Object(f.a)(ea,"MandatoryLabellingDialogFactory",null,[707]);var Oa=a(705),Ha=a(285),Za=a(225),fa=a(677),la=a(103),ba=a(165),aa=a(98),oa=a(493),Na=a(437),Ia=a(104),Sa=a(503),Pa=a(190),za=a(488),wa=a(66),db=a(32),Ba=a(135),Ka=a(366),da=a(112);
class sa extends Sys.EventArgs{constructor(yb){super();this.R3k=yb}}Object(f.a)(sa,"WatermarkChangeEventArgs",Sys.EventArgs,[]);class mb{constructor(yb,Oc,kd,Rc,Xb=[]){var dc;this.tBb=this.Poa=null;this.kdd=this.Gdd=this.kBb=this.vQe=this.jSe=this.K9c=!1;this.$8a=this.ooa=this.lpa=this.iAa=this.nBa=null;this.elh=this.v7c=0;this.dhd=null;this.h$c=!1;this.xb=new da.a;this.Efc=this.ied="";this.Pld=new Map;this.X$c=this.Cdd=this.L7c=null;this.kEg=()=>{this.kdd&&!this.xFc()&&(this.kdd=!1,this.yg.value.Wmk())};
this.EJj=Vc=>{this.kEd(this.kSe[Vc])};this.V1b=()=>{if(!this.yg.value.M4f()){var Vc=this.Gy[this.Bh.AppliedPolicyId];this.kBb&&this.iAa&&this.$8a!==this.iAa.id&&(!Vc||Vc.Order<this.iAa.sensitivityLabel.Order)&&(Vc=this.v5a(this.iAa.id,{},4),32!==Vc?A.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Vc):(this.$8a=this.iAa.id,this.ooa&&(Vc=this.Gy[this.ooa])&&Vc.Order<=this.iAa.sensitivityLabel.Order&&(this.yg.value.Kea(29),this.ooa=null)));
Vc=this.Gy[this.Bh.AppliedPolicyId];if(this.lpa&&this.ooa!==this.lpa.id&&(!Vc||Vc.Order<this.lpa.sensitivityLabel.Order)){const yd=this.lpa.id;this.yg.value.Kea(29);Vc=this.yg.value.vXa(this.lpa.sensitivityLabel);this.yg.value.Cbb(29,Object(O.a)("PolicyBusinessBarTitle"),String.format(Object(O.a)("PolicyLabelRecommendationMessage"),Vc)+" "+this.lpa.Flk,Object(O.a)("PolicyLabelRecommendationButton"),()=>{this.v5a(yd,{},8)});this.ooa=this.lpa.id}this.lpa=this.iAa=null}};this.mif=(Vc,yd,Pd)=>{1===Vc?
this.Wtb(yd===this.Bh.AppliedPolicyId?"":yd,Pd):this.dh.ax()};this.v$e=Vc=>{1===Vc&&this.yg.value.Ajk()};this.agb=()=>32;this.hug=(Vc,yd)=>{yd.nG&&this.Gy&&(Vc=this.Gy[this.Bh.AppliedPolicyId])&&(this.ooa&&(yd=this.Gy[this.ooa])&&yd.Order<=Vc.Order&&(this.yg.value.Kea(29),this.ooa=null),this.$8a&&this.$8a!==Vc.Id&&(this.yg.value.Kea(28),this.$8a=null))};this.qy=new S.a(kd);this.zba=new S.b(kd);this.qmd=[];this.pb=yb;this.dh=Oc;this.ya=kd;this.yg=Rc;this.ZBb={};this.mVe={};this.kSe={};this.LEc=kd.ka("WacApplyManualPolicyLabelIsEnabled");
this.qy.QK()?(this.yg.value.cpd(this.V1b.bind(this)),this.yg.value.SFb(this.V1b.bind(this)),this.yg.value.MCa(this.hug.bind(this)),null===(dc=k.AFrameworkApplication.ua)||void 0===dc?void 0:dc.D4e(this.kEg.bind(this))):(this.yg.value.cpd(this.V1b),this.yg.value.SFb(this.V1b),this.yg.value.MCa(this.hug),k.AFrameworkApplication.ua&&k.AFrameworkApplication.ua.D4e(this.kEg));this.H_f()&&Xb&&0<Xb.length&&(this.h$c=!0,Xb.forEach(Vc=>this.Pld.set(Vc.watermarkElement,Vc)));(Object(S.c)(kd)?this.zba.supportsPolicies():
kd.ka("SupportsPolicies"))&&kd.Qa("AppliedPolicyId")&&(this.Poa=kd.Qa("IrmPolicyTitle"),this.tBb=kd.Qa("IrmPolicyDescription"));Object(S.c)(kd)?(this.FHe=this.zba.RFf(),this.GHe=this.zba.SFf()):(this.FHe=this.ya.Rd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6),this.GHe=this.ya.Rd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3))}get Zua(){return k.AFrameworkApplication.Zua||!!this.Cdd&&this.Cdd()}wi(){this.qy.QK()?(this.X9b(),this.uL(h.a.SPc,this.agb.bind(this),0),this.uL(h.a.aLa,this.aLa.bind(this),
96),this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.uL(h.a.Yae,this.agb.bind(this),0),this.uL(h.a.r3a,this.r3a.bind(this),96)),this.uL(h.a.aza,this.aza.bind(this),4),this.uL(h.a.Xla,this.Xla.bind(this),4),this.uL(h.a.setSensitivity,this.setSensitivity.bind(this),4),this.uL(h.a.bLa,this.bLa.bind(this),96),this.uL(h.a.nV,this.nV.bind(this),4),this.uL(h.a.qZ,this.qZ.bind(this),4),this.dh.ax()):(this.pb.jc(h.a.SPc,Ba.a.frame,this.agb),this.pb.ef(h.a.aLa,
Ba.a.frame,Object(N.a)(this,this.aLa,"queryPolicyLabel"),96),this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.pb.jc(h.a.Yae,Ba.a.frame,this.agb),this.pb.ef(h.a.r3a,Ba.a.frame,Object(N.a)(this,this.r3a,"queryPolicyShortLabel"),96)),this.pb.jc(h.a.aza,Ba.a.frame,Object(N.a)(this,this.aza,"toggleSensitivity")),this.pb.jc(h.a.Xla,Ba.a.frame,Object(N.a)(this,this.Xla,"populateSensitivityFlyout")),this.pb.jc(h.a.setSensitivity,Ba.a.frame,Object(N.a)(this,
this.setSensitivity,"setSensitivity")),this.pb.ef(h.a.bLa,Ba.a.frame,Object(N.a)(this,this.bLa,"querySensitivity"),96),this.pb.jc(h.a.nV,Ba.a.frame,Object(N.a)(this,this.nV,"querySensitivityToggleButton")),this.pb.jc(h.a.qZ,Ba.a.frame,Object(N.a)(this,this.qZ,"querySensitivitySubFlyout")),this.DEb(h.a.aza)||this.pb.Jtb(h.a.aza,4),this.DEb(h.a.Xla)||this.pb.Jtb(h.a.Xla,4),this.DEb(h.a.setSensitivity)||this.pb.Jtb(h.a.setSensitivity,4),this.DEb(h.a.nV)||this.pb.Jtb(h.a.nV,4),this.DEb(h.a.qZ)||this.pb.Jtb(h.a.qZ,
4),this.dh.ax(),k.AFrameworkApplication.ea&&Ia.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.yg.value.pHg(Object(N.a)(this,this.xEg,"registerActionsHandler")))}uL(yb,Oc,kd){0===kd?this.pb.jc(yb,Ba.a.frame,Oc):this.pb.ef(yb,Ba.a.frame,Oc,kd);this.qmd.push(()=>{this.pb.Xx(yb,Ba.a.frame,Oc)})}xEg(){this.wi()}X9b(){if(this.qy.QK()){const yb=this.qmd;this.qmd=[];yb.forEach(Oc=>Oc())}else this.pb.Xx(h.a.SPc,Ba.a.frame,this.agb),
this.pb.Xx(h.a.aLa,Ba.a.frame,Object(N.a)(this,this.aLa,"queryPolicyLabel")),this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.pb.Xx(h.a.Yae,Ba.a.frame,this.agb),this.pb.Xx(h.a.r3a,Ba.a.frame,Object(N.a)(this,this.r3a,"queryPolicyShortLabel"))),this.pb.Xx(h.a.aza,Ba.a.frame,Object(N.a)(this,this.aza,"toggleSensitivity")),this.pb.Xx(h.a.Xla,Ba.a.frame,Object(N.a)(this,this.Xla,"populateSensitivityFlyout")),this.pb.Xx(h.a.setSensitivity,Ba.a.frame,Object(N.a)(this,
this.setSensitivity,"setSensitivity")),this.pb.Xx(h.a.bLa,Ba.a.frame,Object(N.a)(this,this.bLa,"querySensitivity")),this.pb.Xx(h.a.nV,Ba.a.frame,Object(N.a)(this,this.nV,"querySensitivityToggleButton")),this.pb.Xx(h.a.qZ,Ba.a.frame,Object(N.a)(this,this.qZ,"querySensitivitySubFlyout"))}aza(){return 32}KFf(yb){const Oc="mandatoryLabelling_"+yb.Id;this.kSe[Oc]=yb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Oc,["label"]:yb.DisplayName,["hideLabel"]:!1,["customTooltip"]:yb.Tooltip}}kIa(){return Object(S.c)(this.ya)?
this.qy.kIa():this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)}get Bh(){return this.yg.value.Zj}get Gy(){return this.yg.value.vD}get H2a(){return this.yg.value.CCb}UUi(){const yb=[];for(const kd in this.H2a){var Oc=this.H2a[kd];const Rc=this.Gy[kd];if(Rc&&Rc.Enabled&&!Rc.HasUserDefinedPermissions)if(Oc.count){const Xb={["sections"]:[],["shouldAutoOpen"]:!1},dc={["id"]:"mandatoryLabelling_flyoutMenuSection_"+Rc.Id,["controls"]:[]};for(const Vc of Oc)(Oc=this.Gy[Vc])&&
Oc.Enabled&&!Oc.HasUserDefinedPermissions&&Array.add(dc.controls,this.KFf(Oc));Array.add(Xb.sections,dc);Array.add(yb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+Rc.Id,["label"]:Rc.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:Xb})}else Array.add(yb,this.KFf(Rc))}return yb}Xla(yb,Oc,kd,Rc,Xb){if(1===kd||!this.yg.value.Vaa(!0))return 32;Xb.MenuItems=Object.assign(new oa.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(Xb.MenuItems.MenuSectionList,
this.uc(!this.isReactRibbonEnabled()));this.Bh.CustomUrl&&Array.add(Xb.MenuItems.MenuSectionList,this.K8h(this.isReactRibbonEnabled()?this.Bh.CustomUrl:db.a.Ig(this.Bh.CustomUrl)));this.isReactRibbonEnabled()||(Xb.PopulationXML=Za.q(Xb.MenuItems));return 32}bLa(yb,Oc,kd,Rc,Xb){if(1===kd||!Xb||!this.LEc)return 32;if(this.yg.value.Vaa(!0)&&(Xb[d.visible]=!0,this.vQe||(aa.a("MipLabelsAvailable"),this.vQe=!0),this.kIa()&&this.Bh.AreLabelsAvailable&&(yb=Object(t.d)(I.a)))){const dc=this.Bh.AppliedPolicyId?
"LouderLabel_LabelExistsOnLoadActivity":"LouderLabel_NoLabelAppliedOnLoadActivity";yb.execute(Vc=>{Vc.logActivity(dc,null)})}return 32}nV(yb,Oc,kd,Rc,Xb){if(1===kd||!Xb)return 32;let dc,Vc;Xb[d.O2g]=!!(dc=Xb[d.menuItemId])&&!!(Vc=this.ZBb[dc])&&Vc===this.Bh.AppliedPolicyId;return 32}qZ(yb,Oc,kd,Rc,Xb){if(1===kd||!Xb)return 32;let dc,Vc,yd;yb=!!(dc=Xb[d.fA])&&!!(Vc=this.ZBb[dc])&&!!(yd=this.H2a[Vc])&&yd.contains(this.Bh.AppliedPolicyId);Xb[d.kDi]=yb;Xb[d.O2g]=yb;return 32}setSensitivity(yb,Oc,kd,Rc,
Xb){if(1===kd||!Xb)return 32;yb=this.ZBb[Xb[d.fA]];aa.a("SensitivityPickerUsage",void 0,void 0,[{name:"SensitivityPickerLocation",int64:this.r$k(Xb[d.q$k])}]);return this.v5a(yb,Xb,2)}xFc(){return!!k.AFrameworkApplication.ua&&1===k.AFrameworkApplication.ua.mode}S3g(){this.Bh.DefaultLabelId&&this.Bh.MandatoryLabelingEnforced?this.K9c||this.xFc()?this.Bh.AppliedPolicyId?this.kEd(""):(this.yg.value.Rvj(this.yg.value.jXb)||this.xFc())&&this.ntf():this.BQg():this.Bh.DefaultLabelId?this.BQg():this.Bh.MandatoryLabelingEnforced&&
(this.Bh.AppliedPolicyId?this.kEd(""):this.ntf())}e2f(){return this.Bh.MandatoryLabelingEnforced?this.Bh&&this.Bh.AreLabelsAvailable?this.ya.ka("TestOverrideIsReactDialogEnabled")||this.dh&&this.dh.Ab&&this.dh.Ab.HN?!0:(A.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(A.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(A.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),
!1)}ntf(){!this.e2f()||k.AFrameworkApplication.n8||this.jSe||(this.jSe=k.AFrameworkApplication.n8=!0,A.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.yg.value.LBg("",1),this.yg.value.Okc(37,Object(O.a)("MandatoryLabellingDialogBusinessBarTitle"),Object(O.a)("MandatoryLabellingDialogDescriptionText"),Object(O.a)("MandatoryLabellingDialogBusinessBarButton"),()=>{this.DJj()}))}kEd(yb){this.e2f()&&k.AFrameworkApplication.n8&&(k.AFrameworkApplication.n8=!1,A.ULS.sendTraceTag(562837518,
306,50,"Mandatory labelling is escaped successfully."),this.yg.value.DTc(),this.yg.value.LBg(yb,2))}DJj(){ea.instance.Y8h(this.UUi(),this.Bh.CustomUrl,this.EJj)}T9e(){return Object(S.c)(this.ya)?this.ya.ka("CoAuthForProtectedFilesIsEnabled")&&this.zba.supportsOfficeClientCoauthoring()&&this.ya.ka("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.X$c&&this.Zua:this.ya.ka("CoAuthForProtectedFilesEnabled")&&this.ya.ka("SupportsOfficeClientCoauthoring")&&this.ya.ka("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&
!!this.X$c&&this.Zua}v5a(yb,Oc,kd){this.yg.value.vjk(kd);let Rc=32,Xb=!1,dc=!0;const Vc=this.Gy[yb],yd=2===kd||8===kd||16===kd,Pd=yb===this.Bh.AppliedPolicyId;if(this.L7c&&this.L7c(yb,yd))A.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",kd),this.dh.ax();else if(Oc&&d.eqd in Oc&&this.yg.value.aLk(Oc[d.eqd]),yb)if(this.yg.value.M4f()||this.T9e()&&this.Gdd)A.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
kd),this.dh.ax(),yd&&this.imc(Object(O.a)("SensitivityApplicationDialogErrorTitle"),Object(O.a)("SensitivityQuickApplicationErrorMessage"));else if(this.ya.ka("HasDocumentEditRights"))if(this.yg.value.eVh(yb))if((null===Vc||void 0===Vc?0:Vc.HasUserDefinedPermissions)&&!Pd)A.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",kd),1!==kd&&4!==kd&&this.dIh();else if(yd&&this.Bh.MandatoryLabelingEnforced&&Pd)A.ULS.sendTraceTag(570972054,306,50,
"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",kd),this.imc(Object(O.a)("MandatoryLabellingBlockLabelRemovalDialogTitle"),Object(O.a)("MandatoryLabellingBlockLabelRemovalDialogDescriptionText"));else{if(yd&&this.ya.ka("WacLabelingJustificationDialogIsEnabled")&&this.Bh.RequiredDowngradeJustification&&(Pd||(null===Vc||void 0===Vc?0:Vc.RequiredDowngradeJustification))&&!this.nBa)return A.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
kd),this.gte(yb),Rc;if(this.T9e()&&!this.X$c())this.v7c<this.FHe?(A.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.v7c,kd),this.Gdd=!0,this.v7c++,n.Task.delay(this.GHe).continueWith(()=>{this.Gdd=!1;this.v5a(yb,Oc,kd)})):(A.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",kd),Xb=1!==kd,dc=!1,Rc=8);else{if(this.luj(yb)&&
(A.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",kd),1===kd||8===kd||4===kd))return Rc;A.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",kd);this.Wtb(Pd?"":yb,this.nBa,kd);return Rc}}else A.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",kd),this.dh.ax(),yd&&this.imc(Object(O.a)("SensitivityApplicationDialogErrorTitle"),
Object(O.a)("SensitivityCoauthApplicationErrorMessage"));else A.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",kd),this.dh.ax(),yd&&this.imc(Object(O.a)("SensitivityApplicationDialogErrorTitle"),Object(O.a)("SensitivityNoEditRightsErrorMessage"));else A.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",kd),this.dh.ax(),Xb=yd,dc=!1,Rc=8;this.yg.value.wfe(0,
kd,Xb,dc);return Rc}glc(yb){yb&&0<yb.length&&(this.h$c=!0);yb.forEach(Oc=>{this.Pld.set(Oc.watermarkElement,Oc)});this.ZJh(yb);return{}}LGh(yb){this.xb.addHandler("watermarkChangeHandlerEventKey",yb)}pvk(yb){this.xb.removeHandler("watermarkChangeHandlerEventKey",yb)}ycb(yb,Oc,kd=null,Rc=!1){la.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",Ka.b.FailureBased,"wordclpfc",null);this.ya.ka("SupportsOfficeClientCoauthoring")&&this.ya.ka("CoAuthForProtectedFilesIsEnabled")?(this.kBb=!1,
this.Bh&&!this.Bh.AppliedPolicyId?this.kBb=!0:this.Bh&&this.Bh.PolicyLabelAssignmentMethod&&(this.kBb=wa.e(this.Bh.PolicyLabelAssignmentMethod)===wa.e("standard"))):this.kBb=Rc;yb=yb?this.Gy[yb]:null;(Oc=Oc?this.Gy[Oc]:null)?this.lpa=new J(Oc,!0,kd):(this.yg.value.Kea(29),this.ooa=null);yb?this.iAa=new J(yb,!1):this.$8a=null;this.V1b(null,null);return 32}hKh(yb){""!==this.Bh.AppliedPolicyId?this.yg.value.wfe(14,16,!0):this.v5a(yb,null,16)}luj(yb){if(yb in this.H2a){yb=this.H2a[yb];for(const Oc of yb)if((yb=
this.Gy[Oc])&&yb.Enabled)return!0}return!1}YAg(){const yb=this.LEc&&this.isReactRibbonEnabled()&&this.yg.value.Vaa();mb.FUc(yb)}tnk(yb){this.L7c=yb}lok(yb){this.Cdd=yb}BQg(){if(this.ya.ka("WacApplyDefaultPolicyLabelIsEnabled"))if(this.xFc())this.kdd=!0;else if(!this.K9c&&(this.K9c=!0,this.Bh&&this.Bh.DefaultLabelId))if(!this.Bh.AppliedPolicyId)A.ULS.sendTraceTag(509732190,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.Bh.DefaultLabelType),this.v5a(this.Bh.DefaultLabelId,null,1);else if(L.a.Ef().equals(this.Bh.DefaultLabelType,
"documentLibraryDefault")){const yb=this.Gy[this.Bh.AppliedPolicyId],Oc=this.Gy[this.Bh.DefaultLabelId];this.Bh.AppliedPolicyId!==this.Bh.DefaultLabelId&&L.a.Ef().equals(this.Bh.PolicyLabelAssignmentMethod,"standard")&&yb.Order<Oc.Order&&(A.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.Bh.DefaultLabelType),this.v5a(this.Bh.DefaultLabelId,null,1))}}H_f(){return this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableDynamicWatermarking",!1)||
this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableDynamicWatermarkingMockDWLabel",!1)}Wtb(yb,Oc,kd=2){this.nBa=Oc;this.yg.value.Wtb(yb);this.dh.ax();Oc=this.Gy[yb];kd=new B(kd,this.yg.value.vXa(Oc));this.Oze(Oc);this.yg.value.Xtb(yb,this.nBa,kd)}EFc(yb){return this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableDynamicWatermarkingMockDWLabel",!1)?(A.ULS.sendTraceTag(507326934,306,20,"Checking whether TEST watermark label is enabled - this should not happen on client tenants."),
"Microsoft FTE"===yb.DisplayName):yb.AppliesDynamicWatermarking}dIf(yb){return this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableDynamicWatermarkingMockDWLabel",!1)?(A.ULS.sendTraceTag(507326933,306,20,"Using TEST watermark text for label - this should not happen on client tenants."),"Watermark Text - ${Device.DateTime}"):yb.DynamicWatermarkingText}Oze(yb){this.H_f()&&(yb&&this.EFc(yb)||(this.vqk(),this.ied=""),yb&&this.EFc(yb)&&yb.Id!==this.ied&&(this.ied=yb.Id,this.Q7e(yb,Array.from(this.Pld.values()))))}qCg(yb){if(yb&&
this.EFc(yb)){let kd=this.dIf(yb);if(this.qy.l_f()){var Oc=new Intl.DateTimeFormat(Intl.Locale.name,{VAl:"short",rrl:"long"});kd=kd.replace("${Device.DateTime}",Oc.format(Date.now()))}Oc=Object(O.a)("WatermarkTextScreenReaderTemplate");void 0!==Oc?Oc=Oc.replace(/\{0\}/g,kd):(A.ULS.sendTraceTag(507326932,306,20,"Strings proxy returned undefined shared string for 'WatermarkTextScreenReaderTemplate'."),kd||A.ULS.sendTraceTag(507326931,306,20,`Dynamic watermark text is empty for label ${yb.Id} - this should not happen if the label has dynamic watermarking enabled.`),
Oc=kd);this.Efc!==Oc&&(this.Efc=Oc,this.xb.raiseEvent("watermarkChangeHandlerEventKey",new sa(Oc)))}else this.Efc&&((yb=Object(O.a)("WatermarkTextScreenReaderRemove"))&&this.xb.raiseEvent("watermarkChangeHandlerEventKey",new sa(yb)),this.Efc="")}vqk(){Ia.c()&&(appChrome.removeWatermark(),this.qCg(null))}ZJh(yb){this.Gy&&this.Bh.AppliedPolicyId&&this.Q7e(this.Gy[this.Bh.AppliedPolicyId],yb)}Q7e(yb,Oc){yb?this.EFc(yb)&&(Ia.c()?(this.h$c||A.ULS.sendTraceTag(507298335,306,20,"Label requires dynamic watermarking but no elements were registered for watermarking."),
appChrome.applyWatermark(Oc,this.dIf(yb)),A.ULS.sendTraceTag(507348963,306,20,"Apply Watermark is invoked successfully"),this.qCg(yb)):A.ULS.sendTraceTag(507326930,306,20,"Apply Watermark invoked but AppChrome is not loaded yet - element will not be watermarked.")):A.ULS.sendTraceTag(507348992,306,20,"applyDynamicWatermarks called with a null label.")}gte(yb){(new C(this.qy,yb,this.qy.QK()?this.mif.bind(this):this.mif)).gte()}imc(yb="",Oc=""){const kd=new Pa.a;kd.ov=k.AFrameworkApplication.NTb;kd.hc=
0;kd.Ic(1,Object(O.a)("DialogClose"));kd.XR(yb,Oc,null)}dIh(){const yb=new Pa.a;yb.ov=k.AFrameworkApplication.NTb;yb.hc=1;yb.Ic(1,Object(O.a)("OICDownLoadACopyDialogOpenButton"));yb.Ic(0,Object(O.a)("DialogClose"));yb.XR(Object(O.a)("SensitivityApplicationDialogErrorTitle"),Object(O.a)("SensitivityBlockUDPSetLabelMessage"),this.qy.QK()?this.v$e.bind(this):this.v$e)}isReactRibbonEnabled(){return!!this.dh&&!!this.dh.Ab&&this.dh.Ab.$k}oj(){return this.dh&&this.dh.Ab?this.dh.Ab.oj:!1}YLk(yb,Oc,kd,Rc){yb?
(Rc[d.value]=yb,Rc[d.Yi]=yb,Rc[d.customTooltip]=Oc,this.CRg(kd,k.AFrameworkApplication.protectedFile,Rc)):(Rc[d.iconColor]=d.D1c,this.Bh.MandatoryLabelingEnforced?(Rc[d.value]=Rc[d.Yi]=this.HAc().rne,Rc[d.icon]=d.Ckk):(Rc[d.value]=Rc[d.Yi]=this.HAc().s7d,Rc[d.icon]=d.Fkk));Rc[d.visible]=!0}PKk(yb){let Oc="",kd="",Rc="";if(this.Bh.AreLabelsAvailable){let Xb=null;this.Gy&&(Xb=this.Gy[this.Bh.AppliedPolicyId]);this.Oze(Xb);Xb&&(Oc=this.yg.value.vXa(Xb),kd=Xb.Tooltip,Rc=this.qKd(Xb));if(!this.yg.value.Vaa()&&
!Xb)return}else{if(this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.TitleBarSensitivityBufferEnabled",!1))Oc=this.Poa?this.Poa:"";else{if(!this.Poa)return;Oc=this.Poa}Rc=d.D1c;kd=this.tBb?this.tBb:""}this.YLk(Oc,kd,Rc,yb)}aLa(yb,Oc,kd,Rc,Xb){if(1===kd||!this.Bh||!Xb)return 32;Xb[d.value]="";Xb[d.Yi]="";Xb[d.alt]=null;Xb[d.DVf]=null;Xb[d.cka]=null;Xb[d.customTooltip]="";Xb[d.visible]=!1;Xb[d.iconColor]="";Xb[d.icon]="";if(this.kIa())this.PKk(Xb);else{kd=Oc=yb="";if(!this.Bh.AreLabelsAvailable){if(!this.Poa)return 32;
yb=this.Poa;kd=d.D1c;this.tBb&&(Oc=this.tBb)}else if(this.Bh.AppliedPolicyId){Rc=null;for(const dc of this.Bh.SensitivityLabels)if(dc.Id.toLowerCase()===this.Bh.AppliedPolicyId.toLowerCase()){Rc=dc;break}this.Oze(Rc);Rc&&(yb=this.yg.value.vXa(Rc),Oc=Rc.Tooltip,kd=this.qKd(Rc))}yb&&(Xb[d.value]=yb,Xb[d.Yi]=yb,this.oj()?Xb[d.customTooltip]=Oc:Xb[d.alt]=Oc,this.CRg(kd,k.AFrameworkApplication.protectedFile,Xb),Xb[d.visible]=!0)}return 32}r3a(yb,Oc,kd,Rc,Xb){if(1===kd||!this.Bh||!Xb)return 32;Xb[d.Yi]=
"";if(Object(S.c)(this.ya)){if(this.qy.pKd("UseHideBarByDefaultSetting")&&this.Bh.HideBarByDefault)return 32}else if(this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CLP.UseHideBarByDefaultSetting",!1)&&this.Bh.HideBarByDefault)return 32;yb="";if(this.Bh.AreLabelsAvailable)if(this.Bh.AppliedPolicyId){if(!this.Gy)return 32;(Oc=this.Gy[this.Bh.AppliedPolicyId])&&(yb=Oc.ParentId&&this.Gy[Oc.ParentId]?Oc.ParentName:Oc.DisplayName)}else yb=this.Bh.MandatoryLabelingEnforced?this.HAc().rne:this.HAc().s7d;
else{if(!this.Poa)return 32;yb=this.Poa}Xb[d.Yi]=yb;return 32}CRg(yb,Oc,kd){this.kIa()?(kd[d.icon]=this.tOf(Oc),kd[d.iconColor]=this.uOf(yb)):this.oj()?kd[d.icon]=Oc?d.E0k:d.H0k:(kd[d.DVf]=k.AFrameworkApplication.Mz,kd[d.cka]=Oc?ba.c(d.F0k):ba.c(d.I0k))}K8h(yb){const Oc=this.Q0("LearnMoreSection",!0);yb=Object.assign(new Ha.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:yb,LabelText:Object(O.a)("LearnMore"),Command:h.a.openUrlInNewTab.toString(),Image16by16:k.AFrameworkApplication.Mz,
Image16by16Class:ba.c(d.TBj),Visible:!0,Alt:Object(O.a)("LearnMoreTooltip"),KeyTip:"L"});Array.add(Oc.ControlList,yb);return Oc}Slf(yb,Oc,kd=!1){let Rc;Rc="Toggle_"+yb.Id;Rc="Sensitivity_"+Rc;const Xb=yb.DisplayName,dc=yb.Tooltip;var Vc=yb.Id===this.Bh.AppliedPolicyId,yd=kd?db.a.Ig(Rc):Rc;this.kIa()?(Vc=this.qKd(yb),Oc=Object.assign(new Sa.a,{Id:yd,ExternalId:yd,LabelText:kd?db.a.Ig(Xb):Xb,Command:h.a.setSensitivity.toString(),MenuItemId:yd,QueryCommand:h.a.nV.toString(),Visible:!0,Alt:kd?db.a.Ig(dc):
dc,AriaLabel:za.a.enc,IconColor:this.uOf(Vc),KeyTip:Oc}),Oc.ExternalImageId=this.tOf(this.yg.value.w_a(yb))):(yd=Object.assign(new Oa.a,{Id:yd,ExternalId:yd,LabelText:kd?db.a.Ig(Xb):Xb,Command:h.a.setSensitivity.toString(),MenuItemId:yd,QueryCommand:h.a.nV.toString(),CheckedImage:k.AFrameworkApplication.Mz,Visible:!0,Alt:kd?db.a.Ig(dc):dc,IsChecked:Vc,AriaLabel:za.a.enc,KeyTip:Oc}),this.isReactRibbonEnabled()?(yd.CheckedImageClass=ba.c(d.Lfe),yd.ExternalImageId=d.Lfe):yd.CheckedImageClass=ba.c(d.EIb),
Oc=yd);yd=Rc;this.ZBb[yd]=yb.Id;this.mVe[yb.Id]=yd;return Oc}Q0(yb,Oc=!1){return Object.assign(new Na.a,{Title:"",Id:yb,DisplayMode:d.menu,ShowMenuSectionSeparator:Oc,ControlsId:"Ctrl_"+yb,ControlList:[]})}Rai(yb,Oc,kd){yb=this.Q0(yb+"Sub");let Rc=1;for(const Xb of Oc)(Oc=this.Gy[Xb])&&Oc.Enabled&&(Array.add(yb.ControlList,this.Slf(Oc,Rc.toString(),kd)),Rc++);return yb}uc(yb=!1){const Oc=this.Q0("SensitivitySection");let kd=1;for(const Rc in this.H2a){const Xb=this.H2a[Rc],dc=this.Gy[Rc];if(dc&&dc.Enabled){if(Xb.count){const Vc=
"Label"+this.elh++,yd=Object.assign(new fa.a,{Id:Vc,ExternalId:Vc,LabelText:yb?db.a.Ig(dc.DisplayName):dc.DisplayName,Command:h.a.alwaysEnabled.toString(),QueryCommand:h.a.qZ.toString(),Menu:Object.assign(new oa.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:za.a.enc,KeyTip:kd.toString(),Alt:yb?db.a.Ig(dc.Tooltip):dc.Tooltip});this.isReactRibbonEnabled()?yd.ExternalImageId=d.Lfe:(yd.Image16by16=k.AFrameworkApplication.Mz,
yd.Image16by16Class=ba.c(d.EIb));Array.add(yd.Menu.MenuSectionList,this.Rai(Vc,Xb,yb));Array.add(Oc.ControlList,yd);this.ZBb[yd.Id]=dc.Id;this.mVe[dc.Id]=yd.Id}else Array.add(Oc.ControlList,this.Slf(dc,kd.toString(),yb));kd++}}return Oc}DEb(yb){return!!this.pb.mQ(yb)&&!!this.pb.mQ(yb).flags&&!!this.pb.mQ(yb).flags.length}tOf(yb){return yb?d.Ekk:d.Dkk}uOf(yb){return yb?yb:d.D1c}qKd(yb){if(yb.Color||!yb.ParentId)return yb.Color;const Oc=this.Gy[yb.ParentId];return Oc?Oc.Color:yb.Color}r$k(yb){switch(yb){case 2:case 14:case 15:return 1;
case 21:return 2;default:return 0}}HAc(){this.dhd||(this.dhd=Object.assign(new Y,{s7d:HeaderStringsManager.get(HeaderStringsEnum.NoSensitivityLabel),rne:HeaderStringsManager.get(HeaderStringsEnum.SelectASensitivityLabel)}));return this.dhd}static lfl(){k.AFrameworkApplication.ea&&!k.AFrameworkApplication.ea.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||!Ia.c()||appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",!0))}static FUc(yb){Ia.c()&&
appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!yb))}}Object(f.a)(mb,"PolicyActor",null,[696]);var Ma=a(254),hb=a(790),$a=a(1310),Va;(function(yb){yb[yb.unknown=0]="unknown";yb[yb.Fql=1]="boot";yb[yb.refresh=2]="refresh";yb[yb.eAl=3]="selfSetPolicyLabel"})(Va||(Va={}));Object(f.b)("GetPolicyLabelsReason",Va);class xa extends Sys.EventArgs{constructor(yb,Oc,kd,Rc,Xb,dc){super();this.HHb=yb;this.title=Oc;this.message=kd;this.buttonText=Rc;this.Vha=Xb;this.xVb=dc}}Object(f.a)(xa,
"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(yb,Oc,kd,Rc,Xb){super();this.HHb=yb;this.title=Oc;this.message=kd;this.buttonText=Rc;this.Vha=Xb}}Object(f.a)(ia,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Z;(function(yb){yb[yb.none=0]="none";yb[yb.reasonDefaultLabel=1]="reasonDefaultLabel";yb[yb.reasonManual=2]="reasonManual";yb[yb.reasonAutomatic=4]="reasonAutomatic";yb[yb.reasonRecommended=8]="reasonRecommended";yb[yb.reasonMandatory=
16]="reasonMandatory";yb[yb.reasonAI=32]="reasonAI"})(Z||(Z={}));Object(f.b)("ApplyLabelFlags",Z);class ta extends Sys.EventArgs{constructor(yb,Oc,kd){super();this.Qff=yb;this.Pff=Oc;this.existingLabelPriority=kd}}Object(f.a)(ta,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class pa extends Sys.EventArgs{constructor(){super()}}Object(f.a)(pa,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class Ga extends Sys.EventArgs{constructor(){super()}}Object(f.a)(Ga,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,
[]);var Ca=a(1371),kb=a(1177);class eb extends Sys.EventArgs{constructor(yb=!1,Oc=null,kd=null,Rc=null){super();this.nG=yb;this.Lmc=Oc;this.context=kd;this.kSg=Rc}}Object(f.a)(eb,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Yb extends Sys.EventArgs{constructor(yb,Oc){super();this.wJa=yb;this.j7e=Oc}}Object(f.a)(Yb,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class Gb extends Sys.EventArgs{constructor(yb,Oc,kd,Rc){super();this.title=yb;this.aRc=Oc;this.buttonText=kd;this.Rjg=Rc}}
Object(f.a)(Gb,"PolicyTipEventArgs",Sys.EventArgs,[]);class Mb extends Sys.EventArgs{constructor(yb,Oc){super();this.HHb=yb;this.xVb=Oc}}Object(f.a)(Mb,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Rb extends Sys.EventArgs{constructor(){super()}}Object(f.a)(Rb,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class $b extends Sys.EventArgs{constructor(yb,Oc){super();this.$Qc=yb;this.cT=Oc}}Object(f.a)($b,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class cc extends Sys.EventArgs{constructor(yb,
Oc,kd,Rc=null,Xb=null,dc=null,Vc=null){super();this.errorType=yb;this.TWg=kd;this.title=Rc;this.message=Xb;this.buttonText=dc;this.Vha=Vc}}Object(f.a)(cc,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class fb extends Sys.EventArgs{constructor(){super()}}Object(f.a)(fb,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class Sb extends Sys.EventArgs{constructor(yb){super();this.QRk=yb}}Object(f.a)(Sb,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var kc=a(1373),na=a(125),fc=a(95),Cc=a(48),
tc=a(55),nb=a(1372),tb=a(242);class La{static AJk(yb,Oc){if(!yb||!Oc||yb.count!==Oc.count)return!1;for(const kd of yb)if(!Oc.contains(kd))return!1;return!0}static toArray(yb){if(!yb)return null;const Oc=Array(yb.count);let kd=0;for(const Rc of yb)Oc[kd]=Rc,kd++;return Oc}}Object(f.a)(La,"HashSetUtils",null,[]);var wb=a(223),Wa=a(1311),Fa;(function(yb){yb[yb.cgh=0]="S_OK";yb[yb.hpl=1]="S_FALSE";yb[yb.jEe=2147205105]="E_APPLYLABEL_NEWLABELSENSITIVITYORDER";yb[yb.iEe=2147205112]="E_APPLYLABEL_LABELNOTFOUND";
yb[yb.mEe=2147205113]="E_APPLYLABEL_UNSUPPORTED_DKE";yb[yb.kEe=2147205114]="E_APPLYLABEL_UNSUPPORTED_CONTENTTYPE";yb[yb.hEe=2147205115]="E_APPLYLABEL_LABELING_DISABLED";yb[yb.nEe=2147205116]="E_APPLYLABEL_UNSUPPORTED_UDP";yb[yb.gEe=2147205117]="E_APPLYLABEL_LABELDISABLED";yb[yb.fEe=2147205118]="E_APPLYLABEL_INSUFFICIENTPERMISSION";yb[yb.eEe=2147205119]="E_APPLYLABEL_DOCUMENT_READONLY";yb[yb.lEe=2147205120]="E_APPLYLABEL_UNSUPPORTED_CROSSTENANT";yb[yb.Vml=2147220727]="E_APPLYLABEL_USERNOTFOUND";yb[yb.Odh=
2147467259]="E_APPLYLABEL_FAIL";yb[yb.cnl=2147500033]="E_NOTIMPL";yb[yb.gnl=2147500035]="E_POINTER";yb[yb.$ml=2147500037]="E_FAIL";yb[yb.Zml=2147647531]="E_ELEMENTNOTFOUND";yb[yb.bnl=2147942487]="E_INVALIDARG";yb[yb.hnl=2147942488]="E_POLICYMANAGER_UNAVAILABLE"})(Fa||(Fa={}));Object(f.b)("CopilotPolicyError",Fa);var Da=a(1312);class ja{Ylb(){var yb;return null===(yb=k.AFrameworkApplication.ea)||void 0===yb?void 0:yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableRefactorApplyLabelFlagReasonAI",
!1)}constructor(yb,Oc,kd,Rc=0,Xb=null){this.H9c=this.oLe=null;this.bCa=this.yAb=this.AAb=0;this.COa="";this.gRa=this.tQe=this.o7c=this.JOe=this.hoa=this.Ped=null;this.kPe=!1;this.l7c=this.a8f=null;this.ybd=0;this.fhc=this.iRa=this.FPa=this.ehc=null;this.xb=new da.a;this.x6b=this.oQb=this.Tk=null;this.rcd=!1;this.vD={};this.CCb={};this.jXb=null;this.U9e=dc=>{if(!this.q4f){var Vc=dc.SI.task;Vc.continueWith(()=>{this.Tk=Vc.result;this.qy.QK()?this.Tk.wqa(this.Pog.bind(this)):this.Tk.wqa(this.Pog)})}};
this.Pog=(dc,Vc)=>{12===Vc.type&&(this.tQe?this.tQe():this.Aib(this.Bo,2,this.hoa,!0))};this.qy=new S.a(yb);this.zba=new S.b(yb);this.ya=yb;this.sg=Oc;this.Xi=kd;this.$fc=Rc;this.Zj=new Ca.a;this.f5g();this.WHa()?this.chd=this.zba.BNd():this.chd=this.ya.Qa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.pW=Xb;this.LEc=yb.ka("WacApplyManualPolicyLabelIsEnabled");this.dFc=yb.ka("CoAuthForProtectedFilesIsEnabled");this.WHa()?this.supportsOfficeClientCoauthoring=this.zba.supportsOfficeClientCoauthoring():
this.supportsOfficeClientCoauthoring=yb.ka("SupportsOfficeClientCoauthoring");this.Kwj=!1;this.OLk=3E4;this.Ve=fc.TaskManager.instance;this.WHa()?this.zba.supportsPolicies()&&aa.a("MipSupportsPolicies"):yb.ka("SupportsPolicies")&&aa.a("MipSupportsPolicies");this.dFc&&this.supportsOfficeClientCoauthoring&&aa.a("MipSupportsOfficeClientCoauthoring");(Object(Wa.d)()||Object(Wa.c)())&&this.dPg()}WHa(){return Object(S.c)(this.ya)}get YYf(){return this.rcd}get Bo(){var yb,Oc;return this.Im()?null!==(Oc=
null===(yb=this.Zj)||void 0===yb?void 0:yb.AppliedPolicyId)&&void 0!==Oc?Oc:"":this.COa}get Gcj(){if(this.Im()){let yb=0;for(const Oc of this.Zj.SensitivityLabels)Oc&&Oc.Enabled&&(yb=Math.max(yb,Oc.Order));return yb}return this.ybd}Z5b(yb){this.Zj.AppliedPolicyId=yb;const Oc=this.ya.appSettings;Oc&&(Oc.AppliedPolicyId=yb)}get xcb(){var yb,Oc,kd,Rc;if(this.Im()){const Xb=this.Bo;return Xb?this.Im()?null!==(Oc=null===(yb=this.vD[Xb])||void 0===yb?void 0:yb.Order)&&void 0!==Oc?Oc:null:null!==(Rc=null===
(kd=this.Gca(Xb))||void 0===kd?void 0:kd.Order)&&void 0!==Rc?Rc:null:null}return this.l7c}Wtb(yb){this.Im()||(this.Zj.AppliedPolicyId=yb,this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpSetCachedAppliedLabelId",!1)&&(this.COa=yb,this.f8g()))}Pod(yb){this.xb.addHandler("PolicyTipEvent",yb)}MCa(yb){this.xb.addHandler("LabelInfoUpdateEvent",yb)}pHg(yb){this.xb.removeHandler("LabelInfoUpdateEvent",yb)}cpd(yb){this.xb.addHandler("SetPolicyLabelEventKey",yb)}Tuk(yb){this.xb.removeHandler("SetPolicyLabelEventKey",
yb)}SFb(yb){this.xb.addHandler("SetPolicyLabelFailureEventKey",yb)}Suk(yb){this.xb.removeHandler("SetPolicyLabelFailureEventKey",yb)}n4e(yb){this.xb.addHandler("GetPolicyLabelEventKey",yb)}Xsk(yb){this.xb.removeHandler("GetPolicyLabelEventKey",yb)}bEh(yb){this.xb.addHandler("GetPolicyLabelFailureEventKey",yb)}$Dh(yb){this.xb.addHandler("GetAutoPolicyLabelEventKey",yb);this.YYf&&(A.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),
this.lfe(new pa(0)))}Vsk(yb){this.xb.removeHandler("GetAutoPolicyLabelEventKey",yb)}tDh(yb){this.xb.addHandler("CreateAutoCLPSecurityNodesEventKey",yb)}usk(yb){this.xb.removeHandler("CreateAutoCLPSecurityNodesEventKey",yb)}uGh(yb){this.xb.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",yb)}cvk(yb){this.xb.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",yb)}vGh(yb){this.xb.addHandler("UpdateAutoCLPSITNodesEventKey",yb)}dvk(yb){this.xb.removeHandler("UpdateAutoCLPSITNodesEventKey",yb)}bod(yb){this.xb.addHandler("AddAutoPolicyBusinessBarEntryEventKey",
yb)}Erk(yb){this.xb.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",yb)}Uod(yb){this.xb.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",yb)}xuk(yb){this.xb.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",yb)}cod(yb){this.xb.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",yb)}Grk(yb){this.xb.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",yb)}Vod(yb){this.xb.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",yb)}yuk(yb){this.xb.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",
yb)}PEh(yb){this.xb.addHandler("MandatoryLabellingAppHandlerEventKey",yb)}Htk(yb){this.xb.removeHandler("MandatoryLabellingAppHandlerEventKey",yb)}sGh(yb){this.xb.addHandler("UDPLabelingAppHandlerEventKey",yb)}bvk(yb){this.xb.removeHandler("UDPLabelingAppHandlerEventKey",yb)}wKk(){this.vD={};for(const yb of this.Zj.SensitivityLabels)this.vD[yb.Id]=yb}GLk(){this.CCb={};for(const yb of this.Zj.SensitivityLabels)yb.ParentId||(this.CCb[yb.Id]=new Ma.a);for(const yb of this.Zj.SensitivityLabels)yb.ParentId&&
yb.ParentId in this.CCb&&(this.vD[yb.ParentId]&&(yb.ParentName=this.vD[yb.ParentId].DisplayName),yb.Enabled&&this.CCb[yb.ParentId].add(yb.Id))}get kWd(){if(!this.oLe)return!1;for(const yb of this.oLe.Zrl())if(!yb.Capabilities||!yb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get q4f(){return!!this.Tk}PXh(){return this.JOe?this.JOe():!1}onk(yb){this.o7c=yb}ZA(){return(new Date).getTime()}IN(){return this.WHa()?this.qy.IN():this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",
!1)}yzc(){this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WACAADTokenInPolicyHandlerCallbackIsEnabled",!1)?this.sg.p0b(()=>{this.ZHf()}):this.ZHf()}ZHf(){this.Xi&&(this.ehc=this.Xi.Uc("WebServiceCall","Call Get Policy Endpoint On Server"));var yb=wb.a.Nra(1,1),Oc={["X-UsePFTPOP"]:this.ya.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WACAADTokenInPolicyHandlerIsEnabled",!1)?"1":"0"};this.ya.ka("SendHostAttributionInfoForPolicyLabelEnabled")?(Oc=new nb.a(this.D1b("datalosspolicy"),
1,null,Oc,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,yb),Oc=this.sg.send(Oc),this.qy.QK()?Oc.bTc(this.ENc.bind(this),this.DNc.bind(this)):Oc.bTc(Object(N.a)(this,this.ENc,"onDataLossPolicySuccessCallback"),Object(N.a)(this,this.DNc,"onDataLossPolicyFailureCallback"))):(yb=this.qy.QK(),this.sg.Wn(this.D1b("datalosspolicy"),1,null,Oc,!0,2,yb?this.ENc.bind(this):Object(N.a)(this,this.ENc,"onDataLossPolicySuccessCallback"),yb?this.DNc.bind(this):Object(N.a)(this,
this.DNc,"onDataLossPolicyFailureCallback"),null));this.AAb++;A.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.chd,this.AAb)}Wmk(){this.Aib(this.Bo,2,this.hoa)}Aib(yb,Oc=0,kd=null,Rc=!1,Xb=null){la.Health.instance.recordKpiUsage("MipGetPolicyLabel",Ka.b.FailureBased,"officewebclp",this.kLd(void 0,Oc));this.oQb=this.ZA();const dc=this.Zyd(Oc);this.xzc(yb,dc,kd,Rc,Oc,Xb,null);this.Gje(!0)}f5g(){const yb=Object(kb.b)();if(this.DPe=
!!yb)this.Zj=yb}p3f(){this.f5g();return this.DPe}ENc(yb){this.uxg();let Oc="";({data:Oc}=this.Cye(yb)).returnValue&&(A.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.AAb=0,this.Xi&&(this.fhc=this.Xi.Uc("Task","Parse and Handle Get Policy Response")),this.z$j(Oc),this.fhc&&(this.fhc.stop(),this.fhc=null))}DNc(yb){this.uxg();this.AAb<=this.$fc?this.yzc():(A.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",
yb?yb.data?yb.data.t4a:null:null),this.AAb=0)}M4f(){return 0<this.bCa}Xtb(yb,Oc,kd=null,Rc=null){const Xb=this.$yd(kd),dc=this.Im()?this.Bo:"";this.Im()&&this.Z5b(yb);this.Cpe(yb,Oc,Xb,kd,Rc,dc)}Nsg(yb,Oc){this.iRa&&(this.iRa.stop(),this.iRa=null);const {COg:kd,lSg:Rc,$z:Xb}=this.DNf(yb),dc=yb.data.state,Vc=dc?dc.cT:2;let yd="";({data:yd}=this.Cye(yb)).returnValue?(A.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",Vc),this.bCa=0,this.T$j(yd,kd,Rc,
dc,Xb,Oc)):this.Ale(Vc,Xb,0,Oc)}vjk(yb){la.Health.instance.recordKpiUsage("MipSetPolicyLabel",Ka.b.FailureBased,"officewebclp",this.kLd(yb));this.x6b=this.ZA();A.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.xb.raiseEvent("SetPolicyLabelTriggeredEventKey",new fb(yb))}BQj(){this.dFc&&this.supportsOfficeClientCoauthoring&&this.q4f&&this.Tk.g4(12,null,!0)}Msg(yb,Oc){this.iRa&&(this.iRa.stop(),this.iRa=null);const {COg:kd,lSg:Rc,$z:Xb}=this.DNf(yb);if(this.bCa<=this.$fc)this.Im()?
this.Cpe(kd,Rc,this.$yd(null),null,Xb,Oc):this.Xtb(kd,Rc,null,Xb);else{var dc=yb.data.state;dc=dc?dc.cT:2;A.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",yb?yb.data?yb.data.t4a:null:null,dc);this.jXb="WACServerConnectionFailed";this.bCa=0;this.Ale(dc,Xb,0,Oc)}}Rvj(yb){if(yb&&("LabelNotSupported"===yb||"LabelErrorRetryLater"===yb||"CoherencyFailure"===yb||"LabelIdNotFound"===yb||"LabelDisabled"===yb))return A.ULS.sendTraceTag(539103556,
306,50,"LabelError is retriable: {0}",yb),!0;A.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",yb);return!1}w_a(yb){return yb.IsEndpointProtectionEnabled||yb.HasUserDefinedPermissions}eVh(yb){if(!yb)return!1;let Oc=null,kd=null;if(this.Im())Oc=this.vD[yb],kd=this.vD[this.Bo];else for(const Rc of this.Zj.SensitivityLabels)Rc.Id===yb&&(Oc=Rc),Rc.Id===this.Bo&&(kd=Rc);if(!Oc)return!1;if(this.dFc&&this.supportsOfficeClientCoauthoring){if(this.o7c&&this.o7c()||this.kWd)return!0}else if(k.AFrameworkApplication.yx&&
k.AFrameworkApplication.yx.ROb||this.hoa&&this.hoa())return!0;return this.w_a(Oc)===(!!kd&&this.w_a(kd))}Cbb(yb,Oc,kd,Rc,Xb){28===yb?this.mBg(new xa(yb,Oc,kd,Rc,Xb,!1)):this.mBg(new xa(yb,Oc,kd,Rc,Xb,!0))}Kea(yb){28===yb?this.$Bg(new Mb(yb,!1)):this.$Bg(new Mb(yb,!0))}uik(yb,Oc,kd){A.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.xb.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ta(yb,Oc,kd))}Bjk(yb){A.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");
this.xb.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ta(null,null,yb))}Cjk(yb,Oc){A.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.xb.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ta(yb,Oc,null))}LBg(yb,Oc){A.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Oc?"Reading":"Edit")+" switch event.");this.xb.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Yb(yb,Oc))}Okc(yb,Oc,kd,Rc,Xb){37===yb&&this.kik(new ia(37,Oc,kd,Rc,Xb))}DTc(){this.ojk(new Rb)}Ajk(){A.ULS.sendTraceTag(540608322,
306,50,"Raising a UDP labeling event.");this.xb.raiseEvent("UDPLabelingAppHandlerEventKey",new Sb(!0))}Vaa(yb=!1){const Oc=Object(kc.a)(this.Zj);Oc||yb||mb.FUc(!1);return Oc}dPg(){const yb={labelId:this.Bo};if(Object(Wa.d)()){if(!k.AFrameworkApplication.protectedFile||!navigator.msPageInteractionRestrictionManager)return;const Oc=[];k.AFrameworkApplication.enableExtractForProtectedFile||(Oc.push("extract-data"),Oc.push("copy"),Oc.push("screenshot"));k.AFrameworkApplication.printingEnabled||Oc.push("print");
k.AFrameworkApplication.DVa||Oc.push("export-data");if(0===Oc.length)return;(async()=>{const kd=navigator.msPageInteractionRestrictionManager;try{if(await kd.requestPageInteractionRestrictionPermission()){var Rc=await kd.revoke(Oc);for(const Xb of Rc)"denied"===Xb.status&&A.ULS.sendTraceTag(507113505,306,15,"Failed to revoke activity: {0} from msPageInteractionRestrictionManager.",Xb.name)}else A.ULS.sendTraceTag(507113506,306,10,"Failed to get access to msPageInteractionRestrictionManager.")}catch(Xb){A.ULS.sendTraceTag(507113503,
306,10,`Failed to revoke activity: ${Xb}`)}})()}Object(Wa.c)()&&window.postMessage(JSON.stringify({type:"mipProperties",isProtected:k.AFrameworkApplication.protectedFile,sensitivity:yb,usageRights:{docEdit:this.Zj.EditEnabled,extract:k.AFrameworkApplication.enableExtractForProtectedFile,print:k.AFrameworkApplication.printingEnabled,export:k.AFrameworkApplication.DVa,objModel:k.AFrameworkApplication.enableMacrosForProtectedFile,owner:k.AFrameworkApplication.vgb}}),"*")}Hck(){A.ULS.shipAssertTag(507888257,
306,this.p3f(),"populatePolicyLabelsDataFromCache was called with no cached response");Object(kb.c)()?(A.ULS.sendTraceTag(507847580,306,50,"Policy label boot call is still pending response."),Object(kb.e)(this.kWf.bind(this))):(A.ULS.sendTraceTag(507847579,306,50,"Policy label boot call is being used to populate policy label info"),this.kWf())}kWf(){this.nWf(Object(kb.b)(),Object(kb.a)());this.FBg(1,!0)}FBg(yb,Oc){(Object(Wa.d)()||Object(Wa.c)())&&Oc&&this.dPg();la.Health.instance.recordKpiSuccess("MipGetPolicyLabel",
this.Ayc(void 0,yb,this.oQb));this.oQb=null;yb=new pa(yb);this.Fik(yb);Oc&&this.sQk()?(this.YYf?this.Abl(this.a8f!==this.xcb):(this.lfe(yb),this.rcd=!0),this.Im()&&(this.a8f=this.xcb),this.Im()||(this.lfe(yb),this.rcd=!0)):Oc||this.mfe()}aOc(yb){this.FPa&&(this.FPa.stop(),this.FPa=null);var Oc=null;yb&&yb.data&&(Oc=yb.data.$z);let kd;this.Gje(!1);({data:kd}=this.Cye(yb)).returnValue?(A.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.yAb=0,Oc=this.G$j(kd,Oc),this.FBg(this.jMf(yb.data),
Oc)):this.mfe()}sQk(){if(!this.ya.ka("WacApplyManualPolicyLabelIsEnabled"))return A.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.JKh())return!1;if(""===this.Bo)return A.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.xcb===this.Gcj)return A.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),
!1;A.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}Crc(){this.T6g();A.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.gRa.count,this.xcb);const yb=La.toArray(this.gRa);this.uik(yb,yb,this.xcb)}Abl(yb){var Oc=this.gRa;this.T6g();La.AJk(Oc,this.gRa)||(A.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.gRa.count),
Oc=La.toArray(this.gRa),this.Cjk(Oc,Oc));Oc=this.xcb;if(this.Im()?yb:this.kPe)A.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",Oc),this.Bjk(Oc)}T6g(){var yb;const Oc=new hb.a(L.a.Ef());for(const kd of this.Zj.SensitivityLabels)if(0<(null===(yb=null===kd||void 0===kd?void 0:kd.AutoLabelingSensitiveTypeIds)||void 0===yb?void 0:yb.length))for(const Rc of kd.AutoLabelingSensitiveTypeIds)Rc&&Oc.add(Rc);this.gRa=Oc}$Nc(yb){const Oc=this.jMf(yb.data);let kd=
null;yb&&yb.data&&(kd=yb.data.$z);la.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.Ayc(void 0,Oc,this.oQb));this.oQb=null;this.FPa&&(this.FPa.stop(),this.FPa=null);if(this.yAb<=this.$fc){if(this.ya.ka("SendHostAttributionInfoForPolicyLabelEnabled")){const Rc=yb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in Rc&&Rc[wb.a.iWc]&&"HostAttributionInfo.ScenarioTypeParamName"in Rc&&Rc[wb.a.c5b]){yb.data.request.get_headers();yb.data.request.get_headers()[wb.a.c5b];
yb=this.Zyd(Oc);this.xzc(this.Bo,yb,this.hoa,void 0,Oc,kd);return}}this.Aib(this.Bo,Oc,this.hoa,!1,kd)}else A.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",yb?yb.data?yb.data.t4a:null:null),this.mfe(),this.yAb=0,this.Gje(!1)}jMf(yb){return yb.state?yb.state:0}D1b(yb,Oc=!1,kd=null){const Rc=this.WHa()?this.zba.CNd():this.ya.Qa("PolicyHandlerWebServiceBase")||k.AFrameworkApplication.ua.Ab.fR;let Xb=k.AFrameworkApplication.Uh;if(this.WHa()&&this.qy.cZf()||
Object(Wa.a)())Xb=kd||k.AFrameworkApplication.Q6||k.AFrameworkApplication.Uh;return Object(kc.c)(Rc,this.chd,Xb,yb===kc.e&&k.AFrameworkApplication.yx&&k.AFrameworkApplication.yx.uWd,yb,Oc)}DNf(yb){let Oc=null,kd=null,Rc=null;yb&&yb.data&&yb.data.request&&yb.data.request.get_headers()&&(Oc=yb.data.request.get_headers()["X-SelectedPolicyLabelId"],kd=yb.data.request.get_headers()["X-SetPolicyLabelJustification"],Rc=yb.data.$z);return{COg:Oc,lSg:kd,$z:Rc}}Cye(yb){yb=yb?yb.data?yb.data.responseData:null:
null;return yb&&yb.length&&!this.Hwj(yb)?{returnValue:!0,data:yb}:(A.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:yb})}z$j(yb){let Oc;try{Oc=Cc.b(yb)}catch(kd){A.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Oc)if(Oc.IsPolicyTipAvailable)switch(Oc.IsPolicyTipAvailable.toLowerCase()){case "false":A.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");
break;case "true":A.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.H9c=Oc.NavigateUrl;this.EWk(Oc.GeneralText,Object(N.a)(this,this.oWj,"onDataLossPolicyOverrideButtonClick"));break;default:A.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Oc.IsPolicyTipAvailable)}else A.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else A.ULS.sendTraceTag(25565185,
306,10,"policyData is null after deserializing DataLossPrevention response.")}v4h(yb){switch(yb){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;
case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;case "UnprotectedLabelNotSupported":return 16;case "PermissionChangeNotSupported":return 17;default:return 0}}T$j(yb,Oc,kd,Rc,Xb,dc){var Vc=Rc?Rc.cT:2;let yd=0;var Pd="";let re;if(({Ws:re}=Cc.d(yb)).returnValue)if(re){Pd="Success";yb=this.Zyd(3);if(re.IsSuccessful){la.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.Ayc(Vc,void 0,this.x6b));this.jXb=this.x6b=null;A.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",
Vc);2===Vc&&this.Kea(29);this.LMk(Oc,Vc);this.BQj();this.Kea(28);this.IN()?Rc&&(4===Vc||this.Ylb()&&32===Vc)&&(Pd=this.Ylb()?32===Vc:Xb.startsWith("OFFICEJS_SENSITIVITY_CONTEXT_"),this.Cbb(28,Pd?"SENSITIVITY":Object(O.a)("PolicyBusinessBarTitle"),String.format(Pd?this.Ylb()?Object(O.a)("PolicyLabelAiAutomaticallyAppliedMessage"):"Due to content created by Copilot, your organization automatically applied the sensitivity label: {0}.":Object(O.a)("PolicyLabelAutomaticallyAppliedMessage"),Rc.displayName),
Object(O.a)("DialogOk"),()=>{})):Rc&&4===Vc&&this.Cbb(28,Object(O.a)("PolicyBusinessBarTitle"),String.format(Object(O.a)("PolicyLabelAutomaticallyAppliedMessage"),Rc.displayName),Object(O.a)("DialogOk"),()=>{});aa.a("MipAppliedLabels",void 0,void 0,[{name:"SetPolicyLabelApplyFlag",string:Z[Vc]}]);this.xzc(Oc,yb,this.hoa,void 0,3,Xb);return}A.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
Vc,re.FailureReason);this.jXb=re.FailureReason;yd=this.v4h(re.FailureReason);this.Kwj&&0<=re.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Rc=new na.a(2,1,this.OLk,()=>{A.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.bCa);this.bCa<=this.$fc&&(this.Im()?this.Cpe(Oc,kd,this.$yd(null),null,Xb,dc):this.Xtb(Oc,kd,null,Xb))}),this.Ve.Ag(Rc));this.dFc&&this.supportsOfficeClientCoauthoring&&this.xzc(this.Zj.AppliedPolicyId,
yb,this.hoa,!0,3,Xb)}else Pd="setPolicyLabelData null.",A.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Vc);else Pd="TryDeserialize failed.",A.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Vc);this.Ale(Vc,Xb,yd,dc);Vc=this.Ayc(Vc,void 0,this.x6b);this.x6b=null;Vc.extendedProperties.set("SetPolicyLabelDataFailureReason",this.jXb);Vc.extendedProperties.set("SetPolicyLabelDataParseStatus",
Pd.toString());la.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Vc)}Gca(yb){if(""===yb)return null;for(const Oc of this.Zj.SensitivityLabels)if((null===Oc||void 0===Oc?void 0:Oc.Id)===yb)return Oc;return null}P6g(){if(""!==this.Bo)if(this.Im()){var yb=this.vD[this.Bo];yb&&(yb.HasExtractForUser=this.w_a(yb)?this.Zj.ExtractEnabled:!0)}else for(yb of this.Zj.SensitivityLabels)(null===yb||void 0===yb?void 0:yb.Id)===this.Bo&&(yb.HasExtractForUser=this.w_a(yb)?this.Zj.ExtractEnabled:
!0)}Ale(yb,Oc,kd,Rc){A.ULS.sendTraceTag(507576852,306,50,"revertAppliedPolicyId called. ErrorType: {0}",kd);const Xb=2===yb||8===yb||16===yb,dc=new eb;this.Im()?this.Z5b(Rc):this.Wtb(this.COa);this.IN()&&(this.Im()||(dc.Lmc=this.Gca(this.Bo)),dc.context=Oc,dc.kSg=kd);this.IBg(dc);this.wfe(kd,yb,Xb,!1)}LMk(yb,Oc){this.Im()?this.Z5b(yb):this.Wtb(this.COa=yb);this.ujk(new $b(yb,Oc))}f8g(){if(!this.Im())for(const yb of this.Zj.SensitivityLabels)if(null===yb||void 0===yb?0:yb.Enabled)yb.Id===this.COa&&
(this.kPe=this.l7c!==yb.Order,this.l7c=yb.Order),yb.Order>this.ybd&&(this.ybd=yb.Order)}A8g(){var yb,Oc=this.Bo;this.ya.appSettings&&(this.Im()?this.ya.appSettings.AppliedPolicyId=Oc:this.ya.appSettings.AppliedPolicyId=this.Bo);var kd=!1;if(this.Im())Oc&&(Oc=this.vD[Oc])&&(kd=this.w_a(Oc));else if(""!==this.Bo)for(var Rc of this.Zj.SensitivityLabels)if(Rc.Id===this.Bo){kd=this.w_a(Rc);break}if(this.Im())if(k.AFrameworkApplication.protectedFile=kd){kd=this.Zj.EditEnabled;Oc=this.Zj.PrintEnabled;Rc=
this.Zj.MacrosEnabled;const Xb=this.Zj.ExtractEnabled,dc=this.Zj.ExportEnabled,Vc=this.Zj.FullControlEnabled;k.AFrameworkApplication.fma=this.Zj.ViewEnabled&&!kd;k.AFrameworkApplication.printingEnabled=Oc;k.AFrameworkApplication.enableMacrosForProtectedFile=Rc;k.AFrameworkApplication.enableExtractForProtectedFile=Xb;k.AFrameworkApplication.DVa=dc;k.AFrameworkApplication.vgb=Vc}else k.AFrameworkApplication.fma=!1,k.AFrameworkApplication.printingEnabled=!1,k.AFrameworkApplication.enableMacrosForProtectedFile=
!1,k.AFrameworkApplication.enableExtractForProtectedFile=!1,k.AFrameworkApplication.DVa=!1,k.AFrameworkApplication.vgb=!1;else k.AFrameworkApplication.protectedFile=kd,k.AFrameworkApplication.fma=kd?this.Zj.ViewEnabled&&!this.Zj.EditEnabled:!1,k.AFrameworkApplication.printingEnabled=kd?this.Zj.PrintEnabled:!1,k.AFrameworkApplication.enableMacrosForProtectedFile=kd?this.Zj.MacrosEnabled:!1,k.AFrameworkApplication.enableExtractForProtectedFile=kd?this.Zj.ExtractEnabled:!1,k.AFrameworkApplication.DVa=
kd?this.Zj.ExportEnabled:!1,k.AFrameworkApplication.vgb=kd?this.Zj.FullControlEnabled:!1;(null===(yb=k.AFrameworkApplication.ea)||void 0===yb?0:yb.ka("LogPolicyPropertiesUpdate"))&&A.ULS.sendTraceTag(507122269,306,20,"Policy data is updated: IsProtectedLabel: {0}",k.AFrameworkApplication.protectedFile)}nWf(yb,Oc){if(!yb)return A.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!yb.AreLabelsAvailable)return!1;this.Zj=yb;this.Im()?this.Z5b(yb.AppliedPolicyId):
this.COa=yb.AppliedPolicyId;this.IN()&&(this.Im()||this.P6g());this.Im()||this.A8g();this.f8g();this.Vaa()&&A.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");yb=new eb(!0);this.IN()&&(this.Im()||(yb.Lmc=this.Gca(this.Bo)),yb.context=Oc);this.IBg(yb);return!0}G$j(yb,Oc=null){return({Ws:yb}=Cc.d(yb)).returnValue?this.nWf(yb,Oc):(A.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1)}JKh(){var yb;if(!this.Vaa())return A.ULS.sendTraceTag(539877699,
306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Oc of this.Zj.SensitivityLabels)if(0<(null===(yb=null===Oc||void 0===Oc?void 0:Oc.AutoLabelingSensitiveTypeIds)||void 0===yb?void 0:yb.length))return!0;A.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}IBg(yb){A.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Im()&&(this.wKk(),this.GLk(),this.A8g(),
this.IN()&&this.P6g(),yb.Lmc=this.vD[this.Bo]);this.xb.raiseEvent("LabelInfoUpdateEvent",yb)}Fik(yb){A.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.xb.raiseEvent("GetPolicyLabelEventKey",yb)}mfe(){mb.FUc(!1);this.xb.raiseEvent("GetPolicyLabelFailureEventKey",new Ga)}lfe(yb){this.pW&&this.pW.execute(Oc=>{Oc=[Oc.isFeatureEnabled("MsoClpSpTwo",!0),Oc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Oc).then(kd=>{tb.a.any(kd,Rc=>Rc)&&(A.ULS.sendTraceTag(50944077,306,
50,"Raising get auto policy label event."),this.xb.raiseEvent("GetAutoPolicyLabelEventKey",yb),this.Crc(),aa.a("MipAutoClassificationEnabled"));return null})})}kLd(yb=null,Oc=null){const kd=new Map;kd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=yb&&kd.set("ApplyLabelFlags",Z[yb]);null!=Oc&&kd.set("GetPolicyLabelsReason",Va[Oc]);return kd}Ayc(yb=null,Oc=null,kd=null){const Rc={};Rc.extendedProperties=this.kLd(yb,Oc);null!=kd&&(Rc.durationMs=this.ZA()-kd);return Rc}ujk(yb){A.ULS.sendTraceTag(41799710,
306,50,"Raising set policy label event.");this.xb.raiseEvent("SetPolicyLabelEventKey",yb)}mBg(yb){A.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");yb&&yb.xVb&&aa.a("MipRecommendations");this.xb.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",yb)}$Bg(yb){A.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.xb.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",yb)}kik(yb){A.ULS.sendTraceTag(573842331,306,50,
"Raising an add mandatory labelling business bar entry event.");this.xb.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",yb)}ojk(yb){A.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.xb.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",yb)}EWk(yb,Oc=null){A.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.xb.raiseEvent("PolicyTipEvent",new Gb(Object(O.a)("PolicyBusinessBarTitle"),yb,Object(O.a)("PolicyOverrideButton"),
Oc))}wfe(yb,Oc,kd,Rc=!0){A.ULS.sendTraceTag(42074656,306,Rc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Oc);Rc=Object(O.a)("SensitivityApplicationErrorBusinessBarTitle");let Xb=Object(O.a)("SensitivityApplicationErrorBusinessBarMessage"),dc=null,Vc=null;switch(yb){case 2:Rc=Object(O.a)("SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle");Xb=Object(O.a)("SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage");break;case 5:Xb=Object(O.a)("SensitivityApplicationErrorFileLockedBusinessBarMessage");
break;case 7:Rc=Object(O.a)("SensitivityApplicationErrorFileTooLargeBusinessBarTitle");Xb=Object(O.a)("SensitivityApplicationErrorFileTooLargeBusinessBarMessage");break;case 13:Rc=Object(O.a)("SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle");Xb=Object(O.a)("SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage");break;case 9:Rc=Object(O.a)("SensitivityApplicationErrorLabelDisabledBusinessBarTitle");Xb=Object(O.a)("SensitivityApplicationErrorLabelDisabledBusinessBarMessage");
break;case 10:Xb=Object(O.a)("SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage");break;case 14:Rc=Object(O.a)("SensitivityCoauthMandatoryApplicationErrorTitle");Xb=Object(O.a)("SensitivityCoauthMandatoryApplicationErrorMessage");break;case 15:Rc=Object(O.a)("SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle");Xb=Object(O.a)("SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage");dc=Object(O.a)("LearnMore");Vc=()=>{this.PLk()};break;case 16:Xb=Object(O.a)("SensitivityApplicationErrorUnprotectedLabelNotSupportedBusinessBarMessage");
break;case 17:Xb=Object(O.a)("SensitivityApplicationErrorPermissionChangeNotSupportedBusinessBarMessage")}yb=new cc(yb,Oc,kd,Rc,Xb,dc,Vc);this.xb.raiseEvent("SetPolicyLabelFailureEventKey",yb)}aLk(yb){this.Ped=yb}oWj(){this.H9c?(A.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),tc.a.YX(this.H9c)):A.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}Hwj(yb){if(!yb.startsWith("<")||-1===yb.indexOf("Error")&&-1===yb.indexOf("Unavailable"))return!1;
A.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}uxg(){this.ehc&&(this.ehc.stop(),this.ehc=null)}FIi(yb){if(!yb)return"manual";switch(yb.cT){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";case 32:return"ai";default:return"manual"}}UJi(yb){if(!yb)return"privileged";
yb=yb.cT;let Oc="privileged";if(4===yb||1===yb||32===yb)Oc="standard";return Oc}xzc(yb,Oc,kd=null,Rc=!1,Xb=0,dc=null,Vc=null){this.ya.ka("WacLabelingGetPolicyLabelsIsEnabled")&&(this.Im()?this.Z5b(yb):this.COa=yb,this.hoa=kd,this.Xi&&(this.FPa=this.Xi.Uc("WebServiceCall","Call Get Policy Endpoint On Server")),kd=this.qy.QK(),Object(kc.d)(this.ya,this.sg,kd?this.aOc.bind(this):Object(N.a)(this,this.aOc,"onGetPolicyLabelsSuccessCallback"),kd?this.$Nc.bind(this):Object(N.a)(this,this.$Nc,"onGetPolicyLabelsFailureCallback"),
this.D1b("getpolicylabels",Rc,Vc),yb,Oc,Xb,dc),this.yAb++,A.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.yAb))}Cpe(yb,Oc,kd,Rc,Xb,dc){if(this.LEc){this.Xi&&(this.iRa=this.Xi.Uc("WebServiceCall","Call Set Policy Endpoint On Server"));var Vc={};Vc["X-SelectedPolicyLabelId"]=yb;Oc&&(Vc["X-SetPolicyLabelJustification"]=encodeURIComponent(Oc));this.Ped&&(Vc["X-AppLockId"]=this.Ped);Rc?(Vc["X-SetPolicyLabelActionSource"]=this.FIi(Rc),Vc["X-SetPolicyLabelAssignmentMethod"]=
this.UJi(Rc),1===Rc.cT&&this.Zj.DefaultLabelType&&(Vc["X-WOPI-SetPolicyDefaultLabelType"]=this.Zj.DefaultLabelType)):(Vc["X-SetPolicyLabelActionSource"]="manual",Vc["X-SetPolicyLabelAssignmentMethod"]="privileged");this.supportsOfficeClientCoauthoring&&this.Zj&&(Vc["X-PolicyLabelVersionToken"]=this.Zj.PolicyLabelVersionToken);this.ya.ka("SendHostAttributionInfoForPolicyLabelEnabled")?(yb=new nb.a(this.D1b(kc.e,!0),1,null,Vc,!0,2,Rc,void 0,this.IN()?Xb:void 0,void 0,void 0,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,kd),this.sg.send(yb).bTc(yd=>this.Nsg(yd,dc),yd=>this.Msg(yd,dc))):this.sg.Wn(this.D1b(kc.e,!0),1,null,Vc,!0,2,yd=>this.Nsg(yd,dc),yd=>this.Msg(yd,dc),Rc,this.IN()?Xb:void 0,void 0,void 0,void 0,"32");this.bCa++;A.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.bCa)}else A.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}PLk(){const yb=new Pa.a,
Oc=this.ya.Qa("BreadcrumbFolderUrl");Oc?(yb.hc=11,yb.Ic(1,Object(O.a)("SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction")),yb.Ic(2,Object(O.a)("DialogOk"))):(yb.hc=0,yb.Ic(1,Object(O.a)("DialogOk")));yb.wnd(Object(O.a)("SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText"),"0f6cd105-974f-44a4-aadb-43ac5bdfd247");yb.Cqk();yb.XR(Object(O.a)("SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle"),Object(O.a)("SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage"),
kd=>{1===kd&&Oc&&tc.a.Rg(Oc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}Zyd(yb){return Object(kc.b)(yb)}$yd(yb=null){if(!yb)return wb.a.Nra(8,0);switch(yb.cT){case 1:case 16:return wb.a.Nra(1,1);case 32:case 4:case 2:case 8:return wb.a.Nra(8,1);default:return wb.a.Nra(8,0)}}Gje(yb){Ia.c()&&appChrome.api.setAsyncRequestStatus("sensitivity",yb)}vXa(yb){return yb?yb.ParentId&&yb.ParentName?yb.ParentName+"\\"+yb.DisplayName:yb.DisplayName:""}KSi(yb){if(!yb||
0==yb.length)return null;let Oc=null;for(const kd of yb)if(""!==kd)if(this.Im())if(yb=this.vD[kd]){if(!Oc||yb.Order>Oc.Order||Object(Wa.g)(this.ya)&&yb.Order===Oc.Order&&(yb.Id===this.Bo||Oc.Id!==this.Bo&&yb.Id<Oc.Id))Oc=yb}else return null;else{yb=!1;for(const Rc of this.Zj.SensitivityLabels)(null===Rc||void 0===Rc?void 0:Rc.Id)===kd&&(yb=!0,!Oc||Rc.Order>Oc.Order)&&(Oc=Rc);if(!yb)return null}Oc||(Oc=new $a.a);return Oc}getHighestSensitivityLabel(yb){if(!yb||0==yb.length)return{Igb:Da.a.t5c};let Oc=
null;for(const kd of yb)if(kd)if(this.Im()){yb=this.vD[kd];if(!yb)return{Igb:Da.a.j5c};if(!Oc||this.JTk(Oc,yb))Oc=yb}else{yb=!1;for(const Rc of this.Zj.SensitivityLabels)(null===Rc||void 0===Rc?void 0:Rc.Id)===kd&&(yb=!0,!Oc||Rc.Order>Oc.Order)&&(Oc=Rc);if(!yb)return{Igb:Da.a.j5c}}Oc||(Oc=new $a.a);return{val:Oc}}JTk(yb,Oc){if(Oc.Order>yb.Order)return!0;if(!Object(Wa.g)(this.ya)||Oc.Order<yb.Order)return!1;const kd=this.Bo;return Oc.Id===kd?!0:yb.Id===kd?!1:Oc.Id<yb.Id}LJi(){if(""===this.Bo)return[!0,
new $a.a];if(this.WHa()?this.zba.supportsPolicies():this.ya.ka("SupportsPolicies")){let yb;yb=this.Im()?this.vD[this.Bo]:this.Gca(this.Bo);return yb?[!0,yb]:(A.ULS.sendTraceTag(507557842,306,10,"GetAppliedLabel couldn't find an applied label from policy"),[!1,2147205112])}return[!1,2147205115]}JJi(){if(""===this.Bo)return{val:new $a.a};if(this.WHa()?!this.zba.supportsPolicies():!this.ya.ka("SupportsPolicies"))return{Igb:Da.b.Z4c};let yb;yb=this.Im()?this.vD[this.Bo]:this.Gca(this.Bo);return yb?{val:yb}:
(A.ULS.sendTraceTag(507557842,306,10,"GetAppliedLabel couldn't find an applied label from policy"),{Igb:Da.b.Qac})}e$k(yb,Oc,kd){if(Object(Wa.e)(this.ya)){if(!yb)return 2147942487;const Rc=this.Im()?this.vD[yb]:this.Gca(yb);if(!Rc)return 2147205112;const Xb=this.Im()?this.vD[this.Bo]:this.Gca(this.Bo);if(Rc.RequiredDowngradeJustification||(null===Xb||void 0===Xb?void 0:Xb.Order)>=Rc.Order)return 2147205105;if(!Rc.Enabled)return 2147205117;if(Rc.HasUserDefinedPermissions)return 2147205116;if(1==k.AFrameworkApplication.Kb.mode)return 2147205119;
if(Oc&&Oc!==this.ya.Qa("TenantId"))return 2147205120;Oc=new B(this.Ylb()?32:4,this.vXa(Rc));this.Xtb(yb,"",Oc,kd);return 0}if(""===yb)return 0;Oc=this.Im()?this.vD[this.Bo]:this.Gca(this.Bo);yb=this.Im()?this.vD[yb]:this.Gca(yb);if(!yb)return 2147205112;if(!yb.Enabled)return 2147205117;if(yb.HasUserDefinedPermissions)return 2147205116;if(1==k.AFrameworkApplication.Kb.mode)return 2147205119;if(yb.RequiredDowngradeJustification||(null===Oc||void 0===Oc?void 0:Oc.Order)>=yb.Order)return 2147205105;Oc=
new B(this.Ylb()?32:4,this.vXa(yb));this.Xtb(yb.Id,"",Oc,kd);return 0}tryUpgradeLabel(yb,Oc,kd){if(!yb)return Da.a.t5c;const Rc=this.Im()?this.vD[yb]:this.Gca(yb);if(!Rc)return Da.b.Qac;const Xb=this.Im()?this.vD[this.Bo]:this.Gca(this.Bo);if(Rc.RequiredDowngradeJustification||(null===Xb||void 0===Xb?void 0:Xb.Order)>=Rc.Order)return Da.b.Rac;if(!Rc.Enabled)return Da.b.Y4c;if(Rc.HasUserDefinedPermissions)return Da.b.a5c;if(1==k.AFrameworkApplication.Kb.mode)return Da.b.X4c;if(Oc&&Oc!==this.ya.Qa("TenantId"))return Da.b.$4c;
Oc=new B(this.Ylb()?32:4,this.vXa(Rc));this.Xtb(yb,"",Oc,kd);return Da.a.ebc}Im(){return Object(S.c)(this.ya)?this.qy.Im():Object(Wa.f)(this.ya)}qHf(yb){if(Object(Wa.b)(this.ya)){if(yb=Object(Da.c)(yb),yb===Da.a.ebc||yb===Da.b.Rac)return 0}else if(0===yb||2147205105===yb)return 0;return 2}BNi(yb,Oc){if(2!==this.qHf(yb))return"";Oc=1===Oc?"FirstPerson":"General";if(Object(Wa.b)(this.ya)){var kd=Object(Da.c)(yb);if(kd={[Da.b.$4c]:"ApplyLabelUnsupportedCrossTenant",[Da.b.X4c]:"ApplyLabelDocumentReadOnly",
[Da.b.YCe]:"ApplyLabelInsufficientPermission",[Da.b.Y4c]:"ApplyLabelLabelDisabled",[Da.b.a5c]:"ApplyLabelUnsupportedUdp",[Da.b.Z4c]:"ApplyLabelLabelingDisabled",[Da.b.ZCe]:"ApplyLabelUnsupportedContentType",[Da.b.$Ce]:"ApplyLabelUnsupportedDke",[Da.b.Qac]:"ApplyLabelLabelNotFound",[Da.b.Rac]:""}[kd])return Object(O.a)(`${"SensitivityCopilotError"}${kd}${Oc}`)}else switch(yb){case 2147205120:return Object(O.a)(`SensitivityCopilotErrorApplyLabelUnsupportedCrossTenant${Oc}`);case 2147205119:return Object(O.a)(`SensitivityCopilotErrorApplyLabelDocumentReadOnly${Oc}`);
case 2147205118:return Object(O.a)(`SensitivityCopilotErrorApplyLabelInsufficientPermission${Oc}`);case 2147205117:return Object(O.a)(`SensitivityCopilotErrorApplyLabelLabelDisabled${Oc}`);case 2147205116:return Object(O.a)(`SensitivityCopilotErrorApplyLabelUnsupportedUdp${Oc}`);case 2147205115:return Object(O.a)(`SensitivityCopilotErrorApplyLabelLabelingDisabled${Oc}`);case 2147205114:return Object(O.a)(`SensitivityCopilotErrorApplyLabelUnsupportedContentType${Oc}`);case 2147205113:return Object(O.a)(`SensitivityCopilotErrorApplyLabelUnsupportedDke${Oc}`);
case 2147205112:return Object(O.a)(`SensitivityCopilotErrorApplyLabelLabelNotFound${Oc}`)}A.ULS.sendTraceTag(507315737,306,50,"Generic error message return for Sensitivity Copilot error. ErrorCode Hr: {0}",yb);return Object(O.a)(`SensitivityCopilotErrorGenericError${Oc}`)}}Object(f.a)(ja,"PolicyManager",null,[680]);var Qa=a(144),Ob=a(281);class Ub{constructor(){this.G$=this.HQa=this.oc=this.yg=null;this.iNc=()=>{const yb=S.a.instance.QK();this.G$=Object(t.f)(z.a);this.yg||(this.yg=Object(t.a)(G));
this.HQa=Object(t.a)(w);if(Ia.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration"))if(yb){const Oc=()=>{this.yg.pHg(Oc);this.HQa.wi()};this.yg.MCa(Oc)}else this.yg.MCa(Object(N.a)(this.HQa,this.HQa.xEg,"registerActionsHandler"));else this.HQa.wi();yb?this.yg.MCa(this.b3c.bind(this)):this.yg.MCa(this.b3c);k.AFrameworkApplication.ea.ka("WacApplyManualPolicyLabelIsEnabled")&&(yb?(this.yg.SFb(this.TRf.bind(this)),this.yg.bod(this.Cbb.bind(this)),
this.yg.Uod(this.Kea.bind(this)),this.yg.cod(this.Okc.bind(this)),this.yg.Vod(this.DTc.bind(this))):(this.yg.SFb(this.TRf),this.yg.bod(this.Cbb),this.yg.Uod(this.Kea),this.yg.cod(this.Okc),this.yg.Vod(this.DTc)))};this.b3c=()=>{this.HQa.YAg();const yb=this.yg.PXh();k.AFrameworkApplication.ea.ka("HasDocumentEditRights")&&!yb?this.HQa.S3g():A.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",k.AFrameworkApplication.ea.ka("HasDocumentEditRights"),
yb);k.AFrameworkApplication.ua.ax()};this.xZc=(yb,Oc)=>{yb=this.hMf(Oc.title,Oc.aRc,38,Oc.Rjg,Oc.buttonText);k.AFrameworkApplication.ua.Ab.Ekc(yb)?A.ULS.sendTraceTag(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user."):A.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};this.TRf=(yb,Oc)=>{Oc.TWg&&(yb=this.hMf(Oc.title,Oc.message,21,null,null,Oc.Vha,Oc.buttonText),k.AFrameworkApplication.ua.Ab.Ekc(yb)?
A.ULS.sendTraceTag(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user."):A.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))};this.Kea=()=>{};this.Cbb=(yb,Oc)=>{this.G$&&(this.yg.Kea(Oc.HHb),yb=new K.a(Oc.title,Oc.message,null),yb.id=Oc.HHb,yb.closeable=!0,yb.image=3,yb.addButton(Oc.buttonText,Oc.Vha,Oc.buttonText,!0),this.G$.pz(yb,!1))};this.Okc=(yb,Oc)=>{this.G$&&(yb=new K.a(Oc.title,Oc.message,
null),yb.id=Oc.HHb,yb.closeable=!1,yb.image=3,yb.addButton(Oc.buttonText,Oc.Vha,Oc.buttonText,!1),this.G$.pz(yb,!1))};this.DTc=()=>{}}get name(){return"Common.App.Policy"}init(){const yb=S.a.instance.QK();k.AFrameworkApplication.ea.ka("ShouldInitCommonPolicyPackage")&&(k.AFrameworkApplication.ea.ka("IsDataLossPreventionEnabledForUser")&&k.AFrameworkApplication.ua&&(this.yg=Object(t.a)(G),yb?this.yg.Pod(this.xZc.bind(this)):this.yg.Pod(this.xZc),A.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),
k.AFrameworkApplication.ea.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?Qa.a.get_instance().Mg(5,()=>{this.yg.yzc()}):Qa.a.get_instance().Mg(6,()=>{this.yg.yzc()})),k.AFrameworkApplication.ea.ka("WacLabelingPoliciesIsEnabled")&&(Object(S.c)()?S.b.instance.supportsPolicies():k.AFrameworkApplication.ea.ka("SupportsPolicies"))?k.AFrameworkApplication.ea.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?Qa.a.get_instance().Mg(5,
yb?this.iNc.bind(this):this.iNc):Qa.a.get_instance().Mg(6,yb?this.iNc.bind(this):this.iNc):(mb.lfl(),mb.FUc(!1)))}dispose(){}ji(yb){yb.register(680,"Common.App.Policy.Contracts.IPolicyManager").Lc().Qc(()=>new ja(k.AFrameworkApplication.ea,k.AFrameworkApplication.od,k.AFrameworkApplication.ua.KE,k.AFrameworkApplication.ea.Rd("MaxGetPolicyRetries",1),Object(t.d)(M.a),k.AFrameworkApplication.ua.Ab.gi));yb.register(mb,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").Lc().Qc(()=>
new mb(k.AFrameworkApplication.Kb,k.AFrameworkApplication.ua,k.AFrameworkApplication.ea,Object(t.e)(E.a)));this.oc=yb}hMf(yb,Oc,kd,Rc=null,Xb=null,dc=null,Vc=null){yb=new K.a(yb,Oc,null);yb.id=kd;yb.closeable=!0;Rc&&yb.Yzh(Xb,Rc);dc&&yb.addButton(Vc,dc,Vc);return yb}static main(){Ob.a.instance.Qi(new Ub)}}Object(f.a)(Ub,"PackageManager",null,[11,12]);var Zb=a(9);const uc=Object(t.b)("Common.App.Policy.Contracts.IPolicyActor");var Hc=a(605),Dd=a(249),jc=a(430),$c=a(43),ud=a(154),Ud=a(41),ec=a(429),
Db=a(213),ic=a(83),Pc=a(36),Ed=a(255),de=a(1),se=a(28),Fe=a(266);class fe{constructor(){this.$Qc=this.zPg=null;this.cT=0}}Object(f.a)(fe,"ApplyPolicyContextParameters",null,[]);var Tc=a(2),ed=a(930),pd=a(676),Kb=a(57),rb=a(53);class rc{constructor(){this.n0=this.annotationType=null;this.Fkb=this.eG=!1}}Object(f.a)(rc,"AnnotationActivationOptions",null,[]);var ld=a(1178),Tb=a(1377),Wc=a(608),Ac=a(367);class nd extends Wc.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new Ac.a,
{T_:nd.getTypeName(),B_:nd.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static getBaseTypes(){return[]}}Object(f.a)(nd,"SecurityShared",Wc.a,[]);class qd extends nd{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new Ac.a,{T_:qd.getTypeName(),B_:qd.getBaseTypes()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static getBaseTypes(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(f.a)(qd,"CLP",nd,[]);var Xd=a(1374),
Hd=a(1166),Zc=a(1376),Jc=a(614);class gc extends Jc.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new Ac.a,{T_:gc.getTypeName(),B_:gc.getBaseTypes()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}Object(f.a)(gc,"LinkedDataTypeAnnotation",Jc.a,[]);var dd=a(88);class Bb extends Ud.a{constructor(yb,Oc,kd,Rc,Xb){super();this.eeg=3;this.YW=this.hj=null;this.trd=!1;this.Spb=[];this.m8f=new ed.a(pd.a.wQ());
this.aee=0;this.fee=null;this.Crc=(dc,Vc)=>{dc=Object(Tc.a)(new Xd.a,{parentPath:["session","doc","security"],items:[Object(Tc.a)(new Hd.a,{id:"clp",body:Object(Tc.a)(new qd,{existingLabelPriority:Vc.existingLabelPriority,partialDocSITs:Vc.Qff,fullDocSITs:Vc.Pff})})]});this.Spb.push(dc);this.CSb()};this.R6g=(dc,Vc)=>{dc=Object(Tc.a)(new Zc.a,{parentPath:["session","doc","security"],items:[Object(Tc.a)(new Hd.a,{id:"clp",body:Object(Tc.a)(new qd,{existingLabelPriority:Vc.existingLabelPriority})})]});
this.Spb.push(dc);this.CSb()};this.S6g=(dc,Vc)=>{dc=Object(Tc.a)(new Zc.a,{parentPath:["session","doc","security"],items:[Object(Tc.a)(new Hd.a,{id:"clp",body:Object(Tc.a)(new qd,{partialDocSITs:Vc.Qff,fullDocSITs:Vc.Pff})})]});this.Spb.push(dc);this.CSb()};this.vv=()=>{A.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?this.CSb():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.bdi())};this.nTj=
()=>{var dc;A.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");null===(dc=this.hj)||void 0===dc?void 0:dc.unregister("AutoPolicy");this.hj=null};this.DAj=(dc,Vc)=>{var yd,Pd;A.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Vc.operationType)A.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var re=dc=null,ue=null;if(Vc=Vc.annotation){if(null===
(yd=Vc.automatic)||void 0===yd?0:yd.id)dc=Vc.automatic.id;if(null===(Pd=Vc.recommended)||void 0===Pd?0:Pd.id)re=Vc.recommended.id,Vc.recommended.policyTip&&(ue=Vc.recommended.policyTip);this.applyPolicyLabel(dc,re,ue,1)}else A.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.")}};this.KCj=(dc,Vc)=>{A.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===Vc.operationType?A.ULS.sendTraceTag(537154581,
306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(dc=Vc.annotation)?(dc=dc.classificationId,this.applyPolicyLabel(dc,dc,null,2)):A.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.EFg=(dc,Vc)=>{Vc?Vc.xVb&&this.businessBar.GH(41)?(this.businessBar.removeEntry(41),A.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Vc.xVb&&this.businessBar.GH(40)&&(this.businessBar.removeEntry(40),A.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):A.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.XVg=(dc,Vc)=>{Vc?Vc.xVb?(this.businessBar.VWk(Vc.title,Vc.message,Vc.buttonText,yd=>{Vc.Vha(yd);this.businessBar.GH(41)&&this.businessBar.removeEntry(41)}),A.ULS.sendTraceTag(537154531,306,
50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.kUk(Vc.title,Vc.message,Vc.buttonText,yd=>{Vc.Vha(yd);this.businessBar.GH(40)&&this.businessBar.removeEntry(40)}),A.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):A.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.Hce=
yb;this.policyManager=Oc;this.$=kd;this.ea=Rc;this.businessBar=Xb;this.gfj();this.rnk();this.disposed=!1}get yc(){return!this.disposed&&this.$.fa.yc}dispose(){var yb;this.disposed||(this.disposed=!0,this.mfi(),null===(yb=this.hj)||void 0===yb?void 0:yb.unregister("AutoPolicy"),this.Hce=this.policyManager=this.hj=null,super.dispose())}ycb(yb,Oc,kd,Rc,Xb=!1){A.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Rc} with AutoLabelPresent: ${!!yb}, RecommendedLabelPresent: ${!!Oc}, isStandard: ${Xb}.`);
this.yc?this.Hce&&(this.hVh(Oc,Rc)?(this.fee=Oc,this.aee=Rc,this.m8f.ga(Rc,Oc)):Oc=this.fee,yb=this.Hce.ycb(yb,Oc,kd,Xb),A.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${yb}.`)):A.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.fa.yc}.`)}hVh(yb,Oc){if(!this.policyManager.Vaa())return A.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),
!1;const kd=this.policyManager.Zj;let Rc;({value:Rc}=this.m8f.Od(this.aee));let Xb=null,dc=null,Vc=null;for(const yd of kd.SensitivityLabels)yd.Id===yb&&(Xb=yd),yd.Id===Rc&&(dc=yd),yd.Id===this.fee&&(Vc=yd);return dc&&dc.Id===yb?(A.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.GH(41)&&this.aee!==Oc&&Vc&&(!Xb||Vc.Order>=Xb.Order)?(A.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0}XYf(){return de.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}rnk(){this.policyManager.bod(this.XVg);this.policyManager.Uod(this.EFg);this.$.fa.CD(this.vv);this.XYf()&&(this.policyManager.tDh(this.Crc),this.policyManager.uGh(this.R6g),this.policyManager.vGh(this.S6g))}mfi(){this.businessBar.removeEntry(41);
this.businessBar.removeEntry(40);this.policyManager.Erk(this.XVg);this.policyManager.xuk(this.EFg);this.$.fa.xB(this.vv);this.XYf()&&(this.policyManager.usk(this.Crc),this.policyManager.cvk(this.R6g),this.policyManager.dvk(this.S6g))}gfj(){this.YW=new ed.a(pd.a.wQ());const yb=Tb.a.getTypeName();this.YW.add(1,Object(Tc.a)(new rc,{annotationType:yb,n0:this.DAj,eG:!1,Fkb:!1}));this.YW.add(2,Object(Tc.a)(new rc,{annotationType:gc.getTypeName(),n0:this.KCj,eG:!1,Fkb:!1}))}M_g(){for(const yb of this.Spb)this.hj.submitOperation(yb,
"AutoPolicy");this.Spb=[]}Iea(yb){if(!this.YW.Bb(yb))return A.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${yb}.`),!1;if(this.YW.pa(yb).eG)return A.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${yb}.`),!0;this.YW.pa(yb).eG=!0;A.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${yb}.`);
if(!this.$.isEditMode)return A.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;this.CSb();return!0}CSb(){var yb=0<this.Spb.length;if(!yb)for(const Oc of this.YW)if(yb=Oc.value.eG||yb)break;yb?this.hj?(A.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.d1e(),this.M_g()):this.trd?A.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.trd=!0,yb=this.$.ta.FlightingSettings.AutoCLPStartUpDelay,A.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${yb} milliseconds.`),Kb.a.instance.create(()=>{this.kfj()},yb,rb.a.$Mh,!0,!0)):A.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}kfj(){$c.TaskExtensions.tb(Object(dd.d)(u.a.resolve(m.AugmentationLoopManagerService,{xa:1})),yb=>{this.hj=
yb.result;this.trd=!1;this.hj?(A.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.hj.register(this.hj.RT().NV("AutoPolicy").LV(this.nTj).build()),this.$.isEditMode?(this.d1e(),this.M_g()):A.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):A.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.Aa,3)}d1e(){for(const yb of this.YW)yb.value.eG&&!yb.value.Fkb&&this.activateAnnotation(yb.key)}activateAnnotation(yb){this.hj.Iea("AutoPolicy",{annotationType:this.YW.pa(yb).annotationType,ls:!0,dO:this.YW.pa(yb).n0});this.YW.pa(yb).Fkb=!0;A.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${yb}.`)}bdi(){for(const yb of this.YW)yb.value.Fkb&&this.LAd(yb.key)}LAd(yb){var Oc;null===(Oc=this.hj)||void 0===Oc?void 0:Oc.fal(this.YW.pa(yb).annotationType);
this.YW.pa(yb).Fkb=!1;A.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${yb}.`)}applyPolicyLabel(yb,Oc,kd,Rc){if(this.ea.ka("SupportsOfficeClientCoauthoring"))A.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.ycb(yb,Oc,kd,Rc);else{A.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const Xb=dc=>{this.ycb(yb,
Oc,kd,Rc,0===dc||1===dc||4===dc)};this.ANd(Xb,()=>{Xb(2)},this.eeg)}}xrd(yb,Oc){let kd=null,Rc=null;if(!({sensitivityLabel:kd,GSa:Rc}=this.R4g(yb)).returnValue)return A.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Rc&&Rc.Order>=kd.Order)return A.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(kd.Id,kd.Id,null,Oc);return!0}yrd(yb,Oc){Oc=!1;
let kd=null,Rc=null;if(!({sensitivityLabel:kd,GSa:Rc}=this.R4g(yb)).returnValue)return A.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,glb:Oc};if(Rc&&Rc.ParentId&&kd.ParentId&&Rc.ParentId===kd.ParentId)return A.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,glb:Oc};if(Rc&&Rc.Order>=kd.Order)return A.ULS.sendTraceTag(537154573,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,glb:Oc};if(this.ea.ka("SupportsOfficeClientCoauthoring"))A.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),yb=this.policyManager.Zj,yb=!yb.AppliedPolicyId||!yb.PolicyLabelAssignmentMethod||wa.e(yb.PolicyLabelAssignmentMethod)===wa.e("standard"),this.a8e(kd.Id,yb);else{A.ULS.sendTraceTag(537154571,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const Xb=dc=>{this.a8e(kd.Id,0===dc||1===dc||4===dc)};this.ANd(Xb,()=>{Xb(2)},this.eeg)}return{returnValue:!0,glb:Oc}}ANd(yb,Oc,kd,Rc=0){if(this.yc){var Xb=this.$.ma.sa.mc();ld.b(this.$.ma.sa,this.$.ta.DocumentHostInfo.TenantId,dc=>{this.YXi(dc,yb)},()=>{this.XXi(yb,Oc,kd,Rc)},null,null,Xb)}else A.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.fa.yc}.`)}YXi(yb,
Oc){A.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.yc?!yb||Ed.a(yb)?A.ULS.sendTraceTag(537154567,306,15,yb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Oc(yb.Result):A.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.fa.yc}.`)}XXi(yb,
Oc,kd,Rc){A.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.yc?Rc>=kd?(A.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Oc()):this.ANd(yb,Oc,kd,Rc+1):A.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.fa.yc}.`)}a8e(yb,Oc){Oc?this.ycb(yb,null,null,
3,!0):this.ycb(null,yb,null,3,!1)}R4g(yb){let Oc,kd;kd=Oc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Oc,GSa:kd};if(!this.policyManager.Vaa())return A.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Oc,GSa:kd};const Rc=this.policyManager.Zj;if(!Rc)return A.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Oc,
GSa:kd};if(tb.a.Zg(Rc.SensitivityLabels))return A.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Oc,GSa:kd};const Xb=Rc.AppliedPolicyId;for(const dc of yb)for(const Vc of Rc.SensitivityLabels)Vc.Id===dc&&(!Oc||Oc.Order<Vc.Order)&&(Oc=Vc),Vc.Id===Xb&&(kd=Vc);return Oc?{returnValue:!0,sensitivityLabel:Oc,GSa:kd}:(A.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),
{returnValue:!1,sensitivityLabel:Oc,GSa:kd})}}Object(f.a)(Bb,"AutoPolicyManager",Ud.a,[4]);var pc=a(199),wc=a(17),cd=a(13);class Vd extends pc.ErrorDialog{constructor(yb){super(yb,Vd.rGa(yb))}cA(){super.cA();if(this.error.Appearance&1&&this.$.$d&2){const yb=this.getButton(0);wc.DOMElementExtensions.NQg(yb.get_element(),cd.a.instance.ia(1315));this.Paa(()=>{0===this.returnValue&&this.$.$d&2&&(A.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),
void u.a.resolve(m.OpenInExcelService,{xa:0}).then(Oc=>{Oc.Mxd()}))})}}static rGa(yb){return yb.$d&2?Pc.a.Cd(3,1,0,1975,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):Pc.a.Cd(1,1,0,1976,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(f.a)(Vd,"BlockSenitivityLabelActionDialog",pc.ErrorDialog,[]);var xb=a(29),ub=a(87),Fc=a(7),xd=a(81);class Ic extends Ud.a{constructor(yb,Oc,kd,Rc,Xb){super();this.statusBarManager=null;this.Bsd=!1;this.Rha=null;this.v3c=!1;this.wJa=this.joe=null;
this.SK=this.Ice=!1;this.dQa=this.ZTe=this.Uoa=this.nVe=this.Gs=null;this.Hj=()=>{this.Rdf()};this.rng=()=>{this.rzh()};this.Esf=()=>{A.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const dc=this.qnk();A.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${dc}.`)};this.xZc=(dc,Vc)=>{Vc?(this.Gs=Vc.title,this.nVe=Vc.aRc,this.Uoa=Vc.buttonText,this.ZTe=
Vc.Rjg,this.Wha.lh(27,null),A.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):A.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.DXg=(dc,Vc)=>{const yd=Object(ud.a)(cc,Vc);yd?yd.TWg?(A.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${yd.errorType}`),this.Wha.eXk(yd.title,yd.message,yd.buttonText,Pd=>{yd.Vha&&(this.Wha.GH(54)&&this.Wha.removeEntry(54),
yd.Vha(Pd))})):A.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(A.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.Wha.lh(48,null))};this.b3c=(dc,Vc)=>{this.C3&&(A.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.C3.YAg(),this.$.$d&64&&(Vc.nG&&this.wJa?this.gKh():this.C3.S3g()));this.ea.ka("SupportsOfficeClientCoauthoring")&&
(dc=this.us.Zj,this.dQa=dc.AppliedPolicyId,"null"===this.labelId&&(this.dQa=""),this.v3c&&(dc=dc.PolicyLabelAssignmentMethod&&wa.e(dc.PolicyLabelAssignmentMethod)===wa.e("standard")?4:2,this.applyPolicyLabel(this.labelId,dc,!0,this.joe)));this.VZh();this.Bzf();this.Yp()};this.qng=()=>{this.Ice=!0;this.Bzf()};this.Lsg=(dc,Vc)=>{A.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${k.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Vc.cT}`);
this.applyPolicyLabel(Vc.$Qc,Vc.cT,!1,null)};this.eTj=(dc,Vc)=>{this.dQa=Vc.$Qc;if(Pc.a.Ls(dc.Errors)){var yd=Pc.a.mca(dc.Errors,[2045508683]);0<yd.length&&(dc.Errors=Pc.a.rO(dc.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.fa.ur(dc.Errors));yd=Pc.a.mca(dc.Errors,[2046680228]);0<yd.length&&(4===Vc.cT||1===Vc.cT)&&(dc.Errors=Pc.a.rO(dc.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.fa.ur(dc.Errors));yd=dc=null;
for(var Pd of this.us.Zj.SensitivityLabels)se.a.equals(this.labelId,Pd.Id,!1)&&(dc=Pd),se.a.equals(Vc.zPg,Pd.Id,!1)&&(yd=Pd);Pd={};Pd.ApplyLabelFlag=Vc.cT;dc?(Pd.currentLabel="Set",Pd.currentLabelEnabled=dc.Enabled,Pd.currentLabelName=dc.Name?"Set":"NotSet",Pd.currentLabelParentId=dc.ParentId?"Set":"NotSet"):Pd.currentLabel="NotSet";yd?(Pd.serverLabel="Set",Pd.serverLabelEnabled=yd.Enabled,Pd.serverLabelName=yd.Name?"Set":"NotSet",Pd.serverLabelParentId=yd.ParentId?"Set":"NotSet"):Pd.serverLabel=
"NotSet";A.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(Pd)}`)}};this.xOh=(dc,Vc)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const yd=this.us.Zj;if(!yd)return A.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let Pd=null;for(const re of yd.SensitivityLabels)se.a.equals(re.Id,dc,!1)&&(Pd=re);return Pd&&this.kbj(Pd)?(A.ULS.sendTraceTag(50341186,
306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.nUk(Vc),!0):!1};this.Ilj=()=>{let dc=!1;!this.$.ta.IsNewWorkbook||this.labelId&&this.labelId.length||(dc=!0);A.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${dc}`);return dc};this.Hdg=(dc,Vc)=>{1===Vc.j7e?this.$.isEditMode?(A.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ia.Gb(new ic.a(-723527778,
0,this.$.xc,10,null))):A.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.wJa=Vc.wJa,this.$.fa.CD(this.V7e),this.$.Bwb(),A.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ia.Gb(new ic.a(-8805455,0,this.$.xc,10,null)))};this.K2e=(dc,Vc)=>{Vc?(dc=!!(this.$.$d&64),A.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${dc}`),dc&&(this.$.Bwb(),this.Wha.ZVk(Vc.title,
Vc.message,Vc.buttonText,yd=>{Vc.Vha(yd)}))):A.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.hGg=()=>{this.Wha.GH(42)&&this.Wha.removeEntry(42)};this.t5g=(dc,Vc)=>{Vc.QRk&&(A.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),void u.a.resolve(m.OpenInExcelService,{xa:0}).then(yd=>{yd.Mxd()}))};this.V7e=()=>{this.wJa&&
this.$.isEditMode?(this.$.fa.xB(this.V7e),this.wPb()):A.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.wJa} , edit mode : ${this.$.isEditMode}.`)};this.cua=()=>{const dc=this.$.fa.el;dc&&!se.a.equals(dc.AppliedPolicyLabelId,this.labelId,!1)&&(A.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),A.ULS.shipAssertTag(537154463,306,this.$.isEditMode,
"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.ea.ka("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&(this.v3c=!0,this.joe=dc.AppliedPolicyLabelId),this.dQa=dc.AppliedPolicyLabelId,this.wPb())};this.kWd=()=>{let dc=!0;if(!this.$.fa.WW)for(const Vc of this.$.fa.ko)if(!Vc.SupportsClientIsMipTrusted){dc=!1;break}A.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${dc}`);
return dc};this.Qog=()=>{A.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.v3c=!0;this.wPb()};this.Kug=(dc,Vc)=>{$c.TaskExtensions.tb(de.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?Object(dd.d)(u.a.resolve(m.AriaLiveNotifierService,{xa:0})):xd.GetServiceTaskFactory.Ne(this.$.ra,211,212,0),yd=>{yd.result.gLa(Vc.R3k,Fc.a.fDa)},this.$.Aa,3)};this.$=Rc;this.us=yb;this.Wha=kd;this.ea=Xb;this.us.Pod(this.xZc);
this.C3=Oc}initialize(){this.ea.ka("SupportsPolicies")?(this.dQa=this.ea.Qa("AppliedPolicyId"),this.C3.wi(),this.$.ra.Vc(29,yb=>{this.statusBarManager=yb;yb.FJ(this)}),this.Yp(),se.a.Zg(this.ea.Qa("HostUserId"))||this.Rbk(),this.C3.tnk(this.xOh),this.C3.lok(this.Ilj),this.us.onk(this.kWd),this.SK=!0):Ia.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!se.a.Zg(this.ea.Qa("HostUserId"))&&de.EwaSettings.Ra(158)&&this.$.fa.Kh.get(45)&&(A.ULS.sendTraceTag(537154524,
306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.sPi());this.C3.LGh(this.Kug)}Js(yb){this.addHandler("LabelInfoChangedKey",yb)}vs(yb){this.removeHandler("LabelInfoChangedKey",yb)}Wj(){return!0}vq(yb,Oc){if("QueryPolicyLabel"!==yb)return!1;if(this.Yma())return Oc.Visible=!1,!0;!se.a.Zg(Oc.LabelText)&&xb.a.oj(this.$)&&window.setTimeout(()=>{appChrome.api.dispatch(appChrome.actions.setControlCustomTooltip(ub.a.Epc,Oc.Alt))},0);Oc.Visible=!0;return 32===k.AFrameworkApplication.Kb.pe(h.a.aLa,
2,Oc)}dispose(){de.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableDynamicWatermarkingPublicPreview",!1)?this.$.fa.$b.inEmbedView||this.$.isMobileMode||this.$.ta.IsVersionHistorySession?(this.$.fa.Av(this.Hj),this.us.Xsk(this.rng)):this.Xpf():this.Xpf();super.dispose()}Xpf(){this.statusBarManager&&(this.statusBarManager.OI(this),this.statusBarManager=null);this.C3.X9b();this.Bsd=!1;this.us.Suk(this.DXg);this.us.Tuk(this.Lsg);this.$.fa.Bv(this.cua);if(this.ea.ka("SupportsOfficeClientCoauthoring")){const yb=
this.$.ra.Tb(292);yb&&yb.xtk(this.Qog)}this.us.Grk(this.K2e);this.us.yuk(this.hGg);this.us.Htk(this.Hdg);this.us.bvk(this.t5g);this.us.Vsk(this.Esf);this.C3.pvk(this.Kug);this.Rha&&(this.Rha.dispose(),this.Rha=null)}get title(){return this.Gs}get aRc(){return this.nVe}get linkText(){return this.Uoa}get g1j(){return this.ZTe}get labelId(){return this.dQa}xrd(yb,Oc){if(!this.ea.ka("SupportsPolicies"))return A.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.Ice)return A.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(tb.a.Zg(yb))return!1;this.Rha||this.hTd();return this.Rha.xrd(yb,Oc)}glc(yb){return this.C3.glc(yb)}Yp(){this.raiseEvent("LabelInfoChangedKey")}sPi(){Qa.a.get_instance().Mg(10,()=>{this.us.yzc()})}Rbk(){de.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableDynamicWatermarkingPublicPreview",!1)?this.$.fa.$b.inEmbedView||this.$.isMobileMode||
this.$.ta.IsVersionHistorySession?(this.$.fa.Nr(this.Hj),this.us.n4e(this.rng)):this.WEg():this.WEg()}WEg(){const yb=de.EwaSettings.KN()?8:void 0;Qa.a.get_instance().Mg(10,()=>{this.us.MCa(this.b3c);this.us.n4e(this.qng);this.us.bEh(this.qng);this.us.SFb(this.DXg);this.us.cpd(this.Lsg);this.$.fa.au(this.cua);this.us.cod(this.K2e);this.us.Vod(this.hGg);this.us.PEh(this.Hdg);this.us.sGh(this.t5g);if(this.ea.ka("SupportsOfficeClientCoauthoring")){const Oc=this.$.ra.Tb(292);Oc&&Oc.EEh(this.Qog)}A.ULS.sendTraceTag(537154521,
306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler");this.us.$Dh(this.Esf);this.Rdf()},yb)}Rdf(){this.us.p3f()?this.us.Hck():(this.Kzi(),this.$.Hpe("sensitivity",!0))}rzh(){this.$.kY(yb=>{void yb.O1(1).then(()=>{const Oc=this.$.vPd();Oc&&this.C3.glc([Oc])})})}Kzi(){this.ea.ka("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.wPb():this.KJi(this.$.ta.DocumentHostInfo.TenantId)}hTd(){this.Rha=new Bb(this.C3,this.us,this.$,
this.ea,this.Wha)}qnk(){if(!this.ea.ka("SupportsPolicies"))return A.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.Rha||this.hTd();return this.Rha.Iea(1)}yrd(yb,Oc){if(!this.ea.ka("SupportsPolicies"))return A.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,glb:!1};if(!this.Ice)return A.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),
{returnValue:!1,glb:!0};this.Rha||this.hTd();return this.Rha.yrd(yb,Oc)}KJi(yb){A.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${yb.length}`);const Oc=this.$.ma.sa.mc();ld.c(this.$.ma.sa,yb,kd=>{this.J1k(kd)},null,null,null,Oc)}J1k(yb){A.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");yb&&!Ed.a(yb)&&(this.dQa=yb.Result);this.wPb();this.labelId?A.ULS.sendTraceTag(537154512,
306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):A.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}wPb(){this.us.Aib(this.labelId,void 0,void 0,!1)}VZh(){xb.a.CN()&&de.EwaSettings.isChangeGateEnabled("OfficeVSO:8386937_NoCopilotTaskPaneWhenNoExtractPermissions")&&(!k.AFrameworkApplication.protectedFile&&!k.AFrameworkApplication.fma||k.AFrameworkApplication.enableExtractForProtectedFile||this.$.Dc(762629271,-1,0,null))}Bzf(){if(!this.Bsd){this.$.Sg();
this.Bsd=!0;this.Wha.HRf();const yb={};yb.hasLabel=!!this.labelId&&0<this.labelId.length;yb.isProtectedFile=this.ea.ka("ProtectedFile");yb.SupportsPolicies=this.ea.ka("SupportsPolicies");yb.AreLabelsAvailableForDisplay=this.us.Vaa();yb.SupportsOfficeClientCoauthoring=this.ea.ka("SupportsOfficeClientCoauthoring");yb.IsAnonymousUser=this.ea.ka("IsAnonymousUser");A.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(yb)}`)}}gKh(){this.C3.hKh(this.wJa);this.wJa=null}kbj(yb){for(const Oc of yb.LabelActions)if(se.a.equals(Oc.Name,
"ApplyWatermark",!1))return!0;return!1}nUk(yb){yb?(new Vd(this.$)).Om():A.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(yb,Oc,kd,Rc){const Xb=Cc.c(this.us.Zj);if(void 0===yb||null===yb)yb="";const dc=new fe;dc.$Qc=yb;dc.zPg=Rc;dc.cT=Oc;const Vc=this.$.ma.sa;ec.a(this.$.userOperationManager,(yd,Pd,re)=>ld.a(Vc,Xb,yb,this.$.ta.DocumentHostInfo.TenantId,Oc,kd,Fe.c.call(null,
this.eTj,yd),null,re,dc),yd=>new Db.a(222,0,yd),null);this.v3c=!1;this.joe=null}Yma(){const yb=u.a.Cb(m.PasteShortcutManagerService);return this.SK&&yb?yb.SK():!1}}Object(f.a)(Ic,"PolicyManagerWrapper",Ud.a,[360,217,702]);class bd extends jc.a{constructor(yb){super();this.$=yb;this.ri()}create(){const yb=Object(dd.d)(u.a.resolve(m.BusinessBarManagerService,{xa:this.Cc})),Oc=k.AFrameworkApplication.od,kd=k.AFrameworkApplication.ea,Rc=m.CoauthManagerService.Oa()?Object(dd.d)(u.a.resolve(m.CoauthManagerService)):
n.Task.Va(null);$c.TaskExtensions.tb($c.TaskExtensions.jl([yb,Rc],this.Aa),()=>{try{let Xb,dc,Vc=void 0;const yd=this.$.iUb;yd&&(Vc=this.$.vPd());de.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1)?(Dd.a.instance.register(680,"Common.App.Policy.Contracts.IPolicyManager").Lc().Qc(()=>new ja(kd,Oc,k.AFrameworkApplication.ua.KE,this.$.ta.MaxGetPolicyRetries,Object(t.d)(M.a))),Xb=Object(t.e)(E.a),Dd.a.instance.register(mb,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").Lc().Qc(()=>
new mb(k.AFrameworkApplication.Kb,k.AFrameworkApplication.ua,k.AFrameworkApplication.ea,Xb,yd&&Vc?[Vc]:null)),dc=Object(t.e)(uc)):(Xb=new Hc.a(()=>new ja(kd,Oc,k.AFrameworkApplication.ua.KE,this.$.ta.MaxGetPolicyRetries,Object(t.d)(M.a))),dc=new Hc.a(()=>new mb(k.AFrameworkApplication.Kb,k.AFrameworkApplication.ua,k.AFrameworkApplication.ea,Xb,yd&&Vc?[Vc]:null)));let Pd=this.$.ra.Tb(274);Pd||(Pd=new Ic(Xb.value,dc.value,yb.result,this.$,k.AFrameworkApplication.ea),this.$.ra.zc(274,Pd),Pd.initialize());
this.Uf(Pd)}catch(Xb){throw A.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Xb.toString()}]`),Xb;}},this.Aa,3)}static Ea(yb){yb.ra.zc(275,new bd(yb))}}Object(f.a)(bd,"PolicyManagerFactory",jc.a,[]);Type.registerNamespace("Common.App.Policy");Ub.main();(()=>{Zb.a.wb(yb=>{bd.Ea(yb)})})();String(c);window.___1717508060501_closurehack=c}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.policy.js.map/69d0c45907f678b8f0e870bdaa5fc2c2/EwaTS.policy.js.map